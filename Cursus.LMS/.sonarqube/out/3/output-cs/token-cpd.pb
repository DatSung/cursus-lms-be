¸]
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\TransactionService.cs
	namespace

 	
Cursus


 
.

 
LMS

 
.

 
Service

 
.

 
Service

 $
;

$ %
public 
class 
TransactionService 
:  !
ITransactionService" 5
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

TransactionService 
( 
IUnitOfWork )

unitOfWork* 4
,4 5
IMapper6 =
mapper> D
)D E
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetTransactions# 2
(2 3
ClaimsPrincipal 
User 
, 
string 
? 
userId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int 
pageSize 
= 
$num 
)   
{!! 
try"" 
{## 	
if$$ 
($$ 
userId$$ 
.$$ 
IsNullOrEmpty$$ $
($$$ %
)$$% &
)$$& '
{%% 
userId&& 
=&& 
User&& 
.&& 
Claims&& $
.&&$ %
FirstOrDefault&&% 3
(&&3 4
x&&4 5
=>&&6 8
x&&9 :
.&&: ;
Type&&; ?
==&&@ B

ClaimTypes&&C M
.&&M N
NameIdentifier&&N \
)&&\ ]
?&&] ^
.&&^ _
Value&&_ d
;&&d e
}'' 
var)) 
transactions)) 
=)) 
await)) $
_unitOfWork))% 0
.))0 1!
TransactionRepository))1 F
.))F G
GetAllAsync))G R
())R S
x))S T
=>))U W
x))X Y
.))Y Z
UserId))Z `
==))a c
userId))d j
)))j k
;))k l
if,, 
(,, 
!,, 
string,, 
.,, 
IsNullOrEmpty,, %
(,,% &
filterOn,,& .
),,. /
&&,,0 2
!,,3 4
string,,4 :
.,,: ;
IsNullOrEmpty,,; H
(,,H I
filterQuery,,I T
),,T U
),,U V
{-- 
switch.. 
(.. 
filterOn..  
...  !
Trim..! %
(..% &
)..& '
...' (
ToLower..( /
(../ 0
)..0 1
)..1 2
{// 
case00 
$str00 
:00  
{11 
transactions22 $
=22% &
transactions22' 3
.223 4
Where224 9
(33 
x44 
=>44  
x44! "
.44" #
Type44# '
.44' (
ToString44( 0
(440 1
)441 2
.442 3
Contains443 ;
(44; <
filterQuery44< G
,44G H
StringComparison44I Y
.44Y Z$
CurrentCultureIgnoreCase44Z r
)44r s
)44s t
;44t u
break55 
;55 
}66 
case77 
$str77 !
:77! "
{88 
transactions99 $
=99% &
transactions99' 3
.993 4
Where994 9
(:: 
x;; 
=>;;  
x;;! "
.;;" #
Amount;;# )
.;;) *
ToString;;* 2
(;;2 3
CultureInfo;;3 >
.;;> ?
InvariantCulture;;? O
);;O P
.;;P Q
Contains;;Q Y
(;;Y Z
filterQuery;;Z e
,;;e f
StringComparison<<  0
.<<0 1$
CurrentCultureIgnoreCase<<1 I
)<<I J
)<<J K
;<<K L
break== 
;== 
}>> 
default?? 
:?? 
{@@ 
breakAA 
;AA 
}BB 
}CC 
}DD 
ifFF 
(FF 
!FF 
stringFF 
.FF 
IsNullOrEmptyFF %
(FF% &
sortByFF& ,
)FF, -
)FF- .
{GG 
switchHH 
(HH 
sortByHH 
.HH 
TrimHH #
(HH# $
)HH$ %
.HH% &
ToLowerHH& -
(HH- .
)HH. /
)HH/ 0
{II 
caseJJ 
$strJJ 
:JJ  
{KK 
transactionsLL $
=LL% &
isAscendingLL' 2
==LL3 5
trueLL6 :
?MM 
[MM 
..MM !
transactionsMM" .
.MM. /
OrderByMM/ 6
(MM6 7
xMM7 8
=>MM9 ;
xMM< =
.MM= >
TypeMM> B
)MMB C
]MMC D
:NN 
[NN 
..NN !
transactionsNN" .
.NN. /
OrderByDescendingNN/ @
(NN@ A
xNNA B
=>NNC E
xNNF G
.NNG H
TypeNNH L
)NNL M
]NNM N
;NNN O
breakOO 
;OO 
}PP 
caseQQ 
$strQQ !
:QQ! "
{RR 
transactionsSS $
=SS% &
isAscendingSS' 2
==SS3 5
trueSS6 :
?TT 
[TT 
..TT !
transactionsTT" .
.TT. /
OrderByTT/ 6
(TT6 7
xTT7 8
=>TT9 ;
xTT< =
.TT= >
AmountTT> D
)TTD E
]TTE F
:UU 
[UU 
..UU !
transactionsUU" .
.UU. /
OrderByDescendingUU/ @
(UU@ A
xUUA B
=>UUC E
xUUF G
.UUG H
AmountUUH N
)UUN O
]UUO P
;UUP Q
breakVV 
;VV 
}WW 
caseXX 
$strXX 
:XX  
{YY 
transactionsZZ $
=ZZ% &
isAscendingZZ' 2
==ZZ3 5
trueZZ6 :
?[[ 
[[[ 
..[[ !
transactions[[" .
.[[. /
OrderBy[[/ 6
([[6 7
x[[7 8
=>[[9 ;
x[[< =
.[[= >
CreatedTime[[> I
)[[I J
][[J K
:\\ 
[\\ 
..\\ !
transactions\\" .
.\\. /
OrderByDescending\\/ @
(\\@ A
x\\A B
=>\\C E
x\\F G
.\\G H
CreatedTime\\H S
)\\S T
]\\T U
;\\U V
break]] 
;]] 
}^^ 
default__ 
:__ 
{`` 
breakaa 
;aa 
}bb 
}cc 
}dd 
ifgg 
(gg 

pageNumbergg 
>gg 
$numgg 
&&gg !
pageSizegg" *
>gg+ ,
$numgg- .
)gg. /
{hh 
varii 

skipResultii 
=ii  
(ii! "

pageNumberii" ,
-ii- .
$numii/ 0
)ii0 1
*ii2 3
pageSizeii4 <
;ii< =
transactionsjj 
=jj 
transactionsjj +
.jj+ ,
Skipjj, 0
(jj0 1

skipResultjj1 ;
)jj; <
.jj< =
Takejj= A
(jjA B
pageSizejjB J
)jjJ K
.jjK L
ToListjjL R
(jjR S
)jjS T
;jjT U
}kk 
varmm 
transactionsDtomm 
=mm  !
_mappermm" )
.mm) *
Mapmm* -
<mm- .
IEnumerablemm. 9
<mm9 :
GetTransactionDTOmm: K
>mmK L
>mmL M
(mmM N
transactionsmmN Z
)mmZ [
;mm[ \
returnoo 
newoo 
ResponseDTOoo "
(oo" #
)oo# $
{pp 
	IsSuccessqq 
=qq 
trueqq  
,qq  !
Messagerr 
=rr 
$strrr 9
,rr9 :

StatusCodess 
=ss 
$numss  
,ss  !
Resulttt 
=tt 
transactionsDtott (
}uu 
;uu 
}vv 	
catchww 
(ww 
	Exceptionww 
eww 
)ww 
{xx 	
returnyy 
newyy 
ResponseDTOyy "
(yy" #
)yy# $
{zz 
	IsSuccess{{ 
={{ 
false{{ !
,{{! "
Message|| 
=|| 
e|| 
.|| 
Message|| #
,||# $
Result}} 
=}} 
null}} 
,}} 

StatusCode~~ 
=~~ 
$num~~  
} 
; 
}
ÄÄ 	
}
ÅÅ 
public
ÉÉ 

async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
ResponseDTO
ÉÉ !
>
ÉÉ! "
CreateTransaction
ÉÉ# 4
(
ÉÉ4 5"
CreateTransactionDTO
ÉÉ5 I"
createTransactionDto
ÉÉJ ^
)
ÉÉ^ _
{
ÑÑ 
try
ÖÖ 
{
ÜÜ 	
var
áá 
transaction
áá 
=
áá 
new
áá !
Transaction
áá" -
(
áá- .
)
áá. /
{
àà 
Id
ââ 
=
ââ 
Guid
ââ 
.
ââ 
NewGuid
ââ !
(
ââ! "
)
ââ" #
,
ââ# $
Amount
ää 
=
ää "
createTransactionDto
ää -
.
ää- .
Amount
ää. 4
,
ää4 5
Currency
ãã 
=
ãã 
$str
ãã  
,
ãã  !
UserId
åå 
=
åå "
createTransactionDto
åå -
.
åå- .
UserId
åå. 4
,
åå4 5
CreatedTime
çç 
=
çç 
DateTime
çç &
.
çç& '
UtcNow
çç' -
,
çç- .
Type
éé 
=
éé "
createTransactionDto
éé +
.
éé+ ,
Type
éé, 0
}
èè 
;
èè 
await
ëë 
_unitOfWork
ëë 
.
ëë #
TransactionRepository
ëë 3
.
ëë3 4
AddAsync
ëë4 <
(
ëë< =
transaction
ëë= H
)
ëëH I
;
ëëI J
await
íí 
_unitOfWork
íí 
.
íí 
	SaveAsync
íí '
(
íí' (
)
íí( )
;
íí) *
return
îî 
new
îî 
ResponseDTO
îî "
(
îî" #
)
îî# $
{
ïï 
	IsSuccess
ññ 
=
ññ 
true
ññ  
,
ññ  !
Message
óó 
=
óó 
$str
óó ;
,
óó; <
Result
òò 
=
òò 
transaction
òò $
,
òò$ %

StatusCode
ôô 
=
ôô 
$num
ôô  
}
öö 
;
öö 
}
õõ 	
catch
úú 
(
úú 
	Exception
úú 
e
úú 
)
úú 
{
ùù 	
return
ûû 
new
ûû 
ResponseDTO
ûû "
(
ûû" #
)
ûû# $
{
üü 
	IsSuccess
†† 
=
†† 
false
†† !
,
††! "
Message
°° 
=
°° 
e
°° 
.
°° 
Message
°° #
,
°°# $
Result
¢¢ 
=
¢¢ 
null
¢¢ 
,
¢¢ 

StatusCode
££ 
=
££ 
$num
££  
}
§§ 
;
§§ 
}
•• 	
}
¶¶ 
}ßß ≤Y
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\TokenService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
TokenService 
: 
ITokenService )
{ 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
IRedisService "
_redisService# 0
;0 1
public 

TokenService 
( 
UserManager #
<# $
ApplicationUser$ 3
>3 4
userManager5 @
,@ A
IConfigurationB P
configurationQ ^
,^ _
IRedisService 
redisService "
)" #
{ 
_userManager 
= 
userManager "
;" #
_configuration 
= 
configuration &
;& '
_redisService 
= 
redisService $
;$ %
} 
public 

async 
Task 
< 
string 
> '
GenerateJwtAccessTokenAsync 9
(9 :
ApplicationUser: I
userJ N
)N O
{ 
var 
	userRoles 
= 
await 
_userManager *
.* +
GetRolesAsync+ 8
(8 9
user9 =
)= >
;> ?
var 

authClaims 
= 
new 
List !
<! "
Claim" '
>' (
(( )
)) *
{   	
new!! 
Claim!! 
(!! 

ClaimTypes!!  
.!!  !
Name!!! %
,!!% &
user!!' +
.!!+ ,
UserName!!, 4
)!!4 5
,!!5 6
new"" 
Claim"" 
("" 

ClaimTypes""  
.""  !
NameIdentifier""! /
,""/ 0
user""1 5
.""5 6
Id""6 8
)""8 9
,""9 :
}## 	
;##	 

foreach%% 
(%% 
var%% 
role%% 
in%% 
	userRoles%% &
)%%& '
{&& 	

authClaims'' 
.'' 
Add'' 
('' 
new'' 
Claim'' $
(''$ %

ClaimTypes''% /
.''/ 0
Role''0 4
,''4 5
role''6 :
)'': ;
)''; <
;''< =
}(( 	
var++ 

authSecret++ 
=++ 
new++  
SymmetricSecurityKey++ 1
(++1 2
Encoding++2 :
.++: ;
UTF8++; ?
.++? @
GetBytes++@ H
(++H I
_configuration++I W
[++W X
$str++X d
]++d e
)++e f
)++f g
;++g h
var,, 
signingCredentials,, 
=,,  
new,,! $
SigningCredentials,,% 7
(,,7 8

authSecret,,8 B
,,,B C
SecurityAlgorithms,,D V
.,,V W

HmacSha256,,W a
),,a b
;,,b c
var.. 
tokenObject.. 
=.. 
new.. 
JwtSecurityToken.. .
(... /
issuer// 
:// 
_configuration// "
[//" #
$str//# 4
]//4 5
,//5 6
audience00 
:00 
_configuration00 $
[00$ %
$str00% 8
]008 9
,009 :
	notBefore11 
:11 
DateTime11 
.11  
Now11  #
,11# $
expires22 
:22 
DateTime22 
.22 
Now22 !
.22! "

AddMinutes22" ,
(22, -
$num22- /
)22/ 0
,220 1
claims33 
:33 

authClaims33 
,33 
signingCredentials44 
:44 
signingCredentials44  2
)55 	
;55	 

var77 
accessToken77 
=77 
new77 #
JwtSecurityTokenHandler77 5
(775 6
)776 7
.777 8

WriteToken778 B
(77B C
tokenObject77C N
)77N O
;77O P
return99 
accessToken99 
;99 
}:: 
public@@ 

async@@ 
Task@@ 
<@@ 
string@@ 
>@@ (
GenerateJwtRefreshTokenAsync@@ :
(@@: ;
ApplicationUser@@; J
user@@K O
)@@O P
{AA 
varBB 

authClaimsBB 
=BB 
newBB 
ListBB !
<BB! "
ClaimBB" '
>BB' (
(BB( )
)BB) *
{CC 	
newDD 
ClaimDD 
(DD 

ClaimTypesDD  
.DD  !
NameIdentifierDD! /
,DD/ 0
userDD1 5
.DD5 6
IdDD6 8
)DD8 9
,DD9 :
}EE 	
;EE	 

varHH 

authSecretHH 
=HH 
newHH  
SymmetricSecurityKeyHH 1
(HH1 2
EncodingHH2 :
.HH: ;
UTF8HH; ?
.HH? @
GetBytesHH@ H
(HHH I
_configurationHHI W
[HHW X
$strHHX d
]HHd e
)HHe f
)HHf g
;HHg h
varII 
signingCredentialsII 
=II  
newII! $
SigningCredentialsII% 7
(II7 8

authSecretII8 B
,IIB C
SecurityAlgorithmsIID V
.IIV W

HmacSha256IIW a
)IIa b
;IIb c
varKK 
tokenObjectKK 
=KK 
newKK 
JwtSecurityTokenKK .
(KK. /
issuerLL 
:LL 
_configurationLL "
[LL" #
$strLL# 4
]LL4 5
,LL5 6
audienceMM 
:MM 
_configurationMM $
[MM$ %
$strMM% 8
]MM8 9
,MM9 :
	notBeforeNN 
:NN 
DateTimeNN 
.NN  
NowNN  #
,NN# $
expiresOO 
:OO 
DateTimeOO 
.OO 
NowOO !
.OO! "
AddDaysOO" )
(OO) *
$numOO* +
)OO+ ,
,OO, -
claimsPP 
:PP 

authClaimsPP 
,PP 
signingCredentialsQQ 
:QQ 
signingCredentialsQQ  2
)RR 	
;RR	 

varTT 
refreshTokenTT 
=TT 
newTT #
JwtSecurityTokenHandlerTT 6
(TT6 7
)TT7 8
.TT8 9

WriteTokenTT9 C
(TTC D
tokenObjectTTD O
)TTO P
;TTP Q
returnVV 
refreshTokenVV 
;VV 
}WW 
publicYY 

asyncYY 
TaskYY 
<YY 
ClaimsPrincipalYY %
>YY% &!
GetPrincipalFromTokenYY' <
(YY< =
stringYY= C
tokenYYD I
)YYI J
{ZZ 
var[[ 
tokenHandler[[ 
=[[ 
new[[ #
JwtSecurityTokenHandler[[ 6
([[6 7
)[[7 8
;[[8 9
var\\ 
key\\ 
=\\ 
Encoding\\ 
.\\ 
UTF8\\ 
.\\  
GetBytes\\  (
(\\( )
_configuration\\) 7
[\\7 8
$str\\8 D
]\\D E
)\\E F
;\\F G
try^^ 
{__ 	
var`` 
	principal`` 
=`` 
tokenHandler`` (
.``( )
ValidateToken``) 6
(``6 7
token``7 <
,``< =
new``> A%
TokenValidationParameters``B [
{aa 
ValidateIssuerbb 
=bb  
truebb! %
,bb% &
ValidateAudiencecc  
=cc! "
truecc# '
,cc' (
ValidateLifetimedd  
=dd! "
truedd# '
,dd' ($
ValidateIssuerSigningKeyee (
=ee) *
trueee+ /
,ee/ 0
ValidIssuerff 
=ff 
_configurationff ,
[ff, -
$strff- >
]ff> ?
,ff? @
ValidAudiencegg 
=gg 
_configurationgg  .
[gg. /
$strgg/ B
]ggB C
,ggC D
IssuerSigningKeyhh  
=hh! "
newhh# & 
SymmetricSecurityKeyhh' ;
(hh; <
keyhh< ?
)hh? @
}ii 
,ii 
outii 
SecurityTokenii  
validatedTokenii! /
)ii/ 0
;ii0 1
returnjj 
	principaljj 
;jj 
}kk 	
catchll 
{mm 	
returnoo 
nulloo 
;oo 
}pp 	
}qq 
publicyy 

asyncyy 
Taskyy 
<yy 
boolyy 
>yy 
StoreRefreshTokenyy -
(yy- .
stringyy. 4
userIdyy5 ;
,yy; <
stringyy= C
refreshTokenyyD P
)yyP Q
{zz 
string{{ 
redisKey{{ 
={{ 
$"{{ 
$str{{ #
{{{# $
userId{{$ *
}{{* +
$str{{+ 8
"{{8 9
;{{9 :
var|| 
result|| 
=|| 
await|| 
_redisService|| (
.||( )
StoreString||) 4
(||4 5
redisKey||5 =
,||= >
refreshToken||? K
)||K L
;||L M
return}} 
result}} 
;}} 
}~~ 
public
ÖÖ 

async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
string
ÖÖ 
>
ÖÖ "
RetrieveRefreshToken
ÖÖ 2
(
ÖÖ2 3
string
ÖÖ3 9
userId
ÖÖ: @
)
ÖÖ@ A
{
ÜÜ 
string
áá 
redisKey
áá 
=
áá 
$"
áá 
$str
áá #
{
áá# $
userId
áá$ *
}
áá* +
$str
áá+ 8
"
áá8 9
;
áá9 :
var
àà 
result
àà 
=
àà 
await
àà 
_redisService
àà (
.
àà( )
RetrieveString
àà) 7
(
àà7 8
redisKey
àà8 @
)
àà@ A
;
ààA B
return
ââ 
result
ââ 
;
ââ 
}
ää 
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
bool
ëë 
>
ëë  
DeleteRefreshToken
ëë .
(
ëë. /
string
ëë/ 5
userId
ëë6 <
)
ëë< =
{
íí 
string
ìì 
redisKey
ìì 
=
ìì 
$"
ìì 
$str
ìì #
{
ìì# $
userId
ìì$ *
}
ìì* +
$str
ìì+ 8
"
ìì8 9
;
ìì9 :
var
îî 
result
îî 
=
îî 
await
îî 
_redisService
îî (
.
îî( )
DeleteString
îî) 5
(
îî5 6
redisKey
îî6 >
)
îî> ?
;
îî? @
return
ïï 
result
ïï 
;
ïï 
}
ññ 
}óó ë∫
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\StudentService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
{ 
public 

class 
StudentService 
:  !
IStudentsService" 2
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IClosedXMLService *
_closedXmlService+ <
;< =
private 
readonly 
IHubContext $
<$ %
NotificationHub% 4
>4 5
_notificationHub6 F
;F G
private 
readonly 
IWebHostEnvironment ,
_env- 1
;1 2
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 
StudentService 
( 
IUnitOfWork )

unitOfWork* 4
,4 5
IMapper6 =
mapper> D
,D E
IClosedXMLService 
closedXmlService .
,. /
IHubContext0 ;
<; <
NotificationHub< K
>K L
notificationHubM \
,\ ]
IWebHostEnvironment 
env  #
,# $
IConfiguration% 3
config4 :
): ;
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
_mapper 
= 
mapper 
; 
_closedXmlService 
= 
closedXmlService  0
;0 1
_notificationHub 
= 
notificationHub .
;. /
_env   
=   
env   
;   
_config!! 
=!! 
config!! 
;!! 
}"" 	
public%% 
async%% 
Task%% 
<%% 
ResponseDTO%% %
>%%% &
GetAllStudent%%' 4
(&& 	
ClaimsPrincipal'' 
User''  
,''  !
string(( 
?(( 
filterOn(( 
,(( 
string)) 
?)) 
filterQuery)) 
,))  
string** 
?** 
sortBy** 
,** 
bool++ 
?++ 
isAscending++ 
,++ 
int,, 

pageNumber,, 
,,, 
int-- 
pageSize-- 
).. 	
{// 	
try22 
{33 
List44 
<44 
Student44 
>44 
students44 &
=44' (
new44) ,
List44- 1
<441 2
Student442 9
>449 :
(44: ;
)44; <
;44< =
if77 
(77 
!77 
string77 
.77 
IsNullOrEmpty77 )
(77) *
filterOn77* 2
)772 3
&&774 6
!777 8
string778 >
.77> ?
IsNullOrEmpty77? L
(77L M
filterQuery77M X
)77X Y
)77Y Z
{88 
switch99 
(99 
filterOn99 $
.99$ %
Trim99% )
(99) *
)99* +
.99+ ,
ToLower99, 3
(993 4
)994 5
)995 6
{:: 
case;; 
$str;; #
:;;# $
{<< 
students==  (
===) *
_unitOfWork==+ 6
.==6 7
StudentRepository==7 H
.==H I
GetAllAsync==I T
(==T U
includeProperties==U f
:==f g
$str==h y
)==y z
.>>$ %

GetAwaiter>>% /
(>>/ 0
)>>0 1
.>>1 2
	GetResult>>2 ;
(>>; <
)>>< =
.>>= >
Where>>> C
(>>C D
x>>D E
=>>>F H
x??( )
.??) *
ApplicationUser??* 9
.??9 :
FullName??: B
.??B C
Contains??C K
(??K L
filterQuery??L W
,??W X
StringComparison@@, <
.@@< =$
CurrentCultureIgnoreCase@@= U
)@@U V
)@@V W
.@@W X
ToList@@X ^
(@@^ _
)@@_ `
;@@` a
breakAA  %
;AA% &
}BB 
caseCC 
$strCC $
:CC$ %
{DD 
studentsEE  (
=EE) *
_unitOfWorkEE+ 6
.EE6 7
StudentRepositoryEE7 H
.EEH I
GetAllAsyncEEI T
(EET U
includePropertiesEEU f
:EEf g
$strEEh y
)EEy z
.FF$ %

GetAwaiterFF% /
(FF/ 0
)FF0 1
.FF1 2
	GetResultFF2 ;
(FF; <
)FF< =
.FF= >
WhereFF> C
(FFC D
xFFD E
=>FFF H
xGG( )
.GG) *
ApplicationUserGG* 9
.GG9 :
EmailGG: ?
.GG? @
ContainsGG@ H
(GGH I
filterQueryGGI T
,GGT U
StringComparisonHH, <
.HH< =$
CurrentCultureIgnoreCaseHH= U
)HHU V
)HHV W
.HHW X
ToListHHX ^
(HH^ _
)HH_ `
;HH` a
breakII  %
;II% &
}JJ 
defaultKK 
:KK  
{LL 
studentsMM  (
=MM) *
_unitOfWorkMM+ 6
.MM6 7
StudentRepositoryMM7 H
.MMH I
GetAllAsyncMMI T
(MMT U
includePropertiesMMU f
:MMf g
$strMMh y
)MMy z
.NN$ %

GetAwaiterNN% /
(NN/ 0
)NN0 1
.NN1 2
	GetResultNN2 ;
(NN; <
)NN< =
.NN= >
ToListNN> D
(NND E
)NNE F
;NNF G
breakOO  %
;OO% &
}PP 
}QQ 
}RR 
elseSS 
{TT 
studentsUU 
=UU 
_unitOfWorkUU *
.UU* +
StudentRepositoryUU+ <
.UU< =
GetAllAsyncUU= H
(UUH I
includePropertiesUUI Z
:UUZ [
$strUU\ m
)UUm n
.VV 

GetAwaiterVV #
(VV# $
)VV$ %
.VV% &
	GetResultVV& /
(VV/ 0
)VV0 1
.VV1 2
ToListVV2 8
(VV8 9
)VV9 :
;VV: ;
}WW 
ifZZ 
(ZZ 
!ZZ 
stringZZ 
.ZZ 
IsNullOrEmptyZZ )
(ZZ) *
sortByZZ* 0
)ZZ0 1
)ZZ1 2
{[[ 
switch\\ 
(\\ 
sortBy\\ "
.\\" #
Trim\\# '
(\\' (
)\\( )
.\\) *
ToLower\\* 1
(\\1 2
)\\2 3
)\\3 4
{]] 
case^^ 
$str^^ #
:^^# $
{__ 
students``  (
=``) *
isAscending``+ 6
==``7 9
true``: >
?aa$ %
[aa& '
..aa' )
studentsaa* 2
.aa2 3
OrderByaa3 :
(aa: ;
xaa; <
=>aa= ?
xaa@ A
.aaA B
ApplicationUseraaB Q
.aaQ R
FullNameaaR Z
)aaZ [
]aa[ \
:bb$ %
[bb& '
..bb' )
studentsbb* 2
.bb2 3
OrderByDescendingbb3 D
(bbD E
xbbE F
=>bbG I
xbbJ K
.bbK L
ApplicationUserbbL [
.bb[ \
FullNamebb\ d
)bbd e
]bbe f
;bbf g
breakcc  %
;cc% &
}dd 
caseee 
$stree $
:ee$ %
{ff 
studentsgg  (
=gg) *
isAscendinggg+ 6
==gg7 9
truegg: >
?hh$ %
[hh& '
..hh' )
studentshh* 2
.hh2 3
OrderByhh3 :
(hh: ;
xhh; <
=>hh= ?
xhh@ A
.hhA B
ApplicationUserhhB Q
.hhQ R
EmailhhR W
)hhW X
]hhX Y
:ii$ %
[ii& '
..ii' )
studentsii* 2
.ii2 3
OrderByDescendingii3 D
(iiD E
xiiE F
=>iiG I
xiiJ K
.iiK L
ApplicationUseriiL [
.ii[ \
Emailii\ a
)iia b
]iib c
;iic d
breakjj  %
;jj% &
}kk 
defaultll 
:ll  
{mm 
breaknn  %
;nn% &
}oo 
}pp 
}qq 
iftt 
(tt 

pageNumbertt 
>tt  
$numtt! "
&&tt# %
pageSizett& .
>tt/ 0
$numtt1 2
)tt2 3
{uu 
varvv 

skipResultvv "
=vv# $
(vv% &

pageNumbervv& 0
-vv1 2
$numvv3 4
)vv4 5
*vv6 7
pageSizevv8 @
;vv@ A
studentsww 
=ww 
studentsww '
.ww' (
Skipww( ,
(ww, -

skipResultww- 7
)ww7 8
.ww8 9
Takeww9 =
(ww= >
pageSizeww> F
)wwF G
.wwG H
ToListwwH N
(wwN O
)wwO P
;wwP Q
}xx 
if|| 
(|| 
students|| 
==|| 
null||  $
||||% '
!||( )
students||) 1
.||1 2
Any||2 5
(||5 6
)||6 7
)||7 8
{}} 
return~~ 
new~~ 
ResponseDTO~~ *
(~~* +
)~~+ ,
{ 
Message
ÄÄ 
=
ÄÄ  !
$str
ÄÄ" 9
,
ÄÄ9 :
Result
ÅÅ 
=
ÅÅ  
null
ÅÅ! %
,
ÅÅ% &
	IsSuccess
ÇÇ !
=
ÇÇ" #
false
ÇÇ$ )
,
ÇÇ) *

StatusCode
ÉÉ "
=
ÉÉ# $
$num
ÉÉ% (
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 
var
áá  
studentInfoDtoList
áá &
=
áá' (
new
áá) ,
List
áá- 1
<
áá1 2
StudentInfoDTO
áá2 @
>
áá@ A
(
ááA B
)
ááB C
;
ááC D
foreach
ââ 
(
ââ 
var
ââ 
student
ââ $
in
ââ% '
students
ââ( 0
)
ââ0 1
{
ää 
var
ãã 
studentInfoDto
ãã &
=
ãã' (
new
ãã) ,
StudentInfoDTO
ãã- ;
{
åå 
	StudentId
çç !
=
çç" #
student
çç$ +
.
çç+ ,
	StudentId
çç, 5
,
çç5 6
FullName
éé  
=
éé! "
student
éé# *
.
éé* +
ApplicationUser
éé+ :
?
éé: ;
.
éé; <
FullName
éé< D
,
ééD E
Email
èè 
=
èè 
student
èè  '
.
èè' (
ApplicationUser
èè( 7
?
èè7 8
.
èè8 9
Email
èè9 >
,
èè> ?
PhoneNumber
êê #
=
êê$ %
student
êê& -
.
êê- .
ApplicationUser
êê. =
?
êê= >
.
êê> ?
PhoneNumber
êê? J
,
êêJ K
}
ëë 
;
ëë  
studentInfoDtoList
ìì &
.
ìì& '
Add
ìì' *
(
ìì* +
studentInfoDto
ìì+ 9
)
ìì9 :
;
ìì: ;
}
îî 
return
ññ 
new
ññ 
ResponseDTO
ññ &
(
ññ& '
)
ññ' (
{
óó 
Message
òò 
=
òò 
$str
òò =
,
òò= >
Result
ôô 
=
ôô  
studentInfoDtoList
ôô /
,
ôô/ 0
	IsSuccess
öö 
=
öö 
true
öö  $
,
öö$ %

StatusCode
õõ 
=
õõ  
$num
õõ! $
}
úú 
;
úú 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
return
†† 
new
†† 
ResponseDTO
†† &
(
††& '
)
††' (
{
°° 
Message
¢¢ 
=
¢¢ 
e
¢¢ 
.
¢¢  
Message
¢¢  '
,
¢¢' (
Result
££ 
=
££ 
null
££ !
,
££! "
	IsSuccess
§§ 
=
§§ 
false
§§  %
,
§§% &

StatusCode
•• 
=
••  
$num
••! $
}
¶¶ 
;
¶¶ 
}
ßß 
}
®® 	
public
´´ 
async
´´ 
Task
´´ 
<
´´ 
ResponseDTO
´´ %
>
´´% &
GetById
´´' .
(
´´. /
Guid
´´/ 3
id
´´4 6
)
´´6 7
{
¨¨ 	
{
≠≠ 
try
ÆÆ 
{
ØØ 
var
∞∞ 
student
∞∞ 
=
∞∞  !
await
∞∞" '
_unitOfWork
∞∞( 3
.
∞∞3 4
StudentRepository
∞∞4 E
.
∞∞E F
GetById
∞∞F M
(
∞∞M N
id
∞∞N P
)
∞∞P Q
;
∞∞Q R
if
±± 
(
±± 
student
±± 
is
±±  "
null
±±# '
)
±±' (
{
≤≤ 
return
≥≥ 
new
≥≥ "
ResponseDTO
≥≥# .
(
≥≥. /
)
≥≥/ 0
{
¥¥ 
Message
µµ #
=
µµ$ %
$str
µµ& @
,
µµ@ A
	IsSuccess
∂∂ %
=
∂∂& '
false
∂∂( -
,
∂∂- .

StatusCode
∑∑ &
=
∑∑' (
$num
∑∑) ,
,
∑∑, -
Result
∏∏ "
=
∏∏# $
null
∏∏% )
}
ππ 
;
ππ 
}
∫∫ 
var
ºº 
paymentCard
ºº #
=
ºº$ %
await
ºº& +
_unitOfWork
ºº, 7
.
ºº7 8#
PaymentCardRepository
ºº8 M
.
ººM N
GetCardByUserId
ººN ]
(
ºº] ^
student
ºº^ e
.
ººe f
UserId
ººf l
)
ººl m
;
ººm n 
StudentFullInfoDTO
ææ & 
studentFullInfoDto
ææ' 9
=
ææ: ;
new
ææ< ? 
StudentFullInfoDTO
ææ@ R
(
ææR S
)
ææS T
{
øø 
	StudentId
¿¿ !
=
¿¿" #
student
¿¿$ +
.
¿¿+ ,
	StudentId
¿¿, 5
,
¿¿5 6
UserId
¡¡ 
=
¡¡  
student
¡¡! (
.
¡¡( )
UserId
¡¡) /
,
¡¡/ 0
	AvatarUrl
¬¬ !
=
¬¬" #
student
¬¬$ +
.
¬¬+ ,
ApplicationUser
¬¬, ;
.
¬¬; <
	AvatarUrl
¬¬< E
,
¬¬E F
FullName
√√  
=
√√! "
student
√√# *
.
√√* +
ApplicationUser
√√+ :
.
√√: ;
FullName
√√; C
,
√√C D

University
ƒƒ "
=
ƒƒ# $
student
ƒƒ% ,
.
ƒƒ, -

University
ƒƒ- 7
,
ƒƒ7 8
Email
≈≈ 
=
≈≈ 
student
≈≈  '
.
≈≈' (
ApplicationUser
≈≈( 7
.
≈≈7 8
Email
≈≈8 =
,
≈≈= >
Address
∆∆ 
=
∆∆  !
student
∆∆" )
.
∆∆) *
ApplicationUser
∆∆* 9
.
∆∆9 :
Address
∆∆: A
,
∆∆A B
	BirthDate
«« !
=
««" #
student
««$ +
.
««+ ,
ApplicationUser
««, ;
.
««; <
	BirthDate
««< E
,
««E F
Country
»» 
=
»»  !
student
»»" )
.
»») *
ApplicationUser
»»* 9
.
»»9 :
Country
»»: A
,
»»A B
Gender
…… 
=
……  
student
……! (
.
……( )
ApplicationUser
……) 8
.
……8 9
Gender
……9 ?
,
……? @
PhoneNumber
   #
=
  $ %
student
  & -
.
  - .
ApplicationUser
  . =
.
  = >
PhoneNumber
  > I
,
  I J
CardName
ÀÀ  
=
ÀÀ! "
paymentCard
ÀÀ# .
?
ÀÀ. /
.
ÀÀ/ 0
CardName
ÀÀ0 8
,
ÀÀ8 9

CardNumber
ÃÃ "
=
ÃÃ# $
paymentCard
ÃÃ% 0
?
ÃÃ0 1
.
ÃÃ1 2

CardNumber
ÃÃ2 <
,
ÃÃ< =
CardProvider
ÕÕ $
=
ÕÕ% &
paymentCard
ÕÕ' 2
?
ÕÕ2 3
.
ÕÕ3 4
CardProvider
ÕÕ4 @
}
ŒŒ 
;
ŒŒ 
return
–– 
new
–– 
ResponseDTO
–– *
(
––* +
)
––+ ,
{
—— 
Message
““ 
=
““  !
$str
““" @
,
““@ A
	IsSuccess
”” !
=
””" #
false
””$ )
,
””) *

StatusCode
‘‘ "
=
‘‘# $
$num
‘‘% (
,
‘‘( )
Result
’’ 
=
’’   
studentFullInfoDto
’’! 3
}
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ  
e
ÿÿ! "
)
ÿÿ" #
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ *
(
⁄⁄* +
)
⁄⁄+ ,
{
€€ 
Message
‹‹ 
=
‹‹  !
e
‹‹" #
.
‹‹# $
Message
‹‹$ +
,
‹‹+ ,
	IsSuccess
›› !
=
››" #
false
››$ )
,
››) *

StatusCode
ﬁﬁ "
=
ﬁﬁ# $
$num
ﬁﬁ% (
,
ﬁﬁ( )
Result
ﬂﬂ 
=
ﬂﬂ  
null
ﬂﬂ! %
}
‡‡ 
;
‡‡ 
}
·· 
}
‚‚ 
}
„„ 	
public
ÊÊ 
async
ÊÊ 
Task
ÊÊ 
<
ÊÊ 
ResponseDTO
ÊÊ %
>
ÊÊ% &

UpdateById
ÊÊ' 1
(
ÊÊ1 2
UpdateStudentDTO
ÊÊ2 B
updateStudentDTO
ÊÊC S
)
ÊÊS T
{
ÁÁ 	
try
ËË 
{
ÈÈ 
var
ÍÍ 
studentToUpdate
ÍÍ #
=
ÍÍ$ %
await
ÎÎ 
_unitOfWork
ÎÎ %
.
ÎÎ% &
StudentRepository
ÎÎ& 7
.
ÎÎ7 8
GetById
ÎÎ8 ?
(
ÎÎ? @
updateStudentDTO
ÎÎ@ P
.
ÎÎP Q
	StudentId
ÎÎQ Z
)
ÎÎZ [
;
ÎÎ[ \
if
ÌÌ 
(
ÌÌ 
studentToUpdate
ÌÌ #
==
ÌÌ$ &
null
ÌÌ' +
)
ÌÌ+ ,
{
ÓÓ 
return
ÔÔ 
new
ÔÔ 
ResponseDTO
ÔÔ *
{
 
Message
ÒÒ 
=
ÒÒ  !
$str
ÒÒ" 5
,
ÒÒ5 6
Result
ÚÚ 
=
ÚÚ  
null
ÚÚ! %
,
ÚÚ% &
	IsSuccess
ÛÛ !
=
ÛÛ" #
false
ÛÛ$ )
,
ÛÛ) *

StatusCode
ÙÙ "
=
ÙÙ# $
$num
ÙÙ% (
}
ıı 
;
ıı 
}
ˆˆ 
studentToUpdate
¯¯ 
.
¯¯  
ApplicationUser
¯¯  /
.
¯¯/ 0
FullName
¯¯0 8
=
¯¯9 :
updateStudentDTO
¯¯; K
?
¯¯K L
.
¯¯L M
FullName
¯¯M U
;
¯¯U V
studentToUpdate
˘˘ 
.
˘˘  

University
˘˘  *
=
˘˘+ ,
updateStudentDTO
˘˘- =
.
˘˘= >

University
˘˘> H
;
˘˘H I
studentToUpdate
˙˙ 
.
˙˙  
ApplicationUser
˙˙  /
.
˙˙/ 0
Address
˙˙0 7
=
˙˙8 9
updateStudentDTO
˙˙: J
?
˙˙J K
.
˙˙K L
Address
˙˙L S
;
˙˙S T
studentToUpdate
˚˚ 
.
˚˚  
ApplicationUser
˚˚  /
.
˚˚/ 0
	BirthDate
˚˚0 9
=
˚˚: ;
updateStudentDTO
˚˚< L
?
˚˚L M
.
˚˚M N
	BirthDate
˚˚N W
;
˚˚W X
studentToUpdate
¸¸ 
.
¸¸  
ApplicationUser
¸¸  /
.
¸¸/ 0
Gender
¸¸0 6
=
¸¸7 8
updateStudentDTO
¸¸9 I
?
¸¸I J
.
¸¸J K
Gender
¸¸K Q
;
¸¸Q R
studentToUpdate
˝˝ 
.
˝˝  
ApplicationUser
˝˝  /
.
˝˝/ 0
Country
˝˝0 7
=
˝˝8 9
updateStudentDTO
˝˝: J
?
˝˝J K
.
˝˝K L
Country
˝˝L S
;
˝˝S T
studentToUpdate
˛˛ 
.
˛˛  
ApplicationUser
˛˛  /
.
˛˛/ 0

UpdateTime
˛˛0 :
=
˛˛; <
DateTime
˛˛= E
.
˛˛E F
Now
˛˛F I
;
˛˛I J
_unitOfWork
ÅÅ 
.
ÅÅ 
StudentRepository
ÅÅ -
.
ÅÅ- .
Update
ÅÅ. 4
(
ÅÅ4 5
studentToUpdate
ÅÅ5 D
)
ÅÅD E
;
ÅÅE F
await
ÇÇ 
_unitOfWork
ÇÇ !
.
ÇÇ! "
	SaveAsync
ÇÇ" +
(
ÇÇ+ ,
)
ÇÇ, -
;
ÇÇ- .
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ &
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ <
,
ÜÜ< =
Result
áá 
=
áá 
null
áá !
,
áá! "
	IsSuccess
àà 
=
àà 
true
àà  $
,
àà$ %

StatusCode
ââ 
=
ââ  
$num
ââ! $
}
ää 
;
ää 
}
ãã 
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 
return
éé 
new
éé 
ResponseDTO
éé &
{
èè 
Message
êê 
=
êê 
e
êê 
.
êê  
Message
êê  '
,
êê' (
Result
ëë 
=
ëë 
null
ëë !
,
ëë! "
	IsSuccess
íí 
=
íí 
false
íí  %
,
íí% &

StatusCode
ìì 
=
ìì  
$num
ìì! $
}
îî 
;
îî 
}
ïï 
}
ññ 	
public
ôô 
async
ôô 
Task
ôô 
<
ôô 
ResponseDTO
ôô %
>
ôô% &
ActivateStudent
ôô' 6
(
ôô6 7
ClaimsPrincipal
ôô7 F
User
ôôG K
,
ôôK L
Guid
ôôM Q
	studentId
ôôR [
)
ôô[ \
{
öö 	
try
õõ 
{
úú 
var
ùù 
userId
ùù 
=
ùù 
User
ùù !
.
ùù! "
Claims
ùù" (
.
ùù( )
FirstOrDefault
ùù) 7
(
ùù7 8
x
ùù8 9
=>
ùù: <
x
ùù= >
.
ùù> ?
Type
ùù? C
==
ùùD F

ClaimTypes
ùùG Q
.
ùùQ R
NameIdentifier
ùùR `
)
ùù` a
?
ùùa b
.
ùùb c
Value
ùùc h
;
ùùh i
var
ûû 
student
ûû 
=
ûû 
await
ûû #
_unitOfWork
ûû$ /
.
ûû/ 0
StudentRepository
ûû0 A
.
ûûA B
GetById
ûûB I
(
ûûI J
	studentId
ûûJ S
)
ûûS T
;
ûûT U
if
üü 
(
üü 
student
üü 
is
üü 
null
üü #
)
üü# $
{
†† 
return
°° 
new
°° 
ResponseDTO
°° *
(
°°* +
)
°°+ ,
{
¢¢ 
Message
££ 
=
££  !
$str
££" 9
,
££9 :
	IsSuccess
§§ !
=
§§" #
false
§§$ )
,
§§) *

StatusCode
•• "
=
••# $
$num
••% (
,
••( )
Result
¶¶ 
=
¶¶  
null
¶¶! %
}
ßß 
;
ßß 
}
®® 
student
™™ 
.
™™ 
ApplicationUser
™™ '
.
™™' (
LockoutEnabled
™™( 6
=
™™7 8
true
™™9 =
;
™™= >
student
´´ 
.
´´ 
ApplicationUser
´´ '
.
´´' (

LockoutEnd
´´( 2
=
´´3 4
DateTime
´´5 =
.
´´= >
UtcNow
´´> D
;
´´D E
await
¨¨ 
_unitOfWork
¨¨ !
.
¨¨! "
	SaveAsync
¨¨" +
(
¨¨+ ,
)
¨¨, -
;
¨¨- .
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ &
(
ÆÆ& '
)
ÆÆ' (
{
ØØ 
Message
∞∞ 
=
∞∞ 
$str
∞∞ ;
,
∞∞; <
Result
±± 
=
±± 
null
±± !
,
±±! "
	IsSuccess
≤≤ 
=
≤≤ 
true
≤≤  $
,
≤≤$ %

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
}
¥¥ 
;
¥¥ 
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ &
(
∏∏& '
)
∏∏' (
{
ππ 
Message
∫∫ 
=
∫∫ 
e
∫∫ 
.
∫∫  
Message
∫∫  '
,
∫∫' (
	IsSuccess
ªª 
=
ªª 
true
ªª  $
,
ªª$ %

StatusCode
ºº 
=
ºº  
$num
ºº! $
,
ºº$ %
Result
ΩΩ 
=
ΩΩ 
null
ΩΩ !
}
ææ 
;
ææ 
}
øø 
}
¿¿ 	
public
√√ 
async
√√ 
Task
√√ 
<
√√ 
ResponseDTO
√√ %
>
√√% &
DeactivateStudent
√√' 8
(
√√8 9
ClaimsPrincipal
√√9 H
User
√√I M
,
√√M N
Guid
√√O S
	studentId
√√T ]
)
√√] ^
{
ƒƒ 	
try
≈≈ 
{
∆∆ 
var
«« 
userId
«« 
=
«« 
User
«« !
.
««! "
Claims
««" (
.
««( )
FirstOrDefault
««) 7
(
««7 8
x
««8 9
=>
««: <
x
««= >
.
««> ?
Type
««? C
==
««D F

ClaimTypes
««G Q
.
««Q R
NameIdentifier
««R `
)
««` a
?
««a b
.
««b c
Value
««c h
;
««h i
var
…… 
student
…… 
=
…… 
await
…… #
_unitOfWork
……$ /
.
……/ 0
StudentRepository
……0 A
.
……A B
GetById
……B I
(
……I J
	studentId
……J S
)
……S T
;
……T U
if
   
(
   
student
   
is
   
null
   #
)
  # $
{
ÀÀ 
return
ÃÃ 
new
ÃÃ 
ResponseDTO
ÃÃ *
(
ÃÃ* +
)
ÃÃ+ ,
{
ÕÕ 
Message
ŒŒ 
=
ŒŒ  !
$str
ŒŒ" 9
,
ŒŒ9 :
	IsSuccess
œœ !
=
œœ" #
false
œœ$ )
,
œœ) *

StatusCode
–– "
=
––# $
$num
––% (
,
––( )
Result
—— 
=
——  
null
——! %
}
““ 
;
““ 
}
”” 
student
’’ 
.
’’ 
ApplicationUser
’’ '
.
’’' (
LockoutEnabled
’’( 6
=
’’7 8
false
’’9 >
;
’’> ?
await
÷÷ 
_unitOfWork
÷÷ !
.
÷÷! "
	SaveAsync
÷÷" +
(
÷÷+ ,
)
÷÷, -
;
÷÷- .
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ &
(
ÿÿ& '
)
ÿÿ' (
{
ŸŸ 
Message
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄ >
,
⁄⁄> ?
Result
€€ 
=
€€ 
null
€€ !
,
€€! "
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  $
,
‹‹$ %

StatusCode
›› 
=
››  
$num
››! $
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ &
(
‚‚& '
)
‚‚' (
{
„„ 
Message
‰‰ 
=
‰‰ 
e
‰‰ 
.
‰‰  
Message
‰‰  '
,
‰‰' (
	IsSuccess
ÂÂ 
=
ÂÂ 
true
ÂÂ  $
,
ÂÂ$ %

StatusCode
ÊÊ 
=
ÊÊ  
$num
ÊÊ! $
,
ÊÊ$ %
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ !
}
ËË 
;
ËË 
}
ÈÈ 
}
ÍÍ 	
public
ÌÌ 
async
ÌÌ 
Task
ÌÌ 
<
ÌÌ 
ResponseDTO
ÌÌ %
>
ÌÌ% &$
GetStudentTotalCourses
ÌÌ' =
(
ÌÌ= >
Guid
ÌÌ> B
	studentId
ÌÌC L
)
ÌÌL M
{
ÓÓ 	
try
ÔÔ 
{
 
var
ÒÒ 
id
ÒÒ 
=
ÒÒ 
await
ÒÒ 
_unitOfWork
ÒÒ *
.
ÒÒ* +
StudentRepository
ÒÒ+ <
.
ÒÒ< =
GetAsync
ÒÒ= E
(
ÒÒE F
i
ÒÒF G
=>
ÒÒH J
i
ÒÒK L
.
ÒÒL M
	StudentId
ÒÒM V
==
ÒÒW Y
	studentId
ÒÒZ c
)
ÒÒc d
;
ÒÒd e
if
ÛÛ 
(
ÛÛ 
id
ÛÛ 
==
ÛÛ 
null
ÛÛ 
)
ÛÛ 
{
ÙÙ 
return
ıı 
new
ıı 
ResponseDTO
ıı *
(
ıı* +
)
ıı+ ,
{
ˆˆ 
Message
˜˜ 
=
˜˜  !
$str
˜˜" 5
,
˜˜5 6
Result
¯¯ 
=
¯¯  
null
¯¯! %
,
¯¯% &
	IsSuccess
˘˘ !
=
˘˘" #
false
˘˘$ )
,
˘˘) *

StatusCode
˙˙ "
=
˙˙# $
$num
˙˙% (
}
˚˚ 
;
˚˚ 
}
¸¸ 
var
˛˛ 
courses
˛˛ 
=
˛˛ 
await
˛˛ #
_unitOfWork
˛˛$ /
.
˛˛/ 0+
StudentCourseStatusRepository
˛˛0 M
.
˛˛M N
GetAllAsync
˛˛N Y
(
˛˛Y Z
c
˛˛Z [
=>
˛˛\ ^
c
˛˛_ `
.
˛˛` a
Id
˛˛a c
==
˛˛d f
id
˛˛g i
.
˛˛i j
	StudentId
˛˛j s
)
˛˛s t
;
˛˛t u
var
ÄÄ 
totalCourses
ÄÄ  
=
ÄÄ! "
courses
ÄÄ# *
.
ÄÄ* +
Count
ÄÄ+ 0
(
ÄÄ0 1
)
ÄÄ1 2
;
ÄÄ2 3
var
ÅÅ 
pending
ÅÅ 
=
ÅÅ 
courses
ÅÅ %
.
ÅÅ% &
Count
ÅÅ& +
(
ÅÅ+ ,
x
ÅÅ, -
=>
ÅÅ. 0
x
ÅÅ1 2
.
ÅÅ2 3
Status
ÅÅ3 9
==
ÅÅ: <
$num
ÅÅ= >
)
ÅÅ> ?
;
ÅÅ? @
var
ÇÇ 
enrolled
ÇÇ 
=
ÇÇ 
courses
ÇÇ &
.
ÇÇ& '
Count
ÇÇ' ,
(
ÇÇ, -
x
ÇÇ- .
=>
ÇÇ/ 1
x
ÇÇ2 3
.
ÇÇ3 4
Status
ÇÇ4 :
==
ÇÇ; =
$num
ÇÇ> ?
)
ÇÇ? @
;
ÇÇ@ A
var
ÉÉ 
	completed
ÉÉ 
=
ÉÉ 
courses
ÉÉ  '
.
ÉÉ' (
Count
ÉÉ( -
(
ÉÉ- .
x
ÉÉ. /
=>
ÉÉ0 2
x
ÉÉ3 4
.
ÉÉ4 5
Status
ÉÉ5 ;
==
ÉÉ< >
$num
ÉÉ? @
)
ÉÉ@ A
;
ÉÉA B
var
ÑÑ 
canceled
ÑÑ 
=
ÑÑ 
courses
ÑÑ &
.
ÑÑ& '
Count
ÑÑ' ,
(
ÑÑ, -
x
ÑÑ- .
=>
ÑÑ/ 1
x
ÑÑ2 3
.
ÑÑ3 4
Status
ÑÑ4 :
==
ÑÑ; =
$num
ÑÑ> ?
)
ÑÑ? @
;
ÑÑ@ A
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ &
(
ÜÜ& '
)
ÜÜ' (
{
áá 
Message
àà 
=
àà 
$str
àà 6
,
àà6 7
	IsSuccess
ââ 
=
ââ 
true
ââ  $
,
ââ$ %

StatusCode
ää 
=
ää  
$num
ää! $
,
ää$ %
Result
ãã 
=
ãã 
new
ãã  "
StudentTotalCountDTO
ãã! 5
(
ãã5 6
)
ãã6 7
{
åå 
Total
çç 
=
çç 
totalCourses
çç  ,
,
çç, -
Pending
éé 
=
éé  !
pending
éé" )
,
éé) *
Enrolled
èè  
=
èè! "
enrolled
èè# +
,
èè+ ,
	Completed
êê !
=
êê" #
	completed
êê$ -
,
êê- .
Canceled
ëë  
=
ëë! "
canceled
ëë# +
}
íí 
}
ìì 
;
ìì 
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
return
óó 
new
óó 
ResponseDTO
óó &
{
òò 
Message
ôô 
=
ôô 
e
ôô 
.
ôô  
Message
ôô  '
,
ôô' (
Result
öö 
=
öö 
null
öö !
,
öö! "
	IsSuccess
õõ 
=
õõ 
false
õõ  %
,
õõ% &

StatusCode
úú 
=
úú  
$num
úú! $
}
ùù 
;
ùù 
}
ûû 
}
üü 	
public
ÛÛ 
async
ÛÛ 
Task
ÛÛ 
<
ÛÛ 
ResponseDTO
ÛÛ %
>
ÛÛ% &)
GetAllCourseStudentEnrolled
ÛÛ' B
(
ÛÛB C
Guid
ÛÛC G
	studentId
ÛÛH Q
)
ÛÛQ R
{
ÙÙ 	
try
ıı 
{
ˆˆ 
var
¯¯ 
student
¯¯ 
=
¯¯ 
await
¯¯ #
_unitOfWork
¯¯$ /
.
¯¯/ 0
StudentRepository
¯¯0 A
.
¯¯A B
GetAsync
¯¯B J
(
¯¯J K
i
¯¯K L
=>
¯¯M O
i
¯¯P Q
.
¯¯Q R
	StudentId
¯¯R [
==
¯¯\ ^
	studentId
¯¯_ h
)
¯¯h i
;
¯¯i j
if
˘˘ 
(
˘˘ 
student
˘˘ 
==
˘˘ 
null
˘˘ #
)
˘˘# $
{
˙˙ 
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ *
(
˚˚* +
)
˚˚+ ,
{
¸¸ 
Message
˝˝ 
=
˝˝  !
$str
˝˝" 5
,
˝˝5 6
Result
˛˛ 
=
˛˛  
null
˛˛! %
,
˛˛% &
	IsSuccess
ˇˇ !
=
ˇˇ" #
false
ˇˇ$ )
,
ˇˇ) *

StatusCode
ÄÄ "
=
ÄÄ# $
$num
ÄÄ% (
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 
var
ÖÖ 
enrolledCourseIds
ÖÖ %
=
ÖÖ& '
(
ÖÖ( )
await
ÖÖ) .
_unitOfWork
ÖÖ/ :
.
ÖÖ: ;%
StudentCourseRepository
ÖÖ; R
.
ÜÜ 
GetAllAsync
ÜÜ $
(
ÜÜ$ %
sc
ÜÜ% '
=>
ÜÜ( *
sc
ÜÜ+ -
.
ÜÜ- .
	StudentId
ÜÜ. 7
==
ÜÜ8 :
	studentId
ÜÜ; D
&&
ÜÜE G
sc
ÜÜH J
.
ÜÜJ K
Status
ÜÜK Q
==
ÜÜR T
StaticStatus
ÜÜU a
.
ÜÜa b
StudentCourse
ÜÜb o
.
ÜÜo p
Enrolled
ÜÜp x
)
ÜÜx y
)
ÜÜy z
.
áá 
Select
áá 
(
áá  
sc
áá  "
=>
áá# %
sc
áá& (
.
áá( )
CourseId
áá) 1
)
áá1 2
.
àà 
Distinct
àà !
(
àà! "
)
àà" #
.
ââ 
ToList
ââ 
(
ââ  
)
ââ  !
;
ââ! "
if
ãã 
(
ãã 
!
ãã 
enrolledCourseIds
ãã &
.
ãã& '
Any
ãã' *
(
ãã* +
)
ãã+ ,
)
ãã, -
{
åå 
return
çç 
new
çç 
ResponseDTO
çç *
(
çç* +
)
çç+ ,
{
éé 
Message
èè 
=
èè  !
$str
èè" K
,
èèK L
	IsSuccess
êê !
=
êê" #
false
êê$ )
,
êê) *

StatusCode
ëë "
=
ëë# $
$num
ëë% (
,
ëë( )
Result
íí 
=
íí  
null
íí! %
}
ìì 
;
ìì 
}
îî 
var
óó 
courseVersions
óó "
=
óó# $
await
óó% *
_unitOfWork
óó+ 6
.
óó6 7%
CourseVersionRepository
óó7 N
.
òò 
GetAllAsync
òò $
(
òò$ %
cv
òò% '
=>
òò( *
enrolledCourseIds
òò+ <
.
òò< =
Contains
òò= E
(
òòE F
cv
òòF H
.
òòH I
CourseId
òòI Q
)
òòQ R
,
òòR S
includeProperties
òòT e
:
òòe f
$str
òòg x
)
òòx y
;
òòy z
var
õõ  
courseEnrolledDtos
õõ &
=
õõ' (
new
õõ) ,
List
õõ- 1
<
õõ1 2
CourseEnrolledDTO
õõ2 C
>
õõC D
(
õõD E
)
õõE F
;
õõF G
foreach
ùù 
(
ùù 
var
ùù 
cv
ùù 
in
ùù  "
courseVersions
ùù# 1
)
ùù1 2
{
ûû 
var
üü 

instructor
üü "
=
üü# $
await
üü% *
_unitOfWork
üü+ 6
.
üü6 7"
InstructorRepository
üü7 K
.
üüK L
GetAsync
üüL T
(
üüT U
x
üüU V
=>
üüW Y
x
üüZ [
.
üü[ \
InstructorId
üü\ h
==
üüi k
cv
üül n
.
üün o
InstructorId
üüo {
,
üü{ | 
includePropertiesüü} é
:üüé è
$strüüê °
)üü° ¢
;üü¢ £
var
†† 
instructorName
†† &
=
††' (

instructor
††) 3
.
††3 4
ApplicationUser
††4 C
.
††C D
FullName
††D L
;
††L M 
courseEnrolledDtos
¢¢ &
.
¢¢& '
Add
¢¢' *
(
¢¢* +
new
¢¢+ .
CourseEnrolledDTO
¢¢/ @
(
¢¢@ A
)
¢¢A B
{
££ 

CourseName
§§ "
=
§§# $
cv
§§% '
.
§§' (
Title
§§( -
,
§§- .
CourseImage
•• #
=
••$ %
cv
••& (
.
••( )
CourseImgUrl
••) 5
,
••5 6

CourseRate
¶¶ "
=
¶¶# $
(
¶¶% &
float
¶¶& +
)
¶¶+ ,
cv
¶¶, .
.
¶¶. /
Course
¶¶/ 5
.
¶¶5 6
	TotalRate
¶¶6 ?
,
¶¶? @
CourseSummary
ßß %
=
ßß& '
cv
ßß( *
.
ßß* +
Description
ßß+ 6
.
ßß6 7
Length
ßß7 =
>
ßß> ?
$num
ßß@ C
?
ßßD E
cv
ßßF H
.
ßßH I
Description
ßßI T
.
ßßT U
	Substring
ßßU ^
(
ßß^ _
$num
ßß_ `
,
ßß` a
$num
ßßb e
)
ßße f
+
ßßg h
$str
ßßi n
:
ßßo p
cv
ßßq s
.
ßßs t
Description
ßßt 
,ßß Ä
Category
®®  
=
®®! "
cv
®®# %
.
®®% &
Category
®®& .
.
®®. /
Name
®®/ 3
,
®®3 4
InstructorName
©© &
=
©©' (
instructorName
©©) 7
}
™™ 
)
™™ 
;
™™ 
}
´´ 
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ &
(
≠≠& '
)
≠≠' (
{
ÆÆ 
Message
ØØ 
=
ØØ 
$str
ØØ H
,
ØØH I
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  $
,
∞∞$ %

StatusCode
±± 
=
±±  
$num
±±! $
,
±±$ %
Result
≤≤ 
=
≤≤  
courseEnrolledDtos
≤≤ /
}
≥≥ 
;
≥≥ 
}
¥¥ 
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ &
(
∑∑& '
)
∑∑' (
{
∏∏ 
Message
ππ 
=
ππ 
e
ππ 
.
ππ  
Message
ππ  '
,
ππ' (
Result
∫∫ 
=
∫∫ 
null
∫∫ !
,
∫∫! "
	IsSuccess
ªª 
=
ªª 
false
ªª  %
,
ªª% &

StatusCode
ºº 
=
ºº  
$num
ºº! $
}
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 	
public
¡¡ 
async
¡¡ 
Task
¡¡ 
<
¡¡ 
ResponseDTO
¡¡ %
>
¡¡% &"
GetAllStudentComment
¡¡' ;
(
¬¬ 	
Guid
√√ 
	studentId
√√ 
,
√√ 
int
√√ 

pageNumber
√√  *
,
√√* +
int
√√, /
pageSize
√√0 8
)
ƒƒ 	
{
≈≈ 	
try
∆∆ 
{
«« 
var
»» 
comments
»» 
=
»» 
_unitOfWork
»» *
.
»»* +&
StudentCommentRepository
»»+ C
.
»»C D
GetAllAsync
»»D O
(
»»O P
x
…… 
=>
…… 
x
…… 
.
…… 
	StudentId
…… $
==
……% '
	studentId
……( 1
&&
……2 4
x
   
.
   
Status
   !
!=
  " $
$num
  % &
)
ÀÀ 
.
ÀÀ 

GetAwaiter
ÀÀ 
(
ÀÀ 
)
ÀÀ 
.
ÀÀ 
	GetResult
ÀÀ (
(
ÀÀ( )
)
ÀÀ) *
.
ÀÀ* +
ToList
ÀÀ+ 1
(
ÀÀ1 2
)
ÀÀ2 3
;
ÀÀ3 4
if
ÃÃ 
(
ÃÃ 
comments
ÃÃ 
is
ÃÃ 
null
ÃÃ  $
)
ÃÃ$ %
{
ÕÕ 
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ *
(
ŒŒ* +
)
ŒŒ+ ,
{
œœ 
Message
–– 
=
––  !
$str
––" 8
,
––8 9
	IsSuccess
—— !
=
——" #
true
——$ (
,
——( )

StatusCode
““ "
=
““# $
$num
““% (
,
““( )
Result
”” 
=
””  
null
””! %
}
‘‘ 
;
‘‘ 
}
’’ 
comments
◊◊ 
=
◊◊ 
comments
◊◊ #
.
◊◊# $
OrderByDescending
◊◊$ 5
(
◊◊5 6
x
◊◊6 7
=>
◊◊8 :
x
◊◊; <
.
◊◊< =
CreatedTime
◊◊= H
)
◊◊H I
.
◊◊I J
ToList
◊◊J P
(
◊◊P Q
)
◊◊Q R
;
◊◊R S
if
⁄⁄ 
(
⁄⁄ 

pageNumber
⁄⁄ 
>
⁄⁄  
$num
⁄⁄! "
&&
⁄⁄# %
pageSize
⁄⁄& .
>
⁄⁄/ 0
$num
⁄⁄1 2
)
⁄⁄2 3
{
€€ 
var
‹‹ 

skipResult
‹‹ "
=
‹‹# $
(
‹‹% &

pageNumber
‹‹& 0
-
‹‹1 2
$num
‹‹3 4
)
‹‹4 5
*
‹‹6 7
pageSize
‹‹8 @
;
‹‹@ A
comments
›› 
=
›› 
comments
›› '
.
››' (
Skip
››( ,
(
››, -

skipResult
››- 7
)
››7 8
.
››8 9
Take
››9 =
(
››= >
pageSize
››> F
)
››F G
.
››G H
ToList
››H N
(
››N O
)
››O P
;
››P Q
}
ﬁﬁ 
var
‡‡ 
commentsDto
‡‡ 
=
‡‡  !
_mapper
‡‡" )
.
‡‡) *
Map
‡‡* -
<
‡‡- .
List
‡‡. 2
<
‡‡2 3
GetAllCommentsDTO
‡‡3 D
>
‡‡D E
>
‡‡E F
(
‡‡F G
comments
‡‡G O
)
‡‡O P
;
‡‡P Q
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ &
(
‚‚& '
)
‚‚' (
{
„„ 
Message
‰‰ 
=
‰‰ 
$str
‰‰ @
,
‰‰@ A
	IsSuccess
ÂÂ 
=
ÂÂ 
true
ÂÂ  $
,
ÂÂ$ %

StatusCode
ÊÊ 
=
ÊÊ  
$num
ÊÊ! $
,
ÊÊ$ %
Result
ÁÁ 
=
ÁÁ 
commentsDto
ÁÁ (
}
ËË 
;
ËË 
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 
return
ÏÏ 
new
ÏÏ 
ResponseDTO
ÏÏ &
(
ÏÏ& '
)
ÏÏ' (
{
ÌÌ 
Message
ÓÓ 
=
ÓÓ 
e
ÓÓ 
.
ÓÓ  
Message
ÓÓ  '
,
ÓÓ' (
Result
ÔÔ 
=
ÔÔ 
null
ÔÔ !
,
ÔÔ! "
	IsSuccess
 
=
 
false
  %
,
% &

StatusCode
ÒÒ 
=
ÒÒ  
$num
ÒÒ! $
}
ÚÚ 
;
ÚÚ 
}
ÛÛ 
}
ÙÙ 	
public
˜˜ 
async
˜˜ 
Task
˜˜ 
<
˜˜ 
ResponseDTO
˜˜ %
>
˜˜% &"
CreateStudentComment
˜˜' ;
(
˜˜; <
ClaimsPrincipal
˜˜< K
User
˜˜L P
,
˜˜P Q%
CreateStudentCommentDTO
¯¯ #%
createStudentCommentDTO
¯¯$ ;
)
¯¯; <
{
˘˘ 	
try
˙˙ 
{
˚˚ 
var
¸¸ 
	studentId
¸¸ 
=
¸¸ 
await
˝˝ 
_unitOfWork
˝˝ %
.
˝˝% &
StudentRepository
˝˝& 7
.
˝˝7 8
GetAsync
˝˝8 @
(
˝˝@ A
i
˝˝A B
=>
˝˝C E
i
˛˛ 
.
˛˛ 
	StudentId
˛˛ #
==
˛˛$ &%
createStudentCommentDTO
˛˛' >
.
˛˛> ?
	StudentId
˛˛? H
)
˛˛H I
;
˛˛I J
if
ˇˇ 
(
ˇˇ 
	studentId
ˇˇ 
is
ˇˇ  
null
ˇˇ! %
)
ˇˇ% &
{
ÄÄ 
return
ÅÅ 
new
ÅÅ 
ResponseDTO
ÅÅ *
(
ÅÅ* +
)
ÅÅ+ ,
{
ÇÇ 
Message
ÉÉ 
=
ÉÉ  !
$str
ÉÉ" 5
,
ÉÉ5 6
	IsSuccess
ÑÑ !
=
ÑÑ" #
false
ÑÑ$ )
,
ÑÑ) *

StatusCode
ÖÖ "
=
ÖÖ# $
$num
ÖÖ% (
,
ÖÖ( )
Result
ÜÜ 
=
ÜÜ  
null
ÜÜ! %
}
áá 
;
áá 
}
àà 
var
ää 
userId
ää 
=
ää 
User
ää !
.
ää! "
Claims
ää" (
.
ää( )
FirstOrDefault
ää) 7
(
ää7 8
x
ää8 9
=>
ää: <
x
ää= >
.
ää> ?
Type
ää? C
==
ääD F

ClaimTypes
ääG Q
.
ääQ R
NameIdentifier
ääR `
)
ää` a
?
ääa b
.
ääb c
Value
ääc h
;
ääh i
var
ãã 
admin
ãã 
=
ãã 
await
ãã !
_unitOfWork
ãã" -
.
ãã- .#
UserManagerRepository
ãã. C
.
ããC D
FindByIdAsync
ããD Q
(
ããQ R
userId
ããR X
)
ããX Y
;
ããY Z
StudentComment
çç 
studentComment
çç -
=
çç. /
new
çç0 3
StudentComment
çç4 B
(
ççB C
)
ççC D
{
éé 
Comment
èè 
=
èè %
createStudentCommentDTO
èè 5
.
èè5 6
Comment
èè6 =
,
èè= >
	StudentId
êê 
=
êê %
createStudentCommentDTO
êê  7
.
êê7 8
	StudentId
êê8 A
,
êêA B
UpdatedTime
ëë 
=
ëë  !
null
ëë" &
,
ëë& '
CreatedTime
íí 
=
íí  !
DateTime
íí" *
.
íí* +
Now
íí+ .
,
íí. /
	CreatedBy
ìì 
=
ìì 
admin
ìì  %
.
ìì% &
Email
ìì& +
,
ìì+ ,
	UpdatedBy
îî 
=
îî 
$str
îî  "
,
îî" #
Status
ïï 
=
ïï 
$num
ïï 
}
ññ 
;
ññ 
await
òò 
_unitOfWork
òò !
.
òò! "&
StudentCommentRepository
òò" :
.
òò: ;
AddAsync
òò; C
(
òòC D
studentComment
òòD R
)
òòR S
;
òòS T
await
ôô 
_unitOfWork
ôô !
.
ôô! "
	SaveAsync
ôô" +
(
ôô+ ,
)
ôô, -
;
ôô- .
return
õõ 
new
õõ 
ResponseDTO
õõ &
(
õõ& '
)
õõ' (
{
úú 
Message
ùù 
=
ùù 
$str
ùù C
,
ùùC D
	IsSuccess
ûû 
=
ûû 
true
ûû  $
,
ûû$ %

StatusCode
üü 
=
üü  
$num
üü! $
,
üü$ %
Result
†† 
=
†† 
null
†† !
}
°° 
;
°° 
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
e
££ 
)
££ 
{
§§ 
return
•• 
new
•• 
ResponseDTO
•• &
(
••& '
)
••' (
{
¶¶ 
Message
ßß 
=
ßß 
e
ßß 
.
ßß  
Message
ßß  '
,
ßß' (
	IsSuccess
®® 
=
®® 
false
®®  %
,
®®% &

StatusCode
©© 
=
©©  
$num
©©! $
,
©©$ %
Result
™™ 
=
™™ 
null
™™ !
}
´´ 
;
´´ 
}
¨¨ 
}
≠≠ 	
public
∞∞ 
async
∞∞ 
Task
∞∞ 
<
∞∞ 
ResponseDTO
∞∞ %
>
∞∞% &"
UpdateStudentComment
∞∞' ;
(
∞∞; <
ClaimsPrincipal
∞∞< K
User
∞∞L P
,
∞∞P Q%
UpdateStudentCommentDTO
±± #%
updateStudentCommentDTO
±±$ ;
)
±±; <
{
≤≤ 	
try
≥≥ 
{
¥¥ 
var
µµ 
	studentId
µµ 
=
µµ 
await
∂∂ 
_unitOfWork
∂∂ %
.
∂∂% &&
StudentCommentRepository
∂∂& >
.
∂∂> ?
GetAsync
∂∂? G
(
∂∂G H
i
∂∂H I
=>
∂∂J L
i
∂∂M N
.
∂∂N O
Id
∂∂O Q
==
∂∂R T%
updateStudentCommentDTO
∂∂U l
.
∂∂l m
Id
∂∂m o
)
∂∂o p
;
∂∂p q
if
∑∑ 
(
∑∑ 
	studentId
∑∑ 
==
∑∑  
null
∑∑! %
)
∑∑% &
{
∏∏ 
return
ππ 
new
ππ 
ResponseDTO
ππ *
(
ππ* +
)
ππ+ ,
{
∫∫ 
Message
ªª 
=
ªª  !
$str
ªª" 5
,
ªª5 6
Result
ºº 
=
ºº  
null
ºº! %
,
ºº% &
	IsSuccess
ΩΩ !
=
ΩΩ" #
false
ΩΩ$ )
,
ΩΩ) *

StatusCode
ææ "
=
ææ# $
$num
ææ% (
}
øø 
;
øø 
}
¿¿ 
var
¬¬ 
userId
¬¬ 
=
¬¬ 
User
¬¬ !
.
¬¬! "
Claims
¬¬" (
.
¬¬( )
FirstOrDefault
¬¬) 7
(
¬¬7 8
x
¬¬8 9
=>
¬¬: <
x
¬¬= >
.
¬¬> ?
Type
¬¬? C
==
¬¬D F

ClaimTypes
¬¬G Q
.
¬¬Q R
NameIdentifier
¬¬R `
)
¬¬` a
?
¬¬a b
.
¬¬b c
Value
¬¬c h
;
¬¬h i
var
√√ 
admin
√√ 
=
√√ 
await
√√ !
_unitOfWork
√√" -
.
√√- .#
UserManagerRepository
√√. C
.
√√C D
FindByIdAsync
√√D Q
(
√√Q R
userId
√√R X
)
√√X Y
;
√√Y Z
	studentId
∆∆ 
.
∆∆ 
UpdatedTime
∆∆ %
=
∆∆& '
DateTime
∆∆( 0
.
∆∆0 1
Now
∆∆1 4
;
∆∆4 5
	studentId
«« 
.
«« 
	UpdatedBy
«« #
=
««$ %
admin
««& +
.
««+ ,
Email
««, 1
;
««1 2
	studentId
»» 
.
»» 
Comment
»» !
=
»»" #%
updateStudentCommentDTO
»»$ ;
.
»»; <
Comment
»»< C
;
»»C D
	studentId
…… 
.
…… 
Status
……  
=
……! "
$num
……# $
;
……$ %
_unitOfWork
ÀÀ 
.
ÀÀ &
StudentCommentRepository
ÀÀ 4
.
ÀÀ4 5
Update
ÀÀ5 ;
(
ÀÀ; <
	studentId
ÀÀ< E
)
ÀÀE F
;
ÀÀF G
await
ŒŒ 
_unitOfWork
ŒŒ !
.
ŒŒ! "
	SaveAsync
ŒŒ" +
(
ŒŒ+ ,
)
ŒŒ, -
;
ŒŒ- .
return
–– 
new
–– 
ResponseDTO
–– &
(
––& '
)
––' (
{
—— 
Message
““ 
=
““ 
$str
““ <
,
““< =
Result
”” 
=
”” 
null
”” !
,
””! "
	IsSuccess
‘‘ 
=
‘‘ 
true
‘‘  $
,
‘‘$ %

StatusCode
’’ 
=
’’  
$num
’’! $
,
’’$ %
}
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
e
ÿÿ 
)
ÿÿ 
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
{
€€ 
Message
‹‹ 
=
‹‹ 
e
‹‹ 
.
‹‹  
Message
‹‹  '
,
‹‹' (
Result
›› 
=
›› 
null
›› !
,
››! "
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
false
ﬁﬁ  %
,
ﬁﬁ% &

StatusCode
ﬂﬂ 
=
ﬂﬂ  
$num
ﬂﬂ! $
}
‡‡ 
;
‡‡ 
}
·· 
}
‚‚ 	
public
ÂÂ 
async
ÂÂ 
Task
ÂÂ 
<
ÂÂ 
ResponseDTO
ÂÂ %
>
ÂÂ% &"
DeleteStudentComment
ÂÂ' ;
(
ÂÂ; <
Guid
ÂÂ< @
	commentId
ÂÂA J
)
ÂÂJ K
{
ÊÊ 	
try
ÁÁ 
{
ËË 
var
ÈÈ 
comment
ÈÈ 
=
ÈÈ 
await
ÍÍ 
_unitOfWork
ÍÍ %
.
ÍÍ% &&
StudentCommentRepository
ÍÍ& >
.
ÍÍ> ?
GetAsync
ÍÍ? G
(
ÍÍG H
x
ÍÍH I
=>
ÍÍJ L
x
ÍÍM N
.
ÍÍN O
Id
ÍÍO Q
==
ÍÍR T
	commentId
ÍÍU ^
)
ÍÍ^ _
;
ÍÍ_ `
if
ÎÎ 
(
ÎÎ 
comment
ÎÎ 
==
ÎÎ 
null
ÎÎ #
)
ÎÎ# $
{
ÏÏ 
return
ÌÌ 
new
ÌÌ 
ResponseDTO
ÌÌ *
(
ÌÌ* +
)
ÌÌ+ ,
{
ÓÓ 
Message
ÔÔ 
=
ÔÔ  !
$str
ÔÔ" 9
,
ÔÔ9 :
	IsSuccess
 !
=
" #
false
$ )
,
) *

StatusCode
ÒÒ "
=
ÒÒ# $
$num
ÒÒ% (
,
ÒÒ( )
Result
ÚÚ 
=
ÚÚ  
null
ÚÚ! %
,
ÚÚ% &
}
ÛÛ 
;
ÛÛ 
}
ÙÙ 
comment
˜˜ 
.
˜˜ 
Status
˜˜ 
=
˜˜  
$num
˜˜! "
;
˜˜" #
_unitOfWork
˘˘ 
.
˘˘ &
StudentCommentRepository
˘˘ 4
.
˘˘4 5
Update
˘˘5 ;
(
˘˘; <
comment
˘˘< C
)
˘˘C D
;
˘˘D E
await
˙˙ 
_unitOfWork
˙˙ !
.
˙˙! "
	SaveAsync
˙˙" +
(
˙˙+ ,
)
˙˙, -
;
˙˙- .
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ &
(
¸¸& '
)
¸¸' (
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ <
,
˛˛< =
	IsSuccess
ˇˇ 
=
ˇˇ 
true
ˇˇ  $
,
ˇˇ$ %

StatusCode
ÄÄ 
=
ÄÄ  
$num
ÄÄ! $
,
ÄÄ$ %
Result
ÅÅ 
=
ÅÅ 
comment
ÅÅ $
.
ÅÅ$ %
Id
ÅÅ% '
,
ÅÅ' (
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ &
{
áá 
Message
àà 
=
àà 
e
àà 
.
àà  
Message
àà  '
,
àà' (
Result
ââ 
=
ââ 
null
ââ !
,
ââ! "
	IsSuccess
ää 
=
ää 
false
ää  %
,
ää% &

StatusCode
ãã 
=
ãã  
$num
ãã! $
}
åå 
;
åå 
}
çç 
}
éé 	
public
ëë 
async
ëë 
Task
ëë 
<
ëë 
ResponseDTO
ëë %
>
ëë% &
ExportStudents
ëë' 5
(
ëë5 6
string
ëë6 <
userId
ëë= C
,
ëëC D
int
ëëE H
month
ëëI N
,
ëëN O
int
ëëP S
year
ëëT X
)
ëëX Y
{
íí 	
var
îî 
students
îî 
=
îî 
_unitOfWork
îî &
.
îî& '
StudentRepository
îî' 8
.
îî8 9
GetAllAsync
îî9 D
(
îîD E
includeProperties
îîE V
:
îîV W
$str
îîX i
)
îîi j
.
ïï 

GetAwaiter
ïï 
(
ïï 
)
ïï 
.
ïï 
	GetResult
ïï '
(
ïï' (
)
ïï( )
.
ïï) *
ToList
ïï* 0
(
ïï0 1
)
ïï1 2
;
ïï2 3
students
òò 
=
òò 
students
òò 
.
òò  
Where
òò  %
(
òò% &
x
òò& '
=>
òò( *
x
ôô 
.
ôô 
ApplicationUser
ôô %
.
ôô% &

CreateTime
ôô& 0
.
ôô0 1
HasValue
ôô1 9
&&
ôô: <
x
ôô= >
.
ôô> ?
ApplicationUser
ôô? N
.
ôôN O

CreateTime
ôôO Y
.
ôôY Z
Value
ôôZ _
.
ôô_ `
Month
ôô` e
==
ôôf h
month
ôôi n
&&
ôôo q
x
öö 
.
öö 
ApplicationUser
öö %
.
öö% &

CreateTime
öö& 0
.
öö0 1
Value
öö1 6
.
öö6 7
Year
öö7 ;
==
öö< >
year
öö? C
)
ööC D
.
õõ 
ToList
õõ 
(
õõ 
)
õõ 
;
õõ 
var
ûû 
studentInfoDtos
ûû 
=
ûû  !
_mapper
ûû" )
.
ûû) *
Map
ûû* -
<
ûû- .
List
ûû. 2
<
ûû2 3 
StudentFullInfoDTO
ûû3 E
>
ûûE F
>
ûûF G
(
ûûG H
students
ûûH P
)
ûûP Q
;
ûûQ R
var
°° 
fileStudent
°° 
=
°° 
await
°° #
_closedXmlService
°°$ 5
.
°°5 6 
ExportStudentExcel
°°6 H
(
°°H I
studentInfoDtos
°°I X
)
°°X Y
;
°°Y Z
await
§§ 
_notificationHub
§§ "
.
§§" #
Clients
§§# *
.
§§* +
User
§§+ /
(
§§/ 0
userId
§§0 6
)
§§6 7
.
§§7 8
	SendAsync
§§8 A
(
§§A B
$str
§§B T
,
§§T U
fileStudent
§§V a
)
§§a b
;
§§b c
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ "
(
¶¶" #
)
¶¶# $
{
ßß 
Message
®® 
=
®® 
$str
®® &
,
®®& '
	IsSuccess
©© 
=
©© 
true
©©  
,
©©  !

StatusCode
™™ 
=
™™ 
$num
™™  
,
™™  !
Result
´´ 
=
´´ 
null
´´ 
}
¨¨ 
;
¨¨ 
}
≠≠ 	
public
∞∞ 
async
∞∞ 
Task
∞∞ 
<
∞∞ "
ClosedXMLResponseDTO
∞∞ .
>
∞∞. /
DownloadStudents
∞∞0 @
(
∞∞@ A
string
∞∞A G
fileName
∞∞H P
)
∞∞P Q
{
±± 	
try
≤≤ 
{
≥≥ 
string
¥¥ 
filePath
¥¥ 
=
¥¥  !
Path
¥¥" &
.
¥¥& '
Combine
¥¥' .
(
¥¥. /
_env
¥¥/ 3
.
¥¥3 4
ContentRootPath
¥¥4 C
,
¥¥C D
_config
¥¥E L
[
¥¥L M
$str
¥¥M q
]
¥¥q r
,
¥¥r s
fileName
µµ 
)
µµ 
;
µµ 
if
∑∑ 
(
∑∑ 
!
∑∑ 
File
∑∑ 
.
∑∑ 
Exists
∑∑  
(
∑∑  !
filePath
∑∑! )
)
∑∑) *
)
∑∑* +
{
∏∏ 
return
ππ 
new
ππ "
ClosedXMLResponseDTO
ππ 3
(
ππ3 4
)
ππ4 5
{
∫∫ 
Message
ªª 
=
ªª  !
$str
ªª" 2
,
ªª2 3
	IsSuccess
ºº !
=
ºº" #
false
ºº$ )
,
ºº) *

StatusCode
ΩΩ "
=
ΩΩ# $
$num
ΩΩ% (
,
ΩΩ( )
Stream
ææ 
=
ææ  
null
ææ! %
,
ææ% &
ContentType
øø #
=
øø$ %
null
øø& *
,
øø* +
FileName
¿¿  
=
¿¿! "
null
¿¿# '
}
¡¡ 
;
¡¡ 
}
¬¬ 
var
≈≈ 
memoryStream
≈≈  
=
≈≈! "
new
≈≈# &
MemoryStream
≈≈' 3
(
≈≈3 4
)
≈≈4 5
;
≈≈5 6
using
∆∆ 
(
∆∆ 
var
∆∆ 
stream
∆∆ !
=
∆∆" #
new
∆∆$ '

FileStream
∆∆( 2
(
∆∆2 3
filePath
∆∆3 ;
,
∆∆; <
FileMode
∆∆= E
.
∆∆E F
Open
∆∆F J
)
∆∆J K
)
∆∆K L
{
«« 
await
»» 
stream
»»  
.
»»  !
CopyToAsync
»»! ,
(
»», -
memoryStream
»»- 9
)
»»9 :
;
»»: ;
}
…… 
memoryStream
ÀÀ 
.
ÀÀ 
Position
ÀÀ %
=
ÀÀ& '
$num
ÀÀ( )
;
ÀÀ) *
var
ÃÃ 
contentType
ÃÃ 
=
ÃÃ  !
$str
ÃÃ" e
;
ÃÃe f
File
œœ 
.
œœ 
Delete
œœ 
(
œœ 
filePath
œœ $
)
œœ$ %
;
œœ% &
return
—— 
new
—— "
ClosedXMLResponseDTO
—— /
(
——/ 0
)
——0 1
{
““ 
Message
”” 
=
”” 
$str
”” :
,
””: ;
	IsSuccess
‘‘ 
=
‘‘ 
true
‘‘  $
,
‘‘$ %

StatusCode
’’ 
=
’’  
$num
’’! $
,
’’$ %
Stream
÷÷ 
=
÷÷ 
memoryStream
÷÷ )
,
÷÷) *
ContentType
◊◊ 
=
◊◊  !
contentType
◊◊" -
,
◊◊- .
FileName
ÿÿ 
=
ÿÿ 
fileName
ÿÿ '
}
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
catch
€€ 
(
€€ 
	Exception
€€ 
e
€€ 
)
€€ 
{
‹‹ 
Console
›› 
.
›› 
	WriteLine
›› !
(
››! "
e
››" #
.
››# $
Message
››$ +
)
››+ ,
;
››, -
throw
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚ 
ResponseDTO
‚‚ %
>
‚‚% &+
TotalPricesCoursesByStudentId
‚‚' D
(
‚‚D E
Guid
‚‚E I
	studentId
‚‚J S
)
‚‚S T
{
„„ 	
try
‰‰ 
{
ÂÂ 
var
ÁÁ 
student
ÁÁ 
=
ÁÁ 
await
ÁÁ #
_unitOfWork
ÁÁ$ /
.
ÁÁ/ 0
StudentRepository
ÁÁ0 A
.
ÁÁA B
GetAsync
ÁÁB J
(
ÁÁJ K
s
ÁÁK L
=>
ÁÁM O
s
ÁÁP Q
.
ÁÁQ R
	StudentId
ÁÁR [
==
ÁÁ\ ^
	studentId
ÁÁ_ h
)
ÁÁh i
;
ÁÁi j
if
ÈÈ 
(
ÈÈ 
student
ÈÈ 
==
ÈÈ 
null
ÈÈ #
)
ÈÈ# $
{
ÍÍ 
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ *
(
ÎÎ* +
)
ÎÎ+ ,
{
ÏÏ 
Message
ÌÌ 
=
ÌÌ  !
$str
ÌÌ" 5
,
ÌÌ5 6
Result
ÓÓ 
=
ÓÓ  
null
ÓÓ! %
,
ÓÓ% &
	IsSuccess
ÔÔ !
=
ÔÔ" #
false
ÔÔ$ )
,
ÔÔ) *

StatusCode
 "
=
# $
$num
% (
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 
var
ÙÙ 
orderHeaders
ÙÙ  
=
ÙÙ! "
await
ÙÙ# (
_unitOfWork
ÙÙ) 4
.
ÙÙ4 5#
OrderHeaderRepository
ÙÙ5 J
.
ÙÙJ K
GetAllAsync
ÙÙK V
(
ÙÙV W
o
ÙÙW X
=>
ÙÙY [
o
ÙÙ\ ]
.
ÙÙ] ^
	StudentId
ÙÙ^ g
==
ÙÙh j
	studentId
ÙÙk t
)
ÙÙt u
;
ÙÙu v
if
ˆˆ 
(
ˆˆ 
orderHeaders
ˆˆ  
==
ˆˆ! #
null
ˆˆ$ (
||
ˆˆ) +
!
ˆˆ, -
orderHeaders
ˆˆ- 9
.
ˆˆ9 :
Any
ˆˆ: =
(
ˆˆ= >
)
ˆˆ> ?
)
ˆˆ? @
{
˜˜ 
return
¯¯ 
new
¯¯ 
ResponseDTO
¯¯ *
(
¯¯* +
)
¯¯+ ,
{
˘˘ 
Message
˙˙ 
=
˙˙  !
$str
˙˙" I
,
˙˙I J
Result
˚˚ 
=
˚˚  
null
˚˚! %
,
˚˚% &
	IsSuccess
¸¸ !
=
¸¸" #
false
¸¸$ )
,
¸¸) *

StatusCode
˝˝ "
=
˝˝# $
$num
˝˝% (
}
˛˛ 
;
˛˛ 
}
ˇˇ 
var
ÇÇ 
orderHeaderId
ÇÇ !
=
ÇÇ" #
orderHeaders
ÇÇ$ 0
.
ÇÇ0 1
Select
ÇÇ1 7
(
ÇÇ7 8
x
ÇÇ8 9
=>
ÇÇ: <
x
ÇÇ= >
.
ÇÇ> ?
Id
ÇÇ? A
)
ÇÇA B
.
ÇÇB C
ToList
ÇÇC I
(
ÇÇI J
)
ÇÇJ K
;
ÇÇK L
var
ÖÖ 
orderDetails
ÖÖ  
=
ÖÖ! "
await
ÖÖ# (
_unitOfWork
ÖÖ) 4
.
ÖÖ4 5$
OrderDetailsRepository
ÖÖ5 K
.
ÖÖK L
GetAllAsync
ÖÖL W
(
ÖÖW X
od
ÜÜ 
=>
ÜÜ 
orderHeaderId
ÜÜ '
.
ÜÜ' (
Contains
ÜÜ( 0
(
ÜÜ0 1
od
ÜÜ1 3
.
ÜÜ3 4
OrderHeaderId
ÜÜ4 A
)
ÜÜA B
&&
ÜÜC E
od
ÜÜF H
.
ÜÜH I
CourseId
ÜÜI Q
!=
ÜÜR T
Guid
ÜÜU Y
.
ÜÜY Z
Empty
ÜÜZ _
)
ÜÜ_ `
;
ÜÜ` a
var
ââ 
courses
ââ 
=
ââ 
orderDetails
ââ *
.
ââ* +
Count
ââ+ 0
(
ââ0 1
)
ââ1 2
;
ââ2 3
var
åå 

totalPrice
åå 
=
åå  
orderDetails
åå! -
.
åå- .
Sum
åå. 1
(
åå1 2
od
åå2 4
=>
åå5 7
od
åå8 :
.
åå: ;
CoursePrice
åå; F
)
ååF G
;
ååG H
return
éé 
new
éé 
ResponseDTO
éé &
(
éé& '
)
éé' (
{
èè 
Message
êê 
=
êê 
$str
êê <
,
êê< =
Result
ëë 
=
ëë 
new
ëë  
{
ëë! "
Courses
ëë# *
=
ëë+ ,
courses
ëë- 4
,
ëë4 5

TotalPrice
ëë6 @
=
ëëA B

totalPrice
ëëC M
}
ëëN O
,
ëëO P
	IsSuccess
íí 
=
íí 
true
íí  $
,
íí$ %

StatusCode
ìì 
=
ìì  
$num
ìì! $
}
îî 
;
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 
return
òò 
new
òò 
ResponseDTO
òò &
(
òò& '
)
òò' (
{
ôô 
Message
öö 
=
öö 
e
öö 
.
öö  
Message
öö  '
,
öö' (
Result
õõ 
=
õõ 
null
õõ !
,
õõ! "
	IsSuccess
úú 
=
úú 
false
úú  %
,
úú% &

StatusCode
ùù 
=
ùù  
$num
ùù! $
}
ûû 
;
ûû 
}
üü 
}
†† 	
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
ResponseDTO
¢¢ %
>
¢¢% &%
GetAllCourseByStudentId
¢¢' >
(
¢¢> ?
Guid
¢¢? C
	studentId
¢¢D M
)
¢¢M N
{
££ 	
try
§§ 
{
•• 
var
¶¶ 
student
¶¶ 
=
¶¶ 
await
¶¶ #
_unitOfWork
¶¶$ /
.
¶¶/ 0
StudentRepository
¶¶0 A
.
¶¶A B
GetAsync
¶¶B J
(
¶¶J K
i
¶¶K L
=>
¶¶M O
i
¶¶P Q
.
¶¶Q R
	StudentId
¶¶R [
==
¶¶\ ^
	studentId
¶¶_ h
)
¶¶h i
;
¶¶i j
if
ßß 
(
ßß 
student
ßß 
==
ßß 
null
ßß #
)
ßß# $
{
®® 
return
©© 
new
©© 
ResponseDTO
©© *
(
©©* +
)
©©+ ,
{
™™ 
Message
´´ 
=
´´  !
$str
´´" 5
,
´´5 6
Result
¨¨ 
=
¨¨  
null
¨¨! %
,
¨¨% &
	IsSuccess
≠≠ !
=
≠≠" #
false
≠≠$ )
,
≠≠) *

StatusCode
ÆÆ "
=
ÆÆ# $
$num
ÆÆ% (
}
ØØ 
;
ØØ 
}
∞∞ 
var
≤≤ 
courses
≤≤ 
=
≤≤ 
await
≤≤ #
_unitOfWork
≤≤$ /
.
≤≤/ 0%
StudentCourseRepository
≤≤0 G
.
≤≤G H
GetAllAsync
≤≤H S
(
≤≤S T
c
≥≥ 
=>
≥≥ 
c
≥≥ 
.
≥≥ 
	StudentId
≥≥ $
==
≥≥% '
	studentId
≥≥( 1
,
≥≥1 2
includeProperties
¥¥ %
:
¥¥% &
$str
¥¥' J
)
µµ 
;
µµ 
if
∑∑ 
(
∑∑ 
courses
∑∑ 
==
∑∑ 
null
∑∑ #
)
∑∑# $
{
∏∏ 
return
ππ 
new
ππ 
ResponseDTO
ππ *
(
ππ* +
)
ππ+ ,
{
∫∫ 
Message
ªª 
=
ªª  !
$str
ªª" 3
,
ªª3 4
Result
ºº 
=
ºº  
null
ºº! %
,
ºº% &
	IsSuccess
ΩΩ !
=
ΩΩ" #
false
ΩΩ$ )
,
ΩΩ) *

StatusCode
ææ "
=
ææ# $
$num
ææ% (
}
øø 
;
øø 
}
¿¿ 
var
¬¬ 
listCourses
¬¬ 
=
¬¬  !
courses
¬¬" )
.
¬¬) *
Select
¬¬* 0
(
¬¬0 1
cs
¬¬1 3
=>
¬¬4 6
new
¬¬7 :
{
√√ 
cs
ƒƒ 
.
ƒƒ 
Id
ƒƒ 
,
ƒƒ 
cs
≈≈ 
.
≈≈ 
	StudentId
≈≈  
,
≈≈  !
cs
∆∆ 
.
∆∆ 
CourseId
∆∆ 
,
∆∆  
cs
«« 
.
«« 
CertificateImgUrl
«« (
,
««( )
cs
»» 
.
»» 
CreatedTime
»» "
,
»»" #
cs
…… 
.
…… 
	UpdatedBy
……  
,
……  !
cs
   
.
   
UpdatedTime
   "
,
  " #
cs
ÀÀ 
.
ÀÀ 
Status
ÀÀ 
,
ÀÀ 
InstructorName
ÃÃ "
=
ÃÃ# $
cs
ÃÃ% '
.
ÃÃ' (
Course
ÃÃ( .
.
ÃÃ. /

Instructor
ÃÃ/ 9
.
ÃÃ9 :
ApplicationUser
ÃÃ: I
.
ÃÃI J
FullName
ÃÃJ R
}
ÕÕ 
)
ÕÕ 
.
ÕÕ 
ToList
ÕÕ 
(
ÕÕ 
)
ÕÕ 
;
ÕÕ 
if
œœ 
(
œœ 
!
œœ 
listCourses
œœ  
.
œœ  !
Any
œœ! $
(
œœ$ %
)
œœ% &
)
œœ& '
{
–– 
return
—— 
new
—— 
ResponseDTO
—— *
(
——* +
)
——+ ,
{
““ 
Message
”” 
=
””  !
$str
””" K
,
””K L
Result
‘‘ 
=
‘‘  
null
‘‘! %
,
‘‘% &
	IsSuccess
’’ !
=
’’" #
false
’’$ )
,
’’) *

StatusCode
÷÷ "
=
÷÷# $
$num
÷÷% (
}
◊◊ 
;
◊◊ 
}
ÿÿ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
(
⁄⁄& '
)
⁄⁄' (
{
€€ 
Message
‹‹ 
=
‹‹ 
$str
‹‹ <
,
‹‹< =
Result
›› 
=
›› 
listCourses
›› (
,
››( )
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  $
,
ﬁﬁ$ %

StatusCode
ﬂﬂ 
=
ﬂﬂ  
$num
ﬂﬂ! $
}
‡‡ 
;
‡‡ 
}
·· 
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ &
(
‰‰& '
)
‰‰' (
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ  
Message
ÊÊ  '
,
ÊÊ' (
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ !
,
ÁÁ! "
	IsSuccess
ËË 
=
ËË 
false
ËË  %
,
ËË% &

StatusCode
ÈÈ 
=
ÈÈ  
$num
ÈÈ! $
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 
}
ÏÏ 	
}
ÓÓ 
}ÔÔ ∞
sD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\StudentCourseStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public		 
class		 &
StudentCourseStatusService		 '
:		( )'
IStudentCourseStatusService		* E
{

 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
public 
&
StudentCourseStatusService %
(% &
IUnitOfWork& 1

unitOfWork2 <
)< =
{ 
_unitOfWork 
= 

unitOfWork  
;  !
} 
public 

Task 
< 
ResponseDTO 
> #
GetStudentCoursesStatus 4
(4 5
Guid5 9
studentCourseId: I
)I J
{ 
throw 
new #
NotImplementedException )
() *
)* +
;+ ,
} 
public 

Task 
< 
ResponseDTO 
> "
GetStudentCourseStatus 3
(3 4
Guid4 8!
studentCourseStatusId9 N
)N O
{ 
throw 
new #
NotImplementedException )
() *
)* +
;+ ,
} 
public 

async 
Task 
< 
ResponseDTO !
>! "%
CreateStudentCourseStatus# <
(< =(
CreateStudentCourseStatusDTO= Y(
createStudentCourseStatusDtoZ v
)v w
{ 
try 
{ 	
var   
studentCourseStatus   #
=  $ %
new  & )
StudentCourseStatus  * =
(  = >
)  > ?
{!! 
Id"" 
="" 
Guid"" 
."" 
NewGuid"" !
(""! "
)""" #
,""# $
CreatedTime## 
=## 
DateTime## &
.##& '
UtcNow##' -
,##- .
Status$$ 
=$$ (
createStudentCourseStatusDto$$ 5
.$$5 6
Status$$6 <
,$$< =
StudentCourseId%% 
=%%  !(
createStudentCourseStatusDto%%" >
.%%> ?
StudentCourseId%%? N
,%%N O
	CreatedBy&& 
=&& (
createStudentCourseStatusDto&& 8
.&&8 9
	CreatedBy&&9 B
}'' 
;'' 
await)) 
_unitOfWork)) 
.)) )
StudentCourseStatusRepository)) ;
.)); <
AddAsync))< D
())D E
studentCourseStatus))E X
)))X Y
;))Y Z
await** 
_unitOfWork** 
.** 
	SaveAsync** '
(**' (
)**( )
;**) *
return,, 
new,, 
ResponseDTO,, "
(,," #
),,# $
{-- 
	IsSuccess.. 
=.. 
true..  
,..  !

StatusCode// 
=// 
$num//  
,//  !
Message00 
=00 
$str00 E
,00E F
Result11 
=11 
studentCourseStatus11 ,
.11, -
Id11- /
}22 
;22 
}33 	
catch44 
(44 
	Exception44 
e44 
)44 
{55 	
return66 
new66 
ResponseDTO66 "
(66" #
)66# $
{77 
	IsSuccess88 
=88 
false88 !
,88! "

StatusCode99 
=99 
$num99  
,99  !
Message:: 
=:: 
e:: 
.:: 
Message:: #
,::# $
Result;; 
=;; 
null;; 
}<< 
;<< 
}== 	
}>> 
}?? ¬Q
mD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\StudentCourseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public

 
class

  
StudentCourseService

 !
:

" #!
IStudentCourseService

$ 9
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly '
IStudentCourseStatusService 0'
_studentCourseStatusService1 L
;L M
public 
 
StudentCourseService 
(  
IUnitOfWork  +

unitOfWork, 6
,6 7'
IStudentCourseStatusService8 S&
studentCourseStatusServiceT n
)n o
{ 
_unitOfWork 
= 

unitOfWork  
;  !'
_studentCourseStatusService #
=$ %&
studentCourseStatusService& @
;@ A
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
CreateStudentCourse# 6
(6 7
ClaimsPrincipal7 F
UserG K
,K L
EnrollCourseDTOM \
enrollCourseDto] l
)l m
{ 
try 
{ 	
var 
	userEmail 
= 
User  
.  !
Claims! '
.' (
FirstOrDefault( 6
(6 7
x7 8
=>9 ;
x< =
.= >
Type> B
==C E

ClaimTypesF P
.P Q
NameQ U
)U V
?V W
.W X
ValueX ]
;] ^
var 
student 
= 
await 
_unitOfWork  +
.+ ,
StudentRepository, =
.= >
GetAsync> F
(F G
xG H
=>I K
xL M
.M N
	StudentIdN W
==X Z
enrollCourseDto[ j
.j k
	studentIdk t
)t u
;u v
if 
( 
student 
is 
null 
)  
{ 
return 
new 
ResponseDTO &
(& '
)' (
{ 
	IsSuccess   
=   
false    %
,  % &

StatusCode!! 
=!!  
$num!!! $
,!!$ %
Message"" 
="" 
$str"" 5
,""5 6
Result## 
=## 
null## !
}$$ 
;$$ 
}%% 
var'' 
course'' 
='' 
await'' 
_unitOfWork'' *
.''* +
CourseRepository''+ ;
.''; <
GetAsync''< D
(''D E
x''E F
=>''G I
x''J K
.''K L
Id''L N
==''O Q
enrollCourseDto''R a
.''a b
courseId''b j
)''j k
;''k l
if(( 
((( 
course(( 
is(( 
null(( 
)(( 
{)) 
return** 
new** 
ResponseDTO** &
(**& '
)**' (
{++ 
	IsSuccess,, 
=,, 
false,,  %
,,,% &

StatusCode-- 
=--  
$num--! $
,--$ %
Message.. 
=.. 
$str.. 4
,..4 5
Result// 
=// 
null// !
}00 
;00 
}11 
var33 
studentCourse33 
=33 
new33  #
StudentCourse33$ 1
(331 2
)332 3
{44 
Id55 
=55 
Guid55 
.55 
NewGuid55 !
(55! "
)55" #
,55# $
	StudentId66 
=66 
student66 #
.66# $
	StudentId66$ -
,66- .
CourseId77 
=77 
course77 !
.77! "
Id77" $
,77$ %
	CreatedBy88 
=88 
	userEmail88 %
,88% &
CreatedTime99 
=99 
DateTime99 &
.99& '
UtcNow99' -
,99- .
Status:: 
=:: 
StaticStatus:: %
.::% &
StudentCourse::& 3
.::3 4
Enrolled::4 <
,::< =
};; 
;;; 
await== 
_unitOfWork== 
.== #
StudentCourseRepository== 5
.==5 6
AddAsync==6 >
(==> ?
studentCourse==? L
)==L M
;==M N
await>> 
_unitOfWork>> 
.>> 
	SaveAsync>> '
(>>' (
)>>( )
;>>) *
await@@ '
_studentCourseStatusService@@ -
.@@- .%
CreateStudentCourseStatus@@. G
(AA 
newBB (
CreateStudentCourseStatusDTOBB 0
(BB0 1
)BB1 2
{CC 
	CreatedByDD 
=DD 
	userEmailDD  )
,DD) *
StatusEE 
=EE 
StaticStatusEE )
.EE) *
StudentCourseEE* 7
.EE7 8
EnrolledEE8 @
,EE@ A
StudentCourseIdFF #
=FF$ %
studentCourseFF& 3
.FF3 4
IdFF4 6
}GG 
)HH 
;HH 
returnJJ 
newJJ 
ResponseDTOJJ "
(JJ" #
)JJ# $
{KK 
	IsSuccessLL 
=LL 
trueLL  
,LL  !

StatusCodeMM 
=MM 
$numMM  
,MM  !
MessageNN 
=NN 
$strNN A
,NNA B
ResultOO 
=OO 
studentCourseOO &
}PP 
;PP 
}QQ 	
catchRR 
(RR 
	ExceptionRR 
eRR 
)RR 
{SS 	
returnTT 
newTT 
ResponseDTOTT "
(TT" #
)TT# $
{UU 
	IsSuccessVV 
=VV 
falseVV !
,VV! "

StatusCodeWW 
=WW 
$numWW  
,WW  !
MessageXX 
=XX 
eXX 
.XX 
MessageXX #
,XX# $
ResultYY 
=YY 
nullYY 
}ZZ 
;ZZ 
}[[ 	
}\\ 
public^^ 

async^^ 
Task^^ 
<^^ 
ResponseDTO^^ !
>^^! "
UpdateStudentCourse^^# 6
(__ 
ClaimsPrincipal`` 
User`` 
,`` "
UpdateStudentCourseDTOaa "
updateStudentCourseDtoaa 5
)bb 
{cc 
trydd 
{ee 	
varff 
studentCourseff 
=ff 
awaitff  %
_unitOfWorkff& 1
.ff1 2#
StudentCourseRepositoryff2 I
.ffI J
GetAsyncffJ R
(gg 
xhh 
=>hh 
xhh 
.hh 
	StudentIdhh  
==hh! #"
updateStudentCourseDtohh$ :
.hh: ;
	StudentIdhh; D
&&hhE G
xhhH I
.hhI J
CourseIdhhJ R
==hhS U"
updateStudentCourseDtohhV l
.hhl m
CourseIdhhm u
)ii 
;ii 
ifkk 
(kk 
studentCoursekk 
iskk  
nullkk! %
)kk% &
{ll 
returnmm 
newmm 
ResponseDTOmm &
(mm& '
)mm' (
{nn 
	IsSuccessoo 
=oo 
falseoo  %
,oo% &

StatusCodepp 
=pp  
$numpp! $
,pp$ %
Messageqq 
=qq 
$strqq <
,qq< =
Resultrr 
=rr 
nullrr !
}ss 
;ss 
}tt 
studentCoursevv 
.vv 
Statusvv  
=vv! ""
updateStudentCourseDtovv# 9
.vv9 :
Statusvv: @
;vv@ A
_unitOfWorkww 
.ww #
StudentCourseRepositoryww /
.ww/ 0
Updateww0 6
(ww6 7
studentCourseww7 D
)wwD E
;wwE F
awaitxx 
_unitOfWorkxx 
.xx 
	SaveAsyncxx '
(xx' (
)xx( )
;xx) *
awaitzz '
_studentCourseStatusServicezz -
.zz- .%
CreateStudentCourseStatuszz. G
({{ 
new|| (
CreateStudentCourseStatusDTO|| 0
(||0 1
)||1 2
{}} 
	CreatedBy~~ 
=~~ 
User~~  $
.~~$ %
Claims~~% +
.~~+ ,
FirstOrDefault~~, :
(~~: ;
x~~; <
=>~~= ?
x~~@ A
.~~A B
Type~~B F
==~~G I

ClaimTypes~~J T
.~~T U
Name~~U Y
)~~Y Z
?~~Z [
.~~[ \
Value~~\ a
,~~a b
StudentCourseId #
=$ %
studentCourse& 3
.3 4
Id4 6
,6 7
Status
ÄÄ 
=
ÄÄ $
updateStudentCourseDto
ÄÄ 3
.
ÄÄ3 4
Status
ÄÄ4 :
}
ÅÅ 
)
ÇÇ 
;
ÇÇ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
,
áá  !
Message
àà 
=
àà 
$str
àà >
,
àà> ?
Result
ââ 
=
ââ 
null
ââ 
}
ää 
;
ää 
}
ãã 	
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 	
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
	IsSuccess
êê 
=
êê 
false
êê !
,
êê! "

StatusCode
ëë 
=
ëë 
$num
ëë  
,
ëë  !
Message
íí 
=
íí 
e
íí 
.
íí 
Message
íí #
,
íí# $
Result
ìì 
=
ìì 
null
ìì 
}
îî 
;
îî 
}
ïï 	
}
ññ 
}óó ◊Ñ
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\StripeService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
StripeService 
: 
IStripeService +
{		 
public

 

async

 
Task

 
<

 
ResponseDTO

 !
>

! " 
CreatePaymentSession

# 7
(

7 8"
CreateStripeSessionDTO

8 N"
createStripeSessionDto

O e
)

e f
{ 
try 
{ 	
var 
options 
= 
new  
SessionCreateOptions 2
{ 

SuccessUrl 
= "
createStripeSessionDto 3
.3 4
ApprovedUrl4 ?
,? @
	CancelUrl 
= "
createStripeSessionDto 2
.2 3
	CancelUrl3 <
,< =
	LineItems 
= 
new 
List  $
<$ %"
SessionLineItemOptions% ;
>; <
(< =
)= >
,> ?
Mode 
= 
$str  
,  !
} 
; 
if 
( "
createStripeSessionDto &
.& '
OrdersDetails' 4
is5 7
null8 <
)< =
{ 
throw 
new "
NullReferenceException 0
(0 1
)1 2
;2 3
} 
foreach 
( 
var 
orderDetail $
in% '"
createStripeSessionDto( >
.> ?
OrdersDetails? L
)L M
{ 
var 
sessionLineItem #
=$ %
new& )"
SessionLineItemOptions* @
(@ A
)A B
{ 
	PriceData 
= 
new  #+
SessionLineItemPriceDataOptions$ C
(C D
)D E
{   

UnitAmount!! "
=!!# $
(!!% &
long!!& *
)!!* +
(!!+ ,
orderDetail!!, 7
.!!7 8
CoursePrice!!8 C
*!!D E
$num!!F I
)!!I J
,!!J K
Currency""  
=""! "
$str""# (
,""( )
ProductData## #
=##$ %
new##& )6
*SessionLineItemPriceDataProductDataOptions##* T
(##T U
)##U V
{$$ 
Name%%  
=%%! "
orderDetail%%# .
.%%. /
CourseTitle%%/ :
,%%: ;
}&& 
}'' 
,'' 
Quantity(( 
=(( 
$num((  
})) 
;)) 
options** 
.** 
	LineItems** !
.**! "
Add**" %
(**% &
sessionLineItem**& 5
)**5 6
;**6 7
}++ 
var-- 
service-- 
=-- 
new-- 
SessionService-- ,
(--, -
)--- .
;--. /
var.. 
session.. 
=.. 
await.. 
service..  '
...' (
CreateAsync..( 3
(..3 4
options..4 ;
)..; <
;..< ="
createStripeSessionDto00 "
.00" #
StripeSessionId00# 2
=003 4
session005 <
.00< =
Id00= ?
;00? @"
createStripeSessionDto11 "
.11" #
StripeSessionUrl11# 3
=114 5
session116 =
.11= >
Url11> A
;11A B
return33 
new33 
ResponseDTO33 "
(33" #
)33# $
{44 
Result55 
=55 "
createStripeSessionDto55 /
,55/ 0
Message66 
=66 
$str66 >
,66> ?
	IsSuccess77 
=77 
true77  
,77  !

StatusCode88 
=88 
$num88  
}99 
;99 
}:: 	
catch;; 
(;; 
	Exception;; 
e;; 
);; 
{<< 	
Console== 
.== 
	WriteLine== 
(== 
e== 
)==  
;==  !
throw>> 
;>> 
}?? 	
}@@ 
publicBB 

asyncBB 
TaskBB 
<BB 
ResponseDTOBB !
>BB! ""
ValidatePaymentSessionBB# 9
(BB9 :$
ValidateStripeSessionDTOBB: R$
validateStripeSessionDtoBBS k
)BBk l
{CC 
tryDD 
{EE 	
varFF 
serviceFF 
=FF 
newFF 
SessionServiceFF ,
(FF, -
)FF- .
;FF. /
varGG 
sessionGG 
=GG 
awaitGG 
serviceGG  '
.GG' (
GetAsyncGG( 0
(GG0 1$
validateStripeSessionDtoGG1 I
.GGI J
StripeSessionIdGGJ Y
)GGY Z
;GGZ [
varII  
paymentIntentServiceII $
=II% &
newII' * 
PaymentIntentServiceII+ ?
(II? @
)II@ A
;IIA B
varJJ 
paymentIntentJJ 
=JJ 
awaitJJ  % 
paymentIntentServiceJJ& :
.JJ: ;
GetAsyncJJ; C
(JJC D
sessionJJD K
.JJK L
PaymentIntentIdJJL [
)JJ[ \
;JJ\ ]$
validateStripeSessionDtoLL $
.LL$ %
PaymentIntentIdLL% 4
=LL5 6
paymentIntentLL7 D
.LLD E
IdLLE G
;LLG H$
validateStripeSessionDtoMM $
.MM$ %
StatusMM% +
=MM, -
paymentIntentMM. ;
.MM; <
StatusMM< B
;MMB C
returnOO 
newOO 
ResponseDTOOO "
(OO" #
)OO# $
{PP 
ResultQQ 
=QQ $
validateStripeSessionDtoQQ 1
,QQ1 2
MessageRR 
=RR 
$strRR @
,RR@ A
	IsSuccessSS 
=SS 
trueSS  
,SS  !

StatusCodeTT 
=TT 
$numTT  
}UU 
;UU 
}VV 	
catchWW 
(WW 
	ExceptionWW 
eWW 
)WW 
{XX 	
ConsoleYY 
.YY 
	WriteLineYY 
(YY 
eYY 
)YY  
;YY  !
throwZZ 
;ZZ 
}[[ 	
}\\ 
public^^ 

async^^ 
Task^^ 
<^^ 
ResponseDTO^^ !
>^^! ""
CreateConnectedAccount^^# 9
(__ +
CreateStripeConnectedAccountDTO`` '+
createStripeConnectedAccountDto``( G
)aa 
{bb 
vardd 
optionsdd 
=dd 
newdd  
AccountCreateOptionsdd .
{ee 	
Typeff 
=ff 

StaticEnumff 
.ff 
StripeAccountTypeff /
.ff/ 0
expressff0 7
.ff7 8
ToStringff8 @
(ff@ A
)ffA B
,ffB C
Emailgg 
=gg +
createStripeConnectedAccountDtogg 3
.gg3 4
Emailgg4 9
,gg9 :
Countryhh 
=hh +
createStripeConnectedAccountDtohh 5
.hh5 6
Countryhh6 =
,hh= >
Capabilitiesjj 
=jj 
newjj &
AccountCapabilitiesOptionsjj 9
{kk 
CardPaymentsll 
=ll 
newll "2
&AccountCapabilitiesCardPaymentsOptionsll# I
{llJ K
	RequestedllL U
=llV W
truellX \
}ll] ^
,ll^ _
	Transfersmm 
=mm 
newmm /
#AccountCapabilitiesTransfersOptionsmm  C
{mmD E
	RequestedmmF O
=mmP Q
truemmR V
}mmW X
,mmX Y
}nn 
,nn 
BusinessTypepp 
=pp 
$strpp '
,pp' (
}qq 	
;qq	 

varss 
servicess 
=ss 
newss 
AccountServicess (
(ss( )
)ss) *
;ss* +
vartt 
accounttt 
=tt 
awaittt 
servicett #
.tt# $
CreateAsynctt$ /
(tt/ 0
optionstt0 7
)tt7 8
;tt8 9
varww 
accountLinkOptionsww 
=ww  
newww! $$
AccountLinkCreateOptionsww% =
{xx 	
Accountyy 
=yy 
accountyy 
.yy 
Idyy  
,yy  !

RefreshUrlzz 
=zz +
createStripeConnectedAccountDtozz 8
.zz8 9

RefreshUrlzz9 C
,zzC D
	ReturnUrl{{ 
={{ +
createStripeConnectedAccountDto{{ 7
.{{7 8
	ReturnUrl{{8 A
,{{A B
Type|| 
=|| 

StaticEnum|| 
.|| !
StripeAccountLinkType|| 3
.||3 4
account_onboarding||4 F
.||F G
ToString||G O
(||O P
)||P Q
,||Q R
}}} 	
;}}	 

var 
accountLinkService 
=  
new! $
AccountLinkService% 7
(7 8
)8 9
;9 :
var
ÄÄ 
accountLink
ÄÄ 
=
ÄÄ 
await
ÄÄ  
accountLinkService
ÄÄ  2
.
ÄÄ2 3
CreateAsync
ÄÄ3 >
(
ÄÄ> ? 
accountLinkOptions
ÄÄ? Q
)
ÄÄQ R
;
ÄÄR S-
createStripeConnectedAccountDto
ÇÇ '
.
ÇÇ' (
	AccountId
ÇÇ( 1
=
ÇÇ2 3
account
ÇÇ4 ;
.
ÇÇ; <
Id
ÇÇ< >
;
ÇÇ> ?-
createStripeConnectedAccountDto
ÉÉ '
.
ÉÉ' (
AccountLinkUrl
ÉÉ( 6
=
ÉÉ7 8
accountLink
ÉÉ9 D
.
ÉÉD E
Url
ÉÉE H
;
ÉÉH I
return
ÖÖ 
new
ÖÖ 
ResponseDTO
ÖÖ 
(
ÖÖ 
)
ÖÖ  
{
ÜÜ 	
Result
áá 
=
áá -
createStripeConnectedAccountDto
áá 4
,
áá4 5
	IsSuccess
àà 
=
àà 
true
àà 
,
àà 

StatusCode
ââ 
=
ââ 
$num
ââ 
,
ââ 
Message
ää 
=
ää 
$str
ää D
}
ãã 	
;
ãã	 

}
åå 
public
éé 

async
éé 
Task
éé 
<
éé 
ResponseDTO
éé !
>
éé! "
AddCard
éé# *
(
éé* +
AddStripeCardDTO
éé+ ;
addStripeCardDto
éé< L
)
ééL M
{
èè 
var
êê 
options
êê 
=
êê 
new
êê *
ExternalAccountCreateOptions
êê 6
{
ëë 	
ExternalAccount
íí 
=
íí 
addStripeCardDto
íí .
.
íí. /
	CardToken
íí/ 8
,
íí8 9
}
ìì 	
;
ìì	 

var
ïï 
service
ïï 
=
ïï 
new
ïï $
ExternalAccountService
ïï 0
(
ïï0 1
)
ïï1 2
;
ïï2 3
var
ññ 
externalAccount
ññ 
=
ññ 
await
ññ #
service
ññ$ +
.
ññ+ ,
CreateAsync
ññ, 7
(
ññ7 8
addStripeCardDto
ññ8 H
.
ññH I 
ConnectedAccountId
ññI [
,
ññ[ \
options
ññ] d
)
ññd e
;
ññe f
return
òò 
new
òò 
ResponseDTO
òò 
(
òò 
)
òò  
{
ôô 	
Result
öö 
=
öö 
externalAccount
öö $
,
öö$ %
	IsSuccess
õõ 
=
õõ 
true
õõ 
,
õõ 

StatusCode
úú 
=
úú 
$num
úú 
,
úú 
Message
ùù 
=
ùù 
$str
ùù -
}
ûû 	
;
ûû	 

}
üü 
public
°° 

async
°° 
Task
°° 
<
°° 
ResponseDTO
°° !
>
°°! "
CreateTransfer
°°# 1
(
°°1 2%
CreateStripeTransferDTO
°°2 I%
createStripeTransferDto
°°J a
)
°°a b
{
¢¢ 
try
££ 
{
§§ 	
var
•• 
options
•• 
=
•• 
new
•• #
TransferCreateOptions
•• 3
{
¶¶ 
Amount
ßß 
=
ßß %
createStripeTransferDto
ßß 0
.
ßß0 1
Amount
ßß1 7
*
ßß8 9
$num
ßß: =
,
ßß= >
Currency
®® 
=
®® %
createStripeTransferDto
®® 2
.
®®2 3
Currency
®®3 ;
,
®®; <
Destination
©© 
=
©© %
createStripeTransferDto
©© 5
.
©©5 6 
ConnectedAccountId
©©6 H
,
©©H I
}
™™ 
;
™™ 
var
¨¨ 
transferService
¨¨ 
=
¨¨  !
new
¨¨" %
TransferService
¨¨& 5
(
¨¨5 6
)
¨¨6 7
;
¨¨7 8
await
≠≠ 
transferService
≠≠ !
.
≠≠! "
CreateAsync
≠≠" -
(
≠≠- .
options
≠≠. 5
)
≠≠5 6
;
≠≠6 7
return
ØØ 
new
ØØ 
ResponseDTO
ØØ "
(
ØØ" #
)
ØØ# $
{
∞∞ 
Result
±± 
=
±± %
createStripeTransferDto
±± 0
,
±±0 1
	IsSuccess
≤≤ 
=
≤≤ 
true
≤≤  
,
≤≤  !

StatusCode
≥≥ 
=
≥≥ 
$num
≥≥  
,
≥≥  !
Message
¥¥ 
=
¥¥ 
$str
¥¥ 8
}
µµ 
;
µµ 
}
∂∂ 	
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 	
return
ππ 
new
ππ 
ResponseDTO
ππ "
(
ππ" #
)
ππ# $
{
∫∫ 
Result
ªª 
=
ªª 
null
ªª 
,
ªª 
	IsSuccess
ºº 
=
ºº 
true
ºº  
,
ºº  !

StatusCode
ΩΩ 
=
ΩΩ 
$num
ΩΩ  
,
ΩΩ  !
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
}
øø 
;
øø 
}
¿¿ 	
}
¡¡ 
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
ResponseDTO
√√ !
>
√√! "
CreatePayout
√√# /
(
√√/ 0#
CreateStripePayoutDTO
√√0 E#
createStripePayoutDto
√√F [
)
√√[ \
{
ƒƒ 
try
≈≈ 
{
∆∆ 	
var
«« 
options
«« 
=
«« 
new
«« !
PayoutCreateOptions
«« 1
{
»» 
Amount
…… 
=
…… #
createStripePayoutDto
…… .
.
……. /
Amount
……/ 5
*
……6 7
$num
……8 ;
,
……; <
Currency
   
=
   #
createStripePayoutDto
   0
.
  0 1
Currency
  1 9
,
  9 :
}
ÀÀ 
;
ÀÀ 
var
ÕÕ 
service
ÕÕ 
=
ÕÕ 
new
ÕÕ 
PayoutService
ÕÕ +
(
ÕÕ+ ,
)
ÕÕ, -
;
ÕÕ- .
var
œœ 
payout
œœ 
=
œœ 
await
œœ 
service
œœ &
.
œœ& '
CreateAsync
œœ' 2
(
–– 
options
—— 
,
—— 
new
—— 
RequestOptions
—— +
{
““ 
StripeAccount
”” !
=
””" ##
createStripePayoutDto
””$ 9
.
””9 : 
ConnectedAccountId
””: L
}
‘‘ 
)
’’ 
;
’’ 
return
◊◊ 
new
◊◊ 
ResponseDTO
◊◊ "
(
◊◊" #
)
◊◊# $
{
ÿÿ 
Result
ŸŸ 
=
ŸŸ 
payout
ŸŸ 
,
ŸŸ  
	IsSuccess
⁄⁄ 
=
⁄⁄ 
true
⁄⁄  
,
⁄⁄  !

StatusCode
€€ 
=
€€ 
$num
€€  
,
€€  !
Message
‹‹ 
=
‹‹ 
$str
‹‹ 6
}
›› 
;
›› 
}
ﬁﬁ 	
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 	
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Result
„„ 
=
„„ 
null
„„ 
,
„„ 
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
}
ÁÁ 
;
ÁÁ 
}
ËË 	
}
ÈÈ 
}ÍÍ ‹÷
uD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\SectionDetailsVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class (
SectionDetailsVersionService )
:* +)
ISectionDetailsVersionService, I
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IFirebaseService %
_firebaseService& 6
;6 7
public 
(
SectionDetailsVersionService '
(' (
IUnitOfWork( 3

unitOfWork4 >
,> ?
IMapper@ G
mapperH N
,N O
IFirebaseServiceP `
firebaseServicea p
)p q
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
_firebaseService 
= 
firebaseService *
;* +
} 
public 

async 
Task 
< 
ResponseDTO !
>! "'
CloneSectionsDetailsVersion# >
( 
ClaimsPrincipal   
User   
,   *
CloneSectionsDetailsVersionDTO!! &*
cloneSectionsDetailsVersionDto!!' E
)"" 
{## 
try$$ 
{%% 	
var&& "
sectionDetailsVersions&& &
=&&' (
await'' 
_unitOfWork'' !
.''! "+
SectionDetailsVersionRepository''" A
.(( @
4GetSectionDetailsVersionsOfCourseSectionVersionAsync(( I
()) *
cloneSectionsDetailsVersionDto** 6
.**6 7%
OldCourseSectionVersionId**7 P
,**P Q
asNoTracking++ $
:++$ %
true++& *
),, 
;,, 
if.. 
(.. "
sectionDetailsVersions.. &
...& '
IsNullOrEmpty..' 4
(..4 5
)..5 6
)..6 7
{// 
return00 
new00 
ResponseDTO00 &
(00& '
)00' (
{11 
	IsSuccess22 
=22 
false22  %
,22% &

StatusCode33 
=33  
$num33! $
,33$ %
Result44 
=44 
null44 !
,44! "
Message55 
=55 
$str55 W
}66 
;66 
}77 
foreach99 
(99 
var99 !
sectionDetailsVersion99 .
in99/ 1"
sectionDetailsVersions992 H
)99H I
{:: !
sectionDetailsVersion;; %
.;;% &
Id;;& (
=;;) *
Guid;;+ /
.;;/ 0
NewGuid;;0 7
(;;7 8
);;8 9
;;;9 :!
sectionDetailsVersion<< %
.<<% &"
CourseSectionVersionId<<& <
=<<= >*
cloneSectionsDetailsVersionDto<<? ]
.<<] ^%
NewCourseSectionVersionId<<^ w
;<<w x
}== 
await?? 
_unitOfWork?? 
.?? +
SectionDetailsVersionRepository?? =
.??= >
AddRangeAsync??> K
(??K L"
sectionDetailsVersions??L b
)??b c
;??c d
await@@ 
_unitOfWork@@ 
.@@ 
	SaveAsync@@ '
(@@' (
)@@( )
;@@) *
returnBB 
newBB 
ResponseDTOBB "
(BB" #
)BB# $
{CC 
	IsSuccessDD 
=DD 
trueDD  
,DD  !

StatusCodeEE 
=EE 
$numEE  
,EE  !
MessageFF 
=FF 
$strFF O
,FFO P
ResultGG 
=GG 
nullGG 
}HH 
;HH 
}II 	
catchJJ 
(JJ 
	ExceptionJJ 
eJJ 
)JJ 
{KK 	
returnLL 
newLL 
ResponseDTOLL "
(LL" #
)LL# $
{MM 
	IsSuccessNN 
=NN 
falseNN !
,NN! "

StatusCodeOO 
=OO 
$numOO  
,OO  !
MessagePP 
=PP 
ePP 
.PP 
MessagePP #
,PP# $
ResultQQ 
=QQ 
nullQQ 
}RR 
;RR 
}SS 	
}TT 
publicVV 

asyncVV 
TaskVV 
<VV 
ResponseDTOVV !
>VV! "&
GetSectionsDetailsVersionsVV# =
(WW 
ClaimsPrincipalXX 
UserXX 
,XX 
GuidYY 
?YY 
courseSectionIdYY 
,YY 
stringZZ 
?ZZ 
filterOnZZ 
,ZZ 
string[[ 
?[[ 
filterQuery[[ 
,[[ 
string\\ 
?\\ 
sortBy\\ 
,\\ 
bool]] 
?]] 
isAscending]] 
,]] 
int^^ 

pageNumber^^ 
,^^ 
int__ 
pageSize__ 
)__ 
{`` 
tryaa 
{bb 	
IEnumerablecc 
<cc !
SectionDetailsVersioncc -
>cc- .
sectionscc/ 7
;cc7 8
sectionsff 
=ff 
awaitff 
_unitOfWorkff (
.ff( )+
SectionDetailsVersionRepositoryff) H
.ffH I
GetAllAsyncffI T
(ffT U
xffU V
=>ffW Y
xgg 
.gg "
CourseSectionVersionIdgg (
==gg) +
courseSectionIdgg, ;
)gg; <
;gg< =
ifjj 
(jj 
!jj 
sectionsjj 
.jj 
Anyjj 
(jj 
)jj 
)jj  
{kk 
returnll 
newll 
ResponseDTOll &
(ll& '
)ll' (
{mm 
Messagenn 
=nn 
$strnn 4
,nn4 5
	IsSuccessoo 
=oo 
trueoo  $
,oo$ %

StatusCodepp 
=pp  
$numpp! $
,pp$ %
Resultqq 
=qq 
sectionsqq %
}rr 
;rr 
}ss 
varuu 
listSectionuu 
=uu 
sectionsuu &
.uu& '
ToListuu' -
(uu- .
)uu. /
;uu/ 0
ifxx 
(xx 
!xx 
stringxx 
.xx 
IsNullOrEmptyxx %
(xx% &
filterOnxx& .
)xx. /
&&xx0 2
!xx3 4
stringxx4 :
.xx: ;
IsNullOrEmptyxx; H
(xxH I
filterQueryxxI T
)xxT U
)xxU V
{yy 
switchzz 
(zz 
filterOnzz  
.zz  !
Trimzz! %
(zz% &
)zz& '
.zz' (
ToLowerzz( /
(zz/ 0
)zz0 1
)zz1 2
{{{ 
case|| 
$str|| 
:||  
listSection}} #
=}}$ %
listSection}}& 1
.}}1 2
Where}}2 7
(}}7 8
x}}8 9
=>}}: <
x~~ 
.~~ 
Name~~ "
.~~" #
Contains~~# +
(~~+ ,
filterQuery~~, 7
,~~7 8
StringComparison~~9 I
.~~I J$
CurrentCultureIgnoreCase~~J b
)~~b c
)~~c d
.~~d e
ToList~~e k
(~~k l
)~~l m
;~~m n
break 
; 
default
ÄÄ 
:
ÄÄ 
break
ÅÅ 
;
ÅÅ 
}
ÇÇ 
}
ÉÉ 
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
string
ÜÜ 
.
ÜÜ 
IsNullOrEmpty
ÜÜ %
(
ÜÜ% &
sortBy
ÜÜ& ,
)
ÜÜ, -
)
ÜÜ- .
{
áá 
switch
àà 
(
àà 
sortBy
àà 
.
àà 
Trim
àà #
(
àà# $
)
àà$ %
.
àà% &
ToLower
àà& -
(
àà- .
)
àà. /
)
àà/ 0
{
ââ 
case
ää 
$str
ää 
:
ää  
listSection
ãã #
=
ãã$ %
listSection
ãã& 1
.
ãã1 2
OrderBy
ãã2 9
(
ãã9 :
x
ãã: ;
=>
ãã< >
x
ãã? @
.
ãã@ A
Name
ããA E
)
ããE F
.
ããF G
ToList
ããG M
(
ããM N
)
ããN O
;
ããO P
break
åå 
;
åå 
default
çç 
:
çç 
break
éé 
;
éé 
}
èè 
}
êê 
if
ìì 
(
ìì 

pageNumber
ìì 
>
ìì 
$num
ìì 
&&
ìì !
pageSize
ìì" *
>
ìì+ ,
$num
ìì- .
)
ìì. /
{
îî 
var
ïï 

skipResult
ïï 
=
ïï  
(
ïï! "

pageNumber
ïï" ,
-
ïï- .
$num
ïï/ 0
)
ïï0 1
*
ïï2 3
pageSize
ïï4 <
;
ïï< =
listSection
ññ 
=
ññ 
listSection
ññ )
.
ññ) *
Skip
ññ* .
(
ññ. /

skipResult
ññ/ 9
)
ññ9 :
.
ññ: ;
Take
ññ; ?
(
ññ? @
pageSize
ññ@ H
)
ññH I
.
ññI J
ToList
ññJ P
(
ññP Q
)
ññQ R
;
ññR S
}
óó 
var
öö 

sectionDto
öö 
=
öö 
listSection
öö (
.
öö( )
Select
öö) /
(
öö/ 0
section
öö0 7
=>
öö8 :
new
öö; >$
GetAllSectionDetailDTO
öö? U
{
õõ 
Id
úú 
=
úú 
section
úú 
.
úú 
Id
úú 
,
úú  !
courseSectionDetail
ùù #
=
ùù$ %
section
ùù& -
.
ùù- .$
CourseSectionVersionId
ùù. D
,
ùùD E
name
ûû 
=
ûû 
section
ûû 
.
ûû 
Name
ûû #
,
ûû# $
videoUrl
üü 
=
üü 
section
üü "
.
üü" #
VideoUrl
üü# +
,
üü+ ,
slideUrl
†† 
=
†† 
section
†† "
.
††" #
SlideUrl
††# +
,
††+ ,
docsUrl
°° 
=
°° 
section
°° !
.
°°! "
DocsUrl
°°" )
,
°°) *
type
¢¢ 
=
¢¢ 
section
¢¢ 
.
¢¢ 
Type
¢¢ #
,
¢¢# $
currentStatus
££ 
=
££ 
section
££  '
.
££' (
CurrentStatus
££( 5
,
££5 6
}
§§ 
)
§§ 
.
§§ 
ToList
§§ 
(
§§ 
)
§§ 
;
§§ 
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ "
(
¶¶" #
)
¶¶# $
{
ßß 
Message
®® 
=
®® 
$str
®® D
,
®®D E
	IsSuccess
©© 
=
©© 
true
©©  
,
©©  !

StatusCode
™™ 
=
™™ 
$num
™™  
,
™™  !
Result
´´ 
=
´´ 

sectionDto
´´ #
}
¨¨ 
;
¨¨ 
}
≠≠ 	
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 	
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ "
(
∞∞" #
)
∞∞# $
{
±± 
Message
≤≤ 
=
≤≤ 
e
≤≤ 
.
≤≤ 
Message
≤≤ #
,
≤≤# $
Result
≥≥ 
=
≥≥ 
null
≥≥ 
,
≥≥ 
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥ !
,
¥¥! "

StatusCode
µµ 
=
µµ 
$num
µµ  
}
∂∂ 
;
∂∂ 
}
∑∑ 	
}
∏∏ 
public
∫∫ 

async
∫∫ 
Task
∫∫ 
<
∫∫ 
ResponseDTO
∫∫ !
>
∫∫! "&
GetSectionDetailsVersion
∫∫# ;
(
∫∫; <
ClaimsPrincipal
∫∫< K
User
∫∫L P
,
∫∫P Q
Guid
∫∫R V
	detailsId
∫∫W `
)
∫∫` a
{
ªª 
try
ºº 
{
ΩΩ 	
var
ææ 
detail
ææ 
=
ææ 
await
øø 
_unitOfWork
øø !
.
øø! "-
SectionDetailsVersionRepository
øø" A
.
øøA B*
GetSectionDetailsVersionById
øøB ^
(
øø^ _
	detailsId
øø_ h
)
øøh i
;
øøi j
if
¡¡ 
(
¡¡ 
detail
¡¡ 
is
¡¡ 
null
¡¡ 
)
¡¡ 
{
¬¬ 
return
√√ 
new
√√ 
ResponseDTO
√√ &
(
√√& '
)
√√' (
{
ƒƒ 
Result
≈≈ 
=
≈≈ 
$str
≈≈ 
,
≈≈  
Message
∆∆ 
=
∆∆ 
$str
∆∆ K
,
∆∆K L
	IsSuccess
«« 
=
«« 
true
««  $
,
««$ %

StatusCode
»» 
=
»»  
$num
»»! $
}
…… 
;
…… 
}
   
var
ÃÃ 
sectionDetail
ÃÃ 
=
ÃÃ 
new
ÃÃ  ##
SectionDetailsVersion
ÃÃ$ 9
{
ÕÕ 
Id
ŒŒ 
=
ŒŒ 
	detailsId
ŒŒ 
,
ŒŒ $
CourseSectionVersionId
œœ &
=
œœ' (
detail
œœ) /
.
œœ/ 0$
CourseSectionVersionId
œœ0 F
,
œœF G
Name
–– 
=
–– 
detail
–– 
.
–– 
Name
–– "
,
––" #
VideoUrl
—— 
=
—— 
detail
—— !
.
——! "
VideoUrl
——" *
,
——* +
SlideUrl
““ 
=
““ 
detail
““ !
.
““! "
SlideUrl
““" *
,
““* +
DocsUrl
”” 
=
”” 
detail
””  
.
””  !
DocsUrl
””! (
,
””( )
Type
‘‘ 
=
‘‘ 
detail
‘‘ 
.
‘‘ 
Type
‘‘ "
,
‘‘" #
CurrentStatus
’’ 
=
’’ 
detail
’’  &
.
’’& '
CurrentStatus
’’' 4
,
’’4 5
}
÷÷ 
;
÷÷ 
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
{
ŸŸ 
Result
⁄⁄ 
=
⁄⁄ 
sectionDetail
⁄⁄ &
,
⁄⁄& '
Message
€€ 
=
€€ 
$str
€€ B
,
€€B C
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  
,
‹‹  !

StatusCode
›› 
=
›› 
$num
››  
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 	
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
(
‚‚" #
)
‚‚# $
{
„„ 
Result
‰‰ 
=
‰‰ 
null
‰‰ 
,
‰‰ 
Message
ÂÂ 
=
ÂÂ 
e
ÂÂ 
.
ÂÂ 
Message
ÂÂ #
,
ÂÂ# $
	IsSuccess
ÊÊ 
=
ÊÊ 
true
ÊÊ  
,
ÊÊ  !

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
}
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
public
ÏÏ 

async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
ResponseDTO
ÏÏ !
>
ÏÏ! ")
CreateSectionDetailsVersion
ÏÏ# >
(
ÌÌ 
ClaimsPrincipal
ÓÓ 
User
ÓÓ 
,
ÓÓ ,
CreateSectionDetailsVersionDTO
ÔÔ &,
createSectionDetailsVersionDto
ÔÔ' E
)
 
{
ÒÒ 
try
ÚÚ 
{
ÛÛ 	
var
ÙÙ 
Id
ÙÙ 
=
ÙÙ 
await
ıı 
_unitOfWork
ıı !
.
ıı! ",
CourseSectionVersionRepository
ıı" @
.
ıı@ A
GetAsync
ııA I
(
ııI J
i
ııJ K
=>
ııL N
i
ˆˆ 
.
ˆˆ 
Id
ˆˆ 
==
ˆˆ ,
createSectionDetailsVersionDto
ˆˆ :
.
ˆˆ: ;$
courseSectionVersionId
ˆˆ; Q
)
ˆˆQ R
;
ˆˆR S
if
˜˜ 
(
˜˜ 
Id
˜˜ 
==
˜˜ 
null
˜˜ 
)
˜˜ 
{
¯¯ 
return
˘˘ 
new
˘˘ 
ResponseDTO
˘˘ &
(
˘˘& '
)
˘˘' (
{
˙˙ 
Message
˚˚ 
=
˚˚ 
$str
˚˚ >
,
˚˚> ?
Result
¸¸ 
=
¸¸ 
null
¸¸ !
,
¸¸! "
	IsSuccess
˝˝ 
=
˝˝ 
false
˝˝  %
,
˝˝% &

StatusCode
˛˛ 
=
˛˛  
$num
˛˛! $
}
ˇˇ 
;
ˇˇ 
}
ÄÄ 
var
ÇÇ 
sectionDetail
ÇÇ 
=
ÇÇ 
new
ÇÇ  ##
SectionDetailsVersion
ÇÇ$ 9
{
ÉÉ $
CourseSectionVersionId
ÑÑ &
=
ÑÑ' (,
createSectionDetailsVersionDto
ÑÑ) G
?
ÑÑG H
.
ÑÑH I$
courseSectionVersionId
ÑÑI _
,
ÑÑ_ `
Name
ÖÖ 
=
ÖÖ ,
createSectionDetailsVersionDto
ÖÖ 5
?
ÖÖ5 6
.
ÖÖ6 7
name
ÖÖ7 ;
,
ÖÖ; <
}
ÜÜ 
;
ÜÜ 
await
àà 
_unitOfWork
àà 
.
àà -
SectionDetailsVersionRepository
àà =
.
àà= >
AddAsync
àà> F
(
ààF G
sectionDetail
ààG T
)
ààT U
;
ààU V
await
ââ 
_unitOfWork
ââ 
.
ââ 
	SaveAsync
ââ '
(
ââ' (
)
ââ( )
;
ââ) *
return
ãã 
new
ãã 
ResponseDTO
ãã "
{
åå 
Message
çç 
=
çç 
$str
çç >
,
çç> ?
Result
éé 
=
éé 
null
éé 
,
éé 
	IsSuccess
èè 
=
èè 
true
èè  
,
èè  !

StatusCode
êê 
=
êê 
$num
êê  
}
ëë 
;
ëë 
}
íí 	
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 	
return
óó 
new
óó 
ResponseDTO
óó "
{
òò 
Message
ôô 
=
ôô 
e
ôô 
.
ôô 
Message
ôô #
,
ôô# $
Result
öö 
=
öö 
null
öö 
,
öö 
	IsSuccess
õõ 
=
õõ 
false
õõ !
,
õõ! "

StatusCode
úú 
=
úú 
$num
úú  
}
ùù 
;
ùù 
}
ûû 	
}
üü 
public
°° 

async
°° 
Task
°° 
<
°° 
ResponseDTO
°° !
>
°°! "'
EditSectionDetailsVersion
°°# <
(
¢¢ 
ClaimsPrincipal
££ 
User
££ 
,
££ *
EditSectionDetailsVersionDTO
§§ $*
editSectionDetailsVersionDto
§§% A
)
•• 
{
¶¶ 
try
ßß 
{
®® 	
var
©© 
id
©© 
=
©© 
await
©© 
_unitOfWork
©© &
.
©©& '-
SectionDetailsVersionRepository
©©' F
.
©©F G
GetAsync
©©G O
(
©©O P
i
©©P Q
=>
©©R T
i
™™ 
.
™™ 
Id
™™ 
==
™™ *
editSectionDetailsVersionDto
™™ 4
.
™™4 5
sectionDetailId
™™5 D
)
™™D E
;
™™E F
if
¨¨ 
(
¨¨ 
id
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨ 
{
≠≠ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ &
(
ÆÆ& '
)
ÆÆ' (
{
ØØ 
Message
∞∞ 
=
∞∞ 
$str
∞∞ >
,
∞∞> ?
Result
±± 
=
±± 
null
±± !
,
±±! "
	IsSuccess
≤≤ 
=
≤≤ 
false
≤≤  %
,
≤≤% &

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
}
¥¥ 
;
¥¥ 
}
µµ 
id
∑∑ 
.
∑∑ $
CourseSectionVersionId
∑∑ %
=
∑∑& '*
editSectionDetailsVersionDto
∑∑( D
.
∑∑D E
courseSectionId
∑∑E T
;
∑∑T U
id
∏∏ 
.
∏∏ 
Name
∏∏ 
=
∏∏ *
editSectionDetailsVersionDto
∏∏ 2
?
∏∏2 3
.
∏∏3 4
name
∏∏4 8
;
∏∏8 9
_unitOfWork
ªª 
.
ªª -
SectionDetailsVersionRepository
ªª 7
.
ªª7 8
Update
ªª8 >
(
ªª> ?
id
ªª? A
)
ªªA B
;
ªªB C
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
return
ææ 
new
ææ 
ResponseDTO
ææ "
{
øø 
Message
¿¿ 
=
¿¿ 
$str
¿¿ <
,
¿¿< =
Result
¡¡ 
=
¡¡ 
id
¡¡ 
,
¡¡ 
	IsSuccess
¬¬ 
=
¬¬ 
true
¬¬  
,
¬¬  !

StatusCode
√√ 
=
√√ 
$num
√√  
}
ƒƒ 
;
ƒƒ 
}
≈≈ 	
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
e
∆∆ 
)
∆∆ 
{
«« 	
return
»» 
new
»» 
ResponseDTO
»» "
{
…… 
Message
   
=
   
e
   
.
   
Message
   #
,
  # $
Result
ÀÀ 
=
ÀÀ 
null
ÀÀ 
,
ÀÀ 
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ !
,
ÃÃ! "

StatusCode
ÕÕ 
=
ÕÕ 
$num
ÕÕ  
}
ŒŒ 
;
ŒŒ 
}
œœ 	
}
–– 
public
““ 

async
““ 
Task
““ 
<
““ 
ResponseDTO
““ !
>
““! ")
RemoveSectionDetailsVersion
““# >
(
”” 
ClaimsPrincipal
‘‘ 
User
‘‘ 
,
‘‘ 
Guid
’’ 
	detailsId
’’ 
)
÷÷ 
{
◊◊ 
try
ÿÿ 
{
ŸŸ 	
var
⁄⁄ 
Id
⁄⁄ 
=
⁄⁄ 
await
⁄⁄ 
_unitOfWork
⁄⁄ &
.
⁄⁄& '-
SectionDetailsVersionRepository
⁄⁄' F
.
⁄⁄F G
GetAsync
⁄⁄G O
(
⁄⁄O P
i
⁄⁄P Q
=>
⁄⁄R T
i
⁄⁄U V
.
⁄⁄V W
Id
⁄⁄W Y
==
⁄⁄Z \
	detailsId
⁄⁄] f
)
⁄⁄f g
;
⁄⁄g h
if
€€ 
(
€€ 
Id
€€ 
==
€€ 
null
€€ 
)
€€ 
{
‹‹ 
return
›› 
new
›› 
ResponseDTO
›› &
(
››& '
)
››' (
{
ﬁﬁ 
Message
ﬂﬂ 
=
ﬂﬂ 
$str
ﬂﬂ >
,
ﬂﬂ> ?
Result
‡‡ 
=
‡‡ 
null
‡‡ !
,
‡‡! "
	IsSuccess
·· 
=
·· 
false
··  %
,
··% &

StatusCode
‚‚ 
=
‚‚  
$num
‚‚! $
}
„„ 
;
„„ 
}
‰‰ 
_unitOfWork
ÁÁ 
.
ÁÁ -
SectionDetailsVersionRepository
ÁÁ 7
.
ÁÁ7 8
Remove
ÁÁ8 >
(
ÁÁ> ?
Id
ÁÁ? A
)
ÁÁA B
;
ÁÁB C
await
ËË 
_unitOfWork
ËË 
.
ËË 
	SaveAsync
ËË '
(
ËË' (
)
ËË( )
;
ËË) *
return
ÍÍ 
new
ÍÍ 
ResponseDTO
ÍÍ "
(
ÍÍ" #
)
ÍÍ# $
{
ÎÎ 
Message
ÏÏ 
=
ÏÏ 
$str
ÏÏ E
,
ÏÏE F
Result
ÌÌ 
=
ÌÌ 
null
ÌÌ 
,
ÌÌ 
	IsSuccess
ÓÓ 
=
ÓÓ 
true
ÓÓ  
,
ÓÓ  !

StatusCode
ÔÔ 
=
ÔÔ 
$num
ÔÔ  
}
 
;
 
}
ÒÒ 	
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 	
return
ÙÙ 
new
ÙÙ 
ResponseDTO
ÙÙ "
{
ıı 
Message
ˆˆ 
=
ˆˆ 
e
ˆˆ 
.
ˆˆ 
Message
ˆˆ #
,
ˆˆ# $
Result
˜˜ 
=
˜˜ 
null
˜˜ 
,
˜˜ 
	IsSuccess
¯¯ 
=
¯¯ 
false
¯¯ !
,
¯¯! "

StatusCode
˘˘ 
=
˘˘ 
$num
˘˘  
}
˙˙ 
;
˙˙ 
}
˚˚ 	
}
¸¸ 
public
˛˛ 

async
˛˛ 
Task
˛˛ 
<
˛˛ 
ResponseDTO
˛˛ !
>
˛˛! "0
"UploadSectionDetailsVersionContent
˛˛# E
(
ˇˇ 
ClaimsPrincipal
ÄÄ 
User
ÄÄ 
,
ÄÄ 
Guid
ÅÅ 
	detailsId
ÅÅ 
,
ÅÅ 3
%UploadSectionDetailsVersionContentDTO
ÇÇ -3
%uploadSectionDetailsVersionContentDto
ÇÇ. S
)
ÉÉ 
{
ÑÑ 
try
ÖÖ 
{
ÜÜ 	
if
àà 
(
àà 3
%uploadSectionDetailsVersionContentDto
àà 5
.
àà5 6
File
àà6 :
==
àà; =
null
àà> B
)
ààB C
{
ââ 
return
ää 
new
ää 
ResponseDTO
ää &
(
ää& '
)
ää' (
{
ãã 
	IsSuccess
åå 
=
åå 
false
åå  %
,
åå% &

StatusCode
çç 
=
çç  
$num
çç! $
,
çç$ %
Message
éé 
=
éé 
$str
éé 1
}
èè 
;
èè 
}
êê 
var
íí 
fileExtension
íí 
=
íí 
Path
íí  $
.
íí$ %
GetExtension
íí% 1
(
íí1 23
%uploadSectionDetailsVersionContentDto
íí2 W
.
ííW X
File
ííX \
.
íí\ ]
FileName
íí] e
)
ííe f
.
ííf g
ToLower
ííg n
(
íín o
)
íío p
;
ííp q
string
ìì 
[
ìì 
]
ìì 
allowedExtensions
ìì &
=
ìì' (
{
ìì) *
$str
ìì+ 2
,
ìì2 3
$str
ìì4 :
,
ìì: ;
$str
ìì< B
,
ììB C
$str
ììD J
}
ììK L
;
ììL M
if
ïï 
(
ïï 
!
ïï 
allowedExtensions
ïï "
.
ïï" #
Contains
ïï# +
(
ïï+ ,
fileExtension
ïï, 9
)
ïï9 :
)
ïï: ;
{
ññ 
return
óó 
new
óó 
ResponseDTO
óó &
(
óó& '
)
óó' (
{
òò 
	IsSuccess
ôô 
=
ôô 
false
ôô  %
,
ôô% &

StatusCode
öö 
=
öö  
$num
öö! $
,
öö$ %
Message
õõ 
=
õõ 
$str
õõ a
}
úú 
;
úú 
}
ùù 
var
†† 
userId
†† 
=
†† 
User
†† 
.
†† 
Claims
†† $
.
††$ %
FirstOrDefault
††% 3
(
††3 4
x
††4 5
=>
††6 8
x
††9 :
.
††: ;
Type
††; ?
==
††@ B

ClaimTypes
††C M
.
††M N
NameIdentifier
††N \
)
††\ ]
?
††] ^
.
††^ _
Value
††_ d
;
††d e
if
°° 
(
°° 
string
°° 
.
°° 
IsNullOrEmpty
°° $
(
°°$ %
userId
°°% +
)
°°+ ,
)
°°, -
{
¢¢ 
return
££ 
new
££ 
ResponseDTO
££ &
(
££& '
)
££' (
{
§§ 
	IsSuccess
•• 
=
•• 
false
••  %
,
••% &

StatusCode
¶¶ 
=
¶¶  
$num
¶¶! $
,
¶¶$ %
Message
ßß 
=
ßß 
$str
ßß :
}
®® 
;
®® 
}
©© 
var
¨¨ 

instructor
¨¨ 
=
¨¨ 
await
¨¨ "
_unitOfWork
¨¨# .
.
¨¨. /"
InstructorRepository
¨¨/ C
.
¨¨C D
GetAsync
¨¨D L
(
¨¨L M
x
¨¨M N
=>
¨¨O Q
x
¨¨R S
.
¨¨S T
UserId
¨¨T Z
==
¨¨[ ]
userId
¨¨^ d
)
¨¨d e
;
¨¨e f
if
≠≠ 
(
≠≠ 

instructor
≠≠ 
==
≠≠ 
null
≠≠ "
)
≠≠" #
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
(
ØØ& '
)
ØØ' (
{
∞∞ 
	IsSuccess
±± 
=
±± 
false
±±  %
,
±±% &

StatusCode
≤≤ 
=
≤≤  
$num
≤≤! $
,
≤≤$ %
Message
≥≥ 
=
≥≥ 
$str
≥≥ :
}
¥¥ 
;
¥¥ 
}
µµ 
var
ππ 
courseDetail
ππ 
=
ππ 
await
ππ $
_unitOfWork
ππ% 0
.
ππ0 1-
SectionDetailsVersionRepository
ππ1 P
.
ππP Q
GetAsync
ππQ Y
(
ππY Z
x
ππZ [
=>
ππ\ ^
x
∫∫ 
.
∫∫ 
Id
∫∫ 
==
∫∫ 
	detailsId
∫∫ !
)
∫∫! "
;
∫∫" #
if
ªª 
(
ªª 
courseDetail
ªª 
==
ªª 
null
ªª  $
)
ªª$ %
{
ºº 
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ &
(
ΩΩ& '
)
ΩΩ' (
{
ææ 
	IsSuccess
øø 
=
øø 
false
øø  %
,
øø% &

StatusCode
¿¿ 
=
¿¿  
$num
¿¿! $
,
¿¿$ %
Message
¡¡ 
=
¡¡ 
$str
¡¡ I
}
¬¬ 
;
¬¬ 
}
√√ 
var
≈≈ 
courseSection
≈≈ 
=
≈≈ 
await
∆∆ 
_unitOfWork
∆∆ !
.
∆∆! ",
CourseSectionVersionRepository
∆∆" @
.
∆∆@ A
GetAsync
∆∆A I
(
∆∆I J
x
∆∆J K
=>
∆∆L N
x
«« 
.
«« 
Id
«« 
==
«« 
courseDetail
«« (
.
««( )$
CourseSectionVersionId
««) ?
)
««? @
;
««@ A
if
»» 
(
»» 
courseSection
»» 
==
»»  
null
»»! %
)
»»% &
{
…… 
return
   
new
   
ResponseDTO
   &
(
  & '
)
  ' (
{
ÀÀ 
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ  %
,
ÃÃ% &

StatusCode
ÕÕ 
=
ÕÕ  
$num
ÕÕ! $
,
ÕÕ$ %
Message
ŒŒ 
=
ŒŒ 
$str
ŒŒ A
}
œœ 
;
œœ 
}
–– 
var
““ 
courseVersion
““ 
=
““ 
await
”” 
_unitOfWork
”” !
.
””! "%
CourseVersionRepository
””" 9
.
””9 :
GetAsync
””: B
(
””B C
x
””C D
=>
””E G
x
””H I
.
””I J
Id
””J L
==
””M O
courseSection
””P ]
.
””] ^
CourseVersionId
””^ m
)
””m n
;
””n o
if
‘‘ 
(
‘‘ 
courseVersion
‘‘ 
==
‘‘  
null
‘‘! %
)
‘‘% &
{
’’ 
return
÷÷ 
new
÷÷ 
ResponseDTO
÷÷ &
(
÷÷& '
)
÷÷' (
{
◊◊ 
	IsSuccess
ÿÿ 
=
ÿÿ 
false
ÿÿ  %
,
ÿÿ% &

StatusCode
ŸŸ 
=
ŸŸ  
$num
ŸŸ! $
,
ŸŸ$ %
Message
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄ 9
}
€€ 
;
€€ 
}
‹‹ 
var
ﬂﬂ 
courseId
ﬂﬂ 
=
ﬂﬂ 
courseVersion
ﬂﬂ (
.
ﬂﬂ( )
CourseId
ﬂﬂ) 1
;
ﬂﬂ1 2
ResponseDTO
‚‚ 
responseDto
‚‚ #
;
‚‚# $
if
„„ 
(
„„ 
fileExtension
„„ 
==
„„  
$str
„„! '
||
„„( *
fileExtension
„„+ 8
==
„„9 ;
$str
„„< B
)
„„B C
{
‰‰ 
responseDto
ÂÂ 
=
ÂÂ 
await
ÂÂ #
_firebaseService
ÂÂ$ 4
.
ÂÂ4 5
UploadVideo
ÂÂ5 @
(
ÂÂ@ A3
%uploadSectionDetailsVersionContentDto
ÂÂA f
.
ÂÂf g
File
ÂÂg k
,
ÂÂk l
courseId
ÂÂm u
)
ÂÂu v
;
ÂÂv w
courseDetail
ÁÁ 
.
ÁÁ 
VideoUrl
ÁÁ %
=
ÁÁ& '
responseDto
ÁÁ( 3
.
ÁÁ3 4
Result
ÁÁ4 :
?
ÁÁ: ;
.
ÁÁ; <
ToString
ÁÁ< D
(
ÁÁD E
)
ÁÁE F
;
ÁÁF G
}
ËË 
else
ÈÈ 
if
ÈÈ 
(
ÈÈ 
fileExtension
ÈÈ "
==
ÈÈ# %
$str
ÈÈ& ,
)
ÈÈ, -
{
ÍÍ 
responseDto
ÎÎ 
=
ÎÎ 
await
ÎÎ #
_firebaseService
ÎÎ$ 4
.
ÎÎ4 5
UploadSlide
ÎÎ5 @
(
ÎÎ@ A3
%uploadSectionDetailsVersionContentDto
ÎÎA f
.
ÎÎf g
File
ÎÎg k
,
ÎÎk l
courseId
ÎÎm u
)
ÎÎu v
;
ÎÎv w
courseDetail
ÌÌ 
.
ÌÌ 
SlideUrl
ÌÌ %
=
ÌÌ& '
responseDto
ÌÌ( 3
.
ÌÌ3 4
Result
ÌÌ4 :
?
ÌÌ: ;
.
ÌÌ; <
ToString
ÌÌ< D
(
ÌÌD E
)
ÌÌE F
;
ÌÌF G
}
ÓÓ 
else
ÔÔ 
{
 
responseDto
ÒÒ 
=
ÒÒ 
await
ÒÒ #
_firebaseService
ÒÒ$ 4
.
ÒÒ4 5
	UploadDoc
ÒÒ5 >
(
ÒÒ> ?3
%uploadSectionDetailsVersionContentDto
ÒÒ? d
.
ÒÒd e
File
ÒÒe i
,
ÒÒi j
courseId
ÒÒk s
)
ÒÒs t
;
ÒÒt u
courseDetail
ÛÛ 
.
ÛÛ 
DocsUrl
ÛÛ $
=
ÛÛ% &
responseDto
ÛÛ' 2
.
ÛÛ2 3
Result
ÛÛ3 9
?
ÛÛ9 :
.
ÛÛ: ;
ToString
ÛÛ; C
(
ÛÛC D
)
ÛÛD E
;
ÛÛE F
}
ÙÙ 
if
ˆˆ 
(
ˆˆ 
!
ˆˆ 
responseDto
ˆˆ 
.
ˆˆ 
	IsSuccess
ˆˆ &
)
ˆˆ& '
{
˜˜ 
return
¯¯ 
new
¯¯ 
ResponseDTO
¯¯ &
(
¯¯& '
)
¯¯' (
{
˘˘ 
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
,
˚˚$ %
Message
¸¸ 
=
¸¸ 
$str
¸¸ 3
}
˝˝ 
;
˝˝ 
}
˛˛ 
courseDetail
ÅÅ 
.
ÅÅ #
UpdateTypeDescription
ÅÅ .
(
ÅÅ. /
)
ÅÅ/ 0
;
ÅÅ0 1
_unitOfWork
ÉÉ 
.
ÉÉ -
SectionDetailsVersionRepository
ÉÉ 7
.
ÉÉ7 8
Update
ÉÉ8 >
(
ÉÉ> ?
courseDetail
ÉÉ? K
)
ÉÉK L
;
ÉÉL M
await
ÑÑ 
_unitOfWork
ÑÑ 
.
ÑÑ 
	SaveAsync
ÑÑ '
(
ÑÑ' (
)
ÑÑ( )
;
ÑÑ) *
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ "
(
ÜÜ" #
)
ÜÜ# $
{
áá 
	IsSuccess
àà 
=
àà 
true
àà  
,
àà  !

StatusCode
ââ 
=
ââ 
$num
ââ  
,
ââ  !
Result
ää 
=
ää 
responseDto
ää $
.
ää$ %
Result
ää% +
,
ää+ ,
Message
ãã 
=
ãã 
$str
ãã 4
}
åå 
;
åå 
}
çç 	
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 	
return
êê 
new
êê 
ResponseDTO
êê "
(
êê" #
)
êê# $
{
ëë 
	IsSuccess
íí 
=
íí 
false
íí !
,
íí! "

StatusCode
ìì 
=
ìì 
$num
ìì  
,
ìì  !
Result
îî 
=
îî 
null
îî 
,
îî 
Message
ïï 
=
ïï 
e
ïï 
.
ïï 
Message
ïï #
}
ññ 
;
ññ 
}
óó 	
}
òò 
public
öö 

async
öö 
Task
öö 
<
öö  
ContentResponseDTO
öö (
>
öö( )1
#DisplaySectionDetailsVersionContent
öö* M
(
õõ 
ClaimsPrincipal
úú 
User
úú 
,
úú 
Guid
ùù %
sectionDetailsVersionId
ùù $
,
ùù$ %
string
ûû 
type
ûû 
)
üü 
{
†† 
try
°° 
{
¢¢ 	
if
££ 
(
££ %
sectionDetailsVersionId
££ '
.
££' (
ToString
££( 0
(
££0 1
)
££1 2
.
££2 3
IsNullOrEmpty
££3 @
(
££@ A
)
££A B
)
££B C
{
§§ 
throw
•• 
new
•• 
	Exception
•• #
(
••# $
$str
••$ D
)
••D E
;
••E F
}
¶¶ 
if
®® 
(
®® 
type
®® 
.
®® 
IsNullOrEmpty
®® "
(
®®" #
)
®®# $
)
®®$ %
{
©© 
throw
™™ 
new
™™ 
	Exception
™™ #
(
™™# $
$str
™™$ ;
)
™™; <
;
™™< =
}
´´ 
var
≠≠ "
sectionDetailVersion
≠≠ $
=
≠≠% &
await
≠≠' ,
_unitOfWork
≠≠- 8
.
≠≠8 9-
SectionDetailsVersionRepository
≠≠9 X
.
ÆÆ 
GetAsync
ÆÆ 
(
ÆÆ 
x
ÆÆ 
=>
ÆÆ 
x
ÆÆ  
.
ÆÆ  !
Id
ÆÆ! #
==
ÆÆ$ &%
sectionDetailsVersionId
ÆÆ' >
)
ÆÆ> ?
;
ÆÆ? @
if
∞∞ 
(
∞∞ "
sectionDetailVersion
∞∞ $
is
∞∞% '
null
∞∞( ,
)
∞∞, -
{
±± 
throw
≤≤ 
new
≤≤ 
	Exception
≤≤ #
(
≤≤# $
$str
≤≤$ D
)
≤≤D E
;
≤≤E F
}
≥≥ 
var
µµ 
stream
µµ 
=
µµ 
new
µµ 
MemoryStream
µµ )
(
µµ) *
)
µµ* +
;
µµ+ ,
var
∂∂ 
contentType
∂∂ 
=
∂∂ 
$str
∂∂ 7
;
∂∂7 8
string
∑∑ 
?
∑∑ 
filePath
∑∑ 
=
∑∑ 
null
∑∑ #
;
∑∑# $
switch
ππ 
(
ππ 
type
ππ 
.
ππ 
ToLower
ππ  
(
ππ  !
)
ππ! "
)
ππ" #
{
∫∫ 
case
ªª 
$str
ªª 
:
ªª 
{
ºº 
filePath
ΩΩ 
=
ΩΩ "
sectionDetailVersion
ΩΩ 3
.
ΩΩ3 4
VideoUrl
ΩΩ4 <
;
ΩΩ< =
if
øø 
(
øø 
filePath
øø  
==
øø! #
null
øø$ (
)
øø( )
{
¿¿ 
throw
¡¡ 
new
¡¡ !
	Exception
¡¡" +
(
¡¡+ ,
$str
¡¡, C
)
¡¡C D
;
¡¡D E
}
¬¬ 
stream
ƒƒ 
=
ƒƒ 
await
ƒƒ "
_firebaseService
ƒƒ# 3
.
ƒƒ3 4

GetContent
ƒƒ4 >
(
ƒƒ> ?
filePath
ƒƒ? G
)
ƒƒG H
;
ƒƒH I
if
∆∆ 
(
∆∆ 
filePath
∆∆  
.
∆∆  !
EndsWith
∆∆! )
(
∆∆) *
$str
∆∆* 0
)
∆∆0 1
)
∆∆1 2
{
«« 
contentType
»» #
=
»»$ %"
StaticFileExtensions
»»& :
.
»»: ;
Mp4
»»; >
;
»»> ?
}
…… 
if
ÀÀ 
(
ÀÀ 
filePath
ÀÀ  
.
ÀÀ  !
EndsWith
ÀÀ! )
(
ÀÀ) *
$str
ÀÀ* 0
)
ÀÀ0 1
)
ÀÀ1 2
{
ÃÃ 
contentType
ÕÕ #
=
ÕÕ$ %"
StaticFileExtensions
ÕÕ& :
.
ÕÕ: ;
Mov
ÕÕ; >
;
ÕÕ> ?
}
ŒŒ 
break
–– 
;
–– 
}
—— 
case
““ 
$str
““ 
:
““ 
{
”” 
filePath
‘‘ 
=
‘‘ "
sectionDetailVersion
‘‘ 3
.
‘‘3 4
SlideUrl
‘‘4 <
;
‘‘< =
if
÷÷ 
(
÷÷ 
filePath
÷÷  
==
÷÷! #
null
÷÷$ (
)
÷÷( )
{
◊◊ 
throw
ÿÿ 
new
ÿÿ !
	Exception
ÿÿ" +
(
ÿÿ+ ,
$str
ÿÿ, C
)
ÿÿC D
;
ÿÿD E
}
ŸŸ 
stream
€€ 
=
€€ 
await
€€ "
_firebaseService
€€# 3
.
€€3 4

GetContent
€€4 >
(
€€> ?
filePath
€€? G
)
€€G H
;
€€H I
contentType
‹‹ 
=
‹‹  !"
StaticFileExtensions
‹‹" 6
.
‹‹6 7
Pdf
‹‹7 :
;
‹‹: ;
break
›› 
;
›› 
}
ﬁﬁ 
case
ﬂﬂ 
$str
ﬂﬂ 
:
ﬂﬂ 
{
‡‡ 
filePath
·· 
=
·· "
sectionDetailVersion
·· 3
.
··3 4
DocsUrl
··4 ;
;
··; <
if
„„ 
(
„„ 
filePath
„„  
==
„„! #
null
„„$ (
)
„„( )
{
‰‰ 
throw
ÂÂ 
new
ÂÂ !
	Exception
ÂÂ" +
(
ÂÂ+ ,
$str
ÂÂ, C
)
ÂÂC D
;
ÂÂD E
}
ÊÊ 
stream
ËË 
=
ËË 
await
ËË "
_firebaseService
ËË# 3
.
ËË3 4

GetContent
ËË4 >
(
ËË> ?
filePath
ËË? G
)
ËËG H
;
ËËH I
contentType
ÈÈ 
=
ÈÈ  !"
StaticFileExtensions
ÈÈ" 6
.
ÈÈ6 7
Doc
ÈÈ7 :
;
ÈÈ: ;
break
ÎÎ 
;
ÎÎ 
}
ÏÏ 
}
ÌÌ 
if
ÔÔ 
(
ÔÔ 
stream
ÔÔ 
is
ÔÔ 
null
ÔÔ 
)
ÔÔ 
{
 
throw
ÒÒ 
new
ÒÒ 
	Exception
ÒÒ #
(
ÒÒ# $
$str
ÒÒ$ F
)
ÒÒF G
;
ÒÒG H
}
ÚÚ 
return
ıı 
new
ıı  
ContentResponseDTO
ıı )
(
ıı) *
)
ıı* +
{
ˆˆ 
Message
˜˜ 
=
˜˜ 
$str
˜˜ 1
,
˜˜1 2
Stream
¯¯ 
=
¯¯ 
stream
¯¯ 
,
¯¯  
ContentType
˘˘ 
=
˘˘ 
contentType
˘˘ )
,
˘˘) *
FileName
˙˙ 
=
˙˙ 
Path
˙˙ 
.
˙˙  
GetFileName
˙˙  +
(
˙˙+ ,
filePath
˙˙, 4
)
˙˙4 5
}
˚˚ 
;
˚˚ 
}
¸¸ 	
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 	
return
ˇˇ 
new
ˇˇ  
ContentResponseDTO
ˇˇ )
(
ˇˇ) *
)
ˇˇ* +
{
ÄÄ 
ContentType
ÅÅ 
=
ÅÅ 
null
ÅÅ "
,
ÅÅ" #
Message
ÇÇ 
=
ÇÇ 
e
ÇÇ 
.
ÇÇ 
Message
ÇÇ #
,
ÇÇ# $
Stream
ÉÉ 
=
ÉÉ 
null
ÉÉ 
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá ´
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\RedisService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
RedisService 
: 
IRedisService )
{ 
private 
readonly "
IConnectionMultiplexer +
_redis, 2
;2 3
public

 

RedisService

 
(

 "
IConnectionMultiplexer

 .
redis

/ 4
)

4 5
{ 
_redis 
= 
redis 
; 
} 
public 

async 
Task 
< 
bool 
> 
StoreString '
(' (
string( .
key/ 2
,2 3
string4 :
value; @
)@ A
{ 
var 
cache 
= 
_redis 
. 
GetDatabase &
(& '
)' (
;( )
var 
result 
= 
await 
cache  
.  !
StringSetAsync! /
(/ 0
key0 3
,3 4
value5 :
): ;
;; <
return 
result 
; 
} 
public!! 

async!! 
Task!! 
<!! 
string!! 
>!! 
RetrieveString!! ,
(!!, -
string!!- 3
key!!4 7
)!!7 8
{"" 
var## 
cache## 
=## 
_redis## 
.## 
GetDatabase## &
(##& '
)##' (
;##( )
var$$ 
result$$ 
=$$ 
await$$ 
cache$$  
.$$  !
StringGetAsync$$! /
($$/ 0
key$$0 3
)$$3 4
;$$4 5
return%% 
result%% 
;%% 
}&& 
public-- 

async-- 
Task-- 
<-- 
bool-- 
>-- 
DeleteString-- (
(--( )
string--) /
key--0 3
)--3 4
{.. 
var// 
cache// 
=// 
_redis// 
.// 
GetDatabase// &
(//& '
)//' (
;//( )
var00 
result00 
=00 
await00 
cache00  
.00  !
KeyDeleteAsync00! /
(00/ 0
key000 3
)003 4
;004 5
return11 
result11 
;11 
}22 
}33 „ë
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\PaymentService.cs
	namespace		 	
Cursus		
 
.		 
LMS		 
.		 
Service		 
.		 
Service		 $
;		$ %
public 
class 
PaymentService 
: 
IPaymentService -
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IBalanceService $
_balanceService% 4
;4 5
private 
readonly 
ITransactionService (
_transactionService) <
;< =
private 
readonly 
IStripeService #
_stripeService$ 2
;2 3
public 

PaymentService 
( 
IUnitOfWork 

unitOfWork 
, 
IBalanceService 
balanceService &
,& '
ITransactionService 
transactionService .
,. /
IStripeService 
stripeService $
) 
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_balanceService 
= 
balanceService (
;( )
_transactionService 
= 
transactionService 0
;0 1
_stripeService 
= 
stripeService &
;& '
} 
public   

async   
Task   
<   
ResponseDTO   !
>  ! "+
UpdateAvailableBalanceByOrderId  # B
(  B C
Guid  C G
orderHeaderId  H U
)  U V
{!! 
try"" 
{## 	
var$$ 
ordersDetails$$ 
=$$ 
await%% 
_unitOfWork%% !
.%%! ""
OrderDetailsRepository%%" 8
.%%8 9
GetAllAsync%%9 D
(%%D E
x%%E F
=>%%G I
x%%J K
.%%K L
OrderHeaderId%%L Y
==%%Z \
orderHeaderId%%] j
)%%j k
;%%k l
foreach'' 
('' 
var'' 
orderDetails'' %
in''& (
ordersDetails'') 6
)''6 7
{(( 
var)) 
course)) 
=)) 
await)) "
_unitOfWork))# .
.)). /
CourseRepository))/ ?
.))? @
GetAsync))@ H
(** 
x++ 
=>++ 
x++ 
.++ 
Id++ 
==++  
orderDetails++! -
.++- .
CourseId++. 6
),, 
;,, 
var.. 

instructor.. 
=..  
await..! &
_unitOfWork..' 2
...2 3 
InstructorRepository..3 G
...G H
GetAsync..H P
(// 
x00 
=>00 
x00 
.00 
InstructorId00 '
==00( *
course00+ 1
.001 2
InstructorId002 >
)11 
;11 
await33 
_balanceService33 %
.33% &
UpsertBalance33& 3
(333 4
new44 
UpsertBalanceDTO44 (
(44( )
)44) *
{55 
Currency66  
=66! "
$str66# (
,66( )
AvailableBalance77 (
=77) *
orderDetails77+ 7
.777 8
CoursePrice778 C
,77C D
PayoutBalance88 %
=88& '
$num88( )
,88) *
UserId99 
=99  

instructor99! +
.99+ ,
UserId99, 2
}:: 
);; 
;;; 
await== 
_transactionService== )
.==) *
CreateTransaction==* ;
(>> 
new??  
CreateTransactionDTO?? ,
(??, -
)??- .
{@@ 
UserIdAA 
=AA  

instructorAA! +
.AA+ ,
UserIdAA, 2
,AA2 3
AmountBB 
=BB  
orderDetailsBB! -
.BB- .
CoursePriceBB. 9
,BB9 :
TypeCC 
=CC 

StaticEnumCC )
.CC) *
TransactionTypeCC* 9
.CC9 :
IncomeCC: @
,CC@ A
}DD 
)EE 
;EE 
}FF 
returnHH 
newHH 
ResponseDTOHH "
(HH" #
)HH# $
{II 
MessageJJ 
=JJ 
$strJJ 7
,JJ7 8
	IsSuccessKK 
=KK 
trueKK  
,KK  !

StatusCodeLL 
=LL 
$numLL  
,LL  !
ResultMM 
=MM 
nullMM 
}NN 
;NN 
}OO 	
catchPP 
(PP 
	ExceptionPP 
ePP 
)PP 
{QQ 	
returnRR 
newRR 
ResponseDTORR "
(RR" #
)RR# $
{SS 
MessageTT 
=TT 
eTT 
.TT 
MessageTT #
,TT# $
	IsSuccessUU 
=UU 
falseUU !
,UU! "

StatusCodeVV 
=VV 
$numVV  
,VV  !
ResultWW 
=WW 
nullWW 
}XX 
;XX 
}YY 	
}ZZ 
public\\ 

async\\ 
Task\\ 
<\\ 
ResponseDTO\\ !
>\\! "(
CreateStripeConnectedAccount\\# ?
(]] +
CreateStripeConnectedAccountDTO^^ '+
createStripeConnectedAccountDto^^( G
)^^G H
{__ 
try`` 
{aa 	
varbb 
userbb 
=bb 
awaitbb 
_unitOfWorkbb (
.bb( )!
UserManagerRepositorybb) >
.bb> ?
FindByEmailAsyncbb? O
(bbO P+
createStripeConnectedAccountDtobbP o
.bbo p
Emailbbp u
)bbu v
;bbv w
varcc 

instructorcc 
=cc 
awaitcc "
_unitOfWorkcc# .
.cc. / 
InstructorRepositorycc/ C
.ccC D
GetAsyncccD L
(ccL M
xccM N
=>ccO Q
xccR S
.ccS T
UserIdccT Z
==cc[ ]
usercc^ b
.ccb c
Idccc e
)cce f
;ccf g
ifee 
(ee 

instructoree 
isee 
nullee "
)ee" #
{ff 
returngg 
newgg 
ResponseDTOgg &
(gg& '
)gg' (
{hh 
Messageii 
=ii 
$strii 8
,ii8 9
	IsSuccessjj 
=jj 
falsejj  %
,jj% &

StatusCodekk 
=kk  
$numkk! $
,kk$ %
Resultll 
=ll 
nullll !
}mm 
;mm 
}nn 
varpp 
responseDtopp 
=pp 
awaitpp #
_stripeServicepp$ 2
.pp2 3"
CreateConnectedAccountpp3 I
(ppI J+
createStripeConnectedAccountDtoppJ i
)ppi j
;ppj k
ifrr 
(rr 
responseDtorr 
.rr 

StatusCoderr &
==rr' )
$numrr* -
)rr- .
{ss 
returntt 
responseDtott "
;tt" #
}uu 
varww 
resultww 
=ww 
(ww +
CreateStripeConnectedAccountDTOww 9
)ww9 :
responseDtoww: E
.wwE F
ResultwwF L
!wwL M
;wwM N

instructorxx 
.xx 
StripeAccountIdxx &
=xx' (
resultxx) /
.xx/ 0
	AccountIdxx0 9
;xx9 :
awaityy 
_unitOfWorkyy 
.yy 
	SaveAsyncyy '
(yy' (
)yy( )
;yy) *
return{{ 
responseDto{{ 
;{{ 
}|| 	
catch}} 
(}} 
	Exception}} 
e}} 
)}} 
{~~ 	
Console 
. 
	WriteLine 
( 
e 
)  
;  !
throw
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
public
ÑÑ 

async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
ResponseDTO
ÑÑ !
>
ÑÑ! ""
CreateStripeTransfer
ÑÑ# 7
(
ÑÑ7 8%
CreateStripeTransferDTO
ÑÑ8 O%
createStripeTransferDto
ÑÑP g
)
ÑÑg h
{
ÖÖ 
try
ÜÜ 
{
áá 	
if
àà 
(
àà %
createStripeTransferDto
àà '
.
àà' (
UserId
àà( .
is
àà/ 1
null
àà2 6
&&
àà7 9%
createStripeTransferDto
àà: Q
.
ààQ R 
ConnectedAccountId
ààR d
is
ààe g
null
ààh l
)
ààl m
{
ââ 
return
ää 
new
ää 
ResponseDTO
ää &
(
ää& '
)
ää' (
{
ãã 
Message
åå 
=
åå 
$str
åå 2
,
åå2 3
	IsSuccess
çç 
=
çç 
false
çç  %
,
çç% &

StatusCode
éé 
=
éé  
$num
éé! $
,
éé$ %
Result
èè 
=
èè %
createStripeTransferDto
èè 4
}
êê 
;
êê 
}
ëë 
var
ìì 

instructor
ìì 
=
ìì 
await
îî 
_unitOfWork
îî !
.
îî! ""
InstructorRepository
îî" 6
.
îî6 7
GetAsync
îî7 ?
(
îî? @
x
îî@ A
=>
îîB D
x
îîE F
.
îîF G
UserId
îîG M
==
îîN P%
createStripeTransferDto
îîQ h
.
îîh i
UserId
îîi o
)
îîo p
;
îîp q
if
ññ 
(
ññ 

instructor
ññ 
is
ññ 
null
ññ "
)
ññ" #
{
óó 
return
òò 
new
òò 
ResponseDTO
òò &
(
òò& '
)
òò' (
{
ôô 
Message
öö 
=
öö 
$str
öö 8
,
öö8 9
	IsSuccess
õõ 
=
õõ 
false
õõ  %
,
õõ% &

StatusCode
úú 
=
úú  
$num
úú! $
,
úú$ %
Result
ùù 
=
ùù %
createStripeTransferDto
ùù 4
}
ûû 
;
ûû 
}
üü %
createStripeTransferDto
°° #
.
°°# $ 
ConnectedAccountId
°°$ 6
=
°°7 8

instructor
°°9 C
?
°°C D
.
°°D E
StripeAccountId
°°E T
;
°°T U
var
££ 
responseDto
££ 
=
££ 
await
££ #
_stripeService
££$ 2
.
££2 3
CreateTransfer
££3 A
(
££A B%
createStripeTransferDto
££B Y
)
££Y Z
;
££Z [
if
•• 
(
•• 
responseDto
•• 
.
•• 

StatusCode
•• &
!=
••' )
$num
••* -
)
••- .
return
••/ 5
responseDto
••6 A
;
••A B
await
ßß 
_balanceService
ßß !
.
ßß! "
UpsertBalance
ßß" /
(
ßß/ 0
new
ßß0 3
UpsertBalanceDTO
ßß4 D
(
ßßD E
)
ßßE F
{
®® 
Currency
©© 
=
©© 
$str
©© $
,
©©$ %
AvailableBalance
™™ $
=
™™% &%
createStripeTransferDto
™™' >
.
™™> ?
Amount
™™? E
,
™™E F
PayoutBalance
´´ !
=
´´" #
$num
´´$ %
,
´´% &
UserId
¨¨ 
=
¨¨ %
createStripeTransferDto
¨¨ 4
.
¨¨4 5
UserId
¨¨5 ;
}
≠≠ 
)
ÆÆ 
;
ÆÆ 
await
∞∞ !
_transactionService
∞∞ %
.
∞∞% &
CreateTransaction
∞∞& 7
(
±± 
new
≤≤ "
CreateTransactionDTO
≤≤ (
(
≤≤( )
)
≤≤) *
{
≥≥ 
UserId
¥¥ 
=
¥¥ %
createStripeTransferDto
¥¥ 4
.
¥¥4 5
UserId
¥¥5 ;
,
¥¥; <
Amount
µµ 
=
µµ %
createStripeTransferDto
µµ 4
.
µµ4 5
Amount
µµ5 ;
,
µµ; <
Type
∂∂ 
=
∂∂ 

StaticEnum
∂∂ %
.
∂∂% &
TransactionType
∂∂& 5
.
∂∂5 6
Income
∂∂6 <
}
∑∑ 
)
∏∏ 
;
∏∏ 
return
∫∫ 
responseDto
∫∫ 
;
∫∫ 
}
ªª 	
catch
ºº 
(
ºº 
	Exception
ºº 
e
ºº 
)
ºº 
{
ΩΩ 	
Console
ææ 
.
ææ 
	WriteLine
ææ 
(
ææ 
e
ææ 
)
ææ  
;
ææ  !
throw
øø 
;
øø 
}
¿¿ 	
}
¡¡ 
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
ResponseDTO
√√ !
>
√√! "
AddStripeCard
√√# 0
(
√√0 1
AddStripeCardDTO
√√1 A
addStripeCardDto
√√B R
)
√√R S
{
ƒƒ 
return
≈≈ 
await
≈≈ 
_stripeService
≈≈ #
.
≈≈# $
AddCard
≈≈$ +
(
≈≈+ ,
addStripeCardDto
≈≈, <
)
≈≈< =
;
≈≈= >
}
∆∆ 
public
»» 

async
»» 
Task
»» 
<
»» 
ResponseDTO
»» !
>
»»! " 
CreateStripePayout
»»# 5
(
…… 
ClaimsPrincipal
   
User
   
,
   #
CreateStripePayoutDTO
ÀÀ #
createStripePayoutDto
ÀÀ 3
)
ÃÃ 
{
ÕÕ 
try
ŒŒ 
{
œœ 	
var
–– 
userId
–– 
=
–– 
User
–– 
.
–– 
Claims
–– $
.
––$ %
FirstOrDefault
––% 3
(
––3 4
x
––4 5
=>
––6 8
x
––9 :
.
––: ;
Type
––; ?
==
––@ B

ClaimTypes
––C M
.
––M N
NameIdentifier
––N \
)
––\ ]
?
––] ^
.
––^ _
Value
––_ d
;
––d e
if
““ 
(
““ #
createStripePayoutDto
““ %
.
““% & 
ConnectedAccountId
““& 8
.
““8 9
IsNullOrEmpty
““9 F
(
““F G
)
““G H
)
““H I
{
”” 
if
‘‘ 
(
‘‘ 
userId
‘‘ 
is
‘‘ 
null
‘‘ "
)
‘‘" #
{
’’ 
return
÷÷ 
new
÷÷ 
ResponseDTO
÷÷ *
(
÷÷* +
)
÷÷+ ,
{
◊◊ 
Message
ÿÿ 
=
ÿÿ  !
$str
ÿÿ" 6
,
ÿÿ6 7
	IsSuccess
ŸŸ !
=
ŸŸ" #
false
ŸŸ$ )
,
ŸŸ) *

StatusCode
⁄⁄ "
=
⁄⁄# $
$num
⁄⁄% (
,
⁄⁄( )
Result
€€ 
=
€€  #
createStripePayoutDto
€€! 6
}
‹‹ 
;
‹‹ 
}
›› 
var
ﬂﬂ 

instructor
ﬂﬂ 
=
ﬂﬂ  
await
ﬂﬂ! &
_unitOfWork
ﬂﬂ' 2
.
ﬂﬂ2 3"
InstructorRepository
ﬂﬂ3 G
.
ﬂﬂG H
GetAsync
ﬂﬂH P
(
ﬂﬂP Q
x
ﬂﬂQ R
=>
ﬂﬂS U
x
ﬂﬂV W
.
ﬂﬂW X
UserId
ﬂﬂX ^
==
ﬂﬂ_ a
userId
ﬂﬂb h
)
ﬂﬂh i
;
ﬂﬂi j
if
·· 
(
·· 

instructor
·· 
is
·· !
null
··" &
)
··& '
{
‚‚ 
return
„„ 
new
„„ 
ResponseDTO
„„ *
(
„„* +
)
„„+ ,
{
‰‰ 
Message
ÂÂ 
=
ÂÂ  !
$str
ÂÂ" <
,
ÂÂ< =
	IsSuccess
ÊÊ !
=
ÊÊ" #
false
ÊÊ$ )
,
ÊÊ) *

StatusCode
ÁÁ "
=
ÁÁ# $
$num
ÁÁ% (
,
ÁÁ( )
Result
ËË 
=
ËË  #
createStripePayoutDto
ËË! 6
}
ÈÈ 
;
ÈÈ 
}
ÍÍ #
createStripePayoutDto
ÏÏ %
.
ÏÏ% & 
ConnectedAccountId
ÏÏ& 8
=
ÏÏ9 :

instructor
ÏÏ; E
?
ÏÏE F
.
ÏÏF G
StripeAccountId
ÏÏG V
;
ÏÏV W
}
ÌÌ 
var
ÔÔ 
responseDto
ÔÔ 
=
ÔÔ 
await
ÔÔ #
_stripeService
ÔÔ$ 2
.
ÔÔ2 3
CreatePayout
ÔÔ3 ?
(
ÔÔ? @#
createStripePayoutDto
ÔÔ@ U
)
ÔÔU V
;
ÔÔV W
var
ÒÒ 
payout
ÒÒ 
=
ÒÒ 
(
ÒÒ 
Payout
ÒÒ  
)
ÒÒ  !
responseDto
ÒÒ! ,
.
ÒÒ, -
Result
ÒÒ- 3
!
ÒÒ3 4
;
ÒÒ4 5
if
ÛÛ 
(
ÛÛ 
payout
ÛÛ 
.
ÛÛ 
Status
ÛÛ 
!=
ÛÛ  
$str
ÛÛ! *
)
ÛÛ* +
{
ÙÙ 
return
ıı 
responseDto
ıı "
;
ıı" #
}
ˆˆ 
await
¯¯ !
_transactionService
¯¯ %
.
¯¯% &
CreateTransaction
¯¯& 7
(
˘˘ 
new
˙˙ "
CreateTransactionDTO
˙˙ (
(
˙˙( )
)
˙˙) *
{
˚˚ 
Amount
¸¸ 
=
¸¸ #
createStripePayoutDto
¸¸ 2
.
¸¸2 3
Amount
¸¸3 9
,
¸¸9 :
Type
˝˝ 
=
˝˝ 

StaticEnum
˝˝ %
.
˝˝% &
TransactionType
˝˝& 5
.
˝˝5 6
Payout
˝˝6 <
,
˝˝< =
UserId
˛˛ 
=
˛˛ 
userId
˛˛ #
}
ˇˇ 
)
ÄÄ 
;
ÄÄ 
await
ÇÇ 
_balanceService
ÇÇ !
.
ÇÇ! "
UpsertBalance
ÇÇ" /
(
ÉÉ 
new
ÑÑ 
UpsertBalanceDTO
ÑÑ $
(
ÑÑ$ %
)
ÑÑ% &
{
ÖÖ 
Currency
ÜÜ 
=
ÜÜ 
$str
ÜÜ $
,
ÜÜ$ %
AvailableBalance
áá $
=
áá% &
-
áá' (#
createStripePayoutDto
áá( =
.
áá= >
Amount
áá> D
,
ááD E
PayoutBalance
àà !
=
àà" ##
createStripePayoutDto
àà$ 9
.
àà9 :
Amount
àà: @
,
àà@ A
UserId
ââ 
=
ââ 
userId
ââ #
}
ää 
)
ãã 
;
ãã 
return
åå 
responseDto
åå 
;
åå 
}
çç 	
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 	
Console
êê 
.
êê 
	WriteLine
êê 
(
êê 
e
êê 
)
êê  
;
êê  !
throw
ëë 
;
ëë 
}
íí 	
}
ìì 
public
îî 

async
îî 
Task
îî 
<
îî 
ResponseDTO
îî !
>
îî! "'
GetTopInstructorsByPayout
îî# <
(
ïï 
int
ññ 
topN
ññ 
=
ññ 
$num
ññ 
,
ññ 
int
óó 
?
óó 

filterYear
óó 
=
óó 
null
óó 
,
óó 
int
òò 
?
òò 
filterMonth
òò 
=
òò 
null
òò 
,
òò  
int
ôô 
?
ôô 
filterQuarter
ôô 
=
ôô 
null
ôô !
)
öö 
{
õõ 
try
úú 
{
ùù 	
if
üü 
(
üü 
topN
üü 
<=
üü 
$num
üü 
)
üü 
{
†† 
throw
°° 
new
°° 
ArgumentException
°° +
(
°°+ ,
$str
°°, f
)
°°f g
;
°°g h
}
¢¢ 
var
§§ 
currentYear
§§ 
=
§§ 
DateTime
§§ &
.
§§& '
UtcNow
§§' -
.
§§- .
Year
§§. 2
;
§§2 3
var
•• 
	startDate
•• 
=
•• 
DateTime
•• $
.
••$ %
UtcNow
••% +
;
••+ ,
var
¶¶ 
endDate
¶¶ 
=
¶¶ 
DateTime
¶¶ "
.
¶¶" #
UtcNow
¶¶# )
;
¶¶) *
if
©© 
(
©© 

filterYear
©© 
.
©© 
HasValue
©© #
)
©©# $
{
™™ 
	startDate
´´ 
=
´´ 
new
´´ 
DateTime
´´  (
(
´´( )

filterYear
´´) 3
.
´´3 4
Value
´´4 9
,
´´9 :
$num
´´; <
,
´´< =
$num
´´> ?
)
´´? @
;
´´@ A
endDate
¨¨ 
=
¨¨ 
new
¨¨ 
DateTime
¨¨ &
(
¨¨& '

filterYear
¨¨' 1
.
¨¨1 2
Value
¨¨2 7
,
¨¨7 8
$num
¨¨9 ;
,
¨¨; <
$num
¨¨= ?
,
¨¨? @
$num
¨¨A C
,
¨¨C D
$num
¨¨E G
,
¨¨G H
$num
¨¨I K
)
¨¨K L
;
¨¨L M
}
≠≠ 
else
ÆÆ 
{
ØØ 
	startDate
∞∞ 
=
∞∞ 
new
∞∞ 
DateTime
∞∞  (
(
∞∞( )
currentYear
∞∞) 4
,
∞∞4 5
$num
∞∞6 7
,
∞∞7 8
$num
∞∞9 :
)
∞∞: ;
;
∞∞; <
endDate
±± 
=
±± 
new
±± 
DateTime
±± &
(
±±& '
currentYear
±±' 2
,
±±2 3
$num
±±4 6
,
±±6 7
$num
±±8 :
,
±±: ;
$num
±±< >
,
±±> ?
$num
±±@ B
,
±±B C
$num
±±D F
)
±±F G
;
±±G H
}
≤≤ 
if
¥¥ 
(
¥¥ 
filterMonth
¥¥ 
.
¥¥ 
HasValue
¥¥ $
)
¥¥$ %
{
µµ 
	startDate
∂∂ 
=
∂∂ 
new
∂∂ 
DateTime
∂∂  (
(
∂∂( )
	startDate
∂∂) 2
.
∂∂2 3
Year
∂∂3 7
,
∂∂7 8
filterMonth
∂∂9 D
.
∂∂D E
Value
∂∂E J
,
∂∂J K
$num
∂∂L M
)
∂∂M N
;
∂∂N O
endDate
∑∑ 
=
∑∑ 
	startDate
∑∑ #
.
∑∑# $
	AddMonths
∑∑$ -
(
∑∑- .
$num
∑∑. /
)
∑∑/ 0
.
∑∑0 1

AddSeconds
∑∑1 ;
(
∑∑; <
-
∑∑< =
$num
∑∑= >
)
∑∑> ?
;
∑∑? @
}
∏∏ 
if
∫∫ 
(
∫∫ 
filterQuarter
∫∫ 
.
∫∫ 
HasValue
∫∫ &
)
∫∫& '
{
ªª 
int
ºº 

startMonth
ºº 
=
ºº  
(
ºº! "
filterQuarter
ºº" /
.
ºº/ 0
Value
ºº0 5
-
ºº6 7
$num
ºº8 9
)
ºº9 :
*
ºº; <
$num
ºº= >
+
ºº? @
$num
ººA B
;
ººB C
	startDate
ΩΩ 
=
ΩΩ 
new
ΩΩ 
DateTime
ΩΩ  (
(
ΩΩ( )
	startDate
ΩΩ) 2
.
ΩΩ2 3
Year
ΩΩ3 7
,
ΩΩ7 8

startMonth
ΩΩ9 C
,
ΩΩC D
$num
ΩΩE F
)
ΩΩF G
;
ΩΩG H
endDate
ææ 
=
ææ 
	startDate
ææ #
.
ææ# $
	AddMonths
ææ$ -
(
ææ- .
$num
ææ. /
)
ææ/ 0
.
ææ0 1

AddSeconds
ææ1 ;
(
ææ; <
-
ææ< =
$num
ææ= >
)
ææ> ?
;
ææ? @
}
øø 
var
¡¡ 
transactions
¡¡ 
=
¡¡ 
await
¡¡ $
_unitOfWork
¡¡% 0
.
¡¡0 1#
TransactionRepository
¡¡1 F
.
¬¬ 
GetAllAsync
¬¬ 
(
¬¬ 
filter
√√ 
:
√√ 
x
√√ 
=>
√√  
x
√√! "
.
√√" #
Type
√√# '
==
√√( *

StaticEnum
√√+ 5
.
√√5 6
TransactionType
√√6 E
.
√√E F
Payout
√√F L
&&
√√M O
x
ƒƒ! "
.
ƒƒ" #
CreatedTime
ƒƒ# .
>=
ƒƒ/ 1
	startDate
ƒƒ2 ;
&&
ƒƒ< >
x
ƒƒ? @
.
ƒƒ@ A
CreatedTime
ƒƒA L
<=
ƒƒM O
endDate
ƒƒP W
,
ƒƒW X
includeProperties
≈≈ %
:
≈≈% &
$str
≈≈' 8
)
∆∆ 
;
∆∆ 
var
»» 
instructorPayouts
»» !
=
»»" #
transactions
»»$ 0
.
…… 
GroupBy
…… 
(
…… 
x
…… 
=>
…… 
x
…… 
.
……  
UserId
……  &
)
……& '
.
   
Select
   
(
   
group
   
=>
    
new
  ! $
{
ÀÀ 
InstructorId
ÃÃ  
=
ÃÃ! "
group
ÃÃ# (
.
ÃÃ( )
First
ÃÃ) .
(
ÃÃ. /
)
ÃÃ/ 0
.
ÃÃ0 1
ApplicationUser
ÃÃ1 @
.
ÃÃ@ A
Id
ÃÃA C
,
ÃÃC D
FullName
ÕÕ 
=
ÕÕ 
group
ÕÕ $
.
ÕÕ$ %
First
ÕÕ% *
(
ÕÕ* +
)
ÕÕ+ ,
.
ÕÕ, -
ApplicationUser
ÕÕ- <
.
ÕÕ< =
FullName
ÕÕ= E
,
ÕÕE F
TotalPayout
ŒŒ 
=
ŒŒ  !
group
ŒŒ" '
.
ŒŒ' (
Sum
ŒŒ( +
(
ŒŒ+ ,
x
ŒŒ, -
=>
ŒŒ. 0
x
ŒŒ1 2
.
ŒŒ2 3
Amount
ŒŒ3 9
)
ŒŒ9 :
}
œœ 
)
œœ 
.
–– 
OrderByDescending
–– "
(
––" #
x
––# $
=>
––% '
x
––( )
.
––) *
TotalPayout
––* 5
)
––5 6
.
—— 
Take
—— 
(
—— 
topN
—— 
)
—— 
.
““ 
ToList
““ 
(
““ 
)
““ 
;
““ 
return
‘‘ 
new
‘‘ 
ResponseDTO
‘‘ "
(
‘‘" #
)
‘‘# $
{
’’ 
Result
÷÷ 
=
÷÷ 
instructorPayouts
÷÷ *
,
÷÷* +
Message
◊◊ 
=
◊◊ 
$str
◊◊ F
,
◊◊F G
	IsSuccess
ÿÿ 
=
ÿÿ 
true
ÿÿ  
,
ÿÿ  !

StatusCode
ŸŸ 
=
ŸŸ 
$num
ŸŸ  
}
⁄⁄ 
;
⁄⁄ 
}
€€ 	
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 	
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ "
(
ﬁﬁ" #
)
ﬁﬁ# $
{
ﬂﬂ 
Message
‡‡ 
=
‡‡ 
e
‡‡ 
.
‡‡ 
Message
‡‡ #
,
‡‡# $

StatusCode
·· 
=
·· 
$num
··  
,
··  !
Result
‚‚ 
=
‚‚ 
null
‚‚ 
,
‚‚ 
	IsSuccess
„„ 
=
„„ 
false
„„ !
}
‰‰ 
;
‰‰ 
}
ÂÂ 	
}
ÊÊ 
public
ËË 

async
ËË 
Task
ËË 
<
ËË 
ResponseDTO
ËË !
>
ËË! ")
GetLeastInstructorsByPayout
ËË# >
(
ËË> ?
int
ÈÈ 
topN
ÈÈ 
=
ÈÈ 
$num
ÈÈ 
,
ÈÈ 
int
ÍÍ 
?
ÍÍ 

filterYear
ÍÍ	 
=
ÍÍ 
null
ÍÍ 
,
ÍÍ 
int
ÎÎ 
?
ÎÎ 
filterMonth
ÎÎ	 
=
ÎÎ 
null
ÎÎ 
,
ÎÎ 
int
ÏÏ 
?
ÏÏ 
filterQuarter
ÏÏ	 
=
ÏÏ 
null
ÏÏ 
)ÌÌ 
{
ÓÓ 
try
ÔÔ 
{
 	
if
ÚÚ 
(
ÚÚ 
topN
ÚÚ 
<=
ÚÚ 
$num
ÚÚ 
)
ÚÚ 
{
ÛÛ 
throw
ÙÙ 
new
ÙÙ 
ArgumentException
ÙÙ +
(
ÙÙ+ ,
$str
ÙÙ, h
)
ÙÙh i
;
ÙÙi j
}
ıı 
var
˜˜ 
currentYear
˜˜ 
=
˜˜ 
DateTime
˜˜ &
.
˜˜& '
UtcNow
˜˜' -
.
˜˜- .
Year
˜˜. 2
;
˜˜2 3
var
¯¯ 
	startDate
¯¯ 
=
¯¯ 
DateTime
¯¯ $
.
¯¯$ %
UtcNow
¯¯% +
;
¯¯+ ,
var
˘˘ 
endDate
˘˘ 
=
˘˘ 
DateTime
˘˘ "
.
˘˘" #
UtcNow
˘˘# )
;
˘˘) *
if
¸¸ 
(
¸¸ 

filterYear
¸¸ 
.
¸¸ 
HasValue
¸¸ #
)
¸¸# $
{
˝˝ 
	startDate
˛˛ 
=
˛˛ 
new
˛˛ 
DateTime
˛˛  (
(
˛˛( )

filterYear
˛˛) 3
.
˛˛3 4
Value
˛˛4 9
,
˛˛9 :
$num
˛˛; <
,
˛˛< =
$num
˛˛> ?
)
˛˛? @
;
˛˛@ A
endDate
ˇˇ 
=
ˇˇ 
new
ˇˇ 
DateTime
ˇˇ &
(
ˇˇ& '

filterYear
ˇˇ' 1
.
ˇˇ1 2
Value
ˇˇ2 7
,
ˇˇ7 8
$num
ˇˇ9 ;
,
ˇˇ; <
$num
ˇˇ= ?
,
ˇˇ? @
$num
ˇˇA C
,
ˇˇC D
$num
ˇˇE G
,
ˇˇG H
$num
ˇˇI K
)
ˇˇK L
;
ˇˇL M
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
	startDate
ÉÉ 
=
ÉÉ 
new
ÉÉ 
DateTime
ÉÉ  (
(
ÉÉ( )
currentYear
ÉÉ) 4
,
ÉÉ4 5
$num
ÉÉ6 7
,
ÉÉ7 8
$num
ÉÉ9 :
)
ÉÉ: ;
;
ÉÉ; <
endDate
ÑÑ 
=
ÑÑ 
new
ÑÑ 
DateTime
ÑÑ &
(
ÑÑ& '
currentYear
ÑÑ' 2
,
ÑÑ2 3
$num
ÑÑ4 6
,
ÑÑ6 7
$num
ÑÑ8 :
,
ÑÑ: ;
$num
ÑÑ< >
,
ÑÑ> ?
$num
ÑÑ@ B
,
ÑÑB C
$num
ÑÑD F
)
ÑÑF G
;
ÑÑG H
}
ÖÖ 
if
áá 
(
áá 
filterMonth
áá 
.
áá 
HasValue
áá $
)
áá$ %
{
àà 
	startDate
ââ 
=
ââ 
new
ââ 
DateTime
ââ  (
(
ââ( )
	startDate
ââ) 2
.
ââ2 3
Year
ââ3 7
,
ââ7 8
filterMonth
ââ9 D
.
ââD E
Value
ââE J
,
ââJ K
$num
ââL M
)
ââM N
;
ââN O
endDate
ää 
=
ää 
	startDate
ää #
.
ää# $
	AddMonths
ää$ -
(
ää- .
$num
ää. /
)
ää/ 0
.
ää0 1

AddSeconds
ää1 ;
(
ää; <
-
ää< =
$num
ää= >
)
ää> ?
;
ää? @
}
ãã 
if
çç 
(
çç 
filterQuarter
çç 
.
çç 
HasValue
çç &
)
çç& '
{
éé 
int
èè 

startMonth
èè 
=
èè  
(
èè! "
filterQuarter
èè" /
.
èè/ 0
Value
èè0 5
-
èè6 7
$num
èè8 9
)
èè9 :
*
èè; <
$num
èè= >
+
èè? @
$num
èèA B
;
èèB C
	startDate
êê 
=
êê 
new
êê 
DateTime
êê  (
(
êê( )
	startDate
êê) 2
.
êê2 3
Year
êê3 7
,
êê7 8

startMonth
êê9 C
,
êêC D
$num
êêE F
)
êêF G
;
êêG H
endDate
ëë 
=
ëë 
	startDate
ëë #
.
ëë# $
	AddMonths
ëë$ -
(
ëë- .
$num
ëë. /
)
ëë/ 0
.
ëë0 1

AddSeconds
ëë1 ;
(
ëë; <
-
ëë< =
$num
ëë= >
)
ëë> ?
;
ëë? @
}
íí 
var
îî 
transactions
îî 
=
îî 
await
îî $
_unitOfWork
îî% 0
.
îî0 1#
TransactionRepository
îî1 F
.
ïï 
GetAllAsync
ïï 
(
ïï 
filter
ññ 
:
ññ 
x
ññ 
=>
ññ  
x
ññ! "
.
ññ" #
Type
ññ# '
==
ññ( *

StaticEnum
ññ+ 5
.
ññ5 6
TransactionType
ññ6 E
.
ññE F
Payout
ññF L
&&
ññM O
x
óó! "
.
óó" #
CreatedTime
óó# .
>=
óó/ 1
	startDate
óó2 ;
&&
óó< >
x
óó? @
.
óó@ A
CreatedTime
óóA L
<=
óóM O
endDate
óóP W
,
óóW X
includeProperties
òò %
:
òò% &
$str
òò' 8
)
ôô 
;
ôô 
var
õõ 
instructorPayouts
õõ !
=
õõ" #
transactions
õõ$ 0
.
úú 
GroupBy
úú 
(
úú 
x
úú 
=>
úú 
x
úú 
.
úú  
UserId
úú  &
)
úú& '
.
ùù 
Select
ùù 
(
ùù 
group
ùù 
=>
ùù  
new
ùù! $
{
ûû 
InstructorId
üü  
=
üü! "
group
üü# (
.
üü( )
First
üü) .
(
üü. /
)
üü/ 0
.
üü0 1
ApplicationUser
üü1 @
.
üü@ A
Id
üüA C
,
üüC D
FullName
†† 
=
†† 
group
†† $
.
††$ %
First
††% *
(
††* +
)
††+ ,
.
††, -
ApplicationUser
††- <
.
††< =
FullName
††= E
,
††E F
TotalPayout
°° 
=
°°  !
group
°°" '
.
°°' (
Sum
°°( +
(
°°+ ,
x
°°, -
=>
°°. 0
x
°°1 2
.
°°2 3
Amount
°°3 9
)
°°9 :
}
¢¢ 
)
¢¢ 
.
££ 
OrderBy
££ 
(
££ 
x
££ 
=>
££ 
x
££ 
.
££  
TotalPayout
££  +
)
££+ ,
.
§§ 
Take
§§ 
(
§§ 
topN
§§ 
)
§§ 
.
•• 
ToList
•• 
(
•• 
)
•• 
;
•• 
return
ßß 
new
ßß 
ResponseDTO
ßß "
(
ßß" #
)
ßß# $
{
®® 
Result
©© 
=
©© 
instructorPayouts
©© *
,
©©* +
Message
™™ 
=
™™ 
$str
™™ H
,
™™H I
	IsSuccess
´´ 
=
´´ 
true
´´  
,
´´  !

StatusCode
¨¨ 
=
¨¨ 
$num
¨¨  
}
≠≠ 
;
≠≠ 
}
ÆÆ 	
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 	
return
±± 
new
±± 
ResponseDTO
±± "
(
±±" #
)
±±# $
{
≤≤ 
Message
≥≥ 
=
≥≥ 
e
≥≥ 
.
≥≥ 
Message
≥≥ #
,
≥≥# $

StatusCode
¥¥ 
=
¥¥ 
$num
¥¥  
,
¥¥  !
Result
µµ 
=
µµ 
null
µµ 
,
µµ 
	IsSuccess
∂∂ 
=
∂∂ 
false
∂∂ !
}
∑∑ 
;
∑∑ 
}
∏∏ 	
}
ππ 
}ææ √ 
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\OrderStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public		 
class		 
OrderStatusService		 
:		  !
IOrderStatusService		" 5
{

 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
public 

OrderStatusService 
( 
IUnitOfWork )

unitOfWork* 4
)4 5
{ 
_unitOfWork 
= 

unitOfWork  
;  !
} 
public 

Task 
< 
ResponseDTO 
> 
GetOrdersStatus ,
(, -
Guid- 1
orderHeaderId2 ?
)? @
{ 
throw 
new #
NotImplementedException )
() *
)* +
;+ ,
} 
public 

Task 
< 
ResponseDTO 
> 
GetOrderStatus +
(+ ,
Guid, 0
orderStatusId1 >
)> ?
{ 
throw 
new #
NotImplementedException )
() *
)* +
;+ ,
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
CreateOrderStatus# 4
(4 5
ClaimsPrincipal5 D
UserE I
,I J 
CreateOrderStatusDTOK _ 
createOrderStatusDto` t
)t u
{ 
try 
{ 	
var   
orderStatus   
=   
new   !
OrderStatus  " -
(  - .
)  . /
{!! 
Id"" 
="" 
new"" 
Guid"" 
("" 
)"" 
,""  
	CreatedBy## 
=## 
User##  
.##  !
Claims##! '
.##' (
FirstOrDefault##( 6
(##6 7
x##7 8
=>##9 ;
x##< =
.##= >
Type##> B
==##C E

ClaimTypes##F P
.##P Q
Name##Q U
)##U V
?##V W
.##W X
Value##X ]
,##] ^
CreatedTime$$ 
=$$ 
DateTime$$ &
.$$& '
UtcNow$$' -
,$$- .
Status%% 
=%%  
createOrderStatusDto%% -
.%%- .
Status%%. 4
,%%4 5
OrderHeaderId&& 
=&&  
createOrderStatusDto&&  4
.&&4 5
OrderHeaderId&&5 B
}'' 
;'' 
await)) 
_unitOfWork)) 
.)) !
OrderStatusRepository)) 3
.))3 4
AddAsync))4 <
())< =
orderStatus))= H
)))H I
;))I J
await** 
_unitOfWork** 
.** 
	SaveAsync** '
(**' (
)**( )
;**) *
return,, 
new,, 
ResponseDTO,, "
(,," #
),,# $
{-- 
Message.. 
=.. 
$str.. <
,..< =
Result// 
=// 
orderStatus// $
.//$ %
Id//% '
,//' (
	IsSuccess00 
=00 
true00  
,00  !

StatusCode11 
=11 
$num11  
}22 
;22 
}33 	
catch44 
(44 
	Exception44 
e44 
)44 
{55 	
return66 
new66 
ResponseDTO66 "
(66" #
)66# $
{77 
Message88 
=88 
e88 
.88 
Message88 #
,88# $
Result99 
=99 
null99 
,99 
	IsSuccess:: 
=:: 
true::  
,::  !

StatusCode;; 
=;; 
$num;;  
}<< 
;<< 
}== 	
}>> 
}?? ‡î
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\OrderService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
OrderService 
: 
IOrderService )
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IOrderStatusService (
_orderStatusService) <
;< =
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IStripeService #
_stripeService$ 2
;2 3
private 
readonly !
IStudentCourseService *!
_studentCourseService+ @
;@ A
private 
readonly 
ITransactionService (
_transactionService) <
;< =
private 
readonly 
ICourseService #
_courseService$ 2
;2 3
public 

OrderService 
( 
IUnitOfWork 

unitOfWork 
, 
IMapper 
mapper 
, 
IOrderStatusService 
orderStatusService .
,. /
IStripeService 
stripeService $
,$ %!
IStudentCourseService  
studentCourseService 2
,2 3
ITransactionService   
transactionService   .
,  . /
ICourseService  0 >
courseService  ? L
)  L M
{!! 
_unitOfWork"" 
="" 

unitOfWork""  
;""  !
_mapper## 
=## 
mapper## 
;## 
_orderStatusService$$ 
=$$ 
orderStatusService$$ 0
;$$0 1
_stripeService%% 
=%% 
stripeService%% &
;%%& '!
_studentCourseService&& 
=&&  
studentCourseService&&  4
;&&4 5
_transactionService'' 
='' 
transactionService'' 0
;''0 1
_courseService(( 
=(( 
courseService(( &
;((& '
})) 
public++ 

async++ 
Task++ 
<++ 
ResponseDTO++ !
>++! "
CreateOrder++# .
(,, 
ClaimsPrincipal-- 
User-- 
).. 
{// 
try00 
{11 	
var22 
userId22 
=22 
User22 
.22 
Claims22 $
.22$ %
FirstOrDefault22% 3
(223 4
x224 5
=>226 8
x229 :
.22: ;
Type22; ?
==22@ B

ClaimTypes22C M
.22M N
NameIdentifier22N \
)22\ ]
?22] ^
.22^ _
Value22_ d
;22d e
var33 
student33 
=33 
await33 
_unitOfWork33  +
.33+ ,
StudentRepository33, =
.33= >
GetAsync33> F
(44 
filter55 
:55 
x55 
=>55 
x55 
.55 
UserId55 %
==55& (
userId55) /
,55/ 0
includeProperties66 !
:66! "
$str66# 4
)77 
;77 
if88 
(88 
student88 
is88 
null88 
)88  
{99 
return:: 
new:: 
ResponseDTO:: &
(::& '
)::' (
{;; 
Message<< 
=<< 
$str<< 5
,<<5 6
Result== 
=== 
null== !
,==! "
	IsSuccess>> 
=>> 
false>>  %
,>>% &

StatusCode?? 
=??  
$num??! $
}@@ 
;@@ 
}AA 
varCC 

cartHeaderCC 
=CC 
awaitCC "
_unitOfWorkCC# .
.CC. / 
CartHeaderRepositoryCC/ C
.CCC D
GetAsyncCCD L
(CCL M
xCCM N
=>CCO Q
xCCR S
.CCS T
	StudentIdCCT ]
==CC^ `
studentCCa h
.CCh i
	StudentIdCCi r
)CCr s
;CCs t
ifDD 
(DD 

cartHeaderDD 
isDD 
nullDD "
)DD" #
{EE 

cartHeaderFF 
=FF 
newFF  

CartHeaderFF! +
(FF+ ,
)FF, -
{GG 
	StudentIdHH 
=HH 
studentHH  '
.HH' (
	StudentIdHH( 1
,HH1 2
IdII 
=II 
GuidII 
.II 
NewGuidII %
(II% &
)II& '
,II' (

TotalPriceJJ 
=JJ  
$numJJ! "
}KK 
;KK 
awaitLL 
_unitOfWorkLL !
.LL! " 
CartHeaderRepositoryLL" 6
.LL6 7
AddAsyncLL7 ?
(LL? @

cartHeaderLL@ J
)LLJ K
;LLK L
awaitMM 
_unitOfWorkMM !
.MM! "
	SaveAsyncMM" +
(MM+ ,
)MM, -
;MM- .
returnOO 
newOO 
ResponseDTOOO &
(OO& '
)OO' (
{PP 
MessageQQ 
=QQ 
$strQQ 2
,QQ2 3
ResultRR 
=RR 
nullRR !
,RR! "
	IsSuccessSS 
=SS 
falseSS  %
,SS% &

StatusCodeTT 
=TT  
$numTT! $
}UU 
;UU 
}VV 
varXX 
cartDetailsXX 
=XX 
awaitXX #
_unitOfWorkXX$ /
.XX/ 0!
CartDetailsRepositoryXX0 E
.XXE F
GetAllAsyncXXF Q
(XXQ R
xXXR S
=>XXT V
xXXW X
.XXX Y
CartHeaderIdXXY e
==XXf h

cartHeaderXXi s
.XXs t
IdXXt v
)XXv w
;XXw x
ifYY 
(YY 
cartDetailsYY 
.YY 
IsNullOrEmptyYY )
(YY) *
)YY* +
)YY+ ,
{ZZ 
return[[ 
new[[ 
ResponseDTO[[ &
([[& '
)[[' (
{\\ 
Message]] 
=]] 
$str]] -
,]]- .
Result^^ 
=^^ 
null^^ !
,^^! "
	IsSuccess__ 
=__ 
false__  %
,__% &

StatusCode`` 
=``  
$num``! $
}aa 
;aa 
}bb 
vardd 
orderHeaderdd 
=dd 
newdd !
OrderHeaderdd" -
(dd- .
)dd. /
{ee 
Idff 
=ff 
Guidff 
.ff 
NewGuidff !
(ff! "
)ff" #
,ff# $
	StudentIdgg 
=gg 
studentgg #
.gg# $
	StudentIdgg$ -
,gg- .
Statushh 
=hh 
StaticStatushh %
.hh% &
Orderhh& +
.hh+ ,
Pendinghh, 3
,hh3 4
	CreatedByii 
=ii 
studentii #
.ii# $
ApplicationUserii$ 3
.ii3 4
Emailii4 9
,ii9 :
CreatedTimejj 
=jj 
DateTimejj &
.jj& '
UtcNowjj' -
,jj- .

OrderPricekk 
=kk 

cartHeaderkk '
.kk' (

TotalPricekk( 2
}ll 
;ll 
varnn 
orderDetailsnn 
=nn 
newnn "
Listnn# '
<nn' (
OrderDetailsnn( 4
>nn4 5
(nn5 6
)nn6 7
;nn7 8
foreachoo 
(oo 
varoo 

cartDetailoo #
inoo$ &
cartDetailsoo' 2
)oo2 3
{pp 
varqq 
orderDetailqq 
=qq  !
newqq" %
OrderDetailsqq& 2
(qq2 3
)qq3 4
{rr 
Idss 
=ss 
Guidss 
.ss 
NewGuidss %
(ss% &
)ss& '
,ss' (
CourseIdtt 
=tt 

cartDetailtt )
.tt) *
CourseIdtt* 2
,tt2 3
OrderHeaderIduu !
=uu" #
orderHeaderuu$ /
.uu/ 0
Iduu0 2
,uu2 3
CoursePricevv 
=vv  !

cartDetailvv" ,
.vv, -
CoursePricevv- 8
,vv8 9
CourseTitleww 
=ww  !

cartDetailww" ,
.ww, -
CourseTitleww- 8
}xx 
;xx 
orderDetailsyy 
.yy 
Addyy  
(yy  !
orderDetailyy! ,
)yy, -
;yy- .
}zz 
await|| 
_unitOfWork|| 
.|| !
OrderHeaderRepository|| 3
.||3 4
AddAsync||4 <
(||< =
orderHeader||= H
)||H I
;||I J
await}} 
_unitOfWork}} 
.}} "
OrderDetailsRepository}} 4
.}}4 5
AddRangeAsync}}5 B
(}}B C
orderDetails}}C O
)}}O P
;}}P Q
_unitOfWork 
. !
CartDetailsRepository -
.- .
RemoveRange. 9
(9 :
cartDetails: E
)E F
;F G

cartHeader
ÄÄ 
.
ÄÄ 

TotalPrice
ÄÄ !
=
ÄÄ" #
$num
ÄÄ$ %
;
ÄÄ% &
_unitOfWork
ÅÅ 
.
ÅÅ "
CartHeaderRepository
ÅÅ ,
.
ÅÅ, -
Update
ÅÅ- 3
(
ÅÅ3 4

cartHeader
ÅÅ4 >
)
ÅÅ> ?
;
ÅÅ? @
await
ÉÉ 
_unitOfWork
ÉÉ 
.
ÉÉ 
	SaveAsync
ÉÉ '
(
ÉÉ' (
)
ÉÉ( )
;
ÉÉ) *
var
ÖÖ 
orderHeaderDto
ÖÖ 
=
ÖÖ  
_mapper
ÖÖ! (
.
ÖÖ( )
Map
ÖÖ) ,
<
ÖÖ, -
GetOrderHeaderDTO
ÖÖ- >
>
ÖÖ> ?
(
ÖÖ? @
orderHeader
ÖÖ@ K
)
ÖÖK L
;
ÖÖL M
await
áá !
_orderStatusService
áá %
.
áá% &
CreateOrderStatus
áá& 7
(
àà 
User
ââ 
,
ââ 
new
ää "
CreateOrderStatusDTO
ää (
(
ää( )
)
ää) *
{
ãã 
Status
åå 
=
åå 
StaticStatus
åå )
.
åå) *
Order
åå* /
.
åå/ 0
Pending
åå0 7
,
åå7 8
OrderHeaderId
çç !
=
çç" #
orderHeader
çç$ /
.
çç/ 0
Id
çç0 2
}
éé 
)
èè 
;
èè 
return
ëë 
new
ëë 
ResponseDTO
ëë "
(
ëë" #
)
ëë# $
{
íí 
Message
ìì 
=
ìì 
$str
ìì 5
,
ìì5 6
Result
îî 
=
îî 
orderHeaderDto
îî '
,
îî' (
	IsSuccess
ïï 
=
ïï 
true
ïï  
,
ïï  !

StatusCode
ññ 
=
ññ 
$num
ññ  
}
óó 
;
óó 
}
òò 	
catch
ôô 
(
ôô 
	Exception
ôô 
e
ôô 
)
ôô 
{
öö 	
return
õõ 
new
õõ 
ResponseDTO
õõ "
(
õõ" #
)
õõ# $
{
úú 
Message
ùù 
=
ùù 
e
ùù 
.
ùù 
Message
ùù #
,
ùù# $
Result
ûû 
=
ûû 
null
ûû 
,
ûû 
	IsSuccess
üü 
=
üü 
false
üü !
,
üü! "

StatusCode
†† 
=
†† 
$num
††  
}
°° 
;
°° 
}
¢¢ 	
}
££ 
public
•• 

Task
•• 
<
•• 
ResponseDTO
•• 
>
•• 
	GetOrders
•• &
(
¶¶ 
ClaimsPrincipal
ßß 
User
ßß 
,
ßß 
Guid
®® 
?
®® 
	studentId
®® 
,
®® 
string
©© 
?
©© 
filterOn
©© 
,
©© 
string
™™ 
?
™™ 
filterQuery
™™ 
,
™™ 
string
´´ 
?
´´ 
sortBy
´´ 
,
´´ 
bool
¨¨ 
?
¨¨ 
isAscending
¨¨ 
,
¨¨ 
int
≠≠ 

pageNumber
≠≠ 
=
≠≠ 
$num
≠≠ 
,
≠≠ 
int
ÆÆ 
pageSize
ÆÆ 
=
ÆÆ 
$num
ÆÆ 
)
ØØ 
{
∞∞ 
throw
±± 
new
±± %
NotImplementedException
±± )
(
±±) *
)
±±* +
;
±±+ ,
}
≤≤ 
public
¥¥ 

async
¥¥ 
Task
¥¥ 
<
¥¥ 
ResponseDTO
¥¥ !
>
¥¥! "
GetOrder
¥¥# +
(
µµ 
ClaimsPrincipal
∂∂ 
User
∂∂ 
,
∂∂ 
Guid
∑∑ 
orderHeaderId
∑∑ 
)
∏∏ 
{
ππ 
try
∫∫ 
{
ªª 	
var
ºº 
userId
ºº 
=
ºº 
User
ºº 
.
ºº 
Claims
ºº $
.
ºº$ %
FirstOrDefault
ºº% 3
(
ºº3 4
x
ºº4 5
=>
ºº6 8
x
ºº9 :
.
ºº: ;
Type
ºº; ?
==
ºº@ B

ClaimTypes
ººC M
.
ººM N
NameIdentifier
ººN \
)
ºº\ ]
?
ºº] ^
.
ºº^ _
Value
ºº_ d
;
ººd e
var
ææ 
student
ææ 
=
ææ 
await
ææ 
_unitOfWork
ææ  +
.
ææ+ ,
StudentRepository
ææ, =
.
ææ= >
GetAsync
ææ> F
(
ææF G
x
ææG H
=>
ææI K
x
ææL M
.
ææM N
UserId
ææN T
==
ææU W
userId
ææX ^
)
ææ^ _
;
ææ_ `
if
øø 
(
øø 
student
øø 
is
øø 
null
øø 
)
øø  
{
¿¿ 
return
¡¡ 
new
¡¡ 
ResponseDTO
¡¡ &
(
¡¡& '
)
¡¡' (
{
¬¬ 
Message
√√ 
=
√√ 
$str
√√ 5
,
√√5 6
Result
ƒƒ 
=
ƒƒ 
null
ƒƒ !
,
ƒƒ! "
	IsSuccess
≈≈ 
=
≈≈ 
false
≈≈  %
,
≈≈% &

StatusCode
∆∆ 
=
∆∆  
$num
∆∆! $
}
«« 
;
«« 
}
»» 
var
   
orderHeader
   
=
   
await
   #
_unitOfWork
  $ /
.
  / 0#
OrderHeaderRepository
  0 E
.
  E F
GetAsync
  F N
(
  N O
x
  O P
=>
  Q S
x
  T U
.
  U V
Id
  V X
==
  Y [
orderHeaderId
  \ i
)
  i j
;
  j k
var
ÀÀ 
orderDetails
ÀÀ 
=
ÀÀ 
await
ÃÃ 
_unitOfWork
ÃÃ !
.
ÃÃ! "$
OrderDetailsRepository
ÃÃ" 8
.
ÃÃ8 9
GetAllAsync
ÃÃ9 D
(
ÃÃD E
x
ÃÃE F
=>
ÃÃG I
x
ÃÃJ K
.
ÃÃK L
OrderHeaderId
ÃÃL Y
==
ÃÃZ \
orderHeaderId
ÃÃ] j
)
ÃÃj k
;
ÃÃk l
var
ŒŒ 
getOrderHeaderDto
ŒŒ !
=
ŒŒ" #
_mapper
ŒŒ$ +
.
ŒŒ+ ,
Map
ŒŒ, /
<
ŒŒ/ 0
GetOrderHeaderDTO
ŒŒ0 A
>
ŒŒA B
(
ŒŒB C
orderHeader
ŒŒC N
)
ŒŒN O
;
ŒŒO P
getOrderHeaderDto
œœ 
.
œœ 
GetOrderDetails
œœ -
=
œœ. /
_mapper
œœ0 7
.
œœ7 8
Map
œœ8 ;
<
œœ; <
List
œœ< @
<
œœ@ A 
GetOrderDetailsDTO
œœA S
>
œœS T
>
œœT U
(
œœU V
orderDetails
œœV b
)
œœb c
;
œœc d
return
—— 
new
—— 
ResponseDTO
—— "
(
——" #
)
——# $
{
““ 
Message
”” 
=
”” 
$str
”” 2
,
””2 3
	IsSuccess
‘‘ 
=
‘‘ 
true
‘‘  
,
‘‘  !

StatusCode
’’ 
=
’’ 
$num
’’  
,
’’  !
Result
÷÷ 
=
÷÷ 
getOrderHeaderDto
÷÷ *
}
◊◊ 
;
◊◊ 
}
ÿÿ 	
catch
ŸŸ 
(
ŸŸ 
	Exception
ŸŸ 
e
ŸŸ 
)
ŸŸ 
{
⁄⁄ 	
return
€€ 
new
€€ 
ResponseDTO
€€ "
(
€€" #
)
€€# $
{
‹‹ 
}
›› 
;
›› 
}
ﬁﬁ 	
}
ﬂﬂ 
public
·· 

async
·· 
Task
·· 
<
·· 
ResponseDTO
·· !
>
··! "
PayWithStripe
··# 0
(
‚‚ 
ClaimsPrincipal
„„ 
User
„„ 
,
„„ 
PayWithStripeDTO
‰‰ 
payWithStripeDto
‰‰ )
)
ÂÂ 
{
ÊÊ 
try
ÁÁ 
{
ËË 	
var
ÈÈ 
orderHeader
ÈÈ 
=
ÈÈ 
await
ÈÈ #
_unitOfWork
ÈÈ$ /
.
ÈÈ/ 0#
OrderHeaderRepository
ÈÈ0 E
.
ÈÈE F
GetAsync
ÈÈF N
(
ÍÍ 
filter
ÎÎ 
:
ÎÎ 
x
ÎÎ 
=>
ÎÎ 
x
ÎÎ 
.
ÎÎ 
Id
ÎÎ !
==
ÎÎ" $
payWithStripeDto
ÎÎ% 5
.
ÎÎ5 6
OrderHeaderId
ÎÎ6 C
)
ÏÏ 
;
ÏÏ 
if
ÌÌ 
(
ÌÌ 
orderHeader
ÌÌ 
is
ÌÌ 
null
ÌÌ #
)
ÌÌ# $
{
ÓÓ 
return
ÔÔ 
new
ÔÔ 
ResponseDTO
ÔÔ &
(
ÔÔ& '
)
ÔÔ' (
{
 
Message
ÒÒ 
=
ÒÒ 
$str
ÒÒ 3
,
ÒÒ3 4
	IsSuccess
ÚÚ 
=
ÚÚ 
false
ÚÚ  %
,
ÚÚ% &

StatusCode
ÛÛ 
=
ÛÛ  
$num
ÛÛ! $
,
ÛÛ$ %
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ !
}
ıı 
;
ıı 
}
ˆˆ 
if
¯¯ 
(
¯¯ 
orderHeader
¯¯ 
.
¯¯ 
Status
¯¯ "
!=
¯¯# %
$num
¯¯& '
)
¯¯' (
{
˘˘ 
return
˙˙ 
new
˙˙ 
ResponseDTO
˙˙ &
(
˙˙& '
)
˙˙' (
{
˚˚ 
Message
¸¸ 
=
¸¸ 
$str
¸¸ .
,
¸¸. /
	IsSuccess
˝˝ 
=
˝˝ 
false
˝˝  %
,
˝˝% &

StatusCode
˛˛ 
=
˛˛  
$num
˛˛! $
,
˛˛$ %
Result
ˇˇ 
=
ˇˇ 
null
ˇˇ !
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ 
orderDetails
ÉÉ 
=
ÉÉ 
await
ÉÉ $
_unitOfWork
ÉÉ% 0
.
ÉÉ0 1$
OrderDetailsRepository
ÉÉ1 G
.
ÉÉG H
GetAllAsync
ÉÉH S
(
ÑÑ 
filter
ÖÖ 
:
ÖÖ 
x
ÖÖ 
=>
ÖÖ 
x
ÖÖ 
.
ÖÖ 
OrderHeaderId
ÖÖ ,
==
ÖÖ- /
orderHeader
ÖÖ0 ;
.
ÖÖ; <
Id
ÖÖ< >
)
ÜÜ 
;
ÜÜ 
if
áá 
(
áá 
orderDetails
áá 
.
áá 
IsNullOrEmpty
áá *
(
áá* +
)
áá+ ,
)
áá, -
{
àà 
return
ââ 
new
ââ 
ResponseDTO
ââ &
(
ââ& '
)
ââ' (
{
ää 
Message
ãã 
=
ãã 
$str
ãã /
,
ãã/ 0
	IsSuccess
åå 
=
åå 
false
åå  %
,
åå% &

StatusCode
çç 
=
çç  
$num
çç! $
,
çç$ %
Result
éé 
=
éé 
null
éé !
}
èè 
;
èè 
}
êê 
var
íí 
responseDto
íí 
=
íí 
await
íí #
_stripeService
íí$ 2
.
íí2 3"
CreatePaymentSession
íí3 G
(
ìì 
new
îî $
CreateStripeSessionDTO
îî *
(
îî* +
)
îî+ ,
{
ïï 
ApprovedUrl
ññ 
=
ññ  !
payWithStripeDto
ññ" 2
.
ññ2 3
ApprovedUrl
ññ3 >
,
ññ> ?
	CancelUrl
óó 
=
óó 
payWithStripeDto
óó  0
.
óó0 1
	CancelUrl
óó1 :
,
óó: ;
OrdersDetails
òò !
=
òò" #
orderDetails
òò$ 0
}
ôô 
)
öö 
;
öö 
var
õõ 
result
õõ 
=
õõ 
(
õõ $
CreateStripeSessionDTO
õõ 0
)
õõ0 1
responseDto
õõ1 <
.
õõ< =
Result
õõ= C
!
õõC D
;
õõD E
payWithStripeDto
ùù 
.
ùù 
StripeSessionUrl
ùù -
=
ùù. /
result
ùù0 6
.
ùù6 7
StripeSessionUrl
ùù7 G
;
ùùG H
orderHeader
ûû 
.
ûû 
StripeSessionId
ûû '
=
ûû( )
result
ûû* 0
.
ûû0 1
StripeSessionId
ûû1 @
;
ûû@ A
_unitOfWork
üü 
.
üü #
OrderHeaderRepository
üü -
.
üü- .
Update
üü. 4
(
üü4 5
orderHeader
üü5 @
)
üü@ A
;
üüA B
await
†† 
_unitOfWork
†† 
.
†† 
	SaveAsync
†† '
(
††' (
)
††( )
;
††) *
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ "
(
¢¢" #
)
¢¢# $
{
££ 
Message
§§ 
=
§§ 
$str
§§ C
,
§§C D
Result
•• 
=
•• 
payWithStripeDto
•• )
,
••) *

StatusCode
¶¶ 
=
¶¶ 
$num
¶¶  
,
¶¶  !
	IsSuccess
ßß 
=
ßß 
true
ßß  
}
®® 
;
®® 
}
©© 	
catch
™™ 
(
™™ 
	Exception
™™ 
e
™™ 
)
™™ 
{
´´ 	
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
e
ÆÆ 
.
ÆÆ 
Message
ÆÆ #
,
ÆÆ# $
Result
ØØ 
=
ØØ 
null
ØØ 
,
ØØ 

StatusCode
∞∞ 
=
∞∞ 
$num
∞∞  
,
∞∞  !
	IsSuccess
±± 
=
±± 
false
±± !
}
≤≤ 
;
≤≤ 
}
≥≥ 	
}
¥¥ 
public
∂∂ 

async
∂∂ 
Task
∂∂ 
<
∂∂ 
ResponseDTO
∂∂ !
>
∂∂! " 
ValidateWithStripe
∂∂# 5
(
∑∑ 
ClaimsPrincipal
∏∏ 
User
∏∏ 
,
∏∏ #
ValidateWithStripeDTO
ππ #
validateWithStripeDto
ππ 3
)
∫∫ 
{
ªª 
try
ºº 
{
ΩΩ 	
var
ææ 
orderHeader
ææ 
=
ææ 
await
ææ #
_unitOfWork
ææ$ /
.
ææ/ 0#
OrderHeaderRepository
ææ0 E
.
ææE F
GetAsync
ææF N
(
øø 
filter
¿¿ 
:
¿¿ 
x
¿¿ 
=>
¿¿ 
x
¿¿ 
.
¿¿ 
Id
¿¿ !
==
¿¿" $#
validateWithStripeDto
¿¿% :
.
¿¿: ;
OrderHeaderId
¿¿; H
)
¡¡ 
;
¡¡ 
if
√√ 
(
√√ 
orderHeader
√√ 
is
√√ 
null
√√ #
)
√√# $
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
(
≈≈& '
)
≈≈' (
{
∆∆ 
Message
«« 
=
«« 
$str
«« 3
,
««3 4
	IsSuccess
»» 
=
»» 
false
»»  %
,
»»% &

StatusCode
…… 
=
……  
$num
……! $
,
……$ %
Result
   
=
   
null
   !
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
var
ŒŒ 
student
ŒŒ 
=
ŒŒ 
await
ŒŒ 
_unitOfWork
ŒŒ  +
.
ŒŒ+ ,
StudentRepository
ŒŒ, =
.
ŒŒ= >
GetAsync
ŒŒ> F
(
ŒŒF G
x
ŒŒG H
=>
ŒŒI K
x
ŒŒL M
.
ŒŒM N
	StudentId
ŒŒN W
==
ŒŒX Z
orderHeader
ŒŒ[ f
.
ŒŒf g
	StudentId
ŒŒg p
)
ŒŒp q
;
ŒŒq r
if
–– 
(
–– 
student
–– 
is
–– 
null
–– 
)
––  
{
—— 
return
““ 
new
““ 
ResponseDTO
““ &
(
““& '
)
““' (
{
”” 
Message
‘‘ 
=
‘‘ 
$str
‘‘ 5
,
‘‘5 6
	IsSuccess
’’ 
=
’’ 
false
’’  %
,
’’% &

StatusCode
÷÷ 
=
÷÷  
$num
÷÷! $
,
÷÷$ %
Result
◊◊ 
=
◊◊ 
null
◊◊ !
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
var
€€ 
responseDto
€€ 
=
€€ 
await
€€ #
_stripeService
€€$ 2
.
€€2 3$
ValidatePaymentSession
€€3 I
(
‹‹ 
new
›› &
ValidateStripeSessionDTO
›› ,
(
››, -
)
››- .
{
ﬁﬁ 
StripeSessionId
ﬂﬂ #
=
ﬂﬂ$ %
orderHeader
ﬂﬂ& 1
.
ﬂﬂ1 2
StripeSessionId
ﬂﬂ2 A
}
‡‡ 
)
·· 
;
·· 
var
‚‚ 
result
‚‚ 
=
‚‚ 
(
‚‚ &
ValidateStripeSessionDTO
‚‚ 2
)
‚‚2 3
responseDto
‚‚3 >
.
‚‚> ?
Result
‚‚? E
!
‚‚E F
;
‚‚F G
if
ÂÂ 
(
ÂÂ 
result
ÂÂ 
.
ÂÂ 
Status
ÂÂ 
!=
ÂÂ  
$str
ÂÂ! ,
)
ÂÂ, -
{
ÊÊ 
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ &
(
ÁÁ& '
)
ÁÁ' (
{
ËË 
Message
ÈÈ 
=
ÈÈ 
$str
ÈÈ 6
,
ÈÈ6 7
	IsSuccess
ÍÍ 
=
ÍÍ 
false
ÍÍ  %
,
ÍÍ% &

StatusCode
ÎÎ 
=
ÎÎ  
$num
ÎÎ! $
,
ÎÎ$ %
Result
ÏÏ 
=
ÏÏ 
null
ÏÏ !
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 
orderHeader
 
.
 
PaymentIntentId
 '
=
( )
result
* 0
.
0 1
PaymentIntentId
1 @
;
@ A
orderHeader
ÒÒ 
.
ÒÒ 
Status
ÒÒ 
=
ÒÒ  
StaticStatus
ÒÒ! -
.
ÒÒ- .
Order
ÒÒ. 3
.
ÒÒ3 4
Paid
ÒÒ4 8
;
ÒÒ8 9
await
ÚÚ !
_orderStatusService
ÚÚ %
.
ÚÚ% &
CreateOrderStatus
ÚÚ& 7
(
ÛÛ 
User
ÙÙ 
,
ÙÙ 
new
ıı "
CreateOrderStatusDTO
ıı (
(
ıı( )
)
ıı) *
{
ˆˆ 
Status
˜˜ 
=
˜˜ 
StaticStatus
˜˜ )
.
˜˜) *
Order
˜˜* /
.
˜˜/ 0
Paid
˜˜0 4
,
˜˜4 5
OrderHeaderId
¯¯ !
=
¯¯" #
orderHeader
¯¯$ /
.
¯¯/ 0
Id
¯¯0 2
}
˘˘ 
)
˙˙ 
;
˙˙ 
await
˝˝ !
_transactionService
˝˝ %
.
˝˝% &
CreateTransaction
˝˝& 7
(
˛˛ 
new
ˇˇ "
CreateTransactionDTO
ˇˇ (
(
ˇˇ( )
)
ˇˇ) *
{
ÄÄ 
UserId
ÅÅ 
=
ÅÅ 
student
ÅÅ $
.
ÅÅ$ %
UserId
ÅÅ% +
,
ÅÅ+ ,
Amount
ÇÇ 
=
ÇÇ 
orderHeader
ÇÇ (
.
ÇÇ( )

OrderPrice
ÇÇ) 3
,
ÇÇ3 4
Type
ÉÉ 
=
ÉÉ 

StaticEnum
ÉÉ %
.
ÉÉ% &
TransactionType
ÉÉ& 5
.
ÉÉ5 6
Purchase
ÉÉ6 >
}
ÑÑ 
)
ÖÖ 
;
ÖÖ 
return
áá 
new
áá 
ResponseDTO
áá "
(
áá" #
)
áá# $
{
àà 
Message
ââ 
=
ââ 
$str
ââ E
,
ââE F
Result
ää 
=
ää 
null
ää 
,
ää 

StatusCode
ãã 
=
ãã 
$num
ãã  
,
ãã  !
	IsSuccess
åå 
=
åå 
true
åå  
}
çç 
;
çç 
}
éé 	
catch
èè 
(
èè 
	Exception
èè 
e
èè 
)
èè 
{
êê 	
return
ëë 
new
ëë 
ResponseDTO
ëë "
(
ëë" #
)
ëë# $
{
íí 
Message
ìì 
=
ìì 
e
ìì 
.
ìì 
Message
ìì #
,
ìì# $
Result
îî 
=
îî 
null
îî 
,
îî 

StatusCode
ïï 
=
ïï 
$num
ïï  
,
ïï  !
	IsSuccess
ññ 
=
ññ 
false
ññ !
}
óó 
;
óó 
}
òò 	
}
ôô 
public
õõ 

async
õõ 
Task
õõ 
<
õõ 
ResponseDTO
õõ !
>
õõ! "
ConfirmOrder
õõ# /
(
úú 
ClaimsPrincipal
ùù 
User
ùù 
,
ùù 
Guid
ûû 
orderHeaderId
ûû 
)
üü 
{
†† 
try
°° 
{
¢¢ 	
var
££ 
orderHeader
££ 
=
££ 
await
££ #
_unitOfWork
££$ /
.
££/ 0#
OrderHeaderRepository
££0 E
.
££E F
GetAsync
££F N
(
££N O
x
££O P
=>
££Q S
x
££T U
.
££U V
Id
££V X
==
££Y [
orderHeaderId
££\ i
)
££i j
;
££j k
if
§§ 
(
§§ 
orderHeader
§§ 
is
§§ 
null
§§ #
)
§§# $
{
•• 
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ &
(
¶¶& '
)
¶¶' (
{
ßß 
Message
®® 
=
®® 
$str
®® 3
,
®®3 4
	IsSuccess
©© 
=
©© 
false
©©  %
,
©©% &

StatusCode
™™ 
=
™™  
$num
™™! $
,
™™$ %
Result
´´ 
=
´´ 
null
´´ !
}
¨¨ 
;
¨¨ 
}
≠≠ 
if
ØØ 
(
ØØ 
orderHeader
ØØ 
.
ØØ 
Status
ØØ "
!=
ØØ# %
StaticStatus
ØØ& 2
.
ØØ2 3
Order
ØØ3 8
.
ØØ8 9
Paid
ØØ9 =
)
ØØ= >
{
∞∞ 
return
±± 
new
±± 
ResponseDTO
±± &
(
±±& '
)
±±' (
{
≤≤ 
Message
≥≥ 
=
≥≥ 
$str
≥≥ 2
,
≥≥2 3
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥  %
,
¥¥% &

StatusCode
µµ 
=
µµ  
$num
µµ! $
,
µµ$ %
Result
∂∂ 
=
∂∂ 
null
∂∂ !
}
∑∑ 
;
∑∑ 
}
∏∏ 
orderHeader
∫∫ 
.
∫∫ 
Status
∫∫ 
=
∫∫  
StaticStatus
∫∫! -
.
∫∫- .
Order
∫∫. 3
.
∫∫3 4
Pending
∫∫4 ;
;
∫∫; <
_unitOfWork
ªª 
.
ªª #
OrderHeaderRepository
ªª -
.
ªª- .
Update
ªª. 4
(
ªª4 5
orderHeader
ªª5 @
)
ªª@ A
;
ªªA B
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
await
ææ !
_orderStatusService
ææ %
.
ææ% &
CreateOrderStatus
ææ& 7
(
øø 
User
¿¿ 
,
¿¿ 
new
¡¡ "
CreateOrderStatusDTO
¡¡ (
(
¡¡( )
)
¡¡) *
{
¬¬ 
Status
√√ 
=
√√ 
StaticStatus
√√ )
.
√√) *
Order
√√* /
.
√√/ 0
Pending
√√0 7
,
√√7 8
OrderHeaderId
ƒƒ !
=
ƒƒ" #
orderHeader
ƒƒ$ /
.
ƒƒ/ 0
Id
ƒƒ0 2
,
ƒƒ2 3
}
≈≈ 
)
∆∆ 
;
∆∆ 
var
»» 
ordersDetails
»» 
=
»» 
await
…… 
_unitOfWork
…… !
.
……! "$
OrderDetailsRepository
……" 8
.
……8 9
GetAllAsync
……9 D
(
……D E
x
……E F
=>
……G I
x
……J K
.
……K L
OrderHeaderId
……L Y
==
……Z \
orderHeader
……] h
.
……h i
Id
……i k
)
……k l
;
……l m
foreach
ÀÀ 
(
ÀÀ 
var
ÀÀ 
orderDetails
ÀÀ %
in
ÀÀ& (
ordersDetails
ÀÀ) 6
)
ÀÀ6 7
{
ÃÃ 
await
ÕÕ #
_studentCourseService
ÕÕ +
.
ÕÕ+ ,!
CreateStudentCourse
ÕÕ, ?
(
ŒŒ 
User
œœ 
,
œœ 
new
–– 
EnrollCourseDTO
–– '
(
––' (
)
––( )
{
—— 
courseId
““  
=
““! "
orderDetails
““# /
.
““/ 0
CourseId
““0 8
,
““8 9
	studentId
”” !
=
””" #
orderHeader
””$ /
.
””/ 0
	StudentId
””0 9
}
‘‘ 
)
’’ 
;
’’ 
await
◊◊ 
_courseService
◊◊ $
.
◊◊$ %
UpsertCourseTotal
◊◊% 6
(
ÿÿ 
new
ŸŸ "
UpsertCourseTotalDTO
ŸŸ ,
(
ŸŸ, -
)
ŸŸ- .
{
⁄⁄ 
CourseId
€€  
=
€€! "
orderDetails
€€# /
.
€€/ 0
CourseId
€€0 8
,
€€8 9
TotalEarned
‹‹ #
=
‹‹$ %
orderDetails
‹‹& 2
.
‹‹2 3
CoursePrice
‹‹3 >
}
›› 
)
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Message
„„ 
=
„„ 
$str
„„ 6
,
„„6 7
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Result
ÊÊ 
=
ÊÊ 
null
ÊÊ 
}
ÁÁ 
;
ÁÁ 
}
ËË 	
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ "
(
ÎÎ" #
)
ÎÎ# $
{
ÏÏ 
Message
ÌÌ 
=
ÌÌ 
e
ÌÌ 
.
ÌÌ 
Message
ÌÌ #
,
ÌÌ# $
Result
ÓÓ 
=
ÓÓ 
null
ÓÓ 
,
ÓÓ 
	IsSuccess
ÔÔ 
=
ÔÔ 
false
ÔÔ !
,
ÔÔ! "

StatusCode
 
=
 
$num
  
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
}
ÛÛ 
}ÙÙ ü
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\NotificationService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
NotificationService  
:! " 
INotificationService# 7
{ 
} »∞
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\LevelService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
LevelService 
: 
ILevelService )
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
IMapper 
_mapper 
; 
public 

LevelService 
( 
IUnitOfWork #

unitOfWork$ .
,. /
IMapper0 7
mapper8 >
)> ?
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
	GetLevels# ,
( 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int   
pageSize   
=   
$num   
)!! 
{"" 
try## 
{$$ 	
var&& 
userRole&& 
=&& 
User&& 
.&&  
Claims&&  &
.&&& '
FirstOrDefault&&' 5
(&&5 6
x&&6 7
=>&&8 :
x&&; <
.&&< =
Type&&= A
==&&B D

ClaimTypes&&E O
.&&O P
Role&&P T
)&&T U
?&&U V
.&&V W
Value&&W \
;&&\ ]
IEnumerable(( 
<(( 
Level(( 
>(( 
levels(( %
;((% &
if** 
(** 
userRole** 
==** 
StaticUserRoles** +
.**+ ,
Admin**, 1
)**1 2
{++ 
levels-- 
=-- 
await-- 
_unitOfWork-- *
.--* +
LevelRepository--+ :
.--: ;
GetAllAsync--; F
(--F G
)--G H
;--H I
}.. 
else// 
{00 
levels22 
=22 
await22 
_unitOfWork22 *
.22* +
LevelRepository22+ :
.22: ;
GetAllAsync22; F
(22F G
x22G H
=>22I K
x22L M
.22M N
Status22N T
<=22U W
$num22X Y
)22Y Z
;22Z [
}33 
if66 
(66 
!66 
levels66 
.66 
Any66 
(66 
)66 
)66 
{77 
return88 
new88 
ResponseDTO88 &
(88& '
)88' (
{99 
Message:: 
=:: 
$str:: 3
,::3 4
	IsSuccess;; 
=;; 
true;;  $
,;;$ %

StatusCode<< 
=<<  
$num<<! $
,<<$ %
Result== 
=== 
null== !
}>> 
;>> 
}?? 
varAA 

listLevelsAA 
=AA 
levelsAA #
.AA# $
ToListAA$ *
(AA* +
)AA+ ,
;AA, -
ifDD 
(DD 
!DD 
stringDD 
.DD 
IsNullOrEmptyDD %
(DD% &
filterOnDD& .
)DD. /
&&DD0 2
!DD3 4
stringDD4 :
.DD: ;
IsNullOrEmptyDD; H
(DDH I
filterQueryDDI T
)DDT U
)DDU V
{EE 
switchFF 
(FF 
filterOnFF  
.FF  !
TrimFF! %
(FF% &
)FF& '
.FF' (
ToLowerFF( /
(FF/ 0
)FF0 1
)FF1 2
{GG 
caseHH 
$strHH 
:HH  

listLevelsII "
=II# $

listLevelsII% /
.II/ 0
WhereII0 5
(II5 6
xII6 7
=>II8 :
xJJ 
.JJ 
NameJJ "
.JJ" #
ContainsJJ# +
(JJ+ ,
filterQueryJJ, 7
,JJ7 8
StringComparisonJJ9 I
.JJI J$
CurrentCultureIgnoreCaseJJJ b
)JJb c
)JJc d
.JJd e
ToListJJe k
(JJk l
)JJl m
;JJm n
breakKK 
;KK 
defaultLL 
:LL 
breakMM 
;MM 
}NN 
}OO 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrEmptyRR %
(RR% &
sortByRR& ,
)RR, -
)RR- .
{SS 
switchTT 
(TT 
sortByTT 
.TT 
TrimTT #
(TT# $
)TT$ %
.TT% &
ToLowerTT& -
(TT- .
)TT. /
)TT/ 0
{UU 
caseVV 
$strVV 
:VV  

listLevelsWW "
=WW# $

listLevelsWW% /
.WW/ 0
OrderByWW0 7
(WW7 8
xWW8 9
=>WW: <
xWW= >
.WW> ?
NameWW? C
)WWC D
.WWD E
ToListWWE K
(WWK L
)WWL M
;WWM N
breakXX 
;XX 
defaultYY 
:YY 
breakZZ 
;ZZ 
}[[ 
}\\ 
else]] 
{^^ 

listLevels`` 
=`` 

listLevels`` '
.``' (
OrderByDescending``( 9
(``9 :
x``: ;
=>``< >
x``? @
.``@ A
CreatedTime``A L
)``L M
.``M N
ToList``N T
(``T U
)``U V
;``V W
}aa 
ifdd 
(dd 

pageNumberdd 
>dd 
$numdd 
&&dd !
pageSizedd" *
>dd+ ,
$numdd- .
)dd. /
{ee 
varff 

skipResultff 
=ff  
(ff! "

pageNumberff" ,
-ff- .
$numff/ 0
)ff0 1
*ff2 3
pageSizeff4 <
;ff< =

listLevelsgg 
=gg 

listLevelsgg '
.gg' (
Skipgg( ,
(gg, -

skipResultgg- 7
)gg7 8
.gg8 9
Takegg9 =
(gg= >
pageSizegg> F
)ggF G
.ggG H
ToListggH N
(ggN O
)ggO P
;ggP Q
}hh 
varkk 
	levelsDtokk 
=kk 

listLevelskk &
.kk& '
Selectkk' -
(kk- .
levelkk. 3
=>kk4 6
newkk7 :
GetLevelDTOkk; F
(kkF G
)kkG H
{ll 
Idmm 
=mm 
levelmm 
.mm 
Idmm 
,mm 
Namenn 
=nn 
levelnn 
.nn 
Namenn !
,nn! "

CreateTimeoo 
=oo 
leveloo "
.oo" #
CreatedTimeoo# .
,oo. /
CreateBypp 
=pp 
levelpp  
.pp  !
	CreatedBypp! *
,pp* +

UpdateTimeqq 
=qq 
levelqq "
.qq" #
UpdatedTimeqq# .
,qq. /
UpdateByrr 
=rr 
levelrr  
.rr  !
	UpdatedByrr! *
,rr* +
Statusss 
=ss 
levelss 
.ss 
Statusss %
}tt 
)tt 
.tt 
ToListtt 
(tt 
)tt 
;tt 
returnvv 
newvv 
ResponseDTOvv "
(vv" #
)vv# $
{ww 
Messagexx 
=xx 
$strxx 3
,xx3 4
	IsSuccessyy 
=yy 
trueyy  
,yy  !

StatusCodezz 
=zz 
$numzz  
,zz  !
Result{{ 
={{ 
	levelsDto{{ "
}|| 
;|| 
}}} 	
catch~~ 
(~~ 
	Exception~~ 
e~~ 
)~~ 
{ 	
return
ÄÄ 
new
ÄÄ 
ResponseDTO
ÄÄ "
(
ÄÄ" #
)
ÄÄ# $
{
ÅÅ 
Message
ÇÇ 
=
ÇÇ 
e
ÇÇ 
.
ÇÇ 
Message
ÇÇ #
,
ÇÇ# $
Result
ÉÉ 
=
ÉÉ 
null
ÉÉ 
,
ÉÉ 
	IsSuccess
ÑÑ 
=
ÑÑ 
false
ÑÑ !
,
ÑÑ! "

StatusCode
ÖÖ 
=
ÖÖ 
$num
ÖÖ  
}
ÜÜ 
;
ÜÜ 
}
áá 	
}
àà 
public
ää 

async
ää 
Task
ää 
<
ää 
ResponseDTO
ää !
>
ää! "
GetLevel
ää# +
(
ää+ ,
ClaimsPrincipal
ää, ;
User
ää< @
,
ää@ A
Guid
ääB F
levelId
ääG N
)
ääN O
{
ãã 
try
åå 
{
çç 	
var
éé 
LevelID
éé 
=
éé 
await
èè 
_unitOfWork
èè !
.
èè! "
LevelRepository
èè" 1
.
èè1 2
GetLevelById
èè2 >
(
èè> ?
levelId
èè? F
)
èèF G
;
èèG H
if
ëë 
(
ëë 
LevelID
ëë 
is
ëë 
null
ëë 
)
ëë  
{
íí 
return
ìì 
new
ìì 
ResponseDTO
ìì &
(
ìì& '
)
ìì' (
{
îî 
Result
ïï 
=
ïï 
$str
ïï 
,
ïï  
Message
ññ 
=
ññ 
$str
ññ 3
,
ññ3 4
	IsSuccess
óó 
=
óó 
true
óó  $
,
óó$ %

StatusCode
òò 
=
òò  
$num
òò! $
}
ôô 
;
ôô 
}
öö 
GetLevelDTO
úú 
levelDto
úú  
;
úú  !
try
ùù 
{
ûû 
levelDto
üü 
=
üü 
_mapper
üü "
.
üü" #
Map
üü# &
<
üü& '
GetLevelDTO
üü' 2
>
üü2 3
(
üü3 4
LevelID
üü4 ;
)
üü; <
;
üü< =
}
†† 
catch
°° 
(
°° (
AutoMapperMappingException
°° -
e
°°. /
)
°°/ 0
{
¢¢ 
return
•• 
new
•• 
ResponseDTO
•• &
(
••& '
)
••' (
{
¶¶ 
Result
ßß 
=
ßß 
null
ßß !
,
ßß! "
Message
®® 
=
®® 
$str
®® B
,
®®B C
	IsSuccess
©© 
=
©© 
false
©©  %
,
©©% &

StatusCode
™™ 
=
™™  
$num
™™! $
}
´´ 
;
´´ 
}
¨¨ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ "
(
ÆÆ" #
)
ÆÆ# $
{
ØØ 
Result
∞∞ 
=
∞∞ 
levelDto
∞∞ !
,
∞∞! "
Message
±± 
=
±± 
$str
±± 2
,
±±2 3
	IsSuccess
≤≤ 
=
≤≤ 
true
≤≤  
,
≤≤  !

StatusCode
≥≥ 
=
≥≥ 
$num
≥≥  
}
¥¥ 
;
¥¥ 
}
µµ 	
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 	
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
(
∏∏" #
)
∏∏# $
{
ππ 
Result
∫∫ 
=
∫∫ 
null
∫∫ 
,
∫∫ 
Message
ªª 
=
ªª 
e
ªª 
.
ªª 
Message
ªª #
,
ªª# $
	IsSuccess
ºº 
=
ºº 
true
ºº  
,
ºº  !

StatusCode
ΩΩ 
=
ΩΩ 
$num
ΩΩ  
}
ææ 
;
ææ 
}
øø 	
}
¿¿ 
public
¬¬ 

async
¬¬ 
Task
¬¬ 
<
¬¬ 
ResponseDTO
¬¬ !
>
¬¬! "
CreateLevel
¬¬# .
(
¬¬. /
ClaimsPrincipal
¬¬/ >
User
¬¬? C
,
¬¬C D
CreateLevelDTO
¬¬E S
createLevelDto
¬¬T b
)
¬¬b c
{
√√ 
try
ƒƒ 
{
≈≈ 	
var
∆∆ 
userId
∆∆ 
=
∆∆ 
User
∆∆ 
.
∆∆ 
Claims
∆∆ $
.
∆∆$ %
FirstOrDefault
∆∆% 3
(
∆∆3 4
x
∆∆4 5
=>
∆∆6 8
x
∆∆9 :
.
∆∆: ;
Type
∆∆; ?
==
∆∆@ B

ClaimTypes
∆∆C M
.
∆∆M N
NameIdentifier
∆∆N \
)
∆∆\ ]
?
∆∆] ^
.
∆∆^ _
Value
∆∆_ d
;
∆∆d e
var
«« 
admin
«« 
=
«« 
await
«« 
_unitOfWork
«« )
.
««) *#
UserManagerRepository
««* ?
.
««? @
FindByIdAsync
««@ M
(
««M N
userId
««N T
)
««T U
;
««U V
Level
   
levels
   
=
   
new
   
Level
   $
(
  $ %
)
  % &
{
ÀÀ 
Name
ÃÃ 
=
ÃÃ 
createLevelDto
ÃÃ %
.
ÃÃ% &
Name
ÃÃ& *
,
ÃÃ* +
	CreatedBy
ÕÕ 
=
ÕÕ 
admin
ÕÕ !
.
ÕÕ! "
Email
ÕÕ" '
,
ÕÕ' (
CreatedTime
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ &
.
ŒŒ& '
Now
ŒŒ' *
,
ŒŒ* +
UpdatedTime
œœ 
=
œœ 
null
œœ "
,
œœ" #
	UpdatedBy
–– 
=
–– 
$str
–– 
,
–– 
Status
—— 
=
—— 
$num
—— 
}
““ 
;
““ 
await
’’ 
_unitOfWork
’’ 
.
’’ 
LevelRepository
’’ -
.
’’- .
AddAsync
’’. 6
(
’’6 7
levels
’’7 =
)
’’= >
;
’’> ?
await
÷÷ 
_unitOfWork
÷÷ 
.
÷÷ 
	SaveAsync
÷÷ '
(
÷÷' (
)
÷÷( )
;
÷÷) *
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
{
ŸŸ 
Message
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄ 6
,
⁄⁄6 7
Result
€€ 
=
€€ 
levels
€€ 
,
€€  
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  
,
‹‹  !

StatusCode
›› 
=
›› 
$num
››  
,
››  !
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 	
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
{
„„ 
Message
‰‰ 
=
‰‰ 
e
‰‰ 
.
‰‰ 
Message
‰‰ #
,
‰‰# $
Result
ÂÂ 
=
ÂÂ 
null
ÂÂ 
,
ÂÂ 
	IsSuccess
ÊÊ 
=
ÊÊ 
false
ÊÊ !
,
ÊÊ! "

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
}
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
public
ÏÏ 

async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
ResponseDTO
ÏÏ !
>
ÏÏ! "
UpdateLevel
ÏÏ# .
(
ÏÏ. /
ClaimsPrincipal
ÏÏ/ >
User
ÏÏ? C
,
ÏÏC D
UpdateLevelDTO
ÏÏE S
updateLevelDto
ÏÏT b
)
ÏÏb c
{
ÌÌ 
try
ÓÓ 
{
ÔÔ 	
var
ÒÒ 
levelID
ÒÒ 
=
ÒÒ 
await
ÒÒ 
_unitOfWork
ÒÒ  +
.
ÒÒ+ ,
LevelRepository
ÒÒ, ;
.
ÒÒ; <
GetAsync
ÒÒ< D
(
ÒÒD E
c
ÒÒE F
=>
ÒÒG I
c
ÒÒJ K
.
ÒÒK L
Id
ÒÒL N
==
ÒÒO Q
updateLevelDto
ÒÒR `
.
ÒÒ` a
LevelId
ÒÒa h
)
ÒÒh i
;
ÒÒi j
if
ÙÙ 
(
ÙÙ 
levelID
ÙÙ 
==
ÙÙ 
null
ÙÙ 
)
ÙÙ  
{
ıı 
return
ˆˆ 
new
ˆˆ 
ResponseDTO
ˆˆ &
{
˜˜ 
Message
¯¯ 
=
¯¯ 
$str
¯¯ /
,
¯¯/ 0
Result
˘˘ 
=
˘˘ 
null
˘˘ !
,
˘˘! "
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
}
¸¸ 
;
¸¸ 
}
˝˝ 
levelID
ÄÄ 
.
ÄÄ 
Name
ÄÄ 
=
ÄÄ 
updateLevelDto
ÄÄ )
.
ÄÄ) *
Name
ÄÄ* .
;
ÄÄ. /
levelID
ÅÅ 
.
ÅÅ 
UpdatedTime
ÅÅ 
=
ÅÅ  !
DateTime
ÅÅ" *
.
ÅÅ* +
Now
ÅÅ+ .
;
ÅÅ. /
levelID
ÇÇ 
.
ÇÇ 
	UpdatedBy
ÇÇ 
=
ÇÇ 
User
ÇÇ  $
.
ÇÇ$ %
Identity
ÇÇ% -
.
ÇÇ- .
Name
ÇÇ. 2
;
ÇÇ2 3
levelID
ÉÉ 
.
ÉÉ 
Status
ÉÉ 
=
ÉÉ 
$num
ÉÉ 
;
ÉÉ 
_unitOfWork
áá 
.
áá 
LevelRepository
áá '
.
áá' (
Update
áá( .
(
áá. /
levelID
áá/ 6
)
áá6 7
;
áá7 8
var
ää 
save
ää 
=
ää 
await
ää 
_unitOfWork
ää (
.
ää( )
	SaveAsync
ää) 2
(
ää2 3
)
ää3 4
;
ää4 5
if
ãã 
(
ãã 
save
ãã 
<=
ãã 
$num
ãã 
)
ãã 
{
åå 
return
çç 
new
çç 
ResponseDTO
çç &
{
éé 
Message
èè 
=
èè 
$str
èè 6
,
èè6 7
Result
êê 
=
êê 
null
êê !
,
êê! "
	IsSuccess
ëë 
=
ëë 
false
ëë  %
,
ëë% &

StatusCode
íí 
=
íí  
$num
íí! $
}
ìì 
;
ìì 
}
îî 
return
ññ 
new
ññ 
ResponseDTO
ññ "
{
óó 
Message
òò 
=
òò 
$str
òò 6
,
òò6 7
Result
ôô 
=
ôô 
levelID
ôô  
,
ôô  !
	IsSuccess
öö 
=
öö 
true
öö  
,
öö  !

StatusCode
õõ 
=
õõ 
$num
õõ  
}
úú 
;
úú 
}
ùù 	
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 	
return
†† 
new
†† 
ResponseDTO
†† "
{
°° 
Message
¢¢ 
=
¢¢ 
e
¢¢ 
.
¢¢ 
Message
¢¢ #
,
¢¢# $
Result
££ 
=
££ 
null
££ 
,
££ 
	IsSuccess
§§ 
=
§§ 
false
§§ !
,
§§! "

StatusCode
•• 
=
•• 
$num
••  
}
¶¶ 
;
¶¶ 
}
ßß 	
}
®® 
public
´´ 

async
´´ 
Task
´´ 
<
´´ 
ResponseDTO
´´ !
>
´´! "
DeleteLevel
´´# .
(
´´. /
ClaimsPrincipal
´´/ >
User
´´? C
,
´´C D
Guid
´´E I
levelId
´´J Q
)
´´Q R
{
¨¨ 
try
≠≠ 
{
ÆÆ 	
var
∞∞ 
levelID
∞∞ 
=
∞∞ 
await
∞∞ 
_unitOfWork
∞∞  +
.
∞∞+ ,
LevelRepository
∞∞, ;
.
∞∞; <
GetAsync
∞∞< D
(
∞∞D E
c
∞∞E F
=>
∞∞G I
c
∞∞J K
.
∞∞K L
Id
∞∞L N
==
∞∞O Q
levelId
∞∞R Y
)
∞∞Y Z
;
∞∞Z [
if
≤≤ 
(
≤≤ 
levelID
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤  
{
≥≥ 
return
¥¥ 
new
¥¥ 
ResponseDTO
¥¥ &
{
µµ 
Message
∂∂ 
=
∂∂ 
$str
∂∂ 9
,
∂∂9 :
Result
∑∑ 
=
∑∑ 
null
∑∑ !
,
∑∑! "
	IsSuccess
∏∏ 
=
∏∏ 
false
∏∏  %
,
∏∏% &

StatusCode
ππ 
=
ππ  
$num
ππ! $
}
∫∫ 
;
∫∫ 
}
ªª 
levelID
ΩΩ 
.
ΩΩ 
Status
ΩΩ 
=
ΩΩ 
$num
ΩΩ 
;
ΩΩ 
levelID
ææ 
.
ææ 
	UpdatedBy
ææ 
=
ææ 
User
ææ  $
.
ææ$ %
Identity
ææ% -
.
ææ- .
Name
ææ. 2
;
ææ2 3
levelID
øø 
.
øø 
UpdatedTime
øø 
=
øø  !
DateTime
øø" *
.
øø* +
Now
øø+ .
;
øø. /
_unitOfWork
¡¡ 
.
¡¡ 
LevelRepository
¡¡ '
.
¡¡' (
Update
¡¡( .
(
¡¡. /
levelID
¡¡/ 6
)
¡¡6 7
;
¡¡7 8
await
¬¬ 
_unitOfWork
¬¬ 
.
¬¬ 
	SaveAsync
¬¬ '
(
¬¬' (
)
¬¬( )
;
¬¬) *
return
ƒƒ 
new
ƒƒ 
ResponseDTO
ƒƒ "
{
≈≈ 
Message
∆∆ 
=
∆∆ 
$str
∆∆ 6
,
∆∆6 7
Result
«« 
=
«« 
levelID
««  
,
««  !
	IsSuccess
»» 
=
»» 
true
»»  
,
»»  !

StatusCode
…… 
=
…… 
$num
……  
}
   
;
   
}
ÀÀ 	
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 	
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ "
{
œœ 
Message
–– 
=
–– 
e
–– 
.
–– 
Message
–– #
,
––# $
Result
—— 
=
—— 
null
—— 
,
—— 
	IsSuccess
““ 
=
““ 
false
““ !
,
““! "

StatusCode
”” 
=
”” 
$num
””  
}
‘‘ 
;
‘‘ 
}
’’ 	
}
÷÷ 
}◊◊ €ﬁ
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\InstructorService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
InstructorService 
:  
IInstructorService! 3
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IClosedXMLService &
_closedXmlService' 8
;8 9
private 
readonly 
IWebHostEnvironment (
_env) -
;- .
private 
readonly 
IConfiguration #
_config$ +
;+ ,
private 
readonly 
IHubContext  
<  !
NotificationHub! 0
>0 1
_notificationHub2 B
;B C
public 

InstructorService 
( 
IUnitOfWork (

unitOfWork) 3
,3 4
IMapper5 <
mapper= C
,C D
IClosedXMLServiceE V
closedXmlServiceW g
,g h
IWebHostEnvironment 
env 
,  
IConfiguration! /
config0 6
,6 7
IHubContext8 C
<C D
NotificationHubD S
>S T
notificationHubU d
)d e
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
_closedXmlService 
= 
closedXmlService ,
;, -
_env 
= 
env 
; 
_config   
=   
config   
;   
_notificationHub!! 
=!! 
notificationHub!! *
;!!* +
}"" 
public%% 

async%% 
Task%% 
<%% 
ResponseDTO%% !
>%%! "
GetAll%%# )
(&& 
ClaimsPrincipal'' 
User'' 
,'' 
string(( 
?(( 
filterOn(( 
,(( 
string)) 
?)) 
filterQuery)) 
,)) 
string** 
?** 
sortBy** 
,** 
bool++ 
?++ 
isAscending++ 
,++ 
int,, 

pageNumber,, 
,,, 
int-- 
pageSize-- 
).. 
{// 
try22 
{33 	
List44 
<44 

Instructor44 
>44 
instructors44 (
=44) *
new44+ .
List44/ 3
<443 4

Instructor444 >
>44> ?
(44? @
)44@ A
;44A B
if77 
(77 
!77 
string77 
.77 
IsNullOrEmpty77 %
(77% &
filterOn77& .
)77. /
&&770 2
!773 4
string774 :
.77: ;
IsNullOrEmpty77; H
(77H I
filterQuery77I T
)77T U
)77U V
{88 
switch99 
(99 
filterOn99  
.99  !
Trim99! %
(99% &
)99& '
.99' (
ToLower99( /
(99/ 0
)990 1
)991 2
{:: 
case;; 
$str;; 
:;;  
{<< 
instructors== #
===$ %
_unitOfWork==& 1
.==1 2 
InstructorRepository==2 F
.==F G
GetAllAsync==G R
(==R S
includeProperties==S d
:==d e
$str==f w
)==w x
.>> 

GetAwaiter>> '
(>>' (
)>>( )
.>>) *
	GetResult>>* 3
(>>3 4
)>>4 5
.>>5 6
Where>>6 ;
(>>; <
x>>< =
=>>>> @
x??  !
.??! "
ApplicationUser??" 1
.??1 2
FullName??2 :
.??: ;
Contains??; C
(??C D
filterQuery??D O
,??O P
StringComparison@@$ 4
.@@4 5$
CurrentCultureIgnoreCase@@5 M
)@@M N
)@@N O
.@@O P
ToList@@P V
(@@V W
)@@W X
;@@X Y
breakAA 
;AA 
}BB 
caseCC 
$strCC  
:CC  !
{DD 
instructorsEE #
=EE$ %
_unitOfWorkEE& 1
.EE1 2 
InstructorRepositoryEE2 F
.EEF G
GetAllAsyncEEG R
(EER S
includePropertiesEES d
:EEd e
$strEEf w
)EEw x
.FF 

GetAwaiterFF '
(FF' (
)FF( )
.FF) *
	GetResultFF* 3
(FF3 4
)FF4 5
.FF5 6
WhereFF6 ;
(FF; <
xFF< =
=>FF> @
xGG  !
.GG! "
ApplicationUserGG" 1
.GG1 2
EmailGG2 7
.GG7 8
ContainsGG8 @
(GG@ A
filterQueryGGA L
,GGL M
StringComparisonHH$ 4
.HH4 5$
CurrentCultureIgnoreCaseHH5 M
)HHM N
)HHN O
.HHO P
ToListHHP V
(HHV W
)HHW X
;HHX Y
breakII 
;II 
}JJ 
defaultKK 
:KK 
{LL 
instructorsMM #
=MM$ %
_unitOfWorkMM& 1
.MM1 2 
InstructorRepositoryMM2 F
.MMF G
GetAllAsyncMMG R
(MMR S
includePropertiesMMS d
:MMd e
$strMMf w
)MMw x
.NN 

GetAwaiterNN '
(NN' (
)NN( )
.NN) *
	GetResultNN* 3
(NN3 4
)NN4 5
.NN5 6
ToListNN6 <
(NN< =
)NN= >
;NN> ?
breakOO 
;OO 
}PP 
}QQ 
}RR 
elseSS 
{TT 
instructorsUU 
=UU 
_unitOfWorkUU )
.UU) * 
InstructorRepositoryUU* >
.UU> ?
GetAllAsyncUU? J
(UUJ K
includePropertiesUUK \
:UU\ ]
$strUU^ o
)UUo p
.VV 

GetAwaiterVV 
(VV  
)VV  !
.VV! "
	GetResultVV" +
(VV+ ,
)VV, -
.VV- .
ToListVV. 4
(VV4 5
)VV5 6
;VV6 7
}WW 
ifZZ 
(ZZ 
!ZZ 
stringZZ 
.ZZ 
IsNullOrEmptyZZ %
(ZZ% &
sortByZZ& ,
)ZZ, -
)ZZ- .
{[[ 
switch\\ 
(\\ 
sortBy\\ 
.\\ 
Trim\\ #
(\\# $
)\\$ %
.\\% &
ToLower\\& -
(\\- .
)\\. /
)\\/ 0
{]] 
case^^ 
$str^^ 
:^^  
{__ 
instructors`` #
=``$ %
isAscending``& 1
==``2 4
true``5 9
?aa 
[aa 
..aa !
instructorsaa" -
.aa- .
OrderByaa. 5
(aa5 6
xaa6 7
=>aa8 :
xaa; <
.aa< =
ApplicationUseraa= L
.aaL M
FullNameaaM U
)aaU V
]aaV W
:bb 
[bb 
..bb !
instructorsbb" -
.bb- .
OrderByDescendingbb. ?
(bb? @
xbb@ A
=>bbB D
xbbE F
.bbF G
ApplicationUserbbG V
.bbV W
FullNamebbW _
)bb_ `
]bb` a
;bba b
breakcc 
;cc 
}dd 
caseee 
$stree  
:ee  !
{ff 
instructorsgg #
=gg$ %
isAscendinggg& 1
==gg2 4
truegg5 9
?hh 
[hh 
..hh !
instructorshh" -
.hh- .
OrderByhh. 5
(hh5 6
xhh6 7
=>hh8 :
xhh; <
.hh< =
ApplicationUserhh= L
.hhL M
EmailhhM R
)hhR S
]hhS T
:ii 
[ii 
..ii !
instructorsii" -
.ii- .
OrderByDescendingii. ?
(ii? @
xii@ A
=>iiB D
xiiE F
.iiF G
ApplicationUseriiG V
.iiV W
EmailiiW \
)ii\ ]
]ii] ^
;ii^ _
breakjj 
;jj 
}kk 
defaultll 
:ll 
{mm 
breaknn 
;nn 
}oo 
}pp 
}qq 
iftt 
(tt 

pageNumbertt 
>tt 
$numtt 
&&tt !
pageSizett" *
>tt+ ,
$numtt- .
)tt. /
{uu 
varvv 

skipResultvv 
=vv  
(vv! "

pageNumbervv" ,
-vv- .
$numvv/ 0
)vv0 1
*vv2 3
pageSizevv4 <
;vv< =
instructorsww 
=ww 
instructorsww )
.ww) *
Skipww* .
(ww. /

skipResultww/ 9
)ww9 :
.ww: ;
Takeww; ?
(ww? @
pageSizeww@ H
)wwH I
.wwI J
ToListwwJ P
(wwP Q
)wwQ R
;wwR S
}xx 
if|| 
(|| 
instructors|| 
.|| 
IsNullOrEmpty|| )
(||) *
)||* +
)||+ ,
{}} 
return~~ 
new~~ 
ResponseDTO~~ &
(~~& '
)~~' (
{ 
Message
ÄÄ 
=
ÄÄ 
$str
ÄÄ 8
,
ÄÄ8 9
Result
ÅÅ 
=
ÅÅ 
null
ÅÅ !
,
ÅÅ! "
	IsSuccess
ÇÇ 
=
ÇÇ 
false
ÇÇ  %
,
ÇÇ% &

StatusCode
ÉÉ 
=
ÉÉ  
$num
ÉÉ! $
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 
var
áá #
instructorInfoLiteDto
áá %
=
áá& '
_mapper
áá( /
.
áá/ 0
Map
áá0 3
<
áá3 4
List
áá4 8
<
áá8 9#
InstructorInfoLiteDTO
áá9 N
>
ááN O
>
ááO P
(
ááP Q
instructors
ááQ \
)
áá\ ]
;
áá] ^
return
ââ 
new
ââ 
ResponseDTO
ââ "
(
ââ" #
)
ââ# $
{
ää 
Message
ãã 
=
ãã 
$str
ãã 9
,
ãã9 :
Result
åå 
=
åå #
instructorInfoLiteDto
åå .
,
åå. /
	IsSuccess
çç 
=
çç 
true
çç  
,
çç  !

StatusCode
éé 
=
éé 
$num
éé  
}
èè 
;
èè 
}
êê 	
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 	
return
ìì 
new
ìì 
ResponseDTO
ìì "
(
ìì" #
)
ìì# $
{
îî 
Message
ïï 
=
ïï 
e
ïï 
.
ïï 
Message
ïï #
,
ïï# $
Result
ññ 
=
ññ 
null
ññ 
,
ññ 
	IsSuccess
óó 
=
óó 
false
óó !
,
óó! "

StatusCode
òò 
=
òò 
$num
òò  
}
ôô 
;
ôô 
}
öö 	
}
õõ 
public
ùù 

async
ùù 
Task
ùù 
<
ùù 
ResponseDTO
ùù !
>
ùù! "
GetById
ùù# *
(
ùù* +
Guid
ùù+ /
id
ùù0 2
)
ùù2 3
{
ûû 
try
üü 
{
†† 	
var
°° 

instructor
°° 
=
°° 
await
°° "
_unitOfWork
°°# .
.
°°. /"
InstructorRepository
°°/ C
.
°°C D
GetById
°°D K
(
°°K L
id
°°L N
)
°°N O
;
°°O P
if
¢¢ 
(
¢¢ 

instructor
¢¢ 
is
¢¢ 
null
¢¢ "
)
¢¢" #
{
££ 
return
§§ 
new
§§ 
ResponseDTO
§§ &
(
§§& '
)
§§' (
{
•• 
Message
¶¶ 
=
¶¶ 
$str
¶¶ 8
,
¶¶8 9
	IsSuccess
ßß 
=
ßß 
false
ßß  %
,
ßß% &

StatusCode
®® 
=
®®  
$num
®®! $
,
®®$ %
Result
©© 
=
©© 
null
©© !
}
™™ 
;
™™ 
}
´´ 
var
≠≠ 
paymentCard
≠≠ 
=
≠≠ 
await
≠≠ #
_unitOfWork
≠≠$ /
.
≠≠/ 0#
PaymentCardRepository
≠≠0 E
.
≠≠E F
GetCardByUserId
≠≠F U
(
≠≠U V

instructor
≠≠V `
.
≠≠` a
UserId
≠≠a g
)
≠≠g h
;
≠≠h i
InstructorInfoDTO
ØØ 
instructorInfoDto
ØØ /
=
ØØ0 1
new
ØØ2 5
InstructorInfoDTO
ØØ6 G
(
ØØG H
)
ØØH I
{
∞∞ 
InstructorId
±± 
=
±± 

instructor
±± )
.
±±) *
InstructorId
±±* 6
,
±±6 7
UserId
≤≤ 
=
≤≤ 

instructor
≤≤ #
.
≤≤# $
UserId
≤≤$ *
,
≤≤* +
	AvatarUrl
≥≥ 
=
≥≥ 

instructor
≥≥ &
.
≥≥& '
ApplicationUser
≥≥' 6
.
≥≥6 7
	AvatarUrl
≥≥7 @
,
≥≥@ A
FullName
¥¥ 
=
¥¥ 

instructor
¥¥ %
.
¥¥% &
ApplicationUser
¥¥& 5
.
¥¥5 6
FullName
¥¥6 >
,
¥¥> ?
Email
µµ 
=
µµ 

instructor
µµ "
.
µµ" #
ApplicationUser
µµ# 2
.
µµ2 3
Email
µµ3 8
,
µµ8 9
Address
∂∂ 
=
∂∂ 

instructor
∂∂ $
.
∂∂$ %
ApplicationUser
∂∂% 4
.
∂∂4 5
Address
∂∂5 <
,
∂∂< =
PhoneNumber
∑∑ 
=
∑∑ 

instructor
∑∑ (
.
∑∑( )
ApplicationUser
∑∑) 8
.
∑∑8 9
PhoneNumber
∑∑9 D
,
∑∑D E
Gender
∏∏ 
=
∏∏ 

instructor
∏∏ #
.
∏∏# $
ApplicationUser
∏∏$ 3
.
∏∏3 4
Gender
∏∏4 :
,
∏∏: ;
	BirthDate
ππ 
=
ππ 

instructor
ππ &
.
ππ& '
ApplicationUser
ππ' 6
.
ππ6 7
	BirthDate
ππ7 @
,
ππ@ A
Country
∫∫ 
=
∫∫ 

instructor
∫∫ $
.
∫∫$ %
ApplicationUser
∫∫% 4
.
∫∫4 5
Country
∫∫5 <
,
∫∫< =
Degree
ªª 
=
ªª 

instructor
ªª #
.
ªª# $
Degree
ªª$ *
,
ªª* +
Industry
ºº 
=
ºº 

instructor
ºº %
.
ºº% &
Industry
ºº& .
,
ºº. /
Introduction
ΩΩ 
=
ΩΩ 

instructor
ΩΩ )
.
ΩΩ) *
Introduction
ΩΩ* 6
,
ΩΩ6 7
	TaxNumber
ææ 
=
ææ 

instructor
ææ &
.
ææ& '
ApplicationUser
ææ' 6
.
ææ6 7
	TaxNumber
ææ7 @
,
ææ@ A

CardNumber
øø 
=
øø 
paymentCard
øø (
?
øø( )
.
øø) *

CardNumber
øø* 4
,
øø4 5
CardName
¿¿ 
=
¿¿ 
paymentCard
¿¿ &
?
¿¿& '
.
¿¿' (
CardName
¿¿( 0
,
¿¿0 1
CardProvider
¡¡ 
=
¡¡ 
paymentCard
¡¡ *
?
¡¡* +
.
¡¡+ ,
CardProvider
¡¡, 8
,
¡¡8 9

IsAccepted
¬¬ 
=
¬¬ 

instructor
¬¬ '
.
¬¬' (

IsAccepted
¬¬( 2
}
√√ 
;
√√ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ "
(
≈≈" #
)
≈≈# $
{
∆∆ 
Message
«« 
=
«« 
$str
«« 8
,
««8 9
	IsSuccess
»» 
=
»» 
false
»» !
,
»»! "

StatusCode
…… 
=
…… 
$num
……  
,
……  !
Result
   
=
   
instructorInfoDto
   *
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 	
return
œœ 
new
œœ 
ResponseDTO
œœ "
(
œœ" #
)
œœ# $
{
–– 
Message
—— 
=
—— 
e
—— 
.
—— 
Message
—— #
,
——# $
	IsSuccess
““ 
=
““ 
false
““ !
,
““! "

StatusCode
”” 
=
”” 
$num
””  
,
””  !
Result
‘‘ 
=
‘‘ 
null
‘‘ 
}
’’ 
;
’’ 
}
÷÷ 	
}
◊◊ 
public
ﬂﬂ 

async
ﬂﬂ 
Task
ﬂﬂ 
<
ﬂﬂ 
ResponseDTO
ﬂﬂ !
>
ﬂﬂ! "

UpdateById
ﬂﬂ# -
(
ﬂﬂ- .!
UpdateInstructorDTO
ﬂﬂ. A!
updateInstructorDto
ﬂﬂB U
)
ﬂﬂU V
{
‡‡ 
try
·· 
{
‚‚ 	
var
„„  
instructorToUpdate
„„ "
=
„„# $
await
‰‰ 
_unitOfWork
‰‰ !
.
‰‰! ""
InstructorRepository
‰‰" 6
.
‰‰6 7
GetById
‰‰7 >
(
‰‰> ?!
updateInstructorDto
‰‰? R
.
‰‰R S
InstructorId
‰‰S _
)
‰‰_ `
;
‰‰` a
if
ÊÊ 
(
ÊÊ  
instructorToUpdate
ÊÊ "
==
ÊÊ# %
null
ÊÊ& *
)
ÊÊ* +
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË &
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
$str
ÍÍ 4
,
ÍÍ4 5
Result
ÎÎ 
=
ÎÎ 
null
ÎÎ !
,
ÎÎ! "
	IsSuccess
ÏÏ 
=
ÏÏ 
false
ÏÏ  %
,
ÏÏ% &

StatusCode
ÌÌ 
=
ÌÌ  
$num
ÌÌ! $
}
ÓÓ 
;
ÓÓ 
}
ÔÔ  
instructorToUpdate
ÒÒ 
.
ÒÒ 
Degree
ÒÒ %
=
ÒÒ& '!
updateInstructorDto
ÒÒ( ;
.
ÒÒ; <
Degree
ÒÒ< B
;
ÒÒB C 
instructorToUpdate
ÚÚ 
.
ÚÚ 
Industry
ÚÚ '
=
ÚÚ( )!
updateInstructorDto
ÚÚ* =
.
ÚÚ= >
Industry
ÚÚ> F
;
ÚÚF G 
instructorToUpdate
ÛÛ 
.
ÛÛ 
Introduction
ÛÛ +
=
ÛÛ, -!
updateInstructorDto
ÛÛ. A
.
ÛÛA B
Introduction
ÛÛB N
;
ÛÛN O 
instructorToUpdate
ıı 
.
ıı 
ApplicationUser
ıı .
.
ıı. /
Address
ıı/ 6
=
ıı7 8!
updateInstructorDto
ıı9 L
?
ııL M
.
ııM N
Address
ııN U
;
ııU V 
instructorToUpdate
ˆˆ 
.
ˆˆ 
ApplicationUser
ˆˆ .
.
ˆˆ. /
	BirthDate
ˆˆ/ 8
=
ˆˆ9 :!
updateInstructorDto
ˆˆ; N
?
ˆˆN O
.
ˆˆO P
	BirthDate
ˆˆP Y
;
ˆˆY Z 
instructorToUpdate
˜˜ 
.
˜˜ 
ApplicationUser
˜˜ .
.
˜˜. /
PhoneNumber
˜˜/ :
=
˜˜; <!
updateInstructorDto
˜˜= P
?
˜˜P Q
.
˜˜Q R
PhoneNumber
˜˜R ]
;
˜˜] ^ 
instructorToUpdate
¯¯ 
.
¯¯ 
ApplicationUser
¯¯ .
.
¯¯. /
Gender
¯¯/ 5
=
¯¯6 7!
updateInstructorDto
¯¯8 K
?
¯¯K L
.
¯¯L M
Gender
¯¯M S
;
¯¯S T 
instructorToUpdate
˘˘ 
.
˘˘ 
ApplicationUser
˘˘ .
.
˘˘. /
FullName
˘˘/ 7
=
˘˘8 9!
updateInstructorDto
˘˘: M
?
˘˘M N
.
˘˘N O
FullName
˘˘O W
;
˘˘W X 
instructorToUpdate
˙˙ 
.
˙˙ 
ApplicationUser
˙˙ .
.
˙˙. /
Country
˙˙/ 6
=
˙˙7 8!
updateInstructorDto
˙˙9 L
?
˙˙L M
.
˙˙M N
Country
˙˙N U
;
˙˙U V 
instructorToUpdate
˚˚ 
.
˚˚ 
ApplicationUser
˚˚ .
.
˚˚. /
Email
˚˚/ 4
=
˚˚5 6!
updateInstructorDto
˚˚7 J
?
˚˚J K
.
˚˚K L
Email
˚˚L Q
;
˚˚Q R 
instructorToUpdate
¸¸ 
.
¸¸ 
ApplicationUser
¸¸ .
.
¸¸. /
	TaxNumber
¸¸/ 8
=
¸¸9 :!
updateInstructorDto
¸¸; N
?
¸¸N O
.
¸¸O P
	TaxNumber
¸¸P Y
;
¸¸Y Z
_unitOfWork
ˇˇ 
.
ˇˇ "
InstructorRepository
ˇˇ ,
.
ˇˇ, -
Update
ˇˇ- 3
(
ˇˇ3 4 
instructorToUpdate
ˇˇ4 F
)
ˇˇF G
;
ˇˇG H
await
ÄÄ 
_unitOfWork
ÄÄ 
.
ÄÄ 
	SaveAsync
ÄÄ '
(
ÄÄ' (
)
ÄÄ( )
;
ÄÄ) *
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ "
{
ÉÉ 
Message
ÑÑ 
=
ÑÑ 
$str
ÑÑ ;
,
ÑÑ; <
Result
ÖÖ 
=
ÖÖ 
null
ÖÖ 
,
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 	
return
åå 
new
åå 
ResponseDTO
åå "
{
çç 
Message
éé 
=
éé 
e
éé 
.
éé 
Message
éé #
,
éé# $
Result
èè 
=
èè 
null
èè 
,
èè 
	IsSuccess
êê 
=
êê 
false
êê !
,
êê! "

StatusCode
ëë 
=
ëë 
$num
ëë  
}
íí 
;
íí 
}
ìì 	
}
îî 
public
ññ 

async
ññ 
Task
ññ 
<
ññ 
ResponseDTO
ññ !
>
ññ! "
AcceptInstructor
ññ# 3
(
ññ3 4
ClaimsPrincipal
ññ4 C
User
ññD H
,
ññH I
Guid
ññJ N
instructorId
ññO [
)
ññ[ \
{
óó 
try
òò 
{
ôô 	
var
öö 
userId
öö 
=
öö 
User
öö 
.
öö 
Claims
öö $
.
öö$ %
FirstOrDefault
öö% 3
(
öö3 4
x
öö4 5
=>
öö6 8
x
öö9 :
.
öö: ;
Type
öö; ?
==
öö@ B

ClaimTypes
ööC M
.
ööM N
NameIdentifier
ööN \
)
öö\ ]
?
öö] ^
.
öö^ _
Value
öö_ d
;
ööd e
var
õõ 

instructor
õõ 
=
õõ 
await
õõ "
_unitOfWork
õõ# .
.
õõ. /"
InstructorRepository
õõ/ C
.
õõC D
GetById
õõD K
(
õõK L
instructorId
õõL X
)
õõX Y
;
õõY Z
if
úú 
(
úú 

instructor
úú 
is
úú 
null
úú "
)
úú" #
{
ùù 
return
ûû 
new
ûû 
ResponseDTO
ûû &
(
ûû& '
)
ûû' (
{
üü 
Message
†† 
=
†† 
$str
†† 8
,
††8 9
	IsSuccess
°° 
=
°° 
false
°°  %
,
°°% &

StatusCode
¢¢ 
=
¢¢  
$num
¢¢! $
,
¢¢$ %
Result
££ 
=
££ 
null
££ !
}
§§ 
;
§§ 
}
•• 

instructor
ßß 
.
ßß 

IsAccepted
ßß !
=
ßß" #
true
ßß$ (
;
ßß( )

instructor
®® 
.
®® 

AcceptedBy
®® !
=
®®" #
userId
®®$ *
;
®®* +

instructor
©© 
.
©© 
AcceptedTime
©© #
=
©©$ %
DateTime
©©& .
.
©©. /
UtcNow
©©/ 5
;
©©5 6
await
™™ 
_unitOfWork
™™ 
.
™™ 
	SaveAsync
™™ '
(
™™' (
)
™™( )
;
™™) *
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ :
,
ÆÆ: ;
Result
ØØ 
=
ØØ 
null
ØØ 
,
ØØ 
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  
,
∞∞  !

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
Message
∏∏ 
=
∏∏ 
e
∏∏ 
.
∏∏ 
Message
∏∏ #
,
∏∏# $
	IsSuccess
ππ 
=
ππ 
true
ππ  
,
ππ  !

StatusCode
∫∫ 
=
∫∫ 
$num
∫∫  
,
∫∫  !
Result
ªª 
=
ªª 
null
ªª 
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
¿¿ 

async
¿¿ 
Task
¿¿ 
<
¿¿ 
ResponseDTO
¿¿ !
>
¿¿! "
RejectInstructor
¿¿# 3
(
¿¿3 4
ClaimsPrincipal
¿¿4 C
User
¿¿D H
,
¿¿H I
Guid
¿¿J N
instructorId
¿¿O [
)
¿¿[ \
{
¡¡ 
try
¬¬ 
{
√√ 	
var
ƒƒ 
userId
ƒƒ 
=
ƒƒ 
User
ƒƒ 
.
ƒƒ 
Claims
ƒƒ $
.
ƒƒ$ %
FirstOrDefault
ƒƒ% 3
(
ƒƒ3 4
x
ƒƒ4 5
=>
ƒƒ6 8
x
ƒƒ9 :
.
ƒƒ: ;
Type
ƒƒ; ?
==
ƒƒ@ B

ClaimTypes
ƒƒC M
.
ƒƒM N
NameIdentifier
ƒƒN \
)
ƒƒ\ ]
?
ƒƒ] ^
.
ƒƒ^ _
Value
ƒƒ_ d
;
ƒƒd e
var
∆∆ 

instructor
∆∆ 
=
∆∆ 
await
∆∆ "
_unitOfWork
∆∆# .
.
∆∆. /"
InstructorRepository
∆∆/ C
.
∆∆C D
GetById
∆∆D K
(
∆∆K L
instructorId
∆∆L X
)
∆∆X Y
;
∆∆Y Z
if
«« 
(
«« 

instructor
«« 
is
«« 
null
«« "
)
««" #
{
»» 
return
…… 
new
…… 
ResponseDTO
…… &
(
……& '
)
……' (
{
   
Message
ÀÀ 
=
ÀÀ 
$str
ÀÀ 8
,
ÀÀ8 9
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ  %
,
ÃÃ% &

StatusCode
ÕÕ 
=
ÕÕ  
$num
ÕÕ! $
,
ÕÕ$ %
Result
ŒŒ 
=
ŒŒ 
null
ŒŒ !
}
œœ 
;
œœ 
}
–– 

instructor
““ 
.
““ 

IsAccepted
““ !
=
““" #
false
““$ )
;
““) *

instructor
”” 
.
”” 

RejectedBy
”” !
=
””" #
userId
””$ *
;
””* +

instructor
‘‘ 
.
‘‘ 
RejectedTime
‘‘ #
=
‘‘$ %
DateTime
‘‘& .
.
‘‘. /
UtcNow
‘‘/ 5
;
‘‘5 6
await
’’ 
_unitOfWork
’’ 
.
’’ 
	SaveAsync
’’ '
(
’’' (
)
’’( )
;
’’) *
return
◊◊ 
new
◊◊ 
ResponseDTO
◊◊ "
(
◊◊" #
)
◊◊# $
{
ÿÿ 
Message
ŸŸ 
=
ŸŸ 
$str
ŸŸ :
,
ŸŸ: ;
Result
⁄⁄ 
=
⁄⁄ 
null
⁄⁄ 
,
⁄⁄ 
	IsSuccess
€€ 
=
€€ 
true
€€  
,
€€  !

StatusCode
‹‹ 
=
‹‹ 
$num
‹‹  
}
›› 
;
›› 
}
ﬁﬁ 	
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 	
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Message
„„ 
=
„„ 
e
„„ 
.
„„ 
Message
„„ #
,
„„# $
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Result
ÊÊ 
=
ÊÊ 
null
ÊÊ 
}
ÁÁ 
;
ÁÁ 
}
ËË 	
}
ÈÈ 
public
ÎÎ 

async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
ResponseDTO
ÎÎ !
>
ÎÎ! "'
GetInstructorTotalCourses
ÎÎ# <
(
ÎÎ< =
Guid
ÎÎ= A
instructorId
ÎÎB N
)
ÎÎN O
{
ÏÏ 
try
ÌÌ 
{
ÓÓ 	
var
ÔÔ 
id
ÔÔ 
=
ÔÔ 
await
ÔÔ 
_unitOfWork
ÔÔ &
.
ÔÔ& '"
InstructorRepository
ÔÔ' ;
.
ÔÔ; <
GetAsync
ÔÔ< D
(
ÔÔD E
i
ÔÔE F
=>
ÔÔG I
i
ÔÔJ K
.
ÔÔK L
InstructorId
ÔÔL X
==
ÔÔY [
instructorId
ÔÔ\ h
)
ÔÔh i
;
ÔÔi j
if
ÒÒ 
(
ÒÒ 
id
ÒÒ 
==
ÒÒ 
null
ÒÒ 
)
ÒÒ 
{
ÚÚ 
return
ÛÛ 
new
ÛÛ 
ResponseDTO
ÛÛ &
(
ÛÛ& '
)
ÛÛ' (
{
ÙÙ 
Message
ıı 
=
ıı 
$str
ıı 4
,
ıı4 5
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ !
,
ˆˆ! "
	IsSuccess
˜˜ 
=
˜˜ 
false
˜˜  %
,
˜˜% &

StatusCode
¯¯ 
=
¯¯  
$num
¯¯! $
}
˘˘ 
;
˘˘ 
}
˙˙ 
var
¸¸ 
courses
¸¸ 
=
¸¸ 
await
¸¸ 
_unitOfWork
¸¸  +
.
¸¸+ ,
CourseRepository
¸¸, <
.
¸¸< =
GetAllAsync
¸¸= H
(
¸¸H I
c
¸¸I J
=>
¸¸K M
c
¸¸N O
.
¸¸O P
InstructorId
¸¸P \
==
¸¸] _
id
¸¸` b
.
¸¸b c
InstructorId
¸¸c o
)
¸¸o p
;
¸¸p q
var
˛˛ 
totalCourses
˛˛ 
=
˛˛ 
courses
˛˛ &
.
˛˛& '
Count
˛˛' ,
(
˛˛, -
)
˛˛- .
;
˛˛. /
var
ˇˇ 
pending
ˇˇ 
=
ˇˇ 
courses
ˇˇ !
.
ˇˇ! "
Count
ˇˇ" '
(
ˇˇ' (
x
ˇˇ( )
=>
ˇˇ* ,
x
ˇˇ- .
.
ˇˇ. /
Status
ˇˇ/ 5
==
ˇˇ6 8
$num
ˇˇ9 :
)
ˇˇ: ;
;
ˇˇ; <
var
ÄÄ 
	activated
ÄÄ 
=
ÄÄ 
courses
ÄÄ #
.
ÄÄ# $
Count
ÄÄ$ )
(
ÄÄ) *
x
ÄÄ* +
=>
ÄÄ, .
x
ÄÄ/ 0
.
ÄÄ0 1
Status
ÄÄ1 7
==
ÄÄ8 :
$num
ÄÄ; <
)
ÄÄ< =
;
ÄÄ= >
var
ÅÅ 
rejected
ÅÅ 
=
ÅÅ 
courses
ÅÅ "
.
ÅÅ" #
Count
ÅÅ# (
(
ÅÅ( )
x
ÅÅ) *
=>
ÅÅ+ -
x
ÅÅ. /
.
ÅÅ/ 0
Status
ÅÅ0 6
==
ÅÅ7 9
$num
ÅÅ: ;
)
ÅÅ; <
;
ÅÅ< =
var
ÇÇ 
deleted
ÇÇ 
=
ÇÇ 
courses
ÇÇ !
.
ÇÇ! "
Count
ÇÇ" '
(
ÇÇ' (
x
ÇÇ( )
=>
ÇÇ* ,
x
ÇÇ- .
.
ÇÇ. /
Status
ÇÇ/ 5
==
ÇÇ6 8
$num
ÇÇ9 :
)
ÇÇ: ;
;
ÇÇ; <
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ 2
,
ÜÜ2 3
	IsSuccess
áá 
=
áá 
true
áá  
,
áá  !

StatusCode
àà 
=
àà 
$num
àà  
,
àà  !
Result
ââ 
=
ââ 
new
ââ "
InstructorTotalCount
ââ 1
(
ââ1 2
)
ââ2 3
{
ää 
Total
ãã 
=
ãã 
totalCourses
ãã (
,
ãã( )
	Activated
åå 
=
åå 
	activated
åå  )
,
åå) *
Deleted
çç 
=
çç 
deleted
çç %
,
çç% &
Pending
éé 
=
éé 
pending
éé %
,
éé% &
Rejected
èè 
=
èè 
rejected
èè '
}
êê 
}
ëë 
;
ëë 
}
íí 	
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 	
return
ïï 
new
ïï 
ResponseDTO
ïï "
{
ññ 
Message
óó 
=
óó 
e
óó 
.
óó 
Message
óó #
,
óó# $
Result
òò 
=
òò 
null
òò 
,
òò 
	IsSuccess
ôô 
=
ôô 
false
ôô !
,
ôô! "

StatusCode
öö 
=
öö 
$num
öö  
}
õõ 
;
õõ 
}
úú 	
}
ùù 
public
üü 

async
üü 
Task
üü 
<
üü 
ResponseDTO
üü !
>
üü! "&
GetInstructorTotalRating
üü# ;
(
üü; <
Guid
üü< @
instructorId
üüA M
)
üüM N
{
†† 
try
°° 
{
¢¢ 	
var
§§ 
instructorRatings
§§ !
=
§§" #
await
•• 
_unitOfWork
•• !
.
••! "(
InstructorRatingRepository
••" <
.
••< =
GetAllAsync
••= H
(
••H I
x
••I J
=>
••K M
x
••N O
.
••O P
InstructorId
••P \
==
••] _
instructorId
••` l
)
••l m
;
••m n
if
ßß 
(
ßß 
instructorRatings
ßß !
==
ßß" $
null
ßß% )
||
ßß* ,
!
ßß- .
instructorRatings
ßß. ?
.
ßß? @
Any
ßß@ C
(
ßßC D
)
ßßD E
)
ßßE F
{
®® 
return
©© 
new
©© 
ResponseDTO
©© &
{
™™ 
Message
´´ 
=
´´ 
$str
´´ E
,
´´E F
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨  %
,
¨¨% &

StatusCode
≠≠ 
=
≠≠  
$num
≠≠! $
}
ÆÆ 
;
ÆÆ 
}
ØØ 
var
≤≤ 
one
≤≤ 
=
≤≤ 
instructorRatings
≤≤ '
.
≤≤' (
Count
≤≤( -
(
≤≤- .
x
≤≤. /
=>
≤≤0 2
x
≤≤3 4
.
≤≤4 5
Rate
≤≤5 9
==
≤≤: <
$num
≤≤= >
)
≤≤> ?
;
≤≤? @
var
≥≥ 
two
≥≥ 
=
≥≥ 
instructorRatings
≥≥ '
.
≥≥' (
Count
≥≥( -
(
≥≥- .
x
≥≥. /
=>
≥≥0 2
x
≥≥3 4
.
≥≥4 5
Rate
≥≥5 9
==
≥≥: <
$num
≥≥= >
)
≥≥> ?
;
≥≥? @
var
¥¥ 
three
¥¥ 
=
¥¥ 
instructorRatings
¥¥ )
.
¥¥) *
Count
¥¥* /
(
¥¥/ 0
x
¥¥0 1
=>
¥¥2 4
x
¥¥5 6
.
¥¥6 7
Rate
¥¥7 ;
==
¥¥< >
$num
¥¥? @
)
¥¥@ A
;
¥¥A B
var
µµ 
four
µµ 
=
µµ 
instructorRatings
µµ (
.
µµ( )
Count
µµ) .
(
µµ. /
x
µµ/ 0
=>
µµ1 3
x
µµ4 5
.
µµ5 6
Rate
µµ6 :
==
µµ; =
$num
µµ> ?
)
µµ? @
;
µµ@ A
var
∂∂ 
five
∂∂ 
=
∂∂ 
instructorRatings
∂∂ (
.
∂∂( )
Count
∂∂) .
(
∂∂. /
x
∂∂/ 0
=>
∂∂1 3
x
∂∂4 5
.
∂∂5 6
Rate
∂∂6 :
==
∂∂; =
$num
∂∂> ?
)
∂∂? @
;
∂∂@ A
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
{
ππ 
Message
∫∫ 
=
∫∫ 
$str
∫∫ 8
,
∫∫8 9
	IsSuccess
ªª 
=
ªª 
true
ªª  
,
ªª  !

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
Result
ΩΩ 
=
ΩΩ 
new
ΩΩ  
InstructorAvgCount
ΩΩ /
(
ΩΩ/ 0
)
ΩΩ0 1
{
ææ 
One
øø 
=
øø 
one
øø 
,
øø 
Two
¿¿ 
=
¿¿ 
two
¿¿ 
,
¿¿ 
Three
¡¡ 
=
¡¡ 
three
¡¡ !
,
¡¡! "
Four
¬¬ 
=
¬¬ 
four
¬¬ 
,
¬¬  
Five
√√ 
=
√√ 
five
√√ 
}
ƒƒ 
}
≈≈ 
;
≈≈ 
}
∆∆ 	
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 	
return
…… 
new
…… 
ResponseDTO
…… "
{
   
Message
ÀÀ 
=
ÀÀ 
e
ÀÀ 
.
ÀÀ 
Message
ÀÀ #
,
ÀÀ# $
Result
ÃÃ 
=
ÃÃ 
null
ÃÃ 
,
ÃÃ 
	IsSuccess
ÕÕ 
=
ÕÕ 
false
ÕÕ !
,
ÕÕ! "

StatusCode
ŒŒ 
=
ŒŒ 
$num
ŒŒ  
}
œœ 
;
œœ 
}
–– 	
}
—— 
public
‘‘ 

Task
‘‘ 
<
‘‘ 
ResponseDTO
‘‘ 
>
‘‘ &
GetInstructorEarnedMoney
‘‘ 5
(
‘‘5 6
Guid
‘‘6 :
instructorId
‘‘; G
)
‘‘G H
{
’’ 
throw
÷÷ 
new
÷÷ %
NotImplementedException
÷÷ )
(
÷÷) *
)
÷÷* +
;
÷÷+ ,
}
◊◊ 
public
ŸŸ 

Task
ŸŸ 
<
ŸŸ 
ResponseDTO
ŸŸ 
>
ŸŸ &
GetInstructorPayoutMoney
ŸŸ 5
(
ŸŸ5 6
Guid
ŸŸ6 :
instructorId
ŸŸ; G
)
ŸŸG H
{
⁄⁄ 
throw
€€ 
new
€€ %
NotImplementedException
€€ )
(
€€) *
)
€€* +
;
€€+ ,
}
‹‹ 
public
‡‡ 

async
‡‡ 
Task
‡‡ 
<
‡‡ 
ResponseDTO
‡‡ !
>
‡‡! "%
GetAllInstructorComment
‡‡# :
(
·· 
Guid
‚‚ 
instructorId
‚‚ 
,
‚‚ 
int
„„ 

pageNumber
„„ 
,
„„ 
int
‰‰ 
pageSize
‰‰ 
)
ÂÂ 
{
ÊÊ 
try
ÁÁ 
{
ËË 	
var
ÈÈ 
comments
ÈÈ 
=
ÈÈ 
_unitOfWork
ÈÈ &
.
ÈÈ& ')
InstructorCommentRepository
ÈÈ' B
.
ÈÈB C
GetAllAsync
ÈÈC N
(
ÈÈN O
x
ÍÍ 
=>
ÍÍ 
x
ÍÍ 
.
ÍÍ 
InstructorId
ÍÍ #
==
ÍÍ$ &
instructorId
ÍÍ' 3
&&
ÍÍ4 6
x
ÎÎ 
.
ÎÎ 
Status
ÎÎ 
!=
ÎÎ  
$num
ÎÎ! "
)
ÏÏ 
.
ÏÏ 

GetAwaiter
ÏÏ 
(
ÏÏ 
)
ÏÏ 
.
ÏÏ 
	GetResult
ÏÏ $
(
ÏÏ$ %
)
ÏÏ% &
.
ÏÏ& '
ToList
ÏÏ' -
(
ÏÏ- .
)
ÏÏ. /
;
ÏÏ/ 0
if
ÌÌ 
(
ÌÌ 
comments
ÌÌ 
is
ÌÌ 
null
ÌÌ  
)
ÌÌ  !
{
ÓÓ 
return
ÔÔ 
new
ÔÔ 
ResponseDTO
ÔÔ &
(
ÔÔ& '
)
ÔÔ' (
{
 
Message
ÒÒ 
=
ÒÒ 
$str
ÒÒ 4
,
ÒÒ4 5
	IsSuccess
ÚÚ 
=
ÚÚ 
true
ÚÚ  $
,
ÚÚ$ %

StatusCode
ÛÛ 
=
ÛÛ  
$num
ÛÛ! $
,
ÛÛ$ %
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ !
}
ıı 
;
ıı 
}
ˆˆ 
comments
¯¯ 
=
¯¯ 
comments
¯¯ 
.
¯¯  
OrderByDescending
¯¯  1
(
¯¯1 2
x
¯¯2 3
=>
¯¯4 6
x
¯¯7 8
.
¯¯8 9
CreatedTime
¯¯9 D
)
¯¯D E
.
¯¯E F
ToList
¯¯F L
(
¯¯L M
)
¯¯M N
;
¯¯N O
if
˚˚ 
(
˚˚ 

pageNumber
˚˚ 
>
˚˚ 
$num
˚˚ 
&&
˚˚ !
pageSize
˚˚" *
>
˚˚+ ,
$num
˚˚- .
)
˚˚. /
{
¸¸ 
var
˝˝ 

skipResult
˝˝ 
=
˝˝  
(
˝˝! "

pageNumber
˝˝" ,
-
˝˝- .
$num
˝˝/ 0
)
˝˝0 1
*
˝˝2 3
pageSize
˝˝4 <
;
˝˝< =
comments
˛˛ 
=
˛˛ 
comments
˛˛ #
.
˛˛# $
Skip
˛˛$ (
(
˛˛( )

skipResult
˛˛) 3
)
˛˛3 4
.
˛˛4 5
Take
˛˛5 9
(
˛˛9 :
pageSize
˛˛: B
)
˛˛B C
.
˛˛C D
ToList
˛˛D J
(
˛˛J K
)
˛˛K L
;
˛˛L M
}
ˇˇ 
var
ÅÅ 
commentsDto
ÅÅ 
=
ÅÅ 
_mapper
ÅÅ %
.
ÅÅ% &
Map
ÅÅ& )
<
ÅÅ) *
List
ÅÅ* .
<
ÅÅ. /
GetAllCommentsDTO
ÅÅ/ @
>
ÅÅ@ A
>
ÅÅA B
(
ÅÅB C
comments
ÅÅC K
)
ÅÅK L
;
ÅÅL M
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
(
ÉÉ" #
)
ÉÉ# $
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
$str
ÖÖ ?
,
ÖÖ? @
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
,
áá  !
Result
àà 
=
àà 
commentsDto
àà $
}
ââ 
;
ââ 
}
ää 	
catch
ãã 
(
ãã 
	Exception
ãã 
e
ãã 
)
ãã 
{
åå 	
return
çç 
new
çç 
ResponseDTO
çç "
(
çç" #
)
çç# $
{
éé 
Message
èè 
=
èè 
e
èè 
.
èè 
Message
èè #
,
èè# $
Result
êê 
=
êê 
null
êê 
,
êê 
	IsSuccess
ëë 
=
ëë 
false
ëë !
,
ëë! "

StatusCode
íí 
=
íí 
$num
íí  
}
ìì 
;
ìì 
}
îî 	
}
ïï 
public
óó 

async
óó 
Task
óó 
<
óó 
ResponseDTO
óó !
>
óó! "%
CreateInstructorComment
óó# :
(
óó: ;
ClaimsPrincipal
óó; J
User
óóK O
,
óóO P(
CreateInstructorCommentDTO
òò "%
createInstructorComment
òò# :
)
òò: ;
{
ôô 
try
öö 
{
õõ 	
var
ùù 
instructorId
ùù 
=
ùù 
await
ûû 
_unitOfWork
ûû !
.
ûû! ""
InstructorRepository
ûû" 6
.
ûû6 7
GetAsync
ûû7 ?
(
ûû? @
i
ûû@ A
=>
ûûB D
i
üü 
.
üü 
InstructorId
üü "
==
üü# %%
createInstructorComment
üü& =
.
üü= >
instructorId
üü> J
)
üüJ K
;
üüK L
if
†† 
(
†† 
instructorId
†† 
==
†† 
null
††  $
)
††$ %
{
°° 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ &
(
¢¢& '
)
¢¢' (
{
££ 
Message
§§ 
=
§§ 
$str
§§ 4
,
§§4 5
Result
•• 
=
•• 
null
•• !
,
••! "
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
}
®® 
;
®® 
}
©© 
var
´´ 
userId
´´ 
=
´´ 
User
´´ 
.
´´ 
Claims
´´ $
.
´´$ %
FirstOrDefault
´´% 3
(
´´3 4
x
´´4 5
=>
´´6 8
x
´´9 :
.
´´: ;
Type
´´; ?
==
´´@ B

ClaimTypes
´´C M
.
´´M N
NameIdentifier
´´N \
)
´´\ ]
?
´´] ^
.
´´^ _
Value
´´_ d
;
´´d e
var
¨¨ 
admin
¨¨ 
=
¨¨ 
await
¨¨ 
_unitOfWork
¨¨ )
.
¨¨) *#
UserManagerRepository
¨¨* ?
.
¨¨? @
FindByIdAsync
¨¨@ M
(
¨¨M N
userId
¨¨N T
)
¨¨T U
;
¨¨U V
InstructorComment
ØØ 
comment
ØØ %
=
ØØ& '
new
ØØ( +
InstructorComment
ØØ, =
(
ØØ= >
)
ØØ> ?
{
∞∞ 
Comment
±± 
=
±± %
createInstructorComment
±± 1
.
±±1 2
Comment
±±2 9
,
±±9 :
InstructorId
≤≤ 
=
≤≤ %
createInstructorComment
≤≤ 6
.
≤≤6 7
instructorId
≤≤7 C
,
≤≤C D
UpdatedTime
≥≥ 
=
≥≥ 
DateTime
≥≥ &
.
≥≥& '
Now
≥≥' *
,
≥≥* +
CreatedTime
¥¥ 
=
¥¥ 
DateTime
¥¥ &
.
¥¥& '
Now
¥¥' *
,
¥¥* +
	CreatedBy
µµ 
=
µµ 
admin
µµ !
.
µµ! "
Email
µµ" '
,
µµ' (
	UpdatedBy
∂∂ 
=
∂∂ 
$str
∂∂ 
,
∂∂ 
Status
∑∑ 
=
∑∑ 
$num
∑∑ 
}
∏∏ 
;
∏∏ 
await
ªª 
_unitOfWork
ªª 
.
ªª )
InstructorCommentRepository
ªª 9
.
ªª9 :
AddAsync
ªª: B
(
ªªB C
comment
ªªC J
)
ªªJ K
;
ªªK L
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ "
(
ΩΩ" #
)
ΩΩ# $
{
ææ 
Message
øø 
=
øø 
$str
øø 8
,
øø8 9
Result
¿¿ 
=
¿¿ 
comment
¿¿  
,
¿¿  !
	IsSuccess
¡¡ 
=
¡¡ 
true
¡¡  
,
¡¡  !

StatusCode
¬¬ 
=
¬¬ 
$num
¬¬  
,
¬¬  !
}
√√ 
;
√√ 
}
ƒƒ 	
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
e
≈≈ 
)
≈≈ 
{
∆∆ 	
return
«« 
new
«« 
ResponseDTO
«« "
{
»» 
Message
…… 
=
…… 
e
…… 
.
…… 
Message
…… #
,
……# $
Result
   
=
   
null
   
,
   
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ !
,
ÀÀ! "

StatusCode
ÃÃ 
=
ÃÃ 
$num
ÃÃ  
}
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
œœ 
public
—— 

async
—— 
Task
—— 
<
—— 
ResponseDTO
—— !
>
——! "%
UpdateInstructorComment
——# :
(
——: ;
ClaimsPrincipal
——; J
User
——K O
,
——O P(
UpdateInstructorCommentDTO
““ "(
updateInstructorCommentDTO
““# =
)
““= >
{
”” 
try
‘‘ 
{
’’ 	
var
÷÷ 
instructorId
÷÷ 
=
÷÷ 
await
◊◊ 
_unitOfWork
◊◊ !
.
◊◊! ")
InstructorCommentRepository
◊◊" =
.
◊◊= >
GetAsync
◊◊> F
(
◊◊F G
i
◊◊G H
=>
◊◊I K
i
◊◊L M
.
◊◊M N
Id
◊◊N P
==
◊◊Q S(
updateInstructorCommentDTO
◊◊T n
.
◊◊n o
Id
◊◊o q
)
◊◊q r
;
◊◊r s
if
ÿÿ 
(
ÿÿ 
instructorId
ÿÿ 
==
ÿÿ 
null
ÿÿ  $
)
ÿÿ$ %
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
(
⁄⁄& '
)
⁄⁄' (
{
€€ 
Message
‹‹ 
=
‹‹ 
$str
‹‹ 4
,
‹‹4 5
Result
›› 
=
›› 
null
›› !
,
››! "
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
false
ﬁﬁ  %
,
ﬁﬁ% &

StatusCode
ﬂﬂ 
=
ﬂﬂ  
$num
ﬂﬂ! $
}
‡‡ 
;
‡‡ 
}
·· 
var
„„ 
userId
„„ 
=
„„ 
User
„„ 
.
„„ 
Claims
„„ $
.
„„$ %
FirstOrDefault
„„% 3
(
„„3 4
x
„„4 5
=>
„„6 8
x
„„9 :
.
„„: ;
Type
„„; ?
==
„„@ B

ClaimTypes
„„C M
.
„„M N
NameIdentifier
„„N \
)
„„\ ]
?
„„] ^
.
„„^ _
Value
„„_ d
;
„„d e
var
‰‰ 
admin
‰‰ 
=
‰‰ 
await
‰‰ 
_unitOfWork
‰‰ )
.
‰‰) *#
UserManagerRepository
‰‰* ?
.
‰‰? @
FindByIdAsync
‰‰@ M
(
‰‰M N
userId
‰‰N T
)
‰‰T U
;
‰‰U V
instructorId
ÁÁ 
.
ÁÁ 
UpdatedTime
ÁÁ $
=
ÁÁ% &
DateTime
ÁÁ' /
.
ÁÁ/ 0
Now
ÁÁ0 3
;
ÁÁ3 4
instructorId
ËË 
.
ËË 
	UpdatedBy
ËË "
=
ËË# $
admin
ËË% *
.
ËË* +
Email
ËË+ 0
;
ËË0 1
instructorId
ÈÈ 
.
ÈÈ 
Comment
ÈÈ  
=
ÈÈ! "(
updateInstructorCommentDTO
ÈÈ# =
.
ÈÈ= >
comment
ÈÈ> E
;
ÈÈE F
instructorId
ÍÍ 
.
ÍÍ 
Status
ÍÍ 
=
ÍÍ  !
$num
ÍÍ" #
;
ÍÍ# $
_unitOfWork
ÏÏ 
.
ÏÏ )
InstructorCommentRepository
ÏÏ 3
.
ÏÏ3 4
Update
ÏÏ4 :
(
ÏÏ: ;
instructorId
ÏÏ; G
)
ÏÏG H
;
ÏÏH I
await
ÔÔ 
_unitOfWork
ÔÔ 
.
ÔÔ 
	SaveAsync
ÔÔ '
(
ÔÔ' (
)
ÔÔ( )
;
ÔÔ) *
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ "
(
ÒÒ" #
)
ÒÒ# $
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ 
$str
ÛÛ 8
,
ÛÛ8 9
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ 
,
ÙÙ 
	IsSuccess
ıı 
=
ıı 
true
ıı  
,
ıı  !

StatusCode
ˆˆ 
=
ˆˆ 
$num
ˆˆ  
,
ˆˆ  !
}
˜˜ 
;
˜˜ 
}
¯¯ 	
catch
˘˘ 
(
˘˘ 
	Exception
˘˘ 
e
˘˘ 
)
˘˘ 
{
˙˙ 	
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ "
{
¸¸ 
Message
˝˝ 
=
˝˝ 
e
˝˝ 
.
˝˝ 
Message
˝˝ #
,
˝˝# $
Result
˛˛ 
=
˛˛ 
null
˛˛ 
,
˛˛ 
	IsSuccess
ˇˇ 
=
ˇˇ 
false
ˇˇ !
,
ˇˇ! "

StatusCode
ÄÄ 
=
ÄÄ 
$num
ÄÄ  
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
public
ÖÖ 

async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
ResponseDTO
ÖÖ !
>
ÖÖ! "%
DeleteInstructorComment
ÖÖ# :
(
ÖÖ: ;
Guid
ÖÖ; ?
	commentId
ÖÖ@ I
)
ÖÖI J
{
ÜÜ 
try
áá 
{
àà 	
var
ââ 
comment
ââ 
=
ââ 
await
ää 
_unitOfWork
ää !
.
ää! ")
InstructorCommentRepository
ää" =
.
ää= >
GetAsync
ää> F
(
ääF G
x
ääG H
=>
ääI K
x
ääL M
.
ääM N
Id
ääN P
==
ääQ S
	commentId
ääT ]
)
ää] ^
;
ää^ _
if
ãã 
(
ãã 
comment
ãã 
==
ãã 
null
ãã 
)
ãã  
{
åå 
return
çç 
new
çç 
ResponseDTO
çç &
(
çç& '
)
çç' (
{
éé 
Message
èè 
=
èè 
$str
èè 5
,
èè5 6
	IsSuccess
êê 
=
êê 
false
êê  %
,
êê% &

StatusCode
ëë 
=
ëë  
$num
ëë! $
,
ëë$ %
Result
íí 
=
íí 
null
íí !
,
íí! "
}
ìì 
;
ìì 
}
îî 
comment
óó 
.
óó 
Status
óó 
=
óó 
$num
óó 
;
óó 
_unitOfWork
ôô 
.
ôô )
InstructorCommentRepository
ôô 3
.
ôô3 4
Update
ôô4 :
(
ôô: ;
comment
ôô; B
)
ôôB C
;
ôôC D
await
öö 
_unitOfWork
öö 
.
öö 
	SaveAsync
öö '
(
öö' (
)
öö( )
;
öö) *
return
úú 
new
úú 
ResponseDTO
úú "
(
úú" #
)
úú# $
{
ùù 
Message
ûû 
=
ûû 
$str
ûû 8
,
ûû8 9
	IsSuccess
üü 
=
üü 
true
üü  
,
üü  !

StatusCode
†† 
=
†† 
$num
††  
,
††  !
Result
°° 
=
°° 
comment
°°  
.
°°  !
Id
°°! #
,
°°# $
}
¢¢ 
;
¢¢ 
}
££ 	
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 	
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ "
{
ßß 
Message
®® 
=
®® 
e
®® 
.
®® 
Message
®® #
,
®®# $
Result
©© 
=
©© 
null
©© 
,
©© 
	IsSuccess
™™ 
=
™™ 
false
™™ !
,
™™! "

StatusCode
´´ 
=
´´ 
$num
´´  
}
¨¨ 
;
¨¨ 
}
≠≠ 	
}
ÆÆ 
public
∞∞ 

async
∞∞ 
Task
∞∞ 
<
∞∞ 
ResponseDTO
∞∞ !
>
∞∞! "
ExportInstructors
∞∞# 4
(
∞∞4 5
string
∞∞5 ;
userId
∞∞< B
,
∞∞B C
int
∞∞D G
month
∞∞H M
,
∞∞M N
int
∞∞O R
year
∞∞S W
)
∞∞W X
{
±± 
var
≤≤ 
instructors
≤≤ 
=
≤≤ 
_unitOfWork
≤≤ %
.
≤≤% &"
InstructorRepository
≤≤& :
.
≤≤: ;
GetAllAsync
≤≤; F
(
≤≤F G
includeProperties
≤≤G X
:
≤≤X Y
$str
≤≤Z k
)
≤≤k l
.
≥≥ 

GetAwaiter
≥≥ 
(
≥≥ 
)
≥≥ 
.
≥≥ 
	GetResult
≥≥ #
(
≥≥# $
)
≥≥$ %
.
≥≥% &
ToList
≥≥& ,
(
≥≥, -
)
≥≥- .
;
≥≥. /
instructors
µµ 
=
µµ 
instructors
µµ !
.
µµ! "
Where
µµ" '
(
µµ' (
x
µµ( )
=>
µµ* ,
x
∂∂ 
.
∂∂ 
ApplicationUser
∂∂ !
.
∂∂! "

CreateTime
∂∂" ,
.
∂∂, -
Value
∂∂- 2
.
∂∂2 3
Month
∂∂3 8
==
∂∂9 ;
month
∂∂< A
&&
∂∂B D
x
∂∂E F
.
∂∂F G
ApplicationUser
∂∂G V
.
∂∂V W

CreateTime
∂∂W a
.
∂∂a b
Value
∂∂b g
.
∂∂g h
Year
∂∂h l
==
∂∂m o
year
∂∂p t
)
∂∂t u
.
∑∑ 
ToList
∑∑ 
(
∑∑ 
)
∑∑ 
;
∑∑ 
var
ππ  
instructorInfoDtos
ππ 
=
ππ  
_mapper
ππ! (
.
ππ( )
Map
ππ) ,
<
ππ, -
List
ππ- 1
<
ππ1 2
InstructorInfoDTO
ππ2 C
>
ππC D
>
ππD E
(
ππE F
instructors
ππF Q
)
ππQ R
;
ππR S
var
∫∫ 
fileName
∫∫ 
=
∫∫ 
await
∫∫ 
_closedXmlService
∫∫ .
.
∫∫. /#
ExportInstructorExcel
∫∫/ D
(
∫∫D E 
instructorInfoDtos
∫∫E W
)
∫∫W X
;
∫∫X Y
await
ΩΩ 
_notificationHub
ΩΩ 
.
ΩΩ 
Clients
ΩΩ &
.
ΩΩ& '
User
ΩΩ' +
(
ΩΩ+ ,
userId
ΩΩ, 2
)
ΩΩ2 3
.
ΩΩ3 4
	SendAsync
ΩΩ4 =
(
ΩΩ= >
$str
ΩΩ> P
,
ΩΩP Q
fileName
ΩΩR Z
)
ΩΩZ [
;
ΩΩ[ \
return
øø 
new
øø 
ResponseDTO
øø 
(
øø 
)
øø  
{
¿¿ 	
Message
¡¡ 
=
¡¡ 
$str
¡¡ "
,
¡¡" #
	IsSuccess
¬¬ 
=
¬¬ 
true
¬¬ 
,
¬¬ 

StatusCode
√√ 
=
√√ 
$num
√√ 
,
√√ 
Result
ƒƒ 
=
ƒƒ 
null
ƒƒ 
}
≈≈ 	
;
≈≈	 

}
∆∆ 
public
»» 

async
»» 
Task
»» 
<
»» "
ClosedXMLResponseDTO
»» *
>
»»* +!
DownloadInstructors
»», ?
(
»»? @
string
»»@ F
fileName
»»G O
)
»»O P
{
…… 
try
   
{
ÀÀ 	
string
ÃÃ 
filePath
ÃÃ 
=
ÃÃ 
Path
ÃÃ "
.
ÃÃ" #
Combine
ÃÃ# *
(
ÃÃ* +
_env
ÃÃ+ /
.
ÃÃ/ 0
ContentRootPath
ÃÃ0 ?
,
ÃÃ? @
_config
ÃÃA H
[
ÃÃH I
$str
ÃÃI p
]
ÃÃp q
,
ÃÃq r
fileName
ÃÃs {
)
ÃÃ{ |
;
ÃÃ| }
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
File
ŒŒ 
.
ŒŒ 
Exists
ŒŒ 
(
ŒŒ 
filePath
ŒŒ %
)
ŒŒ% &
)
ŒŒ& '
{
œœ 
return
–– 
new
–– "
ClosedXMLResponseDTO
–– /
(
––/ 0
)
––0 1
{
—— 
Message
““ 
=
““ 
$str
““ 2
,
““2 3
	IsSuccess
”” 
=
”” 
false
””  %
,
””% &

StatusCode
‘‘ 
=
‘‘  
$num
‘‘! $
,
‘‘$ %
Stream
’’ 
=
’’ 
null
’’ !
,
’’! "
ContentType
÷÷ 
=
÷÷  !
null
÷÷" &
,
÷÷& '
FileName
◊◊ 
=
◊◊ 
null
◊◊ #
,
◊◊# $
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
var
‹‹ 
memory
‹‹ 
=
‹‹ 
new
‹‹ 
MemoryStream
‹‹ )
(
‹‹) *
)
‹‹* +
;
‹‹+ ,
using
›› 
(
›› 
var
›› 
stream
›› 
=
›› 
new
››  #

FileStream
››$ .
(
››. /
filePath
››/ 7
,
››7 8
FileMode
››9 A
.
››A B
Open
››B F
)
››F G
)
››G H
{
ﬁﬁ 
stream
ﬂﬂ 
.
ﬂﬂ 
CopyTo
ﬂﬂ 
(
ﬂﬂ 
memory
ﬂﬂ $
)
ﬂﬂ$ %
;
ﬂﬂ% &
}
‡‡ 
memory
‚‚ 
.
‚‚ 
Position
‚‚ 
=
‚‚ 
$num
‚‚ 
;
‚‚  
var
„„ 
contentType
„„ 
=
„„ 
$str
„„ a
;
„„a b
System
ÊÊ 
.
ÊÊ 
IO
ÊÊ 
.
ÊÊ 
File
ÊÊ 
.
ÊÊ 
Delete
ÊÊ !
(
ÊÊ! "
filePath
ÊÊ" *
)
ÊÊ* +
;
ÊÊ+ ,
return
ËË 
new
ËË "
ClosedXMLResponseDTO
ËË +
(
ËË+ ,
)
ËË, -
{
ÈÈ 
Stream
ÍÍ 
=
ÍÍ 
memory
ÍÍ 
,
ÍÍ  
ContentType
ÎÎ 
=
ÎÎ 
contentType
ÎÎ )
,
ÎÎ) *
FileName
ÏÏ 
=
ÏÏ 
fileName
ÏÏ #
,
ÏÏ# $

StatusCode
ÌÌ 
=
ÌÌ 
$num
ÌÌ  
,
ÌÌ  !
	IsSuccess
ÓÓ 
=
ÓÓ 
true
ÓÓ  
,
ÓÓ  !
Message
ÔÔ 
=
ÔÔ 
$str
ÔÔ 6
}
 
;
 
}
ÒÒ 	
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 	
Console
ÙÙ 
.
ÙÙ 
	WriteLine
ÙÙ 
(
ÙÙ 
e
ÙÙ 
)
ÙÙ  
;
ÙÙ  !
throw
ıı 
;
ıı 
}
ˆˆ 	
}
˜˜ 
}¯¯ ‹k
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\FirebaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
FirebaseService 
: 
IFirebaseService /
{		 
private

 
readonly

 
StorageClient

 "
_storageClient

# 1
;

1 2
private 
readonly 
string 
_bucketName '
=( )
$str* J
;J K
public 

FirebaseService 
( 
StorageClient (
storageClient) 6
)6 7
{ 
_storageClient 
= 
storageClient &
;& '
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
UploadImage# .
(. /
	IFormFile/ 8
file9 =
,= >
string? E
folderF L
)L M
{ 
if 

( 
file 
is 
null 
|| 
file  
.  !
Length! '
==( *
$num+ ,
), -
{ 	
return 
new 
ResponseDTO "
(" #
)# $
{ 
	IsSuccess 
= 
false !
,! "

StatusCode 
= 
$num  
,  !
Message   
=   
$str   *
}!! 
;!! 
}"" 	
var$$ 
fileName$$ 
=$$ 
$"$$ 
{$$ 
Guid$$ 
.$$ 
NewGuid$$ &
($$& '
)$$' (
}$$( )
$str$$) *
{$$* +
file$$+ /
.$$/ 0
FileName$$0 8
}$$8 9
"$$9 :
;$$: ;
var&& 
filePath&& 
=&& 
$"&& 
{&& 
folder&&  
}&&  !
$str&&! "
{&&" #
fileName&&# +
}&&+ ,
"&&, -
;&&- .
string(( 
url(( 
;(( 
await** 
using** 
(** 
var** 
stream** 
=**  !
file**" &
.**& '
OpenReadStream**' 5
(**5 6
)**6 7
)**7 8
{++ 	
var,, 
result,, 
=,, 
await,, 
_storageClient,, -
.,,- .
UploadObjectAsync,,. ?
(,,? @
_bucketName,,@ K
,,,K L
filePath,,M U
,,,U V
null,,W [
,,,[ \
stream,,] c
),,c d
;,,d e
}-- 	
return// 
new// 
ResponseDTO// 
(// 
)//  
{00 	
	IsSuccess11 
=11 
true11 
,11 

StatusCode22 
=22 
$num22 
,22 
Result33 
=33 
filePath33 
,33 
Message44 
=44 
$str44 2
}55 	
;55	 

}66 
public>> 

async>> 
Task>> 
<>> 
ResponseDTO>> !
>>>! "
UploadVideo>># .
(>>. /
	IFormFile>>/ 8
file>>9 =
,>>= >
Guid>>? C
?>>C D
courseId>>E M
)>>M N
{?? 
if@@ 

(@@ 
file@@ 
is@@ 
null@@ 
||@@ 
file@@  
.@@  !
Length@@! '
==@@( *
$num@@+ ,
)@@, -
{AA 	
returnBB 
newBB 
ResponseDTOBB "
(BB" #
)BB# $
{CC 
	IsSuccessDD 
=DD 
falseDD !
,DD! "

StatusCodeEE 
=EE 
$numEE  
,EE  !
MessageFF 
=FF 
$strFF *
}GG 
;GG 
}HH 	
varJJ 
fileNameJJ 
=JJ 
$"JJ 
{JJ 
GuidJJ 
.JJ 
NewGuidJJ &
(JJ& '
)JJ' (
}JJ( )
$strJJ) *
{JJ* +
fileJJ+ /
.JJ/ 0
FileNameJJ0 8
}JJ8 9
"JJ9 :
;JJ: ;
varLL 
filePathLL 
=LL 
$"LL 
{LL 
$strLL "
}LL" #
$strLL# $
{LL$ %
courseIdLL% -
}LL- .
$strLL. /
{LL/ 0
$strLL0 8
}LL8 9
$strLL9 :
{LL: ;
fileNameLL; C
}LLC D
"LLD E
;LLE F
stringNN 
urlNN 
;NN 
awaitPP 
usingPP 
(PP 
varPP 
streamPP 
=PP  !
filePP" &
.PP& '
OpenReadStreamPP' 5
(PP5 6
)PP6 7
)PP7 8
{QQ 	
varRR 
resultRR 
=RR 
awaitRR 
_storageClientRR -
.RR- .
UploadObjectAsyncRR. ?
(RR? @
_bucketNameRR@ K
,RRK L
filePathRRM U
,RRU V
nullRRW [
,RR[ \
streamRR] c
)RRc d
;RRd e
}SS 	
returnUU 
newUU 
ResponseDTOUU 
(UU 
)UU  
{VV 	
	IsSuccessWW 
=WW 
trueWW 
,WW 

StatusCodeXX 
=XX 
$numXX 
,XX 
ResultYY 
=YY 
filePathYY 
,YY 
MessageZZ 
=ZZ 
$strZZ 2
}[[ 	
;[[	 

}\\ 
publicdd 

asyncdd 
Taskdd 
<dd 
ResponseDTOdd !
>dd! "
UploadSlidedd# .
(dd. /
	IFormFiledd/ 8
filedd9 =
,dd= >
Guiddd? C
?ddC D
courseIdddE M
)ddM N
{ee 
ifff 

(ff 
fileff 
isff 
nullff 
||ff 
fileff  
.ff  !
Lengthff! '
==ff( *
$numff+ ,
)ff, -
{gg 	
returnhh 
newhh 
ResponseDTOhh "
(hh" #
)hh# $
{ii 
	IsSuccessjj 
=jj 
falsejj !
,jj! "

StatusCodekk 
=kk 
$numkk  
,kk  !
Messagell 
=ll 
$strll *
}mm 
;mm 
}nn 	
varpp 
fileNamepp 
=pp 
$"pp 
{pp 
Guidpp 
.pp 
NewGuidpp &
(pp& '
)pp' (
}pp( )
$strpp) *
{pp* +
filepp+ /
.pp/ 0
FileNamepp0 8
}pp8 9
"pp9 :
;pp: ;
varrr 
filePathrr 
=rr 
$"rr 
{rr 
$strrr "
}rr" #
$strrr# $
{rr$ %
courseIdrr% -
}rr- .
$strrr. /
{rr/ 0
$strrr0 8
}rr8 9
$strrr9 :
{rr: ;
fileNamerr; C
}rrC D
"rrD E
;rrE F
stringtt 
urltt 
;tt 
awaitvv 
usingvv 
(vv 
varvv 
streamvv 
=vv  !
filevv" &
.vv& '
OpenReadStreamvv' 5
(vv5 6
)vv6 7
)vv7 8
{ww 	
varxx 
resultxx 
=xx 
awaitxx 
_storageClientxx -
.xx- .
UploadObjectAsyncxx. ?
(xx? @
_bucketNamexx@ K
,xxK L
filePathxxM U
,xxU V
nullxxW [
,xx[ \
streamxx] c
)xxc d
;xxd e
}yy 	
return{{ 
new{{ 
ResponseDTO{{ 
({{ 
){{  
{|| 	
	IsSuccess}} 
=}} 
true}} 
,}} 

StatusCode~~ 
=~~ 
$num~~ 
,~~ 
Result 
= 
filePath 
, 
Message
ÄÄ 
=
ÄÄ 
$str
ÄÄ 2
}
ÅÅ 	
;
ÅÅ	 

}
ÇÇ 
public
ää 

async
ää 
Task
ää 
<
ää 
ResponseDTO
ää !
>
ää! "
	UploadDoc
ää# ,
(
ää, -
	IFormFile
ää- 6
file
ää7 ;
,
ää; <
Guid
ää= A
?
ääA B
courseId
ääC K
)
ääK L
{
ãã 
if
åå 

(
åå 
file
åå 
is
åå 
null
åå 
||
åå 
file
åå  
.
åå  !
Length
åå! '
==
åå( *
$num
åå+ ,
)
åå, -
{
çç 	
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
	IsSuccess
êê 
=
êê 
false
êê !
,
êê! "

StatusCode
ëë 
=
ëë 
$num
ëë  
,
ëë  !
Message
íí 
=
íí 
$str
íí *
}
ìì 
;
ìì 
}
îî 	
var
ññ 
fileName
ññ 
=
ññ 
$"
ññ 
{
ññ 
Guid
ññ 
.
ññ 
NewGuid
ññ &
(
ññ& '
)
ññ' (
}
ññ( )
$str
ññ) *
{
ññ* +
file
ññ+ /
.
ññ/ 0
FileName
ññ0 8
}
ññ8 9
"
ññ9 :
;
ññ: ;
var
òò 
filePath
òò 
=
òò 
$"
òò 
{
òò 
$str
òò "
}
òò" #
$str
òò# $
{
òò$ %
courseId
òò% -
}
òò- .
$str
òò. /
{
òò/ 0
$str
òò0 6
}
òò6 7
$str
òò7 8
{
òò8 9
fileName
òò9 A
}
òòA B
"
òòB C
;
òòC D
string
öö 
url
öö 
;
öö 
await
úú 
using
úú 
(
úú 
var
úú 
stream
úú 
=
úú  !
file
úú" &
.
úú& '
OpenReadStream
úú' 5
(
úú5 6
)
úú6 7
)
úú7 8
{
ùù 	
var
ûû 
result
ûû 
=
ûû 
await
ûû 
_storageClient
ûû -
.
ûû- .
UploadObjectAsync
ûû. ?
(
ûû? @
_bucketName
ûû@ K
,
ûûK L
filePath
ûûM U
,
ûûU V
null
ûûW [
,
ûû[ \
stream
ûû] c
)
ûûc d
;
ûûd e
}
üü 	
return
°° 
new
°° 
ResponseDTO
°° 
(
°° 
)
°°  
{
¢¢ 	
	IsSuccess
££ 
=
££ 
true
££ 
,
££ 

StatusCode
§§ 
=
§§ 
$num
§§ 
,
§§ 
Result
•• 
=
•• 
filePath
•• 
,
•• 
Message
¶¶ 
=
¶¶ 
$str
¶¶ 0
}
ßß 	
;
ßß	 

}
®® 
public
™™ 

async
™™ 
Task
™™ 
<
™™ 
MemoryStream
™™ "
>
™™" #

GetContent
™™$ .
(
™™. /
string
™™/ 5
?
™™5 6
filePath
™™7 ?
)
™™? @
{
´´ 
try
¨¨ 
{
≠≠ 	
MemoryStream
ÆÆ 
memoryStream
ÆÆ %
=
ÆÆ& '
new
ÆÆ( +
MemoryStream
ÆÆ, 8
(
ÆÆ8 9
)
ÆÆ9 :
;
ÆÆ: ;
await
∞∞ 
_storageClient
∞∞  
.
∞∞  !!
DownloadObjectAsync
∞∞! 4
(
∞∞4 5
_bucketName
∞∞5 @
,
∞∞@ A
filePath
∞∞B J
,
∞∞J K
memoryStream
∞∞L X
)
∞∞X Y
;
∞∞Y Z
memoryStream
≤≤ 
.
≤≤ 
Seek
≤≤ 
(
≤≤ 
$num
≤≤ 
,
≤≤  

SeekOrigin
≤≤! +
.
≤≤+ ,
Begin
≤≤, 1
)
≤≤1 2
;
≤≤2 3
return
¥¥ 
memoryStream
¥¥ 
;
¥¥  
}
µµ 	
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 	
return
∏∏ 
null
∏∏ 
;
∏∏ 
}
ππ 	
}
∫∫ 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
MemoryStream
¡¡ "
>
¡¡" #
GetImage
¡¡$ ,
(
¡¡, -
string
¡¡- 3
filePath
¡¡4 <
)
¡¡< =
{
¬¬ 
try
√√ 
{
ƒƒ 	
MemoryStream
≈≈ 
memoryStream
≈≈ %
=
≈≈& '
new
≈≈( +
MemoryStream
≈≈, 8
(
≈≈8 9
)
≈≈9 :
;
≈≈: ;
await
«« 
_storageClient
««  
.
««  !!
DownloadObjectAsync
««! 4
(
««4 5
_bucketName
««5 @
,
««@ A
filePath
««B J
,
««J K
memoryStream
««L X
)
««X Y
;
««Y Z
memoryStream
…… 
.
…… 
Seek
…… 
(
…… 
$num
…… 
,
……  

SeekOrigin
……! +
.
……+ ,
Begin
……, 1
)
……1 2
;
……2 3
return
ÀÀ 
memoryStream
ÀÀ 
;
ÀÀ  
}
ÃÃ 	
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 	
return
œœ 
null
œœ 
;
œœ 
}
–– 	
}
—— 
}““ â4
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailTemplate.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Models #
{ 
public 

class 
EmailTemplate 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
TemplateName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

SenderName  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
SenderEmail !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Category 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
SubjectLine !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
PreHeaderText #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
PersonalizationTags )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 
BodyContent !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
FooterContent #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
CallToAction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Language 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
RecipientType #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
CreateBy 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

CreateTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
UpdateBy 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

UpdateTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Status 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 

BuildEmail  
(  !
string! '
recipientName( 5
,5 6
string7 =
confirmationLink> N
=O P
$strQ S
,S T
stringU [
token\ a
=b c
$strd f
)f g
{ 	
string 
	emailBody 
= 
BodyContent *
;* +
if!! 
(!! 
!!! 
string!! 
.!! 
IsNullOrEmpty!! %
(!!% &
confirmationLink!!& 6
)!!6 7
)!!7 8
{"" 
	emailBody## 
=## 
	emailBody## %
.##% &
Replace##& -
(##- .
$str##. B
,##B C
confirmationLink##D T
)##T U
;##U V
}$$ 
if&& 
(&& 
!&& 
string&& 
.&& 
IsNullOrEmpty&& %
(&&% &
token&&& +
)&&+ ,
)&&, -
{'' 
	emailBody(( 
=(( 
	emailBody(( %
.((% &
Replace((& -
(((- .
$str((. 7
,((7 8
token((9 >
)((> ?
;((? @
})) 
	emailBody++ 
=++ 
	emailBody++ !
.++! "
Replace++" )
(++) *
$str++* ;
,++; <
recipientName++= J
)++J K
;++K L
string-- 
	fullEmail-- 
=-- 
$@"-- "
$str-0" 
{00 
TemplateName00 !
}00! "
$str01" 
{11 
PreHeaderText11 !
}11! "
$str12" 
{22 
	emailBody22 
}22 
$str23 
{33 
FooterContent33 !
}33! "
$str34" 
{44 
CallToAction44 )
}44) *
$str46* 
"66 
;66 
return88 
	fullEmail88 
;88 
}99 	
}:: 
public<< 

class<< #
EmailTemplateRepository<< (
{== 
private>> 
readonly>> 
string>> 
_connectionString>>  1
;>>1 2
public@@ #
EmailTemplateRepository@@ &
(@@& '
string@@' -
connectionString@@. >
)@@> ?
{AA 	
_connectionStringBB 
=BB 
connectionStringBB  0
;BB0 1
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
EmailTemplateEE '
>EE' ('
GetEmailTemplateByNameAsyncEE) D
(EED E
stringEEE K
templateNameEEL X
)EEX Y
{FF 	
usingGG 
(GG 
varGG 

connectionGG !
=GG" #
newGG$ '
SqlConnectionGG( 5
(GG5 6
_connectionStringGG6 G
)GGG H
)GGH I
{HH 
varII 
queryII 
=II 
$strIK A
;KKA B
returnLL 
awaitLL 

connectionLL '
.LL' (%
QuerySingleOrDefaultAsyncLL( A
<LLA B
EmailTemplateLLB O
>LLO P
(LLP Q
queryLLQ V
,LLV W
newMM 
{MM 
TemplateNameMM &
=MM' (
templateNameMM) 5
}MM6 7
)MM7 8
;MM8 9
}NN 
}OO 	
}PP 
}QQ ≈’
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
EmailService 
: 
IEmailService )
{ 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

EmailService 
( 
IConfiguration &
configuration' 4
,4 5
IUnitOfWork6 A

unitOfWorkB L
,L M
IMapperN U
mapperV \
,\ ]
UserManager^ i
<i j
ApplicationUserj y
>y z
userManager	{ Ü
)
Ü á
{ 
_userManager 
= 
userManager "
;" #
_configuration 
= 
configuration &
;& '
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetAll# )
() *
ClaimsPrincipal 
User 
, 
string   
?   
filterOn   
,   
string!! 
?!! 
filterQuery!! 
,!! 
string"" 
?"" 
sortBy"" 
,"" 
bool## 
?## 
isAscending## 
,## 
int$$ 

pageNumber$$ 
,$$ 
int%% 
pageSize%% 
)%% 
{&& 
try)) 
{** 	
List++ 
<++ 
EmailTemplate++ 
>++ 
emailTemplates++  .
=++/ 0
new++1 4
List++5 9
<++9 :
EmailTemplate++: G
>++G H
(++H I
)++I J
;++J K
if.. 
(.. 
!.. 
string.. 
... 
IsNullOrEmpty.. %
(..% &
filterOn..& .
)... /
&&..0 2
!..3 4
string..4 :
...: ;
IsNullOrEmpty..; H
(..H I
filterQuery..I T
)..T U
)..U V
{// 
switch00 
(00 
filterOn00  
.00  !
Trim00! %
(00% &
)00& '
.00' (
ToLower00( /
(00/ 0
)000 1
)001 2
{11 
case22 
$str22 '
:22' (
{33 
emailTemplates44 &
=44' (
_unitOfWork44) 4
.444 5#
EmailTemplateRepository445 L
.44L M
GetAllAsync44M X
(44X Y
)44Y Z
.55 

GetAwaiter55 '
(55' (
)55( )
.55) *
	GetResult55* 3
(553 4
)554 5
.555 6
Where556 ;
(55; <
x55< =
=>55> @
x55A B
.55B C
TemplateName55C O
.55O P
Contains55P X
(55X Y
filterQuery55Y d
,55d e
StringComparison55f v
.55v w%
CurrentCultureIgnoreCase	55w è
)
55è ê
)
55ê ë
.
55ë í
ToList
55í ò
(
55ò ô
)
55ô ö
;
55ö õ
break66 
;66 
}77 
default99 
:99 
{:: 
emailTemplates;; &
=;;' (
_unitOfWork;;) 4
.;;4 5#
EmailTemplateRepository;;5 L
.;;L M
GetAllAsync;;M X
(;;X Y
);;Y Z
.<< 

GetAwaiter<< '
(<<' (
)<<( )
.<<) *
	GetResult<<* 3
(<<3 4
)<<4 5
.<<5 6
ToList<<6 <
(<<< =
)<<= >
;<<> ?
break== 
;== 
}>> 
}?? 
}@@ 
elseAA 
{BB 
emailTemplatesCC 
=CC  
_unitOfWorkCC! ,
.CC, -#
EmailTemplateRepositoryCC- D
.CCD E
GetAllAsyncCCE P
(CCP Q
)CCQ R
.DD 

GetAwaiterDD 
(DD  
)DD  !
.DD! "
	GetResultDD" +
(DD+ ,
)DD, -
.DD- .
ToListDD. 4
(DD4 5
)DD5 6
;DD6 7
}EE 
ifHH 
(HH 
!HH 
stringHH 
.HH 
IsNullOrEmptyHH %
(HH% &
sortByHH& ,
)HH, -
)HH- .
{II 
switchJJ 
(JJ 
sortByJJ 
.JJ 
TrimJJ #
(JJ# $
)JJ$ %
.JJ% &
ToLowerJJ& -
(JJ- .
)JJ. /
)JJ/ 0
{KK 
caseLL 
$strLL '
:LL' (
{MM 
emailTemplatesNN &
=NN' (
isAscendingNN) 4
==NN5 7
trueNN8 <
?OO 
[OO 
..OO !
emailTemplatesOO" 0
.OO0 1
OrderByOO1 8
(OO8 9
xOO9 :
=>OO; =
xOO> ?
.OO? @
TemplateNameOO@ L
)OOL M
]OOM N
:PP 
[PP 
..PP !
emailTemplatesPP" 0
.PP0 1
OrderByDescendingPP1 B
(PPB C
xPPC D
=>PPE G
xPPH I
.PPI J
TemplateNamePPJ V
)PPV W
]PPW X
;PPX Y
breakQQ 
;QQ 
}RR 
caseSS 
$strSS %
:SS% &
{TT 
emailTemplatesUU &
=UU' (
isAscendingUU) 4
==UU5 7
trueUU8 <
?VV 
[VV 
..VV !
emailTemplatesVV" 0
.VV0 1
OrderByVV1 8
(VV8 9
xVV9 :
=>VV; =
xVV> ?
.VV? @

SenderNameVV@ J
)VVJ K
]VVK L
:WW 
[WW 
..WW !
emailTemplatesWW" 0
.WW0 1
OrderByDescendingWW1 B
(WWB C
xWWC D
=>WWE G
xWWH I
.WWI J

SenderNameWWJ T
)WWT U
]WWU V
;WWV W
breakXX 
;XX 
}YY 
caseZZ 
$strZZ &
:ZZ& '
{[[ 
emailTemplates\\ &
=\\' (
isAscending\\) 4
==\\5 7
true\\8 <
?]] 
[]] 
..]] !
emailTemplates]]" 0
.]]0 1
OrderBy]]1 8
(]]8 9
x]]9 :
=>]]; =
x]]> ?
.]]? @
SenderEmail]]@ K
)]]K L
]]]L M
:^^ 
[^^ 
..^^ !
emailTemplates^^" 0
.^^0 1
OrderByDescending^^1 B
(^^B C
x^^C D
=>^^E G
x^^H I
.^^I J
SenderEmail^^J U
)^^U V
]^^V W
;^^W X
break__ 
;__ 
}`` 
caseaa 
$straa #
:aa# $
{bb 
emailTemplatescc &
=cc' (
isAscendingcc) 4
==cc5 7
truecc8 <
?dd 
[dd 
..dd !
emailTemplatesdd" 0
.dd0 1
OrderBydd1 8
(dd8 9
xdd9 :
=>dd; =
xdd> ?
.dd? @
Categorydd@ H
)ddH I
]ddI J
:ee 
[ee 
..ee !
emailTemplatesee" 0
.ee0 1
OrderByDescendingee1 B
(eeB C
xeeC D
=>eeE G
xeeH I
.eeI J
CategoryeeJ R
)eeR S
]eeS T
;eeT U
breakff 
;ff 
}gg 
defaulthh 
:hh 
{ii 
breakjj 
;jj 
}kk 
}ll 
}mm 
ifpp 
(pp 

pageNumberpp 
>pp 
$numpp 
&&pp !
pageSizepp" *
>pp+ ,
$numpp- .
)pp. /
{qq 
varrr 

skipResultrr 
=rr  
(rr! "

pageNumberrr" ,
-rr- .
$numrr/ 0
)rr0 1
*rr2 3
pageSizerr4 <
;rr< =
emailTemplatesss 
=ss  
emailTemplatesss! /
.ss/ 0
Skipss0 4
(ss4 5

skipResultss5 ?
)ss? @
.ss@ A
TakessA E
(ssE F
pageSizessF N
)ssN O
.ssO P
ToListssP V
(ssV W
)ssW X
;ssX Y
}tt 
ifxx 
(xx 
emailTemplatesxx 
.xx 
IsNullOrEmptyxx ,
(xx, -
)xx- .
)xx. /
{yy 
returnzz 
newzz 
ResponseDTOzz &
(zz& '
)zz' (
{{{ 
Message|| 
=|| 
$str|| ;
,||; <
Result}} 
=}} 
null}} !
,}}! "
	IsSuccess~~ 
=~~ 
false~~  %
,~~% &

StatusCode 
=  
$num! $
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ #
instructorInfoLiteDto
ÉÉ %
=
ÉÉ& '
_mapper
ÉÉ( /
.
ÉÉ/ 0
Map
ÉÉ0 3
<
ÉÉ3 4
List
ÉÉ4 8
<
ÉÉ8 9
EmailTemplate
ÉÉ9 F
>
ÉÉF G
>
ÉÉG H
(
ÉÉH I
emailTemplates
ÉÉI W
)
ÉÉW X
;
ÉÉX Y
return
ÖÖ 
new
ÖÖ 
ResponseDTO
ÖÖ "
(
ÖÖ" #
)
ÖÖ# $
{
ÜÜ 
Message
áá 
=
áá 
$str
áá ?
,
áá? @
Result
àà 
=
àà #
instructorInfoLiteDto
àà .
,
àà. /
	IsSuccess
ââ 
=
ââ 
true
ââ  
,
ââ  !

StatusCode
ää 
=
ää 
$num
ää  
}
ãã 
;
ãã 
}
åå 	
catch
çç 
(
çç 
	Exception
çç 
e
çç 
)
çç 
{
éé 	
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Message
ëë 
=
ëë 
e
ëë 
.
ëë 
Message
ëë #
,
ëë# $
Result
íí 
=
íí 
null
íí 
,
íí 
	IsSuccess
ìì 
=
ìì 
false
ìì !
,
ìì! "

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
}
óó 
private
†† 
async
†† 
Task
†† 
<
†† 
bool
†† 
>
†† #
SendEmailFromTemplate
†† 2
(
††2 3
string
††3 9
toMail
††: @
,
††@ A
string
††B H
templateName
††I U
,
††U V
string
††W ]
replacementValue
††^ n
)
††n o
{
°° 
var
££ 
template
££ 
=
££ 
await
££ 
_unitOfWork
££ (
.
££( )%
EmailTemplateRepository
££) @
.
££@ A
GetAsync
££A I
(
££I J
t
££J K
=>
££L N
t
££O P
.
££P Q
TemplateName
££Q ]
==
££^ `
templateName
££a m
)
££m n
;
££n o
if
•• 

(
•• 
template
•• 
==
•• 
null
•• 
)
•• 
{
¶¶ 	
throw
®® 
new
®® 
	Exception
®® 
(
®®  
$str
®®  :
)
®®: ;
;
®®; <
}
©© 	
string
¨¨ 
subject
¨¨ 
=
¨¨ 
template
¨¨ !
.
¨¨! "
SubjectLine
¨¨" -
;
¨¨- .
string
≠≠ 
body
≠≠ 
=
≠≠ 
$@"
≠≠ 
$str
≠∞ 
{
∞∞ 
template
∞∞ 
.
∞∞ 
SubjectLine
∞∞ )
}
∞∞) *
$str
∞±* 
{
±± 
template
±± 
.
±± 
PreHeaderText
±± +
}
±±+ ,
$str
±≤, 
{
≤≤ 
template
≤≤ 
.
≤≤ 
BodyContent
≤≤ (
}
≤≤( )
$str
≤≥) 
{
≥≥ 
replacementValue
≥≥ -
}
≥≥- .
$str≥≥. å
{≥≥å ç
template≥≥ç ï
.≥≥ï ñ
CallToAction≥≥ñ ¢
.≥≥¢ £
Replace≥≥£ ™
(≥≥™ ´
$str≥≥´ ¥
,≥≥¥ µ 
replacementValue≥≥∂ ∆
)≥≥∆ «
}≥≥« »
$str≥¥» 
{
¥¥ 
template
¥¥ 
.
¥¥ 
FooterContent
¥¥ '
}
¥¥' (
$str
¥∂( 
"
∂∂ 
;
∂∂ 
return
∏∏ 
await
∏∏ 
SendEmailAsync
∏∏ #
(
∏∏# $
toMail
∏∏$ *
,
∏∏* +
subject
∏∏, 3
,
∏∏3 4
body
∏∏5 9
)
∏∏9 :
;
∏∏: ;
}
ππ 
private
ªª 
async
ªª 
Task
ªª 
<
ªª 
bool
ªª 
>
ªª -
SendEmailInactiveCourseTemplate
ªª <
(
ªª< =
string
ªª= C
studentEmail
ªªD P
,
ªªP Q
string
ªªR X
templateName
ªªY e
,
ªªe f
string
ªªg m
instructorEmail
ªªn }
,
ªª} ~
stringªª Ö
instructorNameªªÜ î
,ªªî ï
stringªªñ ú
courseTitleªªù ®
)ªª® ©
{
ºº 
var
ΩΩ 
template
ΩΩ 
=
ΩΩ 
await
ΩΩ 
_unitOfWork
ΩΩ (
.
ΩΩ( )%
EmailTemplateRepository
ΩΩ) @
.
ΩΩ@ A
GetAsync
ΩΩA I
(
ΩΩI J
t
ΩΩJ K
=>
ΩΩL N
t
ΩΩO P
.
ΩΩP Q
TemplateName
ΩΩQ ]
==
ΩΩ^ `
templateName
ΩΩa m
)
ΩΩm n
;
ΩΩn o
if
øø 

(
øø 
template
øø 
==
øø 
null
øø 
)
øø 
{
¿¿ 	
throw
¡¡ 
new
¡¡ 
	Exception
¡¡ 
(
¡¡  
$str
¡¡  :
)
¡¡: ;
;
¡¡; <
}
¬¬ 	
string
ƒƒ 
subject
ƒƒ 
=
ƒƒ 
template
ƒƒ !
.
ƒƒ! "
SubjectLine
ƒƒ" -
;
ƒƒ- .
string
≈≈ 
body
≈≈ 
=
≈≈ 
$@"
≈≈ 
$str
≈» 
{
»» 
template
»» 
.
»» 
SubjectLine
»» )
}
»») *
$str
»…* 
{
…… 
template
…… 
.
…… 
PreHeaderText
…… +
}
……+ ,
$str
… , 
{
   
template
   
.
   
BodyContent
   (
.
  ( )
Replace
  ) 0
(
  0 1
$str
  1 @
,
  @ A
courseTitle
  B M
)
  M N
.
  N O
Replace
  O V
(
  V W
$str
  W g
,
  g h
instructorName
  i w
)
  w x
}
  x y
$str
 Ày 
{
ÀÀ 
template
ÀÀ 
.
ÀÀ 
FooterContent
ÀÀ '
}
ÀÀ' (
$str
ÀÕ( 
"
ÕÕ 
;
ÕÕ 
return
œœ 
await
œœ *
SendEmailInactiveCourseAsync
œœ 1
(
œœ1 2
instructorEmail
œœ2 A
,
œœA B
studentEmail
œœC O
,
œœO P
subject
œœQ X
,
œœX Y
body
œœZ ^
)
œœ^ _
;
œœ_ `
}
–– 
public
““ 

async
““ 
Task
““ 
<
““ 
bool
““ 
>
““ 
SendEmailAsync
““ *
(
““* +
string
““+ 1
toEmail
““2 9
,
““9 :
string
““; A
subject
““B I
,
““I J
string
““K Q
body
““R V
)
““V W
{
”” 
try
’’ 
{
÷÷ 	
var
◊◊ 
	fromEmail
◊◊ 
=
◊◊ 
_configuration
◊◊ *
[
◊◊* +
$str
◊◊+ D
]
◊◊D E
;
◊◊E F
var
ÿÿ 
fromPassword
ÿÿ 
=
ÿÿ 
_configuration
ÿÿ -
[
ÿÿ- .
$str
ÿÿ. J
]
ÿÿJ K
;
ÿÿK L
var
ŸŸ 
smtpHost
ŸŸ 
=
ŸŸ 
_configuration
ŸŸ )
[
ŸŸ) *
$str
ŸŸ* B
]
ŸŸB C
;
ŸŸC D
var
⁄⁄ 
smtpPort
⁄⁄ 
=
⁄⁄ 
int
⁄⁄ 
.
⁄⁄ 
Parse
⁄⁄ $
(
⁄⁄$ %
_configuration
⁄⁄% 3
[
⁄⁄3 4
$str
⁄⁄4 L
]
⁄⁄L M
)
⁄⁄M N
;
⁄⁄N O
var
›› 
message
›› 
=
›› 
new
›› 
MailMessage
›› )
(
››) *
	fromEmail
››* 3
,
››3 4
toEmail
››5 <
,
››< =
subject
››> E
,
››E F
body
››G K
)
››K L
;
››L M
message
ﬁﬁ 
.
ﬁﬁ 

IsBodyHtml
ﬁﬁ 
=
ﬁﬁ  
true
ﬁﬁ! %
;
ﬁﬁ% &
using
·· 
var
·· 

smtpClient
··  
=
··! "
new
··# &

SmtpClient
··' 1
(
··1 2
smtpHost
··2 :
,
··: ;
smtpPort
··< D
)
··D E
{
‚‚ 
Credentials
„„ 
=
„„ 
new
„„ !
NetworkCredential
„„" 3
(
„„3 4
	fromEmail
„„4 =
,
„„= >
fromPassword
„„? K
)
„„K L
,
„„L M
	EnableSsl
‰‰ 
=
‰‰ 
true
‰‰  
}
ÂÂ 
;
ÂÂ 
await
ÊÊ 

smtpClient
ÊÊ 
.
ÊÊ 
SendMailAsync
ÊÊ *
(
ÊÊ* +
message
ÊÊ+ 2
)
ÊÊ2 3
;
ÊÊ3 4
return
ÁÁ 
true
ÁÁ 
;
ÁÁ 
}
ËË 	
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
return
ÎÎ 
false
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
}
ÌÌ 
public
ÒÒ 

async
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
bool
ÒÒ 
>
ÒÒ *
SendEmailInactiveCourseAsync
ÒÒ 8
(
ÒÒ8 9
string
ÒÒ9 ?
instructorEmail
ÒÒ@ O
,
ÒÒO P
string
ÒÒQ W
studentEmail
ÒÒX d
,
ÒÒd e
string
ÒÒf l
subject
ÒÒm t
,
ÒÒt u
string
ÒÒv |
bodyÒÒ} Å
)ÒÒÅ Ç
{
ÚÚ 
try
ÛÛ 
{
ÙÙ 	
var
ıı 
fromPassword
ıı 
=
ıı 
_configuration
ıı -
[
ıı- .
$str
ıı. J
]
ııJ K
;
ııK L
var
ˆˆ 
smtpHost
ˆˆ 
=
ˆˆ 
_configuration
ˆˆ )
[
ˆˆ) *
$str
ˆˆ* B
]
ˆˆB C
;
ˆˆC D
var
˜˜ 
smtpPort
˜˜ 
=
˜˜ 
int
˜˜ 
.
˜˜ 
Parse
˜˜ $
(
˜˜$ %
_configuration
˜˜% 3
[
˜˜3 4
$str
˜˜4 L
]
˜˜L M
)
˜˜M N
;
˜˜N O
var
˘˘ 
message
˘˘ 
=
˘˘ 
new
˘˘ 
MailMessage
˘˘ )
(
˘˘) *
instructorEmail
˘˘* 9
,
˘˘9 :
studentEmail
˘˘; G
,
˘˘G H
subject
˘˘I P
,
˘˘P Q
body
˘˘R V
)
˘˘V W
;
˘˘W X
message
˙˙ 
.
˙˙ 

IsBodyHtml
˙˙ 
=
˙˙  
true
˙˙! %
;
˙˙% &
using
¸¸ 
var
¸¸ 

smtpClient
¸¸  
=
¸¸! "
new
¸¸# &

SmtpClient
¸¸' 1
(
¸¸1 2
smtpHost
¸¸2 :
,
¸¸: ;
smtpPort
¸¸< D
)
¸¸D E
{
˝˝ 
Credentials
˛˛ 
=
˛˛ 
new
˛˛ !
NetworkCredential
˛˛" 3
(
˛˛3 4
instructorEmail
˛˛4 C
,
˛˛C D
fromPassword
˛˛E Q
)
˛˛Q R
,
˛˛R S
	EnableSsl
ˇˇ 
=
ˇˇ 
true
ˇˇ  
}
ÄÄ 
;
ÄÄ 
await
ÅÅ 

smtpClient
ÅÅ 
.
ÅÅ 
SendMailAsync
ÅÅ *
(
ÅÅ* +
message
ÅÅ+ 2
)
ÅÅ2 3
;
ÅÅ3 4
return
ÇÇ 
true
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
return
ÜÜ 
false
ÜÜ 
;
ÜÜ 
}
áá 	
}
àà 
public
ää 

async
ää 
Task
ää 
<
ää 
bool
ää 
>
ää !
SendEmailResetAsync
ää /
(
ää/ 0
string
ää0 6
toEmail
ää7 >
,
ää> ?
string
ää@ F
subject
ääG N
,
ääN O
ApplicationUser
ääP _
user
ää` d
,
ääd e
string
ãã 
currentDate
ãã 
,
ãã 
string
ãã "
	resetLink
ãã# ,
,
ãã, -
string
åå 
operatingSystem
åå 
,
åå 
string
åå  &
browser
åå' .
,
åå. /
string
åå0 6
ip
åå7 9
,
åå9 :
string
åå; A
region
ååB H
,
ååH I
string
ååJ P
city
ååQ U
,
ååU V
string
ååW ]
country
åå^ e
)
ååe f
{
çç 
try
èè 
{
êê 	
var
ëë 
	fromEmail
ëë 
=
ëë 
_configuration
ëë *
[
ëë* +
$str
ëë+ D
]
ëëD E
;
ëëE F
var
íí 
fromPassword
íí 
=
íí 
_configuration
íí -
[
íí- .
$str
íí. J
]
ííJ K
;
ííK L
var
ìì 
smtpHost
ìì 
=
ìì 
_configuration
ìì )
[
ìì) *
$str
ìì* B
]
ììB C
;
ììC D
var
îî 
smtpPort
îî 
=
îî 
int
îî 
.
îî 
Parse
îî $
(
îî$ %
_configuration
îî% 3
[
îî3 4
$str
îî4 L
]
îîL M
)
îîM N
;
îîN O
var
ññ 
body
ññ 
=
ññ 
$@"
ññ 
$str
ñö ;
{
öö; <
currentDate
öö< G
}
ööG H
$str
ö¨H D
{
¨¨D E
user
¨¨E I
.
¨¨I J
FullName
¨¨J R
}
¨¨R S
$str¨¨S √
{¨¨√ ƒ
user¨¨ƒ »
.¨¨» …
UserName¨¨… —
}¨¨— “
$str¨Ø“ 
{
ØØ 
	resetLink
ØØ $
}
ØØ$ %
$strØ¥% ò
{¥¥ò ô
operatingSystem¥¥ô ®
}¥¥® ©
$str¥¥© Ó
{¥¥Ó Ô
browser¥¥Ô ˆ
}¥¥ˆ ˜
$str¥¥˜ ¬
{¥¥¬ √
ip¥¥√ ≈
}¥¥≈ ∆
$str¥¥∆ ä
{¥¥ä ã
region¥¥ã ë
}¥¥ë í
$str¥¥í À
{¥¥À Ã
city¥¥Ã –
}¥¥– —
$str¥¥— ä
{¥¥ä ã
country¥¥ã í
}¥¥í ì
$str¥‰ì 
"
‰‰ 
;
‰‰ 
var
ÁÁ 
message
ÁÁ 
=
ÁÁ 
new
ÁÁ 
MailMessage
ÁÁ )
(
ÁÁ) *
	fromEmail
ÁÁ* 3
,
ÁÁ3 4
toEmail
ÁÁ5 <
,
ÁÁ< =
subject
ÁÁ> E
,
ÁÁE F
body
ÁÁG K
)
ÁÁK L
;
ÁÁL M
message
ËË 
.
ËË 

IsBodyHtml
ËË 
=
ËË  
true
ËË! %
;
ËË% &
using
ÎÎ 
var
ÎÎ 

smtpClient
ÎÎ  
=
ÎÎ! "
new
ÎÎ# &

SmtpClient
ÎÎ' 1
(
ÎÎ1 2
smtpHost
ÎÎ2 :
,
ÎÎ: ;
smtpPort
ÎÎ< D
)
ÎÎD E
{
ÏÏ 
Credentials
ÌÌ 
=
ÌÌ 
new
ÌÌ !
NetworkCredential
ÌÌ" 3
(
ÌÌ3 4
	fromEmail
ÌÌ4 =
,
ÌÌ= >
fromPassword
ÌÌ? K
)
ÌÌK L
,
ÌÌL M
	EnableSsl
ÓÓ 
=
ÓÓ 
true
ÓÓ  
}
ÔÔ 
;
ÔÔ 
await
 

smtpClient
 
.
 
SendMailAsync
 *
(
* +
message
+ 2
)
2 3
;
3 4
return
ÒÒ 
true
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 	
return
ıı 
false
ıı 
;
ıı 
}
ˆˆ 	
}
˜˜ 
public
ˇˇ 

async
ˇˇ 
Task
ˇˇ 
<
ˇˇ 
bool
ˇˇ 
>
ˇˇ 
SendVerifyEmail
ˇˇ +
(
ˇˇ+ ,
string
ˇˇ, 2
toMail
ˇˇ3 9
,
ˇˇ9 :
string
ˇˇ; A
confirmationLink
ˇˇB R
)
ˇˇR S
{
ÄÄ 
return
ÅÅ 
await
ÅÅ #
SendEmailFromTemplate
ÅÅ *
(
ÅÅ* +
toMail
ÅÅ+ 1
,
ÅÅ1 2
$str
ÅÅ3 D
,
ÅÅD E
confirmationLink
ÅÅF V
)
ÅÅV W
;
ÅÅW X
}
ÇÇ 
public
ää 

async
ää 
Task
ää 
<
ää 
bool
ää 
>
ää ,
SendEmailForInstructorApproval
ää :
(
ää: ;
string
ää; A
toMail
ääB H
,
ääH I
string
ääJ P
token
ääQ V
)
ääV W
{
ãã 
return
åå 
await
åå #
SendEmailFromTemplate
åå *
(
åå* +
toMail
åå+ 1
,
åå1 2
$str
åå3 L
,
ååL M
token
ååN S
)
ååS T
;
ååT U
}
çç 
public
êê 

async
êê 
Task
êê 
<
êê 
bool
êê 
>
êê %
SendEmailInactiveCourse
êê 3
(
êê3 4
string
êê4 :
instructorEmail
êê; J
,
êêJ K
string
êêL R
instructorName
êêS a
,
êêa b
string
êêc i
courseTitle
êêj u
,
êêu v
List
êêw {
<
êê{ |
stringêê| Ç
>êêÇ É
studentEmailsêêÑ ë
)êêë í
{
ëë 
try
íí 
{
ìì 	
foreach
îî 
(
îî 
var
îî 
studentEmail
îî %
in
îî& (
studentEmails
îî) 6
)
îî6 7
{
ïï 
await
ññ -
SendEmailInactiveCourseTemplate
ññ 5
(
ññ5 6
studentEmail
ññ6 B
,
ññB C
$str
ññD Y
,
ññY Z
instructorEmail
ññ[ j
,
ññj k
instructorName
ññl z
,
ññz {
courseTitleññ| á
)ññá à
;ññà â
}
óó 
return
òò 
true
òò 
;
òò 
}
ôô 	
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 	
return
úú 
false
úú 
;
úú 
}
ùù 	
}
ûû 
public
ßß 

async
ßß 
Task
ßß 
<
ßß 
bool
ßß 
>
ßß -
SendEmailForAdminAboutNewCourse
ßß ;
(
ßß; <
string
ßß< B
toMail
ßßC I
)
ßßI J
{
®® 
var
©© 
template
©© 
=
©© 
await
©© 
_unitOfWork
©© (
.
©©( )%
EmailTemplateRepository
©©) @
.
©©@ A
GetAsync
©©A I
(
©©I J
t
©©J K
=>
©©L N
t
©©O P
.
©©P Q
TemplateName
©©Q ]
==
©©^ `
$str©©a Ö
)©©Ö Ü
;©©Ü á
var
™™ 
courseStatus
™™ 
=
™™ 
await
™™  
_unitOfWork
™™! ,
.
™™, -%
CourseVersionRepository
™™- D
.
™™D E
GetAsync
™™E M
(
™™M N
z
™™N O
=>
™™P R
z
™™S T
.
™™T U
CurrentStatus
™™U b
==
™™c e
$num
™™f g
)
™™g h
;
™™h i
if
´´ 

(
´´ 
template
´´ 
==
´´ 
null
´´ 
)
´´ 
{
¨¨ 	
throw
≠≠ 
new
≠≠ 
	Exception
≠≠ 
(
≠≠  
$str
≠≠  :
)
≠≠: ;
;
≠≠; <
}
ÆÆ 	
string
∞∞ 
subject
∞∞ 
=
∞∞ 
template
∞∞ !
.
∞∞! "
SubjectLine
∞∞" -
;
∞∞- .
string
±± 
body
±± 
=
±± 
$@"
±± 
$str
±¥ 
{
¥¥ 
template
¥¥ 
.
¥¥ 
SubjectLine
¥¥ )
}
¥¥) *
$str
¥µ* 
{
µµ 
template
µµ 
.
µµ 
PreHeaderText
µµ +
}
µµ+ ,
$str
µ∂, 
{
∂∂ 
template
∂∂ 
.
∂∂ 
BodyContent
∂∂ (
}
∂∂( )
$str
∂∑) *
{
∑∑* +
courseStatus
∑∑+ 7
.
∑∑7 8
CurrentStatus
∑∑8 E
}
∑∑E F
$str
∑∏F 
{
∏∏ 
template
∏∏ 
.
∏∏ 
FooterContent
∏∏ '
}
∏∏' (
$str
∏∫( 
"
∫∫ 
;
∫∫ 
return
ºº 
await
ºº 
SendEmailAsync
ºº #
(
ºº# $
toMail
ºº$ *
,
ºº* +
subject
ºº, 3
,
ºº3 4
body
ºº5 9
)
ºº9 :
;
ºº: ;
}
ΩΩ 
public
∆∆ 

async
∆∆ 
Task
∆∆ 
<
∆∆ 
bool
∆∆ 
>
∆∆ 4
&SendEmailForStudentAboutCompleteCourse
∆∆ B
(
∆∆B C
string
∆∆C I
toMail
∆∆J P
)
∆∆P Q
{
«« 
var
»» 
template
»» 
=
»» 
await
»» 
_unitOfWork
»» (
.
»»( )%
EmailTemplateRepository
»») @
.
»»@ A
GetAsync
»»A I
(
»»I J
t
»»J K
=>
»»L N
t
»»O P
.
»»P Q
TemplateName
»»Q ]
==
»»^ `
$str
»»a y
)
»»y z
;
»»z {
var
…… 
courseStatus
…… 
=
…… 
await
……  
_unitOfWork
……! ,
.
……, -%
CourseVersionRepository
……- D
.
……D E
GetAsync
……E M
(
……M N
z
……N O
=>
……P R
z
……S T
.
……T U
CurrentStatus
……U b
==
……c e
$num
……f g
)
……g h
;
……h i
if
   

(
   
template
   
==
   
null
   
)
   
{
ÀÀ 	
throw
ÃÃ 
new
ÃÃ 
	Exception
ÃÃ 
(
ÃÃ  
$str
ÃÃ  :
)
ÃÃ: ;
;
ÃÃ; <
}
ÕÕ 	
string
œœ 
subject
œœ 
=
œœ 
template
œœ !
.
œœ! "
SubjectLine
œœ" -
;
œœ- .
string
–– 
body
–– 
=
–– 
$@"
–– 
$str
–” 
{
”” 
template
”” 
.
”” 
SubjectLine
”” )
}
””) *
$str
”‘* 
{
‘‘ 
template
‘‘ 
.
‘‘ 
PreHeaderText
‘‘ +
}
‘‘+ ,
$str
‘’, 
{
’’ 
template
’’ 
.
’’ 
BodyContent
’’ (
}
’’( )
$str
’÷) *
{
÷÷* +
courseStatus
÷÷+ 7
.
÷÷7 8
CurrentStatus
÷÷8 E
}
÷÷E F
$str
÷◊F 
{
◊◊ 
template
◊◊ 
.
◊◊ 
FooterContent
◊◊ '
}
◊◊' (
$str
◊Ÿ( 
"
ŸŸ 
;
ŸŸ 
return
€€ 
await
€€ 
SendEmailAsync
€€ #
(
€€# $
toMail
€€$ *
,
€€* +
subject
€€, 3
,
€€3 4
body
€€5 9
)
€€9 :
;
€€: ;
}
‹‹ 
public
„„ 

async
„„ 
Task
„„ 
<
„„ 
bool
„„ 
>
„„ 9
+SendApproveEmailForInstructorAboutNewCourse
„„ G
(
„„G H
string
„„H N
toMail
„„O U
)
„„U V
{
‰‰ 
var
ÂÂ 
template
ÂÂ 
=
ÂÂ 
await
ÂÂ 
_unitOfWork
ÂÂ (
.
ÂÂ( )%
EmailTemplateRepository
ÂÂ) @
.
ÂÂ@ A
GetAsync
ÂÂA I
(
ÂÂI J
t
ÂÂJ K
=>
ÂÂL N
t
ÂÂO P
.
ÂÂP Q
TemplateName
ÂÂQ ]
==
ÂÂ^ `
$str
ÂÂa z
)
ÂÂz {
;
ÂÂ{ |
var
ÊÊ 
courseStatus
ÊÊ 
=
ÊÊ 
await
ÊÊ  
_unitOfWork
ÊÊ! ,
.
ÊÊ, -%
CourseVersionRepository
ÊÊ- D
.
ÊÊD E
GetAsync
ÊÊE M
(
ÊÊM N
z
ÊÊN O
=>
ÊÊP R
z
ÊÊS T
.
ÊÊT U
CurrentStatus
ÊÊU b
==
ÊÊc e
$num
ÊÊf g
)
ÊÊg h
;
ÊÊh i
if
ÁÁ 

(
ÁÁ 
template
ÁÁ 
==
ÁÁ 
null
ÁÁ 
)
ÁÁ 
{
ËË 	
throw
ÈÈ 
new
ÈÈ 
	Exception
ÈÈ 
(
ÈÈ  
$str
ÈÈ  :
)
ÈÈ: ;
;
ÈÈ; <
}
ÍÍ 	
string
ÏÏ 
subject
ÏÏ 
=
ÏÏ 
template
ÏÏ !
.
ÏÏ! "
SubjectLine
ÏÏ" -
;
ÏÏ- .
string
ÌÌ 
body
ÌÌ 
=
ÌÌ 
$@"
ÌÌ 
$str
Ì 
{
 
template
 
.
 
SubjectLine
 )
}
) *
$str
Ò* 
{
ÒÒ 
template
ÒÒ 
.
ÒÒ 
PreHeaderText
ÒÒ +
}
ÒÒ+ ,
$str
ÒÚ, 
{
ÚÚ 
template
ÚÚ 
.
ÚÚ 
BodyContent
ÚÚ (
}
ÚÚ( )
$str
ÚÛ) *
{
ÛÛ* +
courseStatus
ÛÛ+ 7
.
ÛÛ7 8
CurrentStatus
ÛÛ8 E
}
ÛÛE F
$str
ÛÙF 
{
ÙÙ 
template
ÙÙ 
.
ÙÙ 
FooterContent
ÙÙ '
}
ÙÙ' (
$str
Ùˆ( 
"
ˆˆ 
;
ˆˆ 
return
¯¯ 
await
¯¯ 
SendEmailAsync
¯¯ #
(
¯¯# $
toMail
¯¯$ *
,
¯¯* +
subject
¯¯, 3
,
¯¯3 4
body
¯¯5 9
)
¯¯9 :
;
¯¯: ;
}
˘˘ 
public
ÄÄ 

async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
bool
ÄÄ 
>
ÄÄ 8
*SendRejectEmailForInstructorAboutNewCourse
ÄÄ F
(
ÄÄF G
string
ÄÄG M
toMail
ÄÄN T
)
ÄÄT U
{
ÅÅ 
var
ÇÇ 
template
ÇÇ 
=
ÇÇ 
await
ÇÇ 
_unitOfWork
ÇÇ (
.
ÇÇ( )%
EmailTemplateRepository
ÇÇ) @
.
ÇÇ@ A
GetAsync
ÇÇA I
(
ÇÇI J
t
ÇÇJ K
=>
ÇÇL N
t
ÇÇO P
.
ÇÇP Q
TemplateName
ÇÇQ ]
==
ÇÇ^ `
$str
ÇÇa y
)
ÇÇy z
;
ÇÇz {
var
ÉÉ 
courseStatus
ÉÉ 
=
ÉÉ 
await
ÉÉ  
_unitOfWork
ÉÉ! ,
.
ÉÉ, -%
CourseVersionRepository
ÉÉ- D
.
ÉÉD E
GetAsync
ÉÉE M
(
ÉÉM N
z
ÉÉN O
=>
ÉÉP R
z
ÉÉS T
.
ÉÉT U
CurrentStatus
ÉÉU b
==
ÉÉc e
$num
ÉÉf g
)
ÉÉg h
;
ÉÉh i
if
ÑÑ 

(
ÑÑ 
template
ÑÑ 
==
ÑÑ 
null
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
throw
ÜÜ 
new
ÜÜ 
	Exception
ÜÜ 
(
ÜÜ  
$str
ÜÜ  :
)
ÜÜ: ;
;
ÜÜ; <
}
áá 	
string
ââ 
subject
ââ 
=
ââ 
template
ââ !
.
ââ! "
SubjectLine
ââ" -
;
ââ- .
string
ää 
body
ää 
=
ää 
$@"
ää 
$str
äç 
{
çç 
template
çç 
.
çç 
SubjectLine
çç )
}
çç) *
$str
çé* 
{
éé 
template
éé 
.
éé 
PreHeaderText
éé +
}
éé+ ,
$str
éè, 
{
èè 
template
èè 
.
èè 
BodyContent
èè (
}
èè( )
$str
èê) 
{
êê 
courseStatus
êê  
.
êê  !
CurrentStatus
êê! .
}
êê. /
$str
êë/ 
{
ëë 
template
ëë 
.
ëë 
FooterContent
ëë '
}
ëë' (
$str
ëì( 
"
ìì 
;
ìì 
return
ïï 
await
ïï 
SendEmailAsync
ïï #
(
ïï# $
toMail
ïï$ *
,
ïï* +
subject
ïï, 3
,
ïï3 4
body
ïï5 9
)
ïï9 :
;
ïï: ;
}
ññ 
public
ùù 

async
ùù 
Task
ùù 
<
ùù 
bool
ùù 
>
ùù *
SendEmailRemindDeleteAccount
ùù 8
(
ùù8 9
string
ùù9 ?
toMail
ùù@ F
)
ùùF G
{
ûû 
var
üü 
template
üü 
=
üü 
await
üü 
_unitOfWork
üü (
.
üü( )%
EmailTemplateRepository
üü) @
.
üü@ A
GetAsync
üüA I
(
üüI J
t
üüJ K
=>
üüL N
t
üüO P
.
üüP Q
TemplateName
üüQ ]
==
üü^ `
$str
üüa v
)
üüv w
;
üüw x
if
†† 

(
†† 
template
†† 
==
†† 
null
†† 
)
†† 
{
°° 	
throw
¢¢ 
new
¢¢ 
	Exception
¢¢ 
(
¢¢  
$str
¢¢  :
)
¢¢: ;
;
¢¢; <
}
££ 	
string
•• 
subject
•• 
=
•• 
template
•• !
.
••! "
SubjectLine
••" -
;
••- .
string
¶¶ 
body
¶¶ 
=
¶¶ 
$@"
¶¶ 
$str
¶© 
{
©© 
template
©© 
.
©© 
SubjectLine
©© )
}
©©) *
$str
©™* 
{
™™ 
template
™™ 
.
™™ 
PreHeaderText
™™ +
}
™™+ ,
$str
™´, 
{
´´ 
template
´´ 
.
´´ 
BodyContent
´´ (
}
´´( )
$str
´¨) 
{
¨¨ 
template
¨¨ 
.
¨¨ 
FooterContent
¨¨ '
}
¨¨' (
$str
¨Æ( 
"
ÆÆ 
;
ÆÆ 
return
∞∞ 
await
∞∞ 
SendEmailAsync
∞∞ #
(
∞∞# $
toMail
∞∞$ *
,
∞∞* +
subject
∞∞, 3
,
∞∞3 4
body
∞∞5 9
)
∞∞9 :
;
∞∞: ;
}
±± 
public
∏∏ 

async
∏∏ 
Task
∏∏ 
<
∏∏ 
bool
∏∏ 
>
∏∏ $
SendEmailDeleteAccount
∏∏ 2
(
∏∏2 3
string
∏∏3 9
toMail
∏∏: @
)
∏∏@ A
{
ππ 
var
∫∫ 
template
∫∫ 
=
∫∫ 
await
∫∫ 
_unitOfWork
∫∫ (
.
∫∫( )%
EmailTemplateRepository
∫∫) @
.
∫∫@ A
GetAsync
∫∫A I
(
∫∫I J
t
∫∫J K
=>
∫∫L N
t
∫∫O P
.
∫∫P Q
TemplateName
∫∫Q ]
==
∫∫^ `
$str
∫∫a p
)
∫∫p q
;
∫∫q r
if
ªª 

(
ªª 
template
ªª 
==
ªª 
null
ªª 
)
ªª 
{
ºº 	
throw
ΩΩ 
new
ΩΩ 
	Exception
ΩΩ 
(
ΩΩ  
$str
ΩΩ  :
)
ΩΩ: ;
;
ΩΩ; <
}
ææ 	
string
¿¿ 
subject
¿¿ 
=
¿¿ 
template
¿¿ !
.
¿¿! "
SubjectLine
¿¿" -
;
¿¿- .
string
¡¡ 
body
¡¡ 
=
¡¡ 
$@"
¡¡ 
$str
¡ƒ 
{
ƒƒ 
template
ƒƒ 
.
ƒƒ 
SubjectLine
ƒƒ )
}
ƒƒ) *
$str
ƒ≈* 
{
≈≈ 
template
≈≈ 
.
≈≈ 
PreHeaderText
≈≈ +
}
≈≈+ ,
$str
≈∆, 
{
∆∆ 
template
∆∆ 
.
∆∆ 
BodyContent
∆∆ (
}
∆∆( )
$str
∆«) 
{
«« 
template
«« 
.
«« 
FooterContent
«« '
}
««' (
$str
«…( 
"
…… 
;
…… 
return
ÀÀ 
await
ÀÀ 
SendEmailAsync
ÀÀ #
(
ÀÀ# $
toMail
ÀÀ$ *
,
ÀÀ* +
subject
ÀÀ, 3
,
ÀÀ3 4
body
ÀÀ5 9
)
ÀÀ9 :
;
ÀÀ: ;
}
ÃÃ 
public
’’ 

async
’’ 
Task
’’ 
<
’’ 
bool
’’ 
>
’’ .
 SendEmailToInstructorAfterPayout
’’ <
(
’’< =
string
’’= C
toMail
’’D J
,
’’J K
double
’’L R
PayoutAmount
’’S _
,
’’_ `
DateTime
’’a i
TransactionDate
’’j y
)
’’y z
{
÷÷ 
var
◊◊ 
template
◊◊ 
=
◊◊ 
await
ÿÿ 
_unitOfWork
ÿÿ 
.
ÿÿ %
EmailTemplateRepository
ÿÿ 5
.
ÿÿ5 6
GetAsync
ÿÿ6 >
(
ÿÿ> ?
t
ÿÿ? @
=>
ÿÿA C
t
ÿÿD E
.
ÿÿE F
TemplateName
ÿÿF R
==
ÿÿS U
$str
ÿÿV w
)
ÿÿw x
;
ÿÿx y
if
ŸŸ 

(
ŸŸ 
template
ŸŸ 
==
ŸŸ 
null
ŸŸ 
)
ŸŸ 
{
⁄⁄ 	
throw
€€ 
new
€€ 
	Exception
€€ 
(
€€  
$str
€€  :
)
€€: ;
;
€€; <
}
‹‹ 	
string
ﬁﬁ 
subject
ﬁﬁ 
=
ﬁﬁ 
template
ﬁﬁ !
.
ﬁﬁ! "
SubjectLine
ﬁﬁ" -
;
ﬁﬁ- .
string
ﬂﬂ 
body
ﬂﬂ 
=
ﬂﬂ 
$@"
ﬂﬂ 
$str
ﬂ‚ 
{
‚‚ 
template
‚‚ 
.
‚‚ 
SubjectLine
‚‚ )
}
‚‚) *
$str
‚„* 
{
„„ 
template
„„ 
.
„„ 
PreHeaderText
„„ +
}
„„+ ,
$str
„‰, 
{
‰‰ 
template
‰‰ 
.
‰‰ 
BodyContent
‰‰ (
}
‰‰( )
$str
‰Á) 
{
ÁÁ 
template
ÁÁ 
.
ÁÁ 
FooterContent
ÁÁ '
}
ÁÁ' (
$str
ÁÈ( 
"
ÈÈ 
;
ÈÈ 
return
ÎÎ 
await
ÎÎ 
SendEmailAsync
ÎÎ #
(
ÎÎ# $
toMail
ÎÎ$ *
,
ÎÎ* +
subject
ÎÎ, 3
,
ÎÎ3 4
body
ÎÎ5 9
)
ÎÎ9 :
;
ÎÎ: ;
}
ÏÏ 
}ÌÌ ÜQ
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailSender.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
EmailSender 
: 
IEmailSender '
{		 
private

 
readonly

 
IEmailService

 "
_emailService

# 0
;

0 1
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
public 

EmailSender 
( 
IEmailService $
emailService% 1
,1 2
IUnitOfWork3 >

unitOfWork? I
)I J
{ 
_emailService 
= 
emailService $
;$ %
_unitOfWork 
= 

unitOfWork  
;  !
} 
public 

async 
Task -
!SendSubmittedCourseEmailForAdmins 7
(7 8
)8 9
{ 
var 
admins 
= 
await 
_unitOfWork &
.& '!
UserManagerRepository' <
.< =
GetUsersInRoleAsync= P
(P Q
StaticUserRolesQ `
.` a
Admina f
)f g
;g h
foreach 
( 
var 
admin 
in 
admins $
)$ %
{ 	
if 
( 
admin 
. 
Email 
!= 
null #
)# $
{ 
await 
_emailService #
.# $+
SendEmailForAdminAboutNewCourse$ C
(C D
adminD I
.I J
EmailJ O
)O P
;P Q
} 
} 	
} 
public 

async 
Task (
SendCompletedCoursForStudent 2
(2 3
)3 4
{   
var!! 
students!! 
=!! 
await!! 
_unitOfWork!! (
.!!( )!
UserManagerRepository!!) >
.!!> ?
GetUsersInRoleAsync!!? R
(!!R S
StaticUserRoles!!S b
.!!b c
Student!!c j
)!!j k
;!!k l
foreach## 
(## 
var## 
user## 
in## 
students## %
)##% &
{$$ 	
if%% 
(%% 
user%% 
.%% 
Email%% 
!=%% 
null%% "
)%%" #
{&& 
await'' 
_emailService'' #
.''# $2
&SendEmailForStudentAboutCompleteCourse''$ J
(''J K
user''K O
.''O P
Email''P U
)''U V
;''V W
}(( 
})) 	
}** 
public,, 

async,, 
Task,, 0
$SendRejectedCourseEmailForInstructor,, :
(,,: ;
Guid,,; ?
courseVersionId,,@ O
),,O P
{-- 
try.. 
{// 	
var00 
courseVersion00 
=00 
await00  %
_unitOfWork00& 1
.001 2#
CourseVersionRepository002 I
.00I J
GetAsync00J R
(00R S
x00S T
=>00U W
x00X Y
.00Y Z
Id00Z \
==00] _
courseVersionId00` o
)00o p
;00p q
var11 

instructor11 
=11 
await22 
_unitOfWork22 !
.22! " 
InstructorRepository22" 6
.226 7
GetAsync227 ?
(33 
filter44 
:44 
x44 
=>44  
x44! "
.44" #
InstructorId44# /
==440 2
courseVersion443 @
.44@ A
InstructorId44A M
,44M N
includeProperties55 %
:55% &
$str55' 8
)66 
;66 
await77 
_emailService77 
.77  6
*SendRejectEmailForInstructorAboutNewCourse77  J
(77J K

instructor77K U
.77U V
ApplicationUser77V e
.77e f
Email77f k
)77k l
;77l m
}88 	
catch99 
(99 
	Exception99 
e99 
)99 
{:: 	
}<< 	
}== 
public?? 

async?? 
Task?? 0
$SendAcceptedCourseEmailForInstructor?? :
(??: ;
Guid??; ?
courseVersionId??@ O
)??O P
{@@ 
tryAA 
{BB 	
varCC 
courseVersionCC 
=CC 
awaitCC  %
_unitOfWorkCC& 1
.CC1 2#
CourseVersionRepositoryCC2 I
.CCI J
GetAsyncCCJ R
(CCR S
xCCS T
=>CCU W
xCCX Y
.CCY Z
IdCCZ \
==CC] _
courseVersionIdCC` o
)CCo p
;CCp q
varDD 

instructorDD 
=DD 
awaitEE 
_unitOfWorkEE !
.EE! " 
InstructorRepositoryEE" 6
.EE6 7
GetAsyncEE7 ?
(FF 
filterGG 
:GG 
xGG 
=>GG  
xGG! "
.GG" #
InstructorIdGG# /
==GG0 2
courseVersionGG3 @
.GG@ A
InstructorIdGGA M
,GGM N
includePropertiesHH %
:HH% &
$strHH' 8
)II 
;II 
awaitJJ 
_emailServiceJJ 
.JJ  7
+SendApproveEmailForInstructorAboutNewCourseJJ  K
(JJK L

instructorJJL V
.JJV W
ApplicationUserJJW f
.JJf g
EmailJJg l
)JJl m
;JJm n
}KK 	
catchLL 
(LL 
	ExceptionLL 
eLL 
)LL 
{MM 	
}OO 	
}PP 
publicRR 

asyncRR 
TaskRR 1
%SendDeactivatedCourseEmailForStudentsRR ;
(RR; <
GuidRR< @
courseIdRRA I
)RRI J
{SS 
tryTT 
{UU 	
varVV 
studentCoursesVV 
=VV  
awaitVV! &
_unitOfWorkVV' 2
.VV2 3#
StudentCourseRepositoryVV3 J
.VVJ K
GetAllAsyncVVK V
(VVV W
xVVW X
=>VVY [
xVV\ ]
.VV] ^
CourseIdVV^ f
==VVg i
courseIdVVj r
)VVr s
;VVs t
varXX 
courseXX 
=XX 
awaitXX 
_unitOfWorkXX *
.XX* +
CourseRepositoryXX+ ;
.XX; <
GetAsyncXX< D
(XXD E
xXXE F
=>XXG I
xXXJ K
.XXK L
IdXXL N
==XXO Q
courseIdXXR Z
)XXZ [
;XX[ \
varZZ 
courseVersionsZZ 
=ZZ  
await[[ 
_unitOfWork[[ !
.[[! "#
CourseVersionRepository[[" 9
.[[9 :
GetAsync[[: B
([[B C
x[[C D
=>[[E G
x[[H I
.[[I J
Id[[J L
==[[M O
course[[P V
.[[V W
CourseVersionId[[W f
)[[f g
;[[g h
var]] 

instructor]] 
=]] 
await]] "
_unitOfWork]]# .
.]]. / 
InstructorRepository]]/ C
.]]C D
GetAsync]]D L
(]]L M
filter^^ 
:^^ 
x^^ 
=>^^ 
course^^ #
!=^^$ &
null^^' +
&&^^, .
x^^/ 0
.^^0 1
InstructorId^^1 =
==^^> @
course^^A G
.^^G H
InstructorId^^H T
,^^T U
includeProperties__ !
:__! "
$str__# 4
)`` 
;`` 
varbb 
studentEmailsbb 
=bb 
newbb  #
Listbb$ (
<bb( )
stringbb) /
>bb/ 0
(bb0 1
)bb1 2
;bb2 3
foreachdd 
(dd 
vardd 
studentCoursedd &
indd' )
studentCoursesdd* 8
)dd8 9
{ee 
varff 
studentff 
=ff 
awaitff #
_unitOfWorkff$ /
.ff/ 0
StudentRepositoryff0 A
.ffA B
GetAsyncffB J
(gg 
filterhh 
:hh 
xhh 
=>hh  
xhh! "
.hh" #
	StudentIdhh# ,
==hh- /
studentCoursehh0 =
.hh= >
	StudentIdhh> G
,hhG H
includePropertiesii %
:ii% &
$strii' 8
)jj 
;jj 
ifkk 
(kk 
studentkk 
?kk 
.kk 
ApplicationUserkk ,
.kk, -
Emailkk- 2
!=kk3 5
nullkk6 :
)kk: ;
{ll 
studentEmailsmm !
.mm! "
Addmm" %
(mm% &
studentmm& -
.mm- .
ApplicationUsermm. =
.mm= >
Emailmm> C
)mmC D
;mmD E
}nn 
}oo 
ifqq 
(qq 

instructorqq 
?qq 
.qq 
ApplicationUserqq +
isqq, .
{qq/ 0
Emailqq1 6
:qq6 7
notqq8 ;
nullqq< @
,qq@ A
FullNameqqB J
:qqJ K
notqqL O
nullqqP T
}qqU V
)qqV W
{rr 
ifss 
(ss 
courseVersionsss "
?ss" #
.ss# $
Titless$ )
!=ss* ,
nullss- 1
)ss1 2
{tt 
awaituu 
_emailServiceuu '
.uu' (#
SendEmailInactiveCourseuu( ?
(uu? @

instructoruu@ J
.uuJ K
ApplicationUseruuK Z
.uuZ [
Emailuu[ `
,uu` a

instructorvv "
.vv" #
ApplicationUservv# 2
.vv2 3
FullNamevv3 ;
,vv; <
courseVersionsvv= K
.vvK L
TitlevvL Q
,vvQ R
studentEmailsvvS `
)vv` a
;vva b
}ww 
}xx 
}yy 	
catchzz 
(zz 
	Exceptionzz 
ezz 
)zz 
{{{ 	
}}} 	
}~~ 
} œ4
sD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseVersionStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public

 
class

 &
CourseVersionStatusService

 '
:

( )'
ICourseVersionStatusService

* E
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 
&
CourseVersionStatusService %
(% &
IUnitOfWork& 1

unitOfWork2 <
,< =
IMapper> E
mapperF L
)L M
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

Task 
< 
ResponseDTO 
> #
GetCourseVersionsStatus 4
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
{ 
throw   
new   #
NotImplementedException   )
(  ) *
)  * +
;  + ,
}!! 
public## 

async## 
Task## 
<## 
ResponseDTO## !
>##! ""
GetCourseVersionStatus### 9
($$ 
ClaimsPrincipal%% 
User%% 
,%% 
Guid&& !
courseVersionStatusId&& "
)'' 
{(( 
try)) 
{** 	
var++ 
courseVersion++ 
=++ 
await,, 
_unitOfWork,, !
.,,! ")
CourseVersionStatusRepository,," ?
.,,? @+
GetCourseVersionStatusByIdAsync,,@ _
(,,_ `!
courseVersionStatusId,,` u
),,u v
;,,v w
if.. 
(.. 
courseVersion.. 
is..  
null..! %
)..% &
{// 
return00 
new00 
ResponseDTO00 &
(00& '
)00' (
{11 
Message22 
=22 
$str22 C
,22C D
Result33 
=33 
null33 !
,33! "
	IsSuccess44 
=44 
false44  %
,44% &

StatusCode55 
=55  
$num55! $
,55$ %
}66 
;66 
}77 
var99 %
getCourseVersionStatusDto99 )
=99* +
_mapper99, 3
.993 4
Map994 7
<997 8%
GetCourseVersionStatusDTO998 Q
>99Q R
(99R S
courseVersion99S `
)99` a
;99a b
return;; 
new;; 
ResponseDTO;; "
(;;" #
);;# $
{<< 
Message== 
=== 
$str== B
,==B C
Result>> 
=>> %
getCourseVersionStatusDto>> 2
,>>2 3
	IsSuccess?? 
=?? 
true??  
,??  !

StatusCode@@ 
=@@ 
$num@@  
}AA 
;AA 
}BB 	
catchCC 
(CC 
	ExceptionCC 
eCC 
)CC 
{DD 	
returnEE 
newEE 
ResponseDTOEE "
(EE" #
)EE# $
{FF 
MessageGG 
=GG 
eGG 
.GG 
MessageGG #
,GG# $
	IsSuccessHH 
=HH 
falseHH !
,HH! "

StatusCodeII 
=II 
$numII  
,II  !
ResultJJ 
=JJ 
nullJJ 
}KK 
;KK 
}LL 	
}MM 
publicOO 

asyncOO 
TaskOO 
<OO 
ResponseDTOOO !
>OO! "%
CreateCourseVersionStatusOO# <
(PP 
ClaimsPrincipalQQ 
UserQQ 
,QQ (
CreateCourseVersionStatusDTORR $(
createCourseVersionStatusDtoRR% A
)SS 
{TT 
tryUU 
{VV 	
varWW 
courseVersionStatusWW #
=WW$ %
newWW& )
CourseVersionStatusWW* =
(WW= >
)WW> ?
{XX 
IdYY 
=YY 
newYY 
GuidYY 
(YY 
)YY 
,YY  

CreateTimeZZ 
=ZZ 
DateTimeZZ %
.ZZ% &
UtcNowZZ& ,
,ZZ, -
Status[[ 
=[[ (
createCourseVersionStatusDto[[ 5
.[[5 6
Status[[6 <
,[[< =
CourseVersionId\\ 
=\\  !(
createCourseVersionStatusDto\\" >
.\\> ?
CourseVersionId\\? N
}]] 
;]] 
await__ 
_unitOfWork__ 
.__ )
CourseVersionStatusRepository__ ;
.__; <
AddAsync__< D
(__D E
courseVersionStatus__E X
)__X Y
;__Y Z
await`` 
_unitOfWork`` 
.`` 
	SaveAsync`` '
(``' (
)``( )
;``) *
returnbb 
newbb 
ResponseDTObb "
(bb" #
)bb# $
{cc 
Messagedd 
=dd 
$strdd E
,ddE F
Resultee 
=ee 
courseVersionStatusee ,
.ee, -
Idee- /
,ee/ 0
	IsSuccessff 
=ff 
trueff  
,ff  !

StatusCodegg 
=gg 
$numgg  
}hh 
;hh 
}ii 	
catchjj 
(jj 
	Exceptionjj 
ejj 
)jj 
{kk 	
returnll 
newll 
ResponseDTOll "
(ll" #
)ll# $
{mm 
Messagenn 
=nn 
enn 
.nn 
Messagenn #
,nn# $
Resultoo 
=oo 
nulloo 
,oo 
	IsSuccesspp 
=pp 
truepp  
,pp  !

StatusCodeqq 
=qq 
$numqq  
}rr 
;rr 
}ss 	
}tt 
}uu ô…
mD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class  
CourseVersionService !
:" #!
ICourseVersionService$ 9
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
ICourseService #
_courseService$ 2
;2 3
private 
readonly (
ICourseSectionVersionService 1(
_courseSectionVersionService2 N
;N O
private 
readonly '
ICourseVersionStatusService 0'
_courseVersionStatusService1 L
;L M
private 
readonly 
IFirebaseService %
_firebaseService& 6
;6 7
private 
IMapper 
_mapper 
; 
public 
 
CourseVersionService 
( 
IUnitOfWork 

unitOfWork 
, 
ICourseService 
courseService $
,$ %
IMapper 
mapper 
, '
ICourseVersionStatusService #&
courseVersionStatusService$ >
,> ?(
ICourseSectionVersionService $'
courseSectionVersionService% @
,@ A
IFirebaseServiceB R
firebaseServiceS b
)b c
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_courseService 
= 
courseService &
;& '
_mapper   
=   
mapper   
;   '
_courseVersionStatusService!! #
=!!$ %&
courseVersionStatusService!!& @
;!!@ A(
_courseSectionVersionService"" $
=""% &'
courseSectionVersionService""' B
;""B C
_firebaseService## 
=## 
firebaseService## *
;##* +
}$$ 
public&& 

async&& 
Task&& 
<&& 
ResponseDTO&& !
>&&! "
GetCourseVersions&&# 4
('' 
ClaimsPrincipal(( 
User(( 
,(( 
Guid)) 
?)) 
courseId)) 
,)) 
string** 
?** 
filterOn** 
,** 
string++ 
?++ 
filterQuery++ 
,++ 
string,, 
?,, 
sortBy,, 
,,, 
bool-- 
?-- 
isAscending-- 
,-- 
int.. 

pageNumber.. 
,.. 
int// 
pageSize// 
)00 
{11 
try22 
{33 	
if44 
(44 
string44 
.44 
IsNullOrEmpty44 $
(44$ %
courseId44% -
.44- .
ToString44. 6
(446 7
)447 8
)448 9
)449 :
{55 
return66 
new66 
ResponseDTO66 &
(66& '
)66' (
{77 
Message88 
=88 
$str88 4
,884 5
	IsSuccess99 
=99 
false99  %
,99% &

StatusCode:: 
=::  
$num::! $
,::$ %
Result;; 
=;; 
null;; !
}<< 
;<< 
}== 
var?? 
courseVersions?? 
=??  
_unitOfWork??! ,
.??, -#
CourseVersionRepository??- D
.@@ 
GetAllAsync@@ 
(@@ 
filterAA 
:AA 
xAA 
=>AA  
xAA! "
.AA" #
CourseIdAA# +
==AA, .
courseIdAA/ 7
,AA7 8
includePropertiesBB %
:BB% &
$strBB' 7
)CC 
.DD 

GetAwaiterDD 
(DD 
)DD 
.DD 
	GetResultDD '
(DD' (
)DD( )
.DD) *
ToListDD* 0
(DD0 1
)DD1 2
;DD2 3
ifFF 
(FF 
courseVersionsFF 
.FF 
IsNullOrEmptyFF ,
(FF, -
)FF- .
)FF. /
{GG 
returnHH 
newHH 
ResponseDTOHH &
(HH& '
)HH' (
{II 
MessageJJ 
=JJ 
$strJJ <
,JJ< =
ResultKK 
=KK 
courseVersionsKK +
,KK+ ,
	IsSuccessLL 
=LL 
falseLL  %
,LL% &

StatusCodeMM 
=MM  
$numMM! $
}NN 
;NN 
}OO 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrEmptyRR %
(RR% &
filterOnRR& .
)RR. /
&&RR0 2
!RR3 4
stringRR4 :
.RR: ;
IsNullOrEmptyRR; H
(RRH I
filterQueryRRI T
)RRT U
)RRU V
{SS 
switchTT 
(TT 
filterOnTT  
.TT  !
TrimTT! %
(TT% &
)TT& '
.TT' (
ToLowerTT( /
(TT/ 0
)TT0 1
)TT1 2
{UU 
caseVV 
$strVV  
:VV  !
{WW 
courseVersionsXX &
=XX' (
courseVersionsXX) 7
.XX7 8
WhereXX8 =
(XX= >
xXX> ?
=>XX@ B
xYY 
.YY 
TitleYY #
.YY# $
ContainsYY$ ,
(YY, -
filterQueryYY- 8
,YY8 9
StringComparisonYY: J
.YYJ K$
CurrentCultureIgnoreCaseYYK c
)YYc d
)YYd e
.YYe f
ToListYYf l
(YYl m
)YYm n
;YYn o
breakZZ 
;ZZ 
}[[ 
case\\ 
$str\\ 
:\\  
{]] 
courseVersions^^ &
=^^' (
courseVersions^^) 7
.^^7 8
Where^^8 =
(^^= >
x^^> ?
=>^^@ B
x__ 
.__ 
Code__ "
.__" #
Contains__# +
(__+ ,
filterQuery__, 7
,__7 8
StringComparison__9 I
.__I J$
CurrentCultureIgnoreCase__J b
)__b c
)__c d
.__d e
ToList__e k
(__k l
)__l m
;__m n
break`` 
;`` 
}aa 
casebb 
$strbb &
:bb& '
{cc 
courseVersionsdd &
=dd' (
courseVersionsdd) 7
.dd7 8
Wheredd8 =
(dd= >
xdd> ?
=>dd@ B
xee 
.ee 
Descriptionee )
.ee) *
Containsee* 2
(ee2 3
filterQueryee3 >
,ee> ?
StringComparisonee@ P
.eeP Q$
CurrentCultureIgnoreCaseeeQ i
)eei j
)eej k
.eek l
ToListeel r
(eer s
)ees t
;eet u
breakff 
;ff 
}gg 
casehh 
$strhh !
:hh! "
{ii 
courseVersionsjj &
=jj' (
courseVersionsjj) 7
.jj7 8
Wherejj8 =
(jj= >
xjj> ?
=>jj@ B
xkk 
.kk 
CurrentStatuskk +
==kk, .
intkk/ 2
.kk2 3
Parsekk3 8
(kk8 9
filterQuerykk9 D
.kkD E
TrimkkE I
(kkI J
)kkJ K
)kkK L
)kkL M
.kkM N
ToListkkN T
(kkT U
)kkU V
;kkV W
breakll 
;ll 
}mm 
}nn 
}oo 
ifrr 
(rr 
!rr 
stringrr 
.rr 
IsNullOrEmptyrr %
(rr% &
sortByrr& ,
)rr, -
)rr- .
{ss 
switchtt 
(tt 
sortBytt 
.tt 
Trimtt #
(tt# $
)tt$ %
.tt% &
ToLowertt& -
(tt- .
)tt. /
)tt/ 0
{uu 
casevv 
$strvv  
:vv  !
{ww 
courseVersionsxx &
=xx' (
isAscendingxx) 4
==xx5 7
truexx8 <
?yy 
[yy 
..yy !
courseVersionsyy" 0
.yy0 1
OrderByyy1 8
(yy8 9
xyy9 :
=>yy; =
xyy> ?
.yy? @
Titleyy@ E
)yyE F
]yyF G
:zz 
[zz 
..zz !
courseVersionszz" 0
.zz0 1
OrderByDescendingzz1 B
(zzB C
xzzC D
=>zzE G
xzzH I
.zzI J
TitlezzJ O
)zzO P
]zzP Q
;zzQ R
break{{ 
;{{ 
}|| 
case}} 
$str}} 
:}}  
{~~ 
courseVersions &
=' (
isAscending) 4
==5 7
true8 <
?
ÄÄ 
[
ÄÄ 
..
ÄÄ !
courseVersions
ÄÄ" 0
.
ÄÄ0 1
OrderBy
ÄÄ1 8
(
ÄÄ8 9
x
ÄÄ9 :
=>
ÄÄ; =
x
ÄÄ> ?
.
ÄÄ? @
Code
ÄÄ@ D
)
ÄÄD E
]
ÄÄE F
:
ÅÅ 
[
ÅÅ 
..
ÅÅ !
courseVersions
ÅÅ" 0
.
ÅÅ0 1
OrderByDescending
ÅÅ1 B
(
ÅÅB C
x
ÅÅC D
=>
ÅÅE G
x
ÅÅH I
.
ÅÅI J
Code
ÅÅJ N
)
ÅÅN O
]
ÅÅO P
;
ÅÅP Q
break
ÇÇ 
;
ÇÇ 
}
ÉÉ 
case
ÑÑ 
$str
ÑÑ &
:
ÑÑ& '
{
ÖÖ 
courseVersions
ÜÜ &
=
ÜÜ' (
isAscending
ÜÜ) 4
==
ÜÜ5 7
true
ÜÜ8 <
?
áá 
[
áá 
..
áá !
courseVersions
áá" 0
.
áá0 1
OrderBy
áá1 8
(
áá8 9
x
áá9 :
=>
áá; =
x
áá> ?
.
áá? @
Description
áá@ K
)
ááK L
]
ááL M
:
àà 
[
àà 
..
àà !
courseVersions
àà" 0
.
àà0 1
OrderByDescending
àà1 B
(
ààB C
x
ààC D
=>
ààE G
x
ààH I
.
ààI J
Description
ààJ U
)
ààU V
]
ààV W
;
ààW X
break
ââ 
;
ââ 
}
ää 
case
ãã 
$str
ãã  
:
ãã  !
{
åå 
courseVersions
çç &
=
çç' (
isAscending
çç) 4
==
çç5 7
true
çç8 <
?
éé 
[
éé 
..
éé !
courseVersions
éé" 0
.
éé0 1
OrderBy
éé1 8
(
éé8 9
x
éé9 :
=>
éé; =
x
éé> ?
.
éé? @
Price
éé@ E
)
ééE F
]
ééF G
:
èè 
[
èè 
..
èè !
courseVersions
èè" 0
.
èè0 1
OrderByDescending
èè1 B
(
èèB C
x
èèC D
=>
èèE G
x
èèH I
.
èèI J
Price
èèJ O
)
èèO P
]
èèP Q
;
èèQ R
break
êê 
;
êê 
}
ëë 
default
íí 
:
íí 
{
ìì 
break
îî 
;
îî 
}
ïï 
}
ññ 
}
óó 
if
öö 
(
öö 

pageNumber
öö 
>
öö 
$num
öö 
&&
öö !
pageSize
öö" *
>
öö+ ,
$num
öö- .
)
öö. /
{
õõ 
var
úú 

skipResult
úú 
=
úú  
(
úú! "

pageNumber
úú" ,
-
úú- .
$num
úú/ 0
)
úú0 1
*
úú2 3
pageSize
úú4 <
;
úú< =
courseVersions
ùù 
=
ùù  
courseVersions
ùù! /
.
ùù/ 0
Skip
ùù0 4
(
ùù4 5

skipResult
ùù5 ?
)
ùù? @
.
ùù@ A
Take
ùùA E
(
ùùE F
pageSize
ùùF N
)
ùùN O
.
ùùO P
ToList
ùùP V
(
ùùV W
)
ùùW X
;
ùùX Y
}
ûû 
if
†† 
(
†† 
courseVersions
†† 
.
†† 
IsNullOrEmpty
†† ,
(
††, -
)
††- .
)
††. /
{
°° 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ &
(
¢¢& '
)
¢¢' (
{
££ 
Message
§§ 
=
§§ 
$str
§§ ;
,
§§; <
Result
•• 
=
•• 
courseVersions
•• +
,
••+ ,
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
}
®® 
;
®® 
}
©© 
var
´´ 
courseVersionDto
´´  
=
´´! "
_mapper
´´# *
.
´´* +
Map
´´+ .
<
´´. /
List
´´/ 3
<
´´3 4!
GetCourseVersionDTO
´´4 G
>
´´G H
>
´´H I
(
´´I J
courseVersions
´´J X
)
´´X Y
;
´´Y Z
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ "
(
≠≠" #
)
≠≠# $
{
ÆÆ 
Result
ØØ 
=
ØØ 
courseVersionDto
ØØ )
,
ØØ) *
Message
∞∞ 
=
∞∞ 
$str
∞∞ <
,
∞∞< =
	IsSuccess
±± 
=
±± 
true
±±  
,
±±  !

StatusCode
≤≤ 
=
≤≤ 
$num
≤≤  
}
≥≥ 
;
≥≥ 
}
¥¥ 	
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 	
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ "
(
∑∑" #
)
∑∑# $
{
∏∏ 
Result
ππ 
=
ππ 
null
ππ 
,
ππ 
Message
∫∫ 
=
∫∫ 
e
∫∫ 
.
∫∫ 
Message
∫∫ #
,
∫∫# $
	IsSuccess
ªª 
=
ªª 
false
ªª !
,
ªª! "

StatusCode
ºº 
=
ºº 
$num
ºº  
}
ΩΩ 
;
ΩΩ 
}
ææ 	
}
øø 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
ResponseDTO
¡¡ !
>
¡¡! "
GetCourseVersion
¡¡# 3
(
¬¬ 
ClaimsPrincipal
√√ 
User
√√ 
,
√√ 
Guid
ƒƒ 
courseVersionId
ƒƒ 
)
≈≈ 
{
∆∆ 
try
«« 
{
»» 	
var
…… 
courseVersion
…… 
=
…… 
await
   
_unitOfWork
   !
.
  ! "%
CourseVersionRepository
  " 9
.
  9 :
GetAsync
  : B
(
ÀÀ 
filter
ÃÃ 
:
ÃÃ 
x
ÃÃ 
=>
ÃÃ  
x
ÃÃ! "
.
ÃÃ" #
Id
ÃÃ# %
==
ÃÃ& (
courseVersionId
ÃÃ) 8
,
ÃÃ8 9
includeProperties
ÕÕ %
:
ÕÕ% &
$str
ÕÕ' 7
)
ŒŒ 
;
ŒŒ 
if
–– 
(
–– 
courseVersion
–– 
is
––  
null
––! %
)
––% &
{
—— 
return
““ 
new
““ 
ResponseDTO
““ &
(
““& '
)
““' (
{
”” 
Result
‘‘ 
=
‘‘ 
$str
‘‘ 
,
‘‘  
Message
’’ 
=
’’ 
$str
’’ <
,
’’< =
	IsSuccess
÷÷ 
=
÷÷ 
true
÷÷  $
,
÷÷$ %

StatusCode
◊◊ 
=
◊◊  
$num
◊◊! $
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
var
€€ 
courseVersionDto
€€  
=
€€! "
_mapper
€€# *
.
€€* +
Map
€€+ .
<
€€. /!
GetCourseVersionDTO
€€/ B
>
€€B C
(
€€C D
courseVersion
€€D Q
)
€€Q R
;
€€R S
return
›› 
new
›› 
ResponseDTO
›› "
(
››" #
)
››# $
{
ﬁﬁ 
Result
ﬂﬂ 
=
ﬂﬂ 
courseVersionDto
ﬂﬂ )
,
ﬂﬂ) *
Message
‡‡ 
=
‡‡ 
$str
‡‡ ;
,
‡‡; <
	IsSuccess
·· 
=
·· 
true
··  
,
··  !

StatusCode
‚‚ 
=
‚‚ 
$num
‚‚  
}
„„ 
;
„„ 
}
‰‰ 	
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 	
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ "
(
ÁÁ" #
)
ÁÁ# $
{
ËË 
Result
ÈÈ 
=
ÈÈ 
null
ÈÈ 
,
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
e
ÍÍ 
.
ÍÍ 
Message
ÍÍ #
,
ÍÍ# $
	IsSuccess
ÎÎ 
=
ÎÎ 
false
ÎÎ !
,
ÎÎ! "

StatusCode
ÏÏ 
=
ÏÏ 
$num
ÏÏ  
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 	
}
ÔÔ 
public
ÒÒ 

async
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
ResponseDTO
ÒÒ !
>
ÒÒ! "$
CreateCourseAndVersion
ÒÒ# 9
(
ÚÚ 
ClaimsPrincipal
ÛÛ 
User
ÛÛ 
,
ÛÛ *
CreateNewCourseAndVersionDTO
ÙÙ $*
createNewCourseAndVersionDto
ÙÙ% A
)
ıı 
{
ˆˆ 
try
˜˜ 
{
¯¯ 	
var
˘˘ 
courseVersionId
˘˘ 
=
˘˘  !
Guid
˘˘" &
.
˘˘& '
NewGuid
˘˘' .
(
˘˘. /
)
˘˘/ 0
;
˘˘0 1
var
˙˙ 
response
˙˙ 
=
˙˙ 
await
˙˙  
_courseService
˙˙! /
.
˙˙/ 0
CreateFrameCourse
˙˙0 A
(
˙˙A B
User
˙˙B F
,
˙˙F G
courseVersionId
˙˙H W
)
˙˙W X
;
˙˙X Y
if
˚˚ 
(
˚˚ 
response
˚˚ 
.
˚˚ 
	IsSuccess
˚˚ "
==
˚˚# %
false
˚˚& +
)
˚˚+ ,
{
¸¸ 
return
˝˝ 
response
˝˝ 
;
˝˝  
}
˛˛ 
var
ÄÄ 
course
ÄÄ 
=
ÄÄ 
(
ÄÄ 
Course
ÄÄ  
)
ÄÄ  !
response
ÄÄ! )
.
ÄÄ) *
Result
ÄÄ* 0
!
ÄÄ0 1
;
ÄÄ1 2
var
ÇÇ 
courseVersion
ÇÇ 
=
ÇÇ 
new
ÇÇ  #
CourseVersion
ÇÇ$ 1
(
ÇÇ1 2
)
ÇÇ2 3
{
ÉÉ 
Id
ÑÑ 
=
ÑÑ 
courseVersionId
ÑÑ $
,
ÑÑ$ %
CourseId
ÖÖ 
=
ÖÖ 
course
ÖÖ !
.
ÖÖ! "
Id
ÖÖ" $
,
ÖÖ$ %
Title
ÜÜ 
=
ÜÜ *
createNewCourseAndVersionDto
ÜÜ 4
.
ÜÜ4 5
Title
ÜÜ5 :
,
ÜÜ: ;
Code
áá 
=
áá *
createNewCourseAndVersionDto
áá 3
.
áá3 4
Code
áá4 8
,
áá8 9
Description
àà 
=
àà *
createNewCourseAndVersionDto
àà :
.
àà: ;
Description
àà; F
,
ààF G
LearningTime
ââ 
=
ââ *
createNewCourseAndVersionDto
ââ ;
.
ââ; <
LearningTime
ââ< H
,
ââH I
Price
ää 
=
ää *
createNewCourseAndVersionDto
ää 4
.
ää4 5
Price
ää5 :
,
ää: ;
OldPrice
ãã 
=
ãã 
$num
ãã 
,
ãã 
CourseImgUrl
åå 
=
åå *
createNewCourseAndVersionDto
åå ;
.
åå; <
CourseImgUrl
åå< H
,
ååH I
InstructorId
çç 
=
çç 
course
çç %
.
çç% &
InstructorId
çç& 2
,
çç2 3

CategoryId
éé 
=
éé *
createNewCourseAndVersionDto
éé 9
.
éé9 :

CategoryId
éé: D
,
ééD E
LevelId
èè 
=
èè *
createNewCourseAndVersionDto
èè 6
.
èè6 7
LevelId
èè7 >
,
èè> ?
CurrentStatus
êê 
=
êê 
$num
êê  !
,
êê! "
Version
ëë 
=
ëë 
$num
ëë 
,
ëë 
CreatedTime
íí 
=
íí 
DateTime
íí &
.
íí& '
UtcNow
íí' -
,
íí- .
}
ìì 
;
ìì 
await
ïï 
_unitOfWork
ïï 
.
ïï %
CourseVersionRepository
ïï 5
.
ïï5 6
AddAsync
ïï6 >
(
ïï> ?
courseVersion
ïï? L
)
ïïL M
;
ïïM N
await
ññ 
_unitOfWork
ññ 
.
ññ 
	SaveAsync
ññ '
(
ññ' (
)
ññ( )
;
ññ) *
var
ôô 
responseDto
ôô 
=
ôô 
await
ôô #)
_courseVersionStatusService
ôô$ ?
.
ôô? @'
CreateCourseVersionStatus
ôô@ Y
(
öö 
User
õõ 
,
õõ 
new
úú *
CreateCourseVersionStatusDTO
úú 0
(
úú0 1
)
úú1 2
{
ùù 
CourseVersionId
ûû #
=
ûû$ %
courseVersion
ûû& 3
.
ûû3 4
Id
ûû4 6
,
ûû6 7
Status
üü 
=
üü '
StaticCourseVersionStatus
üü 6
.
üü6 7
New
üü7 :
}
†† 
)
°° 
;
°° 
if
££ 
(
££ 
responseDto
££ 
.
££ 
	IsSuccess
££ %
is
££& (
false
££) .
)
££. /
{
§§ 
return
•• 
responseDto
•• "
;
••" #
}
¶¶ 
return
®® 
new
®® 
ResponseDTO
®® "
(
®®" #
)
®®# $
{
©© 
Result
™™ 
=
™™ 
courseVersion
™™ &
.
™™& '
Id
™™' )
,
™™) *
Message
´´ 
=
´´ 
$str
´´ M
,
´´M N
	IsSuccess
¨¨ 
=
¨¨ 
true
¨¨  
,
¨¨  !

StatusCode
≠≠ 
=
≠≠ 
$num
≠≠  
}
ÆÆ 
;
ÆÆ 
}
ØØ 	
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 	
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Result
¥¥ 
=
¥¥ 
null
¥¥ 
,
¥¥ 
	IsSuccess
µµ 
=
µµ 
false
µµ !
,
µµ! "
Message
∂∂ 
=
∂∂ 
e
∂∂ 
.
∂∂ 
Message
∂∂ #
,
∂∂# $

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
}
∏∏ 
;
∏∏ 
}
ππ 	
}
∫∫ 
public
ºº 

async
ºº 
Task
ºº 
<
ºº 
ResponseDTO
ºº !
>
ºº! " 
CloneCourseVersion
ºº# 5
(
ΩΩ 
ClaimsPrincipal
ææ 
User
ææ 
,
ææ #
CloneCourseVersionDTO
øø #
cloneCourseVersionDto
øø 3
)
¿¿ 
{
¡¡ 
try
¬¬ 
{
√√ 	
var
≈≈ 
courseVersion
≈≈ 
=
≈≈ 
await
∆∆ 
_unitOfWork
∆∆ !
.
∆∆! "%
CourseVersionRepository
∆∆" 9
.
∆∆9 :#
GetCourseVersionAsync
∆∆: O
(
«« #
cloneCourseVersionDto
»» )
.
»») *
CourseVersionId
»»* 9
,
»»9 :
asNoTracking
……  
:
……  !
true
……" &
)
   
;
   
if
ÃÃ 
(
ÃÃ 
courseVersion
ÃÃ 
is
ÃÃ  
null
ÃÃ! %
)
ÃÃ% &
{
ÕÕ 
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ &
(
ŒŒ& '
)
ŒŒ' (
{
œœ 
Result
–– 
=
–– 
null
–– !
,
––! "
	IsSuccess
—— 
=
—— 
false
——  %
,
——% &
Message
““ 
=
““ 
$str
““ =
,
““= >

StatusCode
”” 
=
””  
$num
””! $
,
””$ %
}
‘‘ 
;
‘‘ 
}
’’ 
var
ÿÿ *
cloneCourseSectionVersionDto
ÿÿ ,
=
ÿÿ- .
new
ÿÿ/ 2*
CloneCourseSectionVersionDTO
ÿÿ3 O
(
ÿÿO P
)
ÿÿP Q
{
ŸŸ  
NewCourseVersionId
⁄⁄ "
=
⁄⁄# $
Guid
⁄⁄% )
.
⁄⁄) *
NewGuid
⁄⁄* 1
(
⁄⁄1 2
)
⁄⁄2 3
,
⁄⁄3 4 
OldCourseVersionId
€€ "
=
€€# $
courseVersion
€€% 2
.
€€2 3
Id
€€3 5
}
‹‹ 
;
‹‹ 
courseVersion
ﬁﬁ 
.
ﬁﬁ 
Id
ﬁﬁ 
=
ﬁﬁ *
cloneCourseSectionVersionDto
ﬁﬁ ;
.
ﬁﬁ; < 
NewCourseVersionId
ﬁﬁ< N
;
ﬁﬁN O
courseVersion
ﬂﬂ 
.
ﬂﬂ 
CurrentStatus
ﬂﬂ '
=
ﬂﬂ( )'
StaticCourseVersionStatus
ﬂﬂ* C
.
ﬂﬂC D
New
ﬂﬂD G
;
ﬂﬂG H
courseVersion
‡‡ 
.
‡‡ 
Version
‡‡ !
=
‡‡" #
await
·· 
_unitOfWork
·· !
.
··! "%
CourseVersionRepository
··" 9
.
··9 :)
GetTotalCourseVersionsAsync
··: U
(
··U V
courseVersion
··V c
.
··c d
CourseId
··d l
)
··l m
+
··n o
$num
··p q
;
··q r
await
„„ 
_unitOfWork
„„ 
.
„„ %
CourseVersionRepository
„„ 5
.
„„5 6
AddAsync
„„6 >
(
„„> ?
courseVersion
„„? L
)
„„L M
;
„„M N
await
‰‰ 
_unitOfWork
‰‰ 
.
‰‰ 
	SaveAsync
‰‰ '
(
‰‰' (
)
‰‰( )
;
‰‰) *
var
ÁÁ 
responseDto
ÁÁ 
=
ÁÁ 
await
ËË *
_courseSectionVersionService
ËË 2
.
ËË2 3'
CloneCourseSectionVersion
ËË3 L
(
ÈÈ 
User
ÍÍ 
,
ÍÍ *
cloneCourseSectionVersionDto
ÎÎ 0
)
ÏÏ 
;
ÏÏ 
if
ÌÌ 
(
ÌÌ 
responseDto
ÌÌ 
.
ÌÌ 

StatusCode
ÌÌ &
==
ÌÌ' )
$num
ÌÌ* -
)
ÌÌ- .
{
ÓÓ 
return
ÔÔ 
responseDto
ÔÔ "
;
ÔÔ" #
}
 
responseDto
ÛÛ 
=
ÛÛ 
await
ÛÛ )
_courseVersionStatusService
ÛÛ  ;
.
ÛÛ; <'
CreateCourseVersionStatus
ÛÛ< U
(
ÙÙ 
User
ıı 
,
ıı 
new
ˆˆ *
CreateCourseVersionStatusDTO
ˆˆ 0
(
ˆˆ0 1
)
ˆˆ1 2
{
˜˜ 
CourseVersionId
¯¯ #
=
¯¯$ %
courseVersion
¯¯& 3
.
¯¯3 4
Id
¯¯4 6
,
¯¯6 7
Status
˘˘ 
=
˘˘ '
StaticCourseVersionStatus
˘˘ 6
.
˘˘6 7
New
˘˘7 :
}
˙˙ 
)
˚˚ 
;
˚˚ 
if
˝˝ 
(
˝˝ 
responseDto
˝˝ 
.
˝˝ 
	IsSuccess
˝˝ %
is
˝˝& (
false
˝˝) .
)
˝˝. /
{
˛˛ 
return
ˇˇ 
responseDto
ˇˇ "
;
ˇˇ" #
}
ÄÄ 
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ "
(
ÇÇ" #
)
ÇÇ# $
{
ÉÉ 
Result
ÑÑ 
=
ÑÑ 
null
ÑÑ 
,
ÑÑ 
	IsSuccess
ÖÖ 
=
ÖÖ 
true
ÖÖ  
,
ÖÖ  !
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ A
,
ÜÜA B

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 	
return
åå 
new
åå 
ResponseDTO
åå "
(
åå" #
)
åå# $
{
çç 
Result
éé 
=
éé 
null
éé 
,
éé 
	IsSuccess
èè 
=
èè 
false
èè !
,
èè! "
Message
êê 
=
êê 
e
êê 
.
êê 
Message
êê #
,
êê# $

StatusCode
ëë 
=
ëë 
$num
ëë  
}
íí 
;
íí 
}
ìì 	
}
îî 
public
ññ 

async
ññ 
Task
ññ 
<
ññ 
ResponseDTO
ññ !
>
ññ! "
EditCourseVersion
ññ# 4
(
ññ4 5
ClaimsPrincipal
ññ5 D
User
ññE I
,
ññI J"
EditCourseVersionDTO
ññK _"
editCourseVersionDto
ññ` t
)
ññt u
{
óó 
try
òò 
{
ôô 	
var
öö 
courseVersion
öö 
=
öö 
await
õõ 
_unitOfWork
õõ !
.
õõ! "%
CourseVersionRepository
õõ" 9
.
õõ9 :
GetAsync
õõ: B
(
õõB C
x
õõC D
=>
õõE G
x
õõH I
.
õõI J
Id
õõJ L
==
õõM O"
editCourseVersionDto
õõP d
.
õõd e
Id
õõe g
)
õõg h
;
õõh i
if
ùù 
(
ùù 
courseVersion
ùù 
is
ùù  
null
ùù! %
)
ùù% &
{
ûû 
return
üü 
new
üü 
ResponseDTO
üü &
(
üü& '
)
üü' (
{
†† 
Message
°° 
=
°° 
$str
°° <
,
°°< =

StatusCode
¢¢ 
=
¢¢  
$num
¢¢! $
,
¢¢$ %
	IsSuccess
££ 
=
££ 
false
££  %
,
££% &
Result
§§ 
=
§§ 
null
§§ !
}
•• 
;
•• 
}
¶¶ 
switch
®® 
(
®® 
courseVersion
®® !
.
®®! "
CurrentStatus
®®" /
)
®®/ 0
{
©© 
case
™™ '
StaticCourseVersionStatus
™™ .
.
™™. /
New
™™/ 2
:
™™2 3
{
´´ 
break
¨¨ 
;
¨¨ 
}
≠≠ 
case
ÆÆ '
StaticCourseVersionStatus
ÆÆ .
.
ÆÆ. /
	Submitted
ÆÆ/ 8
:
ÆÆ8 9
{
ØØ 
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ *
(
∞∞* +
)
∞∞+ ,
{
±± 
Message
≤≤ 
=
≤≤  !
$str
≤≤" E
,
≤≤E F
	IsSuccess
≥≥ !
=
≥≥" #
false
≥≥$ )
,
≥≥) *

StatusCode
¥¥ "
=
¥¥# $
$num
¥¥% (
,
¥¥( )
Result
µµ 
=
µµ  
null
µµ! %
}
∂∂ 
;
∂∂ 
}
∑∑ 
case
∏∏ '
StaticCourseVersionStatus
∏∏ .
.
∏∏. /
Accepted
∏∏/ 7
:
∏∏7 8
{
ππ 
break
∫∫ 
;
∫∫ 
}
ªª 
case
ºº '
StaticCourseVersionStatus
ºº .
.
ºº. /
Rejected
ºº/ 7
:
ºº7 8
{
ΩΩ 
break
ææ 
;
ææ 
}
øø 
case
¿¿ '
StaticCourseVersionStatus
¿¿ .
.
¿¿. /
Merged
¿¿/ 5
:
¿¿5 6
{
¡¡ 
return
¬¬ 
new
¬¬ 
ResponseDTO
¬¬ *
(
¬¬* +
)
¬¬+ ,
{
√√ 
Message
ƒƒ 
=
ƒƒ  !
$str
ƒƒ" B
,
ƒƒB C
	IsSuccess
≈≈ !
=
≈≈" #
false
≈≈$ )
,
≈≈) *

StatusCode
∆∆ "
=
∆∆# $
$num
∆∆% (
,
∆∆( )
Result
«« 
=
««  
null
««! %
}
»» 
;
»» 
}
…… 
case
   '
StaticCourseVersionStatus
   .
.
  . /
Removed
  / 6
:
  6 7
{
ÀÀ 
return
ÃÃ 
new
ÃÃ 
ResponseDTO
ÃÃ *
(
ÃÃ* +
)
ÃÃ+ ,
{
ÕÕ 
Message
ŒŒ 
=
ŒŒ  !
$str
ŒŒ" C
,
ŒŒC D
	IsSuccess
œœ !
=
œœ" #
false
œœ$ )
,
œœ) *

StatusCode
–– "
=
––# $
$num
––% (
,
––( )
Result
—— 
=
——  
null
——! %
}
““ 
;
““ 
}
”” 
}
‘‘ 
courseVersion
÷÷ 
.
÷÷ 

CategoryId
÷÷ $
=
÷÷% &"
editCourseVersionDto
÷÷' ;
.
÷÷; <

CategoryId
÷÷< F
;
÷÷F G
courseVersion
◊◊ 
.
◊◊ 
LevelId
◊◊ !
=
◊◊" #"
editCourseVersionDto
◊◊$ 8
.
◊◊8 9
LevelId
◊◊9 @
;
◊◊@ A
courseVersion
ÿÿ 
.
ÿÿ 
Title
ÿÿ 
=
ÿÿ  !"
editCourseVersionDto
ÿÿ" 6
.
ÿÿ6 7
Title
ÿÿ7 <
;
ÿÿ< =
courseVersion
ŸŸ 
.
ŸŸ 
Code
ŸŸ 
=
ŸŸ  "
editCourseVersionDto
ŸŸ! 5
.
ŸŸ5 6
Code
ŸŸ6 :
;
ŸŸ: ;
courseVersion
⁄⁄ 
.
⁄⁄ 
Description
⁄⁄ %
=
⁄⁄& '"
editCourseVersionDto
⁄⁄( <
.
⁄⁄< =
Description
⁄⁄= H
;
⁄⁄H I
courseVersion
€€ 
.
€€ 
LearningTime
€€ &
=
€€' ("
editCourseVersionDto
€€) =
.
€€= >
LearningTime
€€> J
;
€€J K
courseVersion
‹‹ 
.
‹‹ 
Price
‹‹ 
=
‹‹  !"
editCourseVersionDto
‹‹" 6
.
‹‹6 7
Price
‹‹7 <
;
‹‹< =
courseVersion
›› 
.
›› 
CourseImgUrl
›› &
=
››' ("
editCourseVersionDto
››) =
.
››= >
CourseImgUrl
››> J
;
››J K
_unitOfWork
ﬂﬂ 
.
ﬂﬂ %
CourseVersionRepository
ﬂﬂ /
.
ﬂﬂ/ 0
Update
ﬂﬂ0 6
(
ﬂﬂ6 7
courseVersion
ﬂﬂ7 D
)
ﬂﬂD E
;
ﬂﬂE F
await
‡‡ 
_unitOfWork
‡‡ 
.
‡‡ 
	SaveAsync
‡‡ '
(
‡‡' (
)
‡‡( )
;
‡‡) *
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
(
‚‚" #
)
‚‚# $
{
„„ 
Message
‰‰ 
=
‰‰ 
$str
‰‰ >
,
‰‰> ?
	IsSuccess
ÂÂ 
=
ÂÂ 
true
ÂÂ  
,
ÂÂ  !

StatusCode
ÊÊ 
=
ÊÊ 
$num
ÊÊ  
,
ÊÊ  !
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ 
}
ËË 
;
ËË 
}
ÈÈ 	
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 	
return
ÏÏ 
new
ÏÏ 
ResponseDTO
ÏÏ "
(
ÏÏ" #
)
ÏÏ# $
{
ÌÌ 
Result
ÓÓ 
=
ÓÓ 
null
ÓÓ 
,
ÓÓ 
	IsSuccess
ÔÔ 
=
ÔÔ 
false
ÔÔ !
,
ÔÔ! "
Message
 
=
 
e
 
.
 
Message
 #
,
# $

StatusCode
ÒÒ 
=
ÒÒ 
$num
ÒÒ  
}
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
}
ÙÙ 
public
ˆˆ 

async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
ResponseDTO
ˆˆ !
>
ˆˆ! "!
RemoveCourseVersion
ˆˆ# 6
(
˜˜ 
ClaimsPrincipal
¯¯ 
User
¯¯ 
,
¯¯ 
Guid
˘˘ 
courseVersionId
˘˘ 
)
˙˙ 
{
˚˚ 
try
¸¸ 
{
˝˝ 	
var
˛˛ 
courseVersion
˛˛ 
=
˛˛ 
await
˛˛  %
_unitOfWork
˛˛& 1
.
˛˛1 2%
CourseVersionRepository
˛˛2 I
.
˛˛I J
GetAsync
˛˛J R
(
˛˛R S
x
˛˛S T
=>
˛˛U W
x
˛˛X Y
.
˛˛Y Z
Id
˛˛Z \
==
˛˛] _
courseVersionId
˛˛` o
)
˛˛o p
;
˛˛p q
if
ÄÄ 
(
ÄÄ 
courseVersion
ÄÄ 
is
ÄÄ  
null
ÄÄ! %
)
ÄÄ% &
{
ÅÅ 
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ &
(
ÇÇ& '
)
ÇÇ' (
{
ÉÉ 
Result
ÑÑ 
=
ÑÑ 
null
ÑÑ !
,
ÑÑ! "
	IsSuccess
ÖÖ 
=
ÖÖ 
false
ÖÖ  %
,
ÖÖ% &
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ <
,
ÜÜ< =

StatusCode
áá 
=
áá  
$num
áá! $
}
àà 
;
àà 
}
ââ 
switch
ãã 
(
ãã 
courseVersion
ãã !
.
ãã! "
CurrentStatus
ãã" /
)
ãã/ 0
{
åå 
case
çç '
StaticCourseVersionStatus
çç .
.
çç. /
	Submitted
çç/ 8
:
çç8 9
{
éé 
return
èè 
new
èè 
ResponseDTO
èè *
(
èè* +
)
èè+ ,
{
êê 
Message
ëë 
=
ëë  !
$str
ëë" F
,
ëëF G

StatusCode
íí "
=
íí# $
$num
íí% (
,
íí( )
	IsSuccess
ìì !
=
ìì" #
false
ìì$ )
,
ìì) *
Result
îî 
=
îî  
null
îî! %
}
ïï 
;
ïï 
}
ññ 
case
óó '
StaticCourseVersionStatus
óó .
.
óó. /
Merged
óó/ 5
:
óó5 6
{
òò 
return
ôô 
new
ôô 
ResponseDTO
ôô *
(
ôô* +
)
ôô+ ,
{
öö 
Message
õõ 
=
õõ  !
$str
õõ" C
,
õõC D

StatusCode
úú "
=
úú# $
$num
úú% (
,
úú( )
	IsSuccess
ùù !
=
ùù" #
false
ùù$ )
,
ùù) *
Result
ûû 
=
ûû  
null
ûû! %
}
üü 
;
üü 
}
†† 
case
°° '
StaticCourseVersionStatus
°° .
.
°°. /
Removed
°°/ 6
:
°°6 7
{
¢¢ 
return
££ 
new
££ 
ResponseDTO
££ *
(
££* +
)
££+ ,
{
§§ 
Message
•• 
=
••  !
$str
••" D
,
••D E

StatusCode
¶¶ "
=
¶¶# $
$num
¶¶% (
,
¶¶( )
	IsSuccess
ßß !
=
ßß" #
false
ßß$ )
,
ßß) *
Result
®® 
=
®®  
null
®®! %
}
©© 
;
©© 
}
™™ 
default
´´ 
:
´´ 
{
¨¨ 
courseVersion
≠≠ !
.
≠≠! "
CurrentStatus
≠≠" /
=
≠≠0 1'
StaticCourseVersionStatus
≠≠2 K
.
≠≠K L
Removed
≠≠L S
;
≠≠S T
break
ÆÆ 
;
ÆÆ 
}
ØØ 
}
∞∞ 
_unitOfWork
≤≤ 
.
≤≤ %
CourseVersionRepository
≤≤ /
.
≤≤/ 0
Update
≤≤0 6
(
≤≤6 7
courseVersion
≤≤7 D
)
≤≤D E
;
≤≤E F
var
¥¥ 
responseDto
¥¥ 
=
¥¥ 
await
¥¥ #)
_courseVersionStatusService
¥¥$ ?
.
¥¥? @'
CreateCourseVersionStatus
¥¥@ Y
(
µµ 
User
∂∂ 
,
∂∂ 
new
∑∑ *
CreateCourseVersionStatusDTO
∑∑ 0
(
∑∑0 1
)
∑∑1 2
{
∏∏ 
CourseVersionId
ππ #
=
ππ$ %
courseVersion
ππ& 3
.
ππ3 4
Id
ππ4 6
,
ππ6 7
Status
∫∫ 
=
∫∫ '
StaticCourseVersionStatus
∫∫ 6
.
∫∫6 7
Removed
∫∫7 >
}
ªª 
)
ºº 
;
ºº 
if
ææ 
(
ææ 
responseDto
ææ 
.
ææ 

StatusCode
ææ &
==
ææ' )
$num
ææ* -
)
ææ- .
{
øø 
return
¿¿ 
responseDto
¿¿ "
;
¿¿" #
}
¡¡ 
return
√√ 
new
√√ 
ResponseDTO
√√ "
(
√√" #
)
√√# $
{
ƒƒ 
Result
≈≈ 
=
≈≈ 
null
≈≈ 
,
≈≈ 
	IsSuccess
∆∆ 
=
∆∆ 
true
∆∆  
,
∆∆  !
Message
«« 
=
«« 
$str
«« >
,
««> ?

StatusCode
»» 
=
»» 
$num
»»  
}
…… 
;
…… 
}
   	
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
e
ÀÀ 
)
ÀÀ 
{
ÃÃ 	
return
ÕÕ 
new
ÕÕ 
ResponseDTO
ÕÕ "
(
ÕÕ" #
)
ÕÕ# $
{
ŒŒ 
Result
œœ 
=
œœ 
null
œœ 
,
œœ 
	IsSuccess
–– 
=
–– 
false
–– !
,
––! "
Message
—— 
=
—— 
e
—— 
.
—— 
Message
—— #
,
——# $

StatusCode
““ 
=
““ 
$num
““  
}
”” 
;
”” 
}
‘‘ 	
}
’’ 
public
◊◊ 

async
◊◊ 
Task
◊◊ 
<
◊◊ 
ResponseDTO
◊◊ !
>
◊◊! "!
AcceptCourseVersion
◊◊# 6
(
ÿÿ 
ClaimsPrincipal
ŸŸ 
User
ŸŸ 
,
ŸŸ 
Guid
⁄⁄ 
courseVersionId
⁄⁄ 
)
€€ 
{
‹‹ 
try
›› 
{
ﬁﬁ 	
var
ﬂﬂ 
courseVersion
ﬂﬂ 
=
ﬂﬂ 
await
ﬂﬂ  %
_unitOfWork
ﬂﬂ& 1
.
ﬂﬂ1 2%
CourseVersionRepository
ﬂﬂ2 I
.
ﬂﬂI J
GetAsync
ﬂﬂJ R
(
ﬂﬂR S
x
ﬂﬂS T
=>
ﬂﬂU W
x
ﬂﬂX Y
.
ﬂﬂY Z
Id
ﬂﬂZ \
==
ﬂﬂ] _
courseVersionId
ﬂﬂ` o
)
ﬂﬂo p
;
ﬂﬂp q
if
·· 
(
·· 
courseVersion
·· 
is
··  
null
··! %
)
··% &
{
‚‚ 
return
„„ 
new
„„ 
ResponseDTO
„„ &
(
„„& '
)
„„' (
{
‰‰ 
Result
ÂÂ 
=
ÂÂ 
null
ÂÂ !
,
ÂÂ! "
	IsSuccess
ÊÊ 
=
ÊÊ 
false
ÊÊ  %
,
ÊÊ% &
Message
ÁÁ 
=
ÁÁ 
$str
ÁÁ <
,
ÁÁ< =

StatusCode
ËË 
=
ËË  
$num
ËË! $
}
ÈÈ 
;
ÈÈ 
}
ÍÍ 
switch
ÏÏ 
(
ÏÏ 
courseVersion
ÏÏ !
.
ÏÏ! "
CurrentStatus
ÏÏ" /
)
ÏÏ/ 0
{
ÌÌ 
case
ÓÓ '
StaticCourseVersionStatus
ÓÓ .
.
ÓÓ. /
New
ÓÓ/ 2
:
ÓÓ2 3
{
ÔÔ 
return
 
new
 
ResponseDTO
 *
(
* +
)
+ ,
{
ÒÒ 
Message
ÚÚ 
=
ÚÚ  !
$str
ÚÚ" G
,
ÚÚG H

StatusCode
ÛÛ "
=
ÛÛ# $
$num
ÛÛ% (
,
ÛÛ( )
	IsSuccess
ÙÙ !
=
ÙÙ" #
false
ÙÙ$ )
,
ÙÙ) *
Result
ıı 
=
ıı  
null
ıı! %
}
ˆˆ 
;
ˆˆ 
}
˜˜ 
case
¯¯ '
StaticCourseVersionStatus
¯¯ .
.
¯¯. /
Accepted
¯¯/ 7
:
¯¯7 8
{
˘˘ 
return
˙˙ 
new
˙˙ 
ResponseDTO
˙˙ *
(
˙˙* +
)
˙˙+ ,
{
˚˚ 
Message
¸¸ 
=
¸¸  !
$str
¸¸" E
,
¸¸E F

StatusCode
˝˝ "
=
˝˝# $
$num
˝˝% (
,
˝˝( )
	IsSuccess
˛˛ !
=
˛˛" #
false
˛˛$ )
,
˛˛) *
Result
ˇˇ 
=
ˇˇ  
null
ˇˇ! %
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
case
ÇÇ '
StaticCourseVersionStatus
ÇÇ .
.
ÇÇ. /
Merged
ÇÇ/ 5
:
ÇÇ5 6
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ *
(
ÑÑ* +
)
ÑÑ+ ,
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ  !
$str
ÜÜ" C
,
ÜÜC D

StatusCode
áá "
=
áá# $
$num
áá% (
,
áá( )
	IsSuccess
àà !
=
àà" #
false
àà$ )
,
àà) *
Result
ââ 
=
ââ  
null
ââ! %
}
ää 
;
ää 
}
ãã 
case
åå '
StaticCourseVersionStatus
åå .
.
åå. /
Removed
åå/ 6
:
åå6 7
{
çç 
return
éé 
new
éé 
ResponseDTO
éé *
(
éé* +
)
éé+ ,
{
èè 
Message
êê 
=
êê  !
$str
êê" D
,
êêD E

StatusCode
ëë "
=
ëë# $
$num
ëë% (
,
ëë( )
	IsSuccess
íí !
=
íí" #
false
íí$ )
,
íí) *
Result
ìì 
=
ìì  
null
ìì! %
}
îî 
;
îî 
}
ïï 
default
ññ 
:
ññ 
{
óó 
courseVersion
òò !
.
òò! "
CurrentStatus
òò" /
=
òò0 1'
StaticCourseVersionStatus
òò2 K
.
òòK L
Accepted
òòL T
;
òòT U
break
ôô 
;
ôô 
}
öö 
}
õõ 
_unitOfWork
ùù 
.
ùù %
CourseVersionRepository
ùù /
.
ùù/ 0
Update
ùù0 6
(
ùù6 7
courseVersion
ùù7 D
)
ùùD E
;
ùùE F
var
üü 
responseDto
üü 
=
üü 
await
üü #)
_courseVersionStatusService
üü$ ?
.
üü? @'
CreateCourseVersionStatus
üü@ Y
(
†† 
User
°° 
,
°° 
new
¢¢ *
CreateCourseVersionStatusDTO
¢¢ 0
(
¢¢0 1
)
¢¢1 2
{
££ 
CourseVersionId
§§ #
=
§§$ %
courseVersion
§§& 3
.
§§3 4
Id
§§4 6
,
§§6 7
Status
•• 
=
•• '
StaticCourseVersionStatus
•• 6
.
••6 7
Accepted
••7 ?
}
¶¶ 
)
ßß 
;
ßß 
if
©© 
(
©© 
responseDto
©© 
.
©© 

StatusCode
©© &
==
©©' )
$num
©©* -
)
©©- .
{
™™ 
return
´´ 
responseDto
´´ "
;
´´" #
}
¨¨ 
BackgroundJob
ÆÆ 
.
ÆÆ 
Enqueue
ÆÆ !
<
ÆÆ! "
IEmailSender
ÆÆ" .
>
ÆÆ. /
(
ÆÆ/ 0
job
ÆÆ0 3
=>
ÆÆ4 6
job
ÆÆ7 :
.
ÆÆ: ;2
$SendAcceptedCourseEmailForInstructor
ÆÆ; _
(
ÆÆ_ `
courseVersionId
ÆÆ` o
)
ÆÆo p
)
ÆÆp q
;
ÆÆq r
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ "
(
∞∞" #
)
∞∞# $
{
±± 
Result
≤≤ 
=
≤≤ 
null
≤≤ 
,
≤≤ 
	IsSuccess
≥≥ 
=
≥≥ 
true
≥≥  
,
≥≥  !
Message
¥¥ 
=
¥¥ 
$str
¥¥ >
,
¥¥> ?

StatusCode
µµ 
=
µµ 
$num
µµ  
}
∂∂ 
;
∂∂ 
}
∑∑ 	
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 	
return
∫∫ 
new
∫∫ 
ResponseDTO
∫∫ "
(
∫∫" #
)
∫∫# $
{
ªª 
Result
ºº 
=
ºº 
null
ºº 
,
ºº 
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ !
,
ΩΩ! "
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $

StatusCode
øø 
=
øø 
$num
øø  
}
¿¿ 
;
¿¿ 
}
¡¡ 	
}
¬¬ 
public
ƒƒ 

async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
ResponseDTO
ƒƒ !
>
ƒƒ! "!
RejectCourseVersion
ƒƒ# 6
(
≈≈ 
ClaimsPrincipal
∆∆ 
User
∆∆ 
,
∆∆ 
Guid
«« 
courseVersionId
«« 
)
»» 
{
…… 
try
   
{
ÀÀ 	
var
ÃÃ 
courseVersion
ÃÃ 
=
ÃÃ 
await
ÃÃ  %
_unitOfWork
ÃÃ& 1
.
ÃÃ1 2%
CourseVersionRepository
ÃÃ2 I
.
ÃÃI J
GetAsync
ÃÃJ R
(
ÃÃR S
x
ÃÃS T
=>
ÃÃU W
x
ÃÃX Y
.
ÃÃY Z
Id
ÃÃZ \
==
ÃÃ] _
courseVersionId
ÃÃ` o
)
ÃÃo p
;
ÃÃp q
if
ŒŒ 
(
ŒŒ 
courseVersion
ŒŒ 
is
ŒŒ  
null
ŒŒ! %
)
ŒŒ% &
{
œœ 
return
–– 
new
–– 
ResponseDTO
–– &
(
––& '
)
––' (
{
—— 
Result
““ 
=
““ 
null
““ !
,
““! "
	IsSuccess
”” 
=
”” 
false
””  %
,
””% &
Message
‘‘ 
=
‘‘ 
$str
‘‘ <
,
‘‘< =

StatusCode
’’ 
=
’’  
$num
’’! $
}
÷÷ 
;
÷÷ 
}
◊◊ 
switch
ŸŸ 
(
ŸŸ 
courseVersion
ŸŸ !
.
ŸŸ! "
CurrentStatus
ŸŸ" /
)
ŸŸ/ 0
{
⁄⁄ 
case
€€ '
StaticCourseVersionStatus
€€ .
.
€€. /
New
€€/ 2
:
€€2 3
{
‹‹ 
return
›› 
new
›› 
ResponseDTO
›› *
(
››* +
)
››+ ,
{
ﬁﬁ 
Message
ﬂﬂ 
=
ﬂﬂ  !
$str
ﬂﬂ" G
,
ﬂﬂG H

StatusCode
‡‡ "
=
‡‡# $
$num
‡‡% (
,
‡‡( )
	IsSuccess
·· !
=
··" #
false
··$ )
,
··) *
Result
‚‚ 
=
‚‚  
null
‚‚! %
}
„„ 
;
„„ 
}
‰‰ 
case
ÂÂ '
StaticCourseVersionStatus
ÂÂ .
.
ÂÂ. /
Accepted
ÂÂ/ 7
:
ÂÂ7 8
{
ÊÊ 
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ *
(
ÁÁ* +
)
ÁÁ+ ,
{
ËË 
Message
ÈÈ 
=
ÈÈ  !
$str
ÈÈ" E
,
ÈÈE F

StatusCode
ÍÍ "
=
ÍÍ# $
$num
ÍÍ% (
,
ÍÍ( )
	IsSuccess
ÎÎ !
=
ÎÎ" #
false
ÎÎ$ )
,
ÎÎ) *
Result
ÏÏ 
=
ÏÏ  
null
ÏÏ! %
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 
case
ÔÔ '
StaticCourseVersionStatus
ÔÔ .
.
ÔÔ. /
Merged
ÔÔ/ 5
:
ÔÔ5 6
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ *
(
ÒÒ* +
)
ÒÒ+ ,
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ  !
$str
ÛÛ" C
,
ÛÛC D

StatusCode
ÙÙ "
=
ÙÙ# $
$num
ÙÙ% (
,
ÙÙ( )
	IsSuccess
ıı !
=
ıı" #
false
ıı$ )
,
ıı) *
Result
ˆˆ 
=
ˆˆ  
null
ˆˆ! %
}
˜˜ 
;
˜˜ 
}
¯¯ 
case
˘˘ '
StaticCourseVersionStatus
˘˘ .
.
˘˘. /
Removed
˘˘/ 6
:
˘˘6 7
{
˙˙ 
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ *
(
˚˚* +
)
˚˚+ ,
{
¸¸ 
Message
˝˝ 
=
˝˝  !
$str
˝˝" D
,
˝˝D E

StatusCode
˛˛ "
=
˛˛# $
$num
˛˛% (
,
˛˛( )
	IsSuccess
ˇˇ !
=
ˇˇ" #
false
ˇˇ$ )
,
ˇˇ) *
Result
ÄÄ 
=
ÄÄ  
null
ÄÄ! %
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 
default
ÉÉ 
:
ÉÉ 
{
ÑÑ 
courseVersion
ÖÖ !
.
ÖÖ! "
CurrentStatus
ÖÖ" /
=
ÖÖ0 1'
StaticCourseVersionStatus
ÖÖ2 K
.
ÖÖK L
Rejected
ÖÖL T
;
ÖÖT U
break
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 
_unitOfWork
ää 
.
ää %
CourseVersionRepository
ää /
.
ää/ 0
Update
ää0 6
(
ää6 7
courseVersion
ää7 D
)
ääD E
;
ääE F
var
åå 
responseDto
åå 
=
åå 
await
åå #)
_courseVersionStatusService
åå$ ?
.
åå? @'
CreateCourseVersionStatus
åå@ Y
(
çç 
User
éé 
,
éé 
new
èè *
CreateCourseVersionStatusDTO
èè 0
(
èè0 1
)
èè1 2
{
êê 
CourseVersionId
ëë #
=
ëë$ %
courseVersion
ëë& 3
.
ëë3 4
Id
ëë4 6
,
ëë6 7
Status
íí 
=
íí '
StaticCourseVersionStatus
íí 6
.
íí6 7
Rejected
íí7 ?
}
ìì 
)
îî 
;
îî 
if
ññ 
(
ññ 
responseDto
ññ 
.
ññ 

StatusCode
ññ &
==
ññ' )
$num
ññ* -
)
ññ- .
{
óó 
return
òò 
responseDto
òò "
;
òò" #
}
ôô 
BackgroundJob
õõ 
.
õõ 
Enqueue
õõ !
<
õõ! "
IEmailSender
õõ" .
>
õõ. /
(
õõ/ 0
job
õõ0 3
=>
õõ4 6
job
õõ7 :
.
õõ: ;2
$SendRejectedCourseEmailForInstructor
õõ; _
(
õõ_ `
courseVersionId
õõ` o
)
õõo p
)
õõp q
;
õõq r
return
ùù 
new
ùù 
ResponseDTO
ùù "
(
ùù" #
)
ùù# $
{
ûû 
Result
üü 
=
üü 
null
üü 
,
üü 
	IsSuccess
†† 
=
†† 
true
††  
,
††  !
Message
°° 
=
°° 
$str
°° >
,
°°> ?

StatusCode
¢¢ 
=
¢¢ 
$num
¢¢  
}
££ 
;
££ 
}
§§ 	
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 	
return
ßß 
new
ßß 
ResponseDTO
ßß "
(
ßß" #
)
ßß# $
{
®® 
Result
©© 
=
©© 
null
©© 
,
©© 
	IsSuccess
™™ 
=
™™ 
false
™™ !
,
™™! "
Message
´´ 
=
´´ 
e
´´ 
.
´´ 
Message
´´ #
,
´´# $

StatusCode
¨¨ 
=
¨¨ 
$num
¨¨  
}
≠≠ 
;
≠≠ 
}
ÆÆ 	
}
ØØ 
public
±± 

async
±± 
Task
±± 
<
±± 
ResponseDTO
±± !
>
±±! "!
SubmitCourseVersion
±±# 6
(
≤≤ 
ClaimsPrincipal
≥≥ 
User
≥≥ 
,
≥≥ 
Guid
¥¥ 
courseVersionId
¥¥ 
)
µµ 
{
∂∂ 
try
∑∑ 
{
∏∏ 	
var
ππ 
courseVersion
ππ 
=
ππ 
await
ππ  %
_unitOfWork
ππ& 1
.
ππ1 2%
CourseVersionRepository
ππ2 I
.
ππI J
GetAsync
ππJ R
(
ππR S
x
ππS T
=>
ππU W
x
ππX Y
.
ππY Z
Id
ππZ \
==
ππ] _
courseVersionId
ππ` o
)
ππo p
;
ππp q
if
ªª 
(
ªª 
courseVersion
ªª 
is
ªª  
null
ªª! %
)
ªª% &
{
ºº 
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ &
(
ΩΩ& '
)
ΩΩ' (
{
ææ 
Result
øø 
=
øø 
null
øø !
,
øø! "
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿  %
,
¿¿% &
Message
¡¡ 
=
¡¡ 
$str
¡¡ <
,
¡¡< =

StatusCode
¬¬ 
=
¬¬  
$num
¬¬! $
}
√√ 
;
√√ 
}
ƒƒ 
switch
∆∆ 
(
∆∆ 
courseVersion
∆∆ !
.
∆∆! "
CurrentStatus
∆∆" /
)
∆∆/ 0
{
«« 
case
»» '
StaticCourseVersionStatus
»» .
.
»». /
	Submitted
»»/ 8
:
»»8 9
{
…… 
return
   
new
   
ResponseDTO
   *
(
  * +
)
  + ,
{
ÀÀ 
Message
ÃÃ 
=
ÃÃ  !
$str
ÃÃ" F
,
ÃÃF G

StatusCode
ÕÕ "
=
ÕÕ# $
$num
ÕÕ% (
,
ÕÕ( )
	IsSuccess
ŒŒ !
=
ŒŒ" #
false
ŒŒ$ )
,
ŒŒ) *
Result
œœ 
=
œœ  
null
œœ! %
}
–– 
;
–– 
}
—— 
case
““ '
StaticCourseVersionStatus
““ .
.
““. /
Accepted
““/ 7
:
““7 8
{
”” 
return
‘‘ 
new
‘‘ 
ResponseDTO
‘‘ *
(
‘‘* +
)
‘‘+ ,
{
’’ 
Message
÷÷ 
=
÷÷  !
$str
÷÷" E
,
÷÷E F

StatusCode
◊◊ "
=
◊◊# $
$num
◊◊% (
,
◊◊( )
	IsSuccess
ÿÿ !
=
ÿÿ" #
false
ÿÿ$ )
,
ÿÿ) *
Result
ŸŸ 
=
ŸŸ  
null
ŸŸ! %
}
⁄⁄ 
;
⁄⁄ 
}
€€ 
case
‹‹ '
StaticCourseVersionStatus
‹‹ .
.
‹‹. /
Merged
‹‹/ 5
:
‹‹5 6
{
›› 
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ *
(
ﬁﬁ* +
)
ﬁﬁ+ ,
{
ﬂﬂ 
Message
‡‡ 
=
‡‡  !
$str
‡‡" C
,
‡‡C D

StatusCode
·· "
=
··# $
$num
··% (
,
··( )
	IsSuccess
‚‚ !
=
‚‚" #
false
‚‚$ )
,
‚‚) *
Result
„„ 
=
„„  
null
„„! %
}
‰‰ 
;
‰‰ 
}
ÂÂ 
case
ÊÊ '
StaticCourseVersionStatus
ÊÊ .
.
ÊÊ. /
Removed
ÊÊ/ 6
:
ÊÊ6 7
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË *
(
ËË* +
)
ËË+ ,
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ  !
$str
ÍÍ" D
,
ÍÍD E

StatusCode
ÎÎ "
=
ÎÎ# $
$num
ÎÎ% (
,
ÎÎ( )
	IsSuccess
ÏÏ !
=
ÏÏ" #
false
ÏÏ$ )
,
ÏÏ) *
Result
ÌÌ 
=
ÌÌ  
null
ÌÌ! %
}
ÓÓ 
;
ÓÓ 
}
ÔÔ 
default
 
:
 
{
ÒÒ 
courseVersion
ÚÚ !
.
ÚÚ! "
CurrentStatus
ÚÚ" /
=
ÚÚ0 1'
StaticCourseVersionStatus
ÚÚ2 K
.
ÚÚK L
	Submitted
ÚÚL U
;
ÚÚU V
break
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 
_unitOfWork
˜˜ 
.
˜˜ %
CourseVersionRepository
˜˜ /
.
˜˜/ 0
Update
˜˜0 6
(
˜˜6 7
courseVersion
˜˜7 D
)
˜˜D E
;
˜˜E F
var
˘˘ 
responseDto
˘˘ 
=
˘˘ 
await
˘˘ #)
_courseVersionStatusService
˘˘$ ?
.
˘˘? @'
CreateCourseVersionStatus
˘˘@ Y
(
˙˙ 
User
˚˚ 
,
˚˚ 
new
¸¸ *
CreateCourseVersionStatusDTO
¸¸ 0
(
¸¸0 1
)
¸¸1 2
{
˝˝ 
CourseVersionId
˛˛ #
=
˛˛$ %
courseVersion
˛˛& 3
.
˛˛3 4
Id
˛˛4 6
,
˛˛6 7
Status
ˇˇ 
=
ˇˇ '
StaticCourseVersionStatus
ˇˇ 6
.
ˇˇ6 7
	Submitted
ˇˇ7 @
}
ÄÄ 
)
ÅÅ 
;
ÅÅ 
if
ÉÉ 
(
ÉÉ 
responseDto
ÉÉ 
.
ÉÉ 

StatusCode
ÉÉ &
==
ÉÉ' )
$num
ÉÉ* -
)
ÉÉ- .
{
ÑÑ 
return
ÖÖ 
responseDto
ÖÖ "
;
ÖÖ" #
}
ÜÜ 
BackgroundJob
àà 
.
àà 
Enqueue
àà !
<
àà! "
IEmailSender
àà" .
>
àà. /
(
àà/ 0
job
àà0 3
=>
àà4 6
job
àà7 :
.
àà: ;/
!SendSubmittedCourseEmailForAdmins
àà; \
(
àà\ ]
)
àà] ^
)
àà^ _
;
àà_ `
return
ää 
new
ää 
ResponseDTO
ää "
(
ää" #
)
ää# $
{
ãã 
Result
åå 
=
åå 
null
åå 
,
åå 
	IsSuccess
çç 
=
çç 
true
çç  
,
çç  !
Message
éé 
=
éé 
$str
éé >
,
éé> ?

StatusCode
èè 
=
èè 
$num
èè  
}
êê 
;
êê 
}
ëë 	
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 	
return
îî 
new
îî 
ResponseDTO
îî "
(
îî" #
)
îî# $
{
ïï 
Result
ññ 
=
ññ 
null
ññ 
,
ññ 
	IsSuccess
óó 
=
óó 
false
óó !
,
óó! "
Message
òò 
=
òò 
e
òò 
.
òò 
Message
òò #
,
òò# $

StatusCode
ôô 
=
ôô 
$num
ôô  
}
öö 
;
öö 
}
õõ 	
}
úú 
public
ûû 

async
ûû 
Task
ûû 
<
ûû 
ResponseDTO
ûû !
>
ûû! " 
MergeCourseVersion
ûû# 5
(
üü 
ClaimsPrincipal
†† 
User
†† 
,
†† 
Guid
°° 
courseVersionId
°° 
)
¢¢ 
{
££ 
try
§§ 
{
•• 	
var
¶¶ 
courseVersion
¶¶ 
=
¶¶ 
await
¶¶  %
_unitOfWork
¶¶& 1
.
¶¶1 2%
CourseVersionRepository
¶¶2 I
.
¶¶I J
GetAsync
¶¶J R
(
¶¶R S
x
¶¶S T
=>
¶¶U W
x
¶¶X Y
.
¶¶Y Z
Id
¶¶Z \
==
¶¶] _
courseVersionId
¶¶` o
)
¶¶o p
;
¶¶p q
if
ßß 
(
ßß 
courseVersion
ßß 
is
ßß  
null
ßß! %
)
ßß% &
{
®® 
return
©© 
new
©© 
ResponseDTO
©© &
(
©©& '
)
©©' (
{
™™ 
Result
´´ 
=
´´ 
null
´´ !
,
´´! "
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨  %
,
¨¨% &
Message
≠≠ 
=
≠≠ 
$str
≠≠ <
,
≠≠< =

StatusCode
ÆÆ 
=
ÆÆ  
$num
ÆÆ! $
}
ØØ 
;
ØØ 
}
∞∞ 
switch
≤≤ 
(
≤≤ 
courseVersion
≤≤ !
.
≤≤! "
CurrentStatus
≤≤" /
)
≤≤/ 0
{
≥≥ 
case
¥¥ '
StaticCourseVersionStatus
¥¥ .
.
¥¥. /
New
¥¥/ 2
:
¥¥2 3
{
µµ 
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ *
(
∂∂* +
)
∂∂+ ,
{
∑∑ 
Message
∏∏ 
=
∏∏  !
$str
∏∏" G
,
∏∏G H

StatusCode
ππ "
=
ππ# $
$num
ππ% (
,
ππ( )
	IsSuccess
∫∫ !
=
∫∫" #
false
∫∫$ )
,
∫∫) *
Result
ªª 
=
ªª  
null
ªª! %
}
ºº 
;
ºº 
}
ΩΩ 
case
ææ '
StaticCourseVersionStatus
ææ .
.
ææ. /
Rejected
ææ/ 7
:
ææ7 8
{
øø 
return
¿¿ 
new
¿¿ 
ResponseDTO
¿¿ *
(
¿¿* +
)
¿¿+ ,
{
¡¡ 
Message
¬¬ 
=
¬¬  !
$str
¬¬" E
,
¬¬E F

StatusCode
√√ "
=
√√# $
$num
√√% (
,
√√( )
	IsSuccess
ƒƒ !
=
ƒƒ" #
false
ƒƒ$ )
,
ƒƒ) *
Result
≈≈ 
=
≈≈  
null
≈≈! %
}
∆∆ 
;
∆∆ 
}
«« 
case
»» '
StaticCourseVersionStatus
»» .
.
»». /
	Submitted
»»/ 8
:
»»8 9
{
…… 
return
   
new
   
ResponseDTO
   *
(
  * +
)
  + ,
{
ÀÀ 
Message
ÃÃ 
=
ÃÃ  !
$str
ÃÃ" F
,
ÃÃF G

StatusCode
ÕÕ "
=
ÕÕ# $
$num
ÕÕ% (
,
ÕÕ( )
	IsSuccess
ŒŒ !
=
ŒŒ" #
false
ŒŒ$ )
,
ŒŒ) *
Result
œœ 
=
œœ  
null
œœ! %
}
–– 
;
–– 
}
—— 
case
““ '
StaticCourseVersionStatus
““ .
.
““. /
Merged
““/ 5
:
““5 6
{
”” 
return
‘‘ 
new
‘‘ 
ResponseDTO
‘‘ *
(
‘‘* +
)
‘‘+ ,
{
’’ 
Message
÷÷ 
=
÷÷  !
$str
÷÷" C
,
÷÷C D

StatusCode
◊◊ "
=
◊◊# $
$num
◊◊% (
,
◊◊( )
	IsSuccess
ÿÿ !
=
ÿÿ" #
false
ÿÿ$ )
,
ÿÿ) *
Result
ŸŸ 
=
ŸŸ  
null
ŸŸ! %
}
⁄⁄ 
;
⁄⁄ 
}
€€ 
case
‹‹ '
StaticCourseVersionStatus
‹‹ .
.
‹‹. /
Removed
‹‹/ 6
:
‹‹6 7
{
›› 
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ *
(
ﬁﬁ* +
)
ﬁﬁ+ ,
{
ﬂﬂ 
Message
‡‡ 
=
‡‡  !
$str
‡‡" D
,
‡‡D E

StatusCode
·· "
=
··# $
$num
··% (
,
··( )
	IsSuccess
‚‚ !
=
‚‚" #
false
‚‚$ )
,
‚‚) *
Result
„„ 
=
„„  
null
„„! %
}
‰‰ 
;
‰‰ 
}
ÂÂ 
default
ÊÊ 
:
ÊÊ 
{
ÁÁ 
courseVersion
ËË !
.
ËË! "
CurrentStatus
ËË" /
=
ËË0 1'
StaticCourseVersionStatus
ËË2 K
.
ËËK L
Merged
ËËL R
;
ËËR S
break
ÈÈ 
;
ÈÈ 
}
ÍÍ 
}
ÎÎ 
var
ÌÌ 
course
ÌÌ 
=
ÌÌ 
await
ÌÌ 
_unitOfWork
ÌÌ *
.
ÌÌ* +
CourseRepository
ÌÌ+ ;
.
ÌÌ; <
GetAsync
ÌÌ< D
(
ÌÌD E
x
ÌÌE F
=>
ÌÌG I
x
ÌÌJ K
.
ÌÌK L
Id
ÌÌL N
==
ÌÌO Q
courseVersion
ÌÌR _
.
ÌÌ_ `
CourseId
ÌÌ` h
)
ÌÌh i
;
ÌÌi j
if
ÔÔ 
(
ÔÔ 
course
ÔÔ 
is
ÔÔ 
null
ÔÔ 
)
ÔÔ 
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ &
(
ÒÒ& '
)
ÒÒ' (
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ 
$str
ÛÛ 4
,
ÛÛ4 5

StatusCode
ÙÙ 
=
ÙÙ  
$num
ÙÙ! $
,
ÙÙ$ %
	IsSuccess
ıı 
=
ıı 
false
ıı  %
,
ıı% &
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ !
}
˜˜ 
;
˜˜ 
}
¯¯ 
course
˙˙ 
.
˙˙ 
CourseVersionId
˙˙ "
=
˙˙# $
courseVersion
˙˙% 2
.
˙˙2 3
Id
˙˙3 5
;
˙˙5 6
_unitOfWork
¸¸ 
.
¸¸ %
CourseVersionRepository
¸¸ /
.
¸¸/ 0
Update
¸¸0 6
(
¸¸6 7
courseVersion
¸¸7 D
)
¸¸D E
;
¸¸E F
_unitOfWork
˝˝ 
.
˝˝ 
CourseRepository
˝˝ (
.
˝˝( )
Update
˝˝) /
(
˝˝/ 0
course
˝˝0 6
)
˝˝6 7
;
˝˝7 8
await
˛˛ 
_unitOfWork
˛˛ 
.
˛˛ 
	SaveAsync
˛˛ '
(
˛˛' (
)
˛˛( )
;
˛˛) *
var
ÄÄ 
responseDto
ÄÄ 
=
ÄÄ 
await
ÄÄ #)
_courseVersionStatusService
ÄÄ$ ?
.
ÄÄ? @'
CreateCourseVersionStatus
ÄÄ@ Y
(
ÅÅ 
User
ÇÇ 
,
ÇÇ 
new
ÉÉ *
CreateCourseVersionStatusDTO
ÉÉ 0
(
ÉÉ0 1
)
ÉÉ1 2
{
ÑÑ 
CourseVersionId
ÖÖ #
=
ÖÖ$ %
courseVersion
ÖÖ& 3
.
ÖÖ3 4
Id
ÖÖ4 6
,
ÖÖ6 7
Status
ÜÜ 
=
ÜÜ '
StaticCourseVersionStatus
ÜÜ 6
.
ÜÜ6 7
Merged
ÜÜ7 =
,
ÜÜ= >
}
áá 
)
àà 
;
àà 
if
ää 
(
ää 
responseDto
ää 
.
ää 

StatusCode
ää &
==
ää' )
$num
ää* -
)
ää- .
{
ãã 
return
åå 
responseDto
åå "
;
åå" #
}
çç 
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Result
ëë 
=
ëë 
null
ëë 
,
ëë 
	IsSuccess
íí 
=
íí 
true
íí  
,
íí  !
Message
ìì 
=
ìì 
$str
ìì >
,
ìì> ?

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 	
return
ôô 
new
ôô 
ResponseDTO
ôô "
(
ôô" #
)
ôô# $
{
öö 
Result
õõ 
=
õõ 
null
õõ 
,
õõ 
	IsSuccess
úú 
=
úú 
false
úú !
,
úú! "
Message
ùù 
=
ùù 
e
ùù 
.
ùù 
Message
ùù #
,
ùù# $

StatusCode
ûû 
=
ûû 
$num
ûû  
}
üü 
;
üü 
}
†† 	
}
°° 
public
££ 

async
££ 
Task
££ 
<
££ 
ResponseDTO
££ !
>
££! "'
GetCourseVersionsComments
££# <
(
§§ 
ClaimsPrincipal
•• 
User
•• 
,
•• 
Guid
¶¶ 
?
¶¶ 
courseVersionId
¶¶ 
,
¶¶ 
string
ßß 
?
ßß 
filterOn
ßß 
,
ßß 
string
®® 
?
®® 
filterQuery
®® 
,
®® 
string
©© 
?
©© 
sortBy
©© 
,
©© 
int
™™ 

pageNumber
™™ 
,
™™ 
int
´´ 
pageSize
´´ 
)
¨¨ 
{
≠≠ 
try
ÆÆ 
{
ØØ 	
var
±± 
userRole
±± 
=
±± 
User
±± 
.
±±  
Claims
±±  &
.
±±& '
FirstOrDefault
±±' 5
(
±±5 6
x
±±6 7
=>
±±8 :
x
±±; <
.
±±< =
Type
±±= A
==
±±B D

ClaimTypes
±±E O
.
±±O P
Role
±±P T
)
±±T U
?
±±U V
.
±±V W
Value
±±W \
;
±±\ ]
IEnumerable
≥≥ 
<
≥≥ "
CourseVersionComment
≥≥ ,
>
≥≥, -
comments
≥≥. 6
;
≥≥6 7
if
µµ 
(
µµ 
userRole
µµ 
==
µµ 
StaticUserRoles
µµ +
.
µµ+ ,
Admin
µµ, 1
)
µµ1 2
{
∂∂ 
comments
∏∏ 
=
∏∏ 
await
∏∏  
_unitOfWork
∏∏! ,
.
∏∏, -,
CourseVersionCommentRepository
∏∏- K
.
∏∏K L
GetAllAsync
∏∏L W
(
∏∏W X
x
∏∏X Y
=>
∏∏Z \
x
ππ 
.
ππ 
CourseVersionId
ππ %
==
ππ& (
courseVersionId
ππ) 8
)
ππ8 9
;
ππ9 :
}
∫∫ 
else
ªª 
{
ºº 
comments
ææ 
=
ææ 
await
ææ  
_unitOfWork
ææ! ,
.
ææ, -,
CourseVersionCommentRepository
ææ- K
.
ææK L
GetAllAsync
ææL W
(
ææW X
x
ææX Y
=>
ææZ \
x
øø 
.
øø 
CourseVersionId
øø %
==
øø& (
courseVersionId
øø) 8
&&
øø9 ;
x
øø< =
.
øø= >
Status
øø> D
<=
øøE G
StaticStatus
øøH T
.
øøT U
Category
øøU ]
.
øø] ^
	Activated
øø^ g
)
øøg h
;
øøh i
}
¿¿ 
if
√√ 
(
√√ 
!
√√ 
comments
√√ 
.
√√ 
Any
√√ 
(
√√ 
)
√√ 
)
√√  
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
(
≈≈& '
)
≈≈' (
{
∆∆ 
Message
«« 
=
«« 
$str
«« 5
,
««5 6
	IsSuccess
»» 
=
»» 
true
»»  $
,
»»$ %

StatusCode
…… 
=
……  
$num
……! $
,
……$ %
Result
   
=
   
null
   !
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
var
ŒŒ 
listComments
ŒŒ 
=
ŒŒ 
comments
ŒŒ '
.
ŒŒ' (
ToList
ŒŒ( .
(
ŒŒ. /
)
ŒŒ/ 0
;
ŒŒ0 1
if
—— 
(
—— 
!
—— 
string
—— 
.
—— 
IsNullOrEmpty
—— %
(
——% &
filterOn
——& .
)
——. /
&&
——0 2
!
——3 4
string
——4 :
.
——: ;
IsNullOrEmpty
——; H
(
——H I
filterQuery
——I T
)
——T U
)
——U V
{
““ 
switch
”” 
(
”” 
filterOn
””  
.
””  !
Trim
””! %
(
””% &
)
””& '
.
””' (
ToLower
””( /
(
””/ 0
)
””0 1
)
””1 2
{
‘‘ 
case
’’ 
$str
’’ "
:
’’" #
listComments
÷÷ $
=
÷÷% &
listComments
÷÷' 3
.
÷÷3 4
Where
÷÷4 9
(
÷÷9 :
x
÷÷: ;
=>
÷÷< >
x
◊◊ 
.
◊◊ 
Comment
◊◊ %
.
◊◊% &
Contains
◊◊& .
(
◊◊. /
filterQuery
◊◊/ :
,
◊◊: ;
StringComparison
◊◊< L
.
◊◊L M&
CurrentCultureIgnoreCase
◊◊M e
)
◊◊e f
)
◊◊f g
.
◊◊g h
ToList
◊◊h n
(
◊◊n o
)
◊◊o p
;
◊◊p q
break
ÿÿ 
;
ÿÿ 
case
ŸŸ 
$str
ŸŸ #
:
ŸŸ# $
listComments
⁄⁄ $
=
⁄⁄% &
listComments
⁄⁄' 3
.
⁄⁄3 4
Where
⁄⁄4 9
(
⁄⁄9 :
x
⁄⁄: ;
=>
⁄⁄< >
x
€€ 
.
€€ 
	CreatedBy
€€ '
.
€€' (
Contains
€€( 0
(
€€0 1
filterQuery
€€1 <
,
€€< =
StringComparison
€€> N
.
€€N O&
CurrentCultureIgnoreCase
€€O g
)
€€g h
)
€€h i
.
€€i j
ToList
€€j p
(
€€p q
)
€€q r
;
€€r s
break
‹‹ 
;
‹‹ 
case
›› 
$str
›› #
:
››# $
listComments
ﬁﬁ $
=
ﬁﬁ% &
listComments
ﬁﬁ' 3
.
ﬁﬁ3 4
Where
ﬁﬁ4 9
(
ﬁﬁ9 :
x
ﬁﬁ: ;
=>
ﬁﬁ< >
x
ﬂﬂ 
.
ﬂﬂ 
	UpdatedBy
ﬂﬂ '
.
ﬂﬂ' (
Contains
ﬂﬂ( 0
(
ﬂﬂ0 1
filterQuery
ﬂﬂ1 <
,
ﬂﬂ< =
StringComparison
ﬂﬂ> N
.
ﬂﬂN O&
CurrentCultureIgnoreCase
ﬂﬂO g
)
ﬂﬂg h
)
ﬂﬂh i
.
ﬂﬂi j
ToList
ﬂﬂj p
(
ﬂﬂp q
)
ﬂﬂq r
;
ﬂﬂr s
break
‡‡ 
;
‡‡ 
case
·· 
$str
·· %
:
··% &
listComments
‚‚ $
=
‚‚% &
listComments
‚‚' 3
.
‚‚3 4
Where
‚‚4 9
(
‚‚9 :
x
‚‚: ;
=>
‚‚< >
x
„„  !
.
„„! "
CreatedTime
„„" -
.
„„- .
HasValue
„„. 6
&&
„„7 9
x
„„: ;
.
„„; <
CreatedTime
„„< G
.
„„G H
Value
„„H M
.
„„M N
Date
„„N R
==
„„S U
DateTime
„„V ^
.
„„^ _
Parse
„„_ d
(
„„d e
filterQuery
„„e p
)
„„p q
.
„„q r
Date
„„r v
)
„„v w
.
‰‰ 
ToList
‰‰ #
(
‰‰# $
)
‰‰$ %
;
‰‰% &
break
ÂÂ 
;
ÂÂ 
case
ÊÊ 
$str
ÊÊ %
:
ÊÊ% &
listComments
ÁÁ $
=
ÁÁ% &
listComments
ÁÁ' 3
.
ÁÁ3 4
Where
ÁÁ4 9
(
ÁÁ9 :
x
ÁÁ: ;
=>
ÁÁ< >
x
ËË  !
.
ËË! "
UpdatedTime
ËË" -
.
ËË- .
HasValue
ËË. 6
&&
ËË7 9
x
ËË: ;
.
ËË; <
UpdatedTime
ËË< G
.
ËËG H
Value
ËËH M
.
ËËM N
Date
ËËN R
==
ËËS U
DateTime
ËËV ^
.
ËË^ _
Parse
ËË_ d
(
ËËd e
filterQuery
ËËe p
)
ËËp q
.
ËËq r
Date
ËËr v
)
ËËv w
.
ÈÈ 
ToList
ÈÈ #
(
ÈÈ# $
)
ÈÈ$ %
;
ÈÈ% &
break
ÍÍ 
;
ÍÍ 
case
ÎÎ 
$str
ÎÎ !
:
ÎÎ! "
if
ÏÏ 
(
ÏÏ 
int
ÏÏ 
.
ÏÏ  
TryParse
ÏÏ  (
(
ÏÏ( )
filterQuery
ÏÏ) 4
,
ÏÏ4 5
out
ÏÏ6 9
var
ÏÏ: =
status
ÏÏ> D
)
ÏÏD E
)
ÏÏE F
{
ÌÌ 
listComments
ÓÓ (
=
ÓÓ) *
listComments
ÓÓ+ 7
.
ÓÓ7 8
Where
ÓÓ8 =
(
ÓÓ= >
x
ÓÓ> ?
=>
ÓÓ@ B
x
ÓÓC D
.
ÓÓD E
Status
ÓÓE K
==
ÓÓL N
status
ÓÓO U
)
ÓÓU V
.
ÓÓV W
ToList
ÓÓW ]
(
ÓÓ] ^
)
ÓÓ^ _
;
ÓÓ_ `
}
ÔÔ 
break
ÒÒ 
;
ÒÒ 
default
ÚÚ 
:
ÚÚ 
break
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 
if
¯¯ 
(
¯¯ 
!
¯¯ 
string
¯¯ 
.
¯¯ 
IsNullOrEmpty
¯¯ %
(
¯¯% &
sortBy
¯¯& ,
)
¯¯, -
)
¯¯- .
{
˘˘ 
switch
˙˙ 
(
˙˙ 
sortBy
˙˙ 
.
˙˙ 
Trim
˙˙ #
(
˙˙# $
)
˙˙$ %
.
˙˙% &
ToLower
˙˙& -
(
˙˙- .
)
˙˙. /
)
˙˙/ 0
{
˚˚ 
case
¸¸ 
$str
¸¸ "
:
¸¸" #
listComments
˝˝ $
=
˝˝% &
listComments
˝˝' 3
.
˝˝3 4
OrderBy
˝˝4 ;
(
˝˝; <
x
˝˝< =
=>
˝˝> @
x
˝˝A B
.
˝˝B C
Comment
˝˝C J
)
˝˝J K
.
˝˝K L
ToList
˝˝L R
(
˝˝R S
)
˝˝S T
;
˝˝T U
break
˛˛ 
;
˛˛ 
case
ˇˇ 
$str
ˇˇ #
:
ˇˇ# $
listComments
Ä	Ä	 $
=
Ä	Ä	% &
listComments
Ä	Ä	' 3
.
Ä	Ä	3 4
OrderBy
Ä	Ä	4 ;
(
Ä	Ä	; <
x
Ä	Ä	< =
=>
Ä	Ä	> @
x
Ä	Ä	A B
.
Ä	Ä	B C
	CreatedBy
Ä	Ä	C L
)
Ä	Ä	L M
.
Ä	Ä	M N
ToList
Ä	Ä	N T
(
Ä	Ä	T U
)
Ä	Ä	U V
;
Ä	Ä	V W
break
Å	Å	 
;
Å	Å	 
case
Ç	Ç	 
$str
Ç	Ç	 #
:
Ç	Ç	# $
listComments
É	É	 $
=
É	É	% &
listComments
É	É	' 3
.
É	É	3 4
OrderBy
É	É	4 ;
(
É	É	; <
x
É	É	< =
=>
É	É	> @
x
É	É	A B
.
É	É	B C
	UpdatedBy
É	É	C L
)
É	É	L M
.
É	É	M N
ToList
É	É	N T
(
É	É	T U
)
É	É	U V
;
É	É	V W
break
Ñ	Ñ	 
;
Ñ	Ñ	 
case
Ö	Ö	 
$str
Ö	Ö	 %
:
Ö	Ö	% &
listComments
Ü	Ü	 $
=
Ü	Ü	% &
listComments
Ü	Ü	' 3
.
Ü	Ü	3 4
OrderBy
Ü	Ü	4 ;
(
Ü	Ü	; <
x
Ü	Ü	< =
=>
Ü	Ü	> @
x
Ü	Ü	A B
.
Ü	Ü	B C
CreatedTime
Ü	Ü	C N
)
Ü	Ü	N O
.
Ü	Ü	O P
ToList
Ü	Ü	P V
(
Ü	Ü	V W
)
Ü	Ü	W X
;
Ü	Ü	X Y
break
á	á	 
;
á	á	 
case
à	à	 
$str
à	à	 %
:
à	à	% &
listComments
â	â	 $
=
â	â	% &
listComments
â	â	' 3
.
â	â	3 4
OrderBy
â	â	4 ;
(
â	â	; <
x
â	â	< =
=>
â	â	> @
x
â	â	A B
.
â	â	B C
UpdatedTime
â	â	C N
)
â	â	N O
.
â	â	O P
ToList
â	â	P V
(
â	â	V W
)
â	â	W X
;
â	â	X Y
break
ä	ä	 
;
ä	ä	 
case
ã	ã	 
$str
ã	ã	 !
:
ã	ã	! "
listComments
å	å	 $
=
å	å	% &
listComments
å	å	' 3
.
å	å	3 4
OrderBy
å	å	4 ;
(
å	å	; <
x
å	å	< =
=>
å	å	> @
x
å	å	A B
.
å	å	B C
Status
å	å	C I
)
å	å	I J
.
å	å	J K
ToList
å	å	K Q
(
å	å	Q R
)
å	å	R S
;
å	å	S T
break
ç	ç	 
;
ç	ç	 
default
é	é	 
:
é	é	 
break
è	è	 
;
è	è	 
}
ê	ê	 
}
ë	ë	 
else
í	í	 
{
ì	ì	 
listComments
ï	ï	 
=
ï	ï	 
listComments
ï	ï	 +
.
ï	ï	+ ,
OrderByDescending
ï	ï	, =
(
ï	ï	= >
x
ï	ï	> ?
=>
ï	ï	@ B
x
ï	ï	C D
.
ï	ï	D E
CreatedTime
ï	ï	E P
)
ï	ï	P Q
.
ï	ï	Q R
ToList
ï	ï	R X
(
ï	ï	X Y
)
ï	ï	Y Z
;
ï	ï	Z [
}
ñ	ñ	 
if
ô	ô	 
(
ô	ô	 

pageNumber
ô	ô	 
>
ô	ô	 
$num
ô	ô	 
&&
ô	ô	 !
pageSize
ô	ô	" *
>
ô	ô	+ ,
$num
ô	ô	- .
)
ô	ô	. /
{
ö	ö	 
var
õ	õ	 

skipResult
õ	õ	 
=
õ	õ	  
(
õ	õ	! "

pageNumber
õ	õ	" ,
-
õ	õ	- .
$num
õ	õ	/ 0
)
õ	õ	0 1
*
õ	õ	2 3
pageSize
õ	õ	4 <
;
õ	õ	< =
listComments
ú	ú	 
=
ú	ú	 
listComments
ú	ú	 +
.
ú	ú	+ ,
Skip
ú	ú	, 0
(
ú	ú	0 1

skipResult
ú	ú	1 ;
)
ú	ú	; <
.
ú	ú	< =
Take
ú	ú	= A
(
ú	ú	A B
pageSize
ú	ú	B J
)
ú	ú	J K
.
ú	ú	K L
ToList
ú	ú	L R
(
ú	ú	R S
)
ú	ú	S T
;
ú	ú	T U
}
ù	ù	 
var
†	†	 
commentsDto
†	†	 
=
†	†	 
listComments
†	†	 *
.
†	†	* +
Select
†	†	+ 1
(
†	†	1 2
comment
†	†	2 9
=>
†	†	: <
new
†	†	= @
GetAllCommentsDTO
†	†	A R
{
°	°	 
Id
¢	¢	 
=
¢	¢	 
comment
¢	¢	 
.
¢	¢	 
Id
¢	¢	 
,
¢	¢	  
Comment
£	£	 
=
£	£	 
comment
£	£	 !
.
£	£	! "
Comment
£	£	" )
,
£	£	) *

CreateTime
§	§	 
=
§	§	 
comment
§	§	 $
.
§	§	$ %
CreatedTime
§	§	% 0
,
§	§	0 1
CreateBy
•	•	 
=
•	•	 
comment
•	•	 "
.
•	•	" #
	CreatedBy
•	•	# ,
,
•	•	, -

UpdateTime
¶	¶	 
=
¶	¶	 
comment
¶	¶	 $
.
¶	¶	$ %
UpdatedTime
¶	¶	% 0
,
¶	¶	0 1
UpdateBy
ß	ß	 
=
ß	ß	 
comment
ß	ß	 "
.
ß	ß	" #
	UpdatedBy
ß	ß	# ,
,
ß	ß	, -
Status
®	®	 
=
®	®	 
comment
®	®	  
.
®	®	  !
Status
®	®	! '
}
©	©	 
)
©	©	 
.
©	©	 
ToList
©	©	 
(
©	©	 
)
©	©	 
;
©	©	 
return
´	´	 
new
´	´	 
ResponseDTO
´	´	 "
(
´	´	" #
)
´	´	# $
{
¨	¨	 
Message
≠	≠	 
=
≠	≠	 
$str
≠	≠	 D
,
≠	≠	D E
	IsSuccess
Æ	Æ	 
=
Æ	Æ	 
true
Æ	Æ	  
,
Æ	Æ	  !

StatusCode
Ø	Ø	 
=
Ø	Ø	 
$num
Ø	Ø	  
,
Ø	Ø	  !
Result
∞	∞	 
=
∞	∞	 
commentsDto
∞	∞	 $
}
±	±	 
;
±	±	 
}
≤	≤	 	
catch
≥	≥	 
(
≥	≥	 
	Exception
≥	≥	 
e
≥	≥	 
)
≥	≥	 
{
¥	¥	 	
return
µ	µ	 
new
µ	µ	 
ResponseDTO
µ	µ	 "
(
µ	µ	" #
)
µ	µ	# $
{
∂	∂	 
Message
∑	∑	 
=
∑	∑	 
e
∑	∑	 
.
∑	∑	 
Message
∑	∑	 #
,
∑	∑	# $
Result
∏	∏	 
=
∏	∏	 
null
∏	∏	 
,
∏	∏	 
	IsSuccess
π	π	 
=
π	π	 
false
π	π	 !
,
π	π	! "

StatusCode
∫	∫	 
=
∫	∫	 
$num
∫	∫	  
}
ª	ª	 
;
ª	ª	 
}
º	º	 	
}
Ω	Ω	 
public
¡	¡	 

async
¡	¡	 
Task
¡	¡	 
<
¡	¡	 
ResponseDTO
¡	¡	 !
>
¡	¡	! "%
GetCourseVersionComment
¡	¡	# :
(
¡	¡	: ;
ClaimsPrincipal
¡	¡	; J
User
¡	¡	K O
,
¡	¡	O P
Guid
¡	¡	Q U$
courseVersionCommentId
¡	¡	V l
)
¡	¡	l m
{
¬	¬	 
try
√	√	 
{
ƒ	ƒ	 	
var
≈	≈	 "
courseVersionComment
≈	≈	 $
=
≈	≈	% &
await
∆	∆	 
_unitOfWork
∆	∆	 !
.
∆	∆	! ",
CourseVersionCommentRepository
∆	∆	" @
.
∆	∆	@ A)
GetCourseVersionCommentById
∆	∆	A \
(
∆	∆	\ ]$
courseVersionCommentId
∆	∆	] s
)
∆	∆	s t
;
∆	∆	t u
if
»	»	 
(
»	»	 "
courseVersionComment
»	»	 $
is
»	»	% '
null
»	»	( ,
)
»	»	, -
{
…	…	 
return
 	 	 
new
 	 	 
ResponseDTO
 	 	 &
(
 	 	& '
)
 	 	' (
{
À	À	 
Result
Ã	Ã	 
=
Ã	Ã	 
$str
Ã	Ã	 
,
Ã	Ã	  
Message
Õ	Õ	 
=
Õ	Õ	 
$str
Õ	Õ	 <
,
Õ	Õ	< =
	IsSuccess
Œ	Œ	 
=
Œ	Œ	 
true
Œ	Œ	  $
,
Œ	Œ	$ %

StatusCode
œ	œ	 
=
œ	œ	  
$num
œ	œ	! $
}
–	–	 
;
–	–	 
}
—	—	 
var
”	”	 %
courseVersionCommentDto
”	”	 '
=
”	”	( )
_mapper
”	”	* 1
.
”	”	1 2
Map
”	”	2 5
<
”	”	5 6!
GetCourseCommnetDTO
”	”	6 I
>
”	”	I J
(
”	”	J K"
courseVersionComment
”	”	K _
)
”	”	_ `
;
”	”	` a
return
’	’	 
new
’	’	 
ResponseDTO
’	’	 "
(
’	’	" #
)
’	’	# $
{
÷	÷	 
Result
◊	◊	 
=
◊	◊	 %
courseVersionCommentDto
◊	◊	 0
,
◊	◊	0 1
Message
ÿ	ÿ	 
=
ÿ	ÿ	 
$str
ÿ	ÿ	 ;
,
ÿ	ÿ	; <
	IsSuccess
Ÿ	Ÿ	 
=
Ÿ	Ÿ	 
true
Ÿ	Ÿ	  
,
Ÿ	Ÿ	  !

StatusCode
⁄	⁄	 
=
⁄	⁄	 
$num
⁄	⁄	  
}
€	€	 
;
€	€	 
}
‹	‹	 	
catch
›	›	 
(
›	›	 
	Exception
›	›	 
e
›	›	 
)
›	›	 
{
ﬁ	ﬁ	 	
return
ﬂ	ﬂ	 
new
ﬂ	ﬂ	 
ResponseDTO
ﬂ	ﬂ	 "
(
ﬂ	ﬂ	" #
)
ﬂ	ﬂ	# $
{
‡	‡	 
Result
·	·	 
=
·	·	 
null
·	·	 
,
·	·	 
Message
‚	‚	 
=
‚	‚	 
e
‚	‚	 
.
‚	‚	 
Message
‚	‚	 #
,
‚	‚	# $
	IsSuccess
„	„	 
=
„	„	 
true
„	„	  
,
„	„	  !

StatusCode
‰	‰	 
=
‰	‰	 
$num
‰	‰	  
}
Â	Â	 
;
Â	Â	 
}
Ê	Ê	 	
}
Á	Á	 
public
Í	Í	 

async
Í	Í	 
Task
Í	Í	 
<
Í	Í	 
ResponseDTO
Í	Í	 !
>
Í	Í	! "(
CreateCourseVersionComment
Í	Í	# =
(
Í	Í	= >
ClaimsPrincipal
Í	Í	> M
User
Í	Í	N R
,
Í	Í	R S,
CreateCourseVersionCommentsDTO
Î	Î	 &,
createCourseVersionCommentsDTO
Î	Î	' E
)
Î	Î	E F
{
Ï	Ï	 
try
Ì	Ì	 
{
Ó	Ó	 	
var
		 
courseVersionId
		 
=
		  !
await
Ò	Ò	 
_unitOfWork
Ò	Ò	 !
.
Ò	Ò	! "%
CourseVersionRepository
Ò	Ò	" 9
.
Ò	Ò	9 :
GetAsync
Ò	Ò	: B
(
Ò	Ò	B C
c
Ò	Ò	C D
=>
Ò	Ò	E G
c
Ú	Ú	 
.
Ú	Ú	 
Id
Ú	Ú	 
==
Ú	Ú	 ,
createCourseVersionCommentsDTO
Ú	Ú	 :
.
Ú	Ú	: ;
CourseVersionId
Ú	Ú	; J
)
Ú	Ú	J K
;
Ú	Ú	K L
if
Û	Û	 
(
Û	Û	 
courseVersionId
Û	Û	 
==
Û	Û	  "
null
Û	Û	# '
)
Û	Û	' (
{
Ù	Ù	 
return
ı	ı	 
new
ı	ı	 
ResponseDTO
ı	ı	 &
(
ı	ı	& '
)
ı	ı	' (
{
ˆ	ˆ	 
Message
˜	˜	 
=
˜	˜	 
$str
˜	˜	 7
,
˜	˜	7 8
Result
¯	¯	 
=
¯	¯	 
null
¯	¯	 !
,
¯	¯	! "
	IsSuccess
˘	˘	 
=
˘	˘	 
false
˘	˘	  %
,
˘	˘	% &

StatusCode
˙	˙	 
=
˙	˙	  
$num
˙	˙	! $
}
˚	˚	 
;
˚	˚	 
}
¸	¸	 
var
˛	˛	 
userId
˛	˛	 
=
˛	˛	 
User
˛	˛	 
.
˛	˛	 
Claims
˛	˛	 $
.
˛	˛	$ %
FirstOrDefault
˛	˛	% 3
(
˛	˛	3 4
x
˛	˛	4 5
=>
˛	˛	6 8
x
˛	˛	9 :
.
˛	˛	: ;
Type
˛	˛	; ?
==
˛	˛	@ B

ClaimTypes
˛	˛	C M
.
˛	˛	M N
NameIdentifier
˛	˛	N \
)
˛	˛	\ ]
?
˛	˛	] ^
.
˛	˛	^ _
Value
˛	˛	_ d
;
˛	˛	d e
var
ˇ	ˇ	 
admin
ˇ	ˇ	 
=
ˇ	ˇ	 
await
ˇ	ˇ	 
_unitOfWork
ˇ	ˇ	 )
.
ˇ	ˇ	) *#
UserManagerRepository
ˇ	ˇ	* ?
.
ˇ	ˇ	? @
FindByIdAsync
ˇ	ˇ	@ M
(
ˇ	ˇ	M N
userId
ˇ	ˇ	N T
)
ˇ	ˇ	T U
;
ˇ	ˇ	U V"
CourseVersionComment
Ç
Ç
  
comment
Ç
Ç
! (
=
Ç
Ç
) *
new
Ç
Ç
+ ."
CourseVersionComment
Ç
Ç
/ C
(
Ç
Ç
C D
)
Ç
Ç
D E
{
É
É
 
Comment
Ñ
Ñ
 
=
Ñ
Ñ
 ,
createCourseVersionCommentsDTO
Ñ
Ñ
 8
.
Ñ
Ñ
8 9
Comment
Ñ
Ñ
9 @
,
Ñ
Ñ
@ A
CourseVersionId
Ö
Ö
 
=
Ö
Ö
  !,
createCourseVersionCommentsDTO
Ö
Ö
" @
.
Ö
Ö
@ A
CourseVersionId
Ö
Ö
A P
,
Ö
Ö
P Q
	CreatedBy
Ü
Ü
 
=
Ü
Ü
 
admin
Ü
Ü
 !
.
Ü
Ü
! "
Email
Ü
Ü
" '
,
Ü
Ü
' (
CreatedTime
á
á
 
=
á
á
 
DateTime
á
á
 &
.
á
á
& '
Now
á
á
' *
,
á
á
* +
UpdatedTime
à
à
 
=
à
à
 
null
à
à
 "
,
à
à
" #
	UpdatedBy
â
â
 
=
â
â
 
$str
â
â
 
,
â
â
 
Status
ä
ä
 
=
ä
ä
 
$num
ä
ä
 
}
ã
ã
 
;
ã
ã
 
await
é
é
 
_unitOfWork
é
é
 
.
é
é
 ,
CourseVersionCommentRepository
é
é
 <
.
é
é
< =
AddAsync
é
é
= E
(
é
é
E F
comment
é
é
F M
)
é
é
M N
;
é
é
N O
await
è
è
 
_unitOfWork
è
è
 
.
è
è
 
	SaveAsync
è
è
 '
(
è
è
' (
)
è
è
( )
;
è
è
) *
return
ë
ë
 
new
ë
ë
 
ResponseDTO
ë
ë
 "
(
ë
ë
" #
)
ë
ë
# $
{
í
í
 
Message
ì
ì
 
=
ì
ì
 
$str
ì
ì
 8
,
ì
ì
8 9
Result
î
î
 
=
î
î
 
comment
î
î
  
,
î
î
  !
	IsSuccess
ï
ï
 
=
ï
ï
 
true
ï
ï
  
,
ï
ï
  !

StatusCode
ñ
ñ
 
=
ñ
ñ
 
$num
ñ
ñ
  
,
ñ
ñ
  !
}
ó
ó
 
;
ó
ó
 
}
ò
ò
 	
catch
ô
ô
 
(
ô
ô
 
	Exception
ô
ô
 
e
ô
ô
 
)
ô
ô
 
{
ö
ö
 	
return
õ
õ
 
new
õ
õ
 
ResponseDTO
õ
õ
 "
{
ú
ú
 
Message
ù
ù
 
=
ù
ù
 
e
ù
ù
 
.
ù
ù
 
Message
ù
ù
 #
,
ù
ù
# $
Result
û
û
 
=
û
û
 
null
û
û
 
,
û
û
 
	IsSuccess
ü
ü
 
=
ü
ü
 
false
ü
ü
 !
,
ü
ü
! "

StatusCode
†
†
 
=
†
†
 
$num
†
†
  
}
°
°
 
;
°
°
 
}
¢
¢
 	
}
£
£
 
public
¶
¶
 

async
¶
¶
 
Task
¶
¶
 
<
¶
¶
 
ResponseDTO
¶
¶
 !
>
¶
¶
! "&
EditCourseVersionComment
¶
¶
# ;
(
¶
¶
; <
ClaimsPrincipal
¶
¶
< K
User
¶
¶
L P
,
¶
¶
P Q*
EditCourseVersionCommentsDTO
ß
ß
 $*
editCourseVersionCommentsDTO
ß
ß
% A
)
ß
ß
A B
{
®
®
 
try
©
©
 
{
™
™
 	
var
¨
¨
 
courseVersionId
¨
¨
 
=
¨
¨
  !
await
≠
≠
 
_unitOfWork
≠
≠
 !
.
≠
≠
! ",
CourseVersionCommentRepository
≠
≠
" @
.
≠
≠
@ A
GetAsync
≠
≠
A I
(
≠
≠
I J
c
≠
≠
J K
=>
≠
≠
L N
c
Æ
Æ
 
.
Æ
Æ
 
Id
Æ
Æ
 
==
Æ
Æ
 *
editCourseVersionCommentsDTO
Æ
Æ
 8
.
Æ
Æ
8 9
Id
Æ
Æ
9 ;
)
Æ
Æ
; <
;
Æ
Æ
< =
if
Ø
Ø
 
(
Ø
Ø
 
courseVersionId
Ø
Ø
 
==
Ø
Ø
  "
null
Ø
Ø
# '
)
Ø
Ø
' (
{
∞
∞
 
return
±
±
 
new
±
±
 
ResponseDTO
±
±
 &
(
±
±
& '
)
±
±
' (
{
≤
≤
 
Message
≥
≥
 
=
≥
≥
 
$str
≥
≥
 7
,
≥
≥
7 8
Result
¥
¥
 
=
¥
¥
 
null
¥
¥
 !
,
¥
¥
! "
	IsSuccess
µ
µ
 
=
µ
µ
 
false
µ
µ
  %
,
µ
µ
% &

StatusCode
∂
∂
 
=
∂
∂
  
$num
∂
∂
! $
}
∑
∑
 
;
∑
∑
 
}
∏
∏
 
var
∫
∫
 
userId
∫
∫
 
=
∫
∫
 
User
∫
∫
 
.
∫
∫
 
Claims
∫
∫
 $
.
∫
∫
$ %
FirstOrDefault
∫
∫
% 3
(
∫
∫
3 4
x
∫
∫
4 5
=>
∫
∫
6 8
x
∫
∫
9 :
.
∫
∫
: ;
Type
∫
∫
; ?
==
∫
∫
@ B

ClaimTypes
∫
∫
C M
.
∫
∫
M N
NameIdentifier
∫
∫
N \
)
∫
∫
\ ]
?
∫
∫
] ^
.
∫
∫
^ _
Value
∫
∫
_ d
;
∫
∫
d e
var
ª
ª
 
admin
ª
ª
 
=
ª
ª
 
await
ª
ª
 
_unitOfWork
ª
ª
 )
.
ª
ª
) *#
UserManagerRepository
ª
ª
* ?
.
ª
ª
? @
FindByIdAsync
ª
ª
@ M
(
ª
ª
M N
userId
ª
ª
N T
)
ª
ª
T U
;
ª
ª
U V
courseVersionId
æ
æ
 
.
æ
æ
 
UpdatedTime
æ
æ
 '
=
æ
æ
( )
DateTime
æ
æ
* 2
.
æ
æ
2 3
UtcNow
æ
æ
3 9
;
æ
æ
9 :
courseVersionId
ø
ø
 
.
ø
ø
 
	UpdatedBy
ø
ø
 %
=
ø
ø
& '
admin
ø
ø
( -
.
ø
ø
- .
Email
ø
ø
. 3
;
ø
ø
3 4
courseVersionId
¿
¿
 
.
¿
¿
 
Comment
¿
¿
 #
=
¿
¿
$ %*
editCourseVersionCommentsDTO
¿
¿
& B
.
¿
¿
B C
Comment
¿
¿
C J
;
¿
¿
J K
courseVersionId
¡
¡
 
.
¡
¡
 
Status
¡
¡
 "
=
¡
¡
# $
$num
¡
¡
% &
;
¡
¡
& '
_unitOfWork
√
√
 
.
√
√
 ,
CourseVersionCommentRepository
√
√
 6
.
√
√
6 7
Update
√
√
7 =
(
√
√
= >
courseVersionId
√
√
> M
)
√
√
M N
;
√
√
N O
await
ƒ
ƒ
 
_unitOfWork
ƒ
ƒ
 
.
ƒ
ƒ
 
	SaveAsync
ƒ
ƒ
 '
(
ƒ
ƒ
' (
)
ƒ
ƒ
( )
;
ƒ
ƒ
) *
return
∆
∆
 
new
∆
∆
 
ResponseDTO
∆
∆
 "
(
∆
∆
" #
)
∆
∆
# $
{
«
«
 
Message
»
»
 
=
»
»
 
$str
»
»
 7
,
»
»
7 8
Result
…
…
 
=
…
…
 
null
…
…
 
,
…
…
 
	IsSuccess
 
 
 
=
 
 
 
true
 
 
  
,
 
 
  !

StatusCode
À
À
 
=
À
À
 
$num
À
À
  
,
À
À
  !
}
Ã
Ã
 
;
Ã
Ã
 
}
Õ
Õ
 	
catch
Œ
Œ
 
(
Œ
Œ
 
	Exception
Œ
Œ
 
e
Œ
Œ
 
)
Œ
Œ
 
{
œ
œ
 	
return
–
–
 
new
–
–
 
ResponseDTO
–
–
 "
{
—
—
 
Message
“
“
 
=
“
“
 
e
“
“
 
.
“
“
 
Message
“
“
 #
,
“
“
# $
Result
”
”
 
=
”
”
 
null
”
”
 
,
”
”
 
	IsSuccess
‘
‘
 
=
‘
‘
 
false
‘
‘
 !
,
‘
‘
! "

StatusCode
’
’
 
=
’
’
 
$num
’
’
  
}
÷
÷
 
;
÷
÷
 
}
◊
◊
 	
}
ÿ
ÿ
 
public
€
€
 

async
€
€
 
Task
€
€
 
<
€
€
 
ResponseDTO
€
€
 !
>
€
€
! "(
RemoveCourseVersionComment
€
€
# =
(
€
€
= >
ClaimsPrincipal
€
€
> M
User
€
€
N R
,
€
€
R S
Guid
‹
‹
 
	commentId
‹
‹
 
)
‹
‹
 
{
›
›
 
try
ﬁ
ﬁ
 
{
ﬂ
ﬂ
 	
var
·
·
 
courseVersionId
·
·
 
=
·
·
  !
await
‚
‚
 
_unitOfWork
‚
‚
 !
.
‚
‚
! ",
CourseVersionCommentRepository
‚
‚
" @
.
‚
‚
@ A
GetAsync
‚
‚
A I
(
‚
‚
I J
c
‚
‚
J K
=>
‚
‚
L N
c
„
„
 
.
„
„
 
Id
„
„
 
==
„
„
 
	commentId
„
„
 %
)
„
„
% &
;
„
„
& '
if
‰
‰
 
(
‰
‰
 
courseVersionId
‰
‰
 
==
‰
‰
  "
null
‰
‰
# '
)
‰
‰
' (
{
Â
Â
 
return
Ê
Ê
 
new
Ê
Ê
 
ResponseDTO
Ê
Ê
 &
(
Ê
Ê
& '
)
Ê
Ê
' (
{
Á
Á
 
Message
Ë
Ë
 
=
Ë
Ë
 
$str
Ë
Ë
 7
,
Ë
Ë
7 8
Result
È
È
 
=
È
È
 
null
È
È
 !
,
È
È
! "
	IsSuccess
Í
Í
 
=
Í
Í
 
false
Í
Í
  %
,
Í
Í
% &

StatusCode
Î
Î
 
=
Î
Î
  
$num
Î
Î
! $
}
Ï
Ï
 
;
Ï
Ï
 
}
Ì
Ì
 
var
Ô
Ô
 
userId
Ô
Ô
 
=
Ô
Ô
 
User
Ô
Ô
 
.
Ô
Ô
 
Claims
Ô
Ô
 $
.
Ô
Ô
$ %
FirstOrDefault
Ô
Ô
% 3
(
Ô
Ô
3 4
x
Ô
Ô
4 5
=>
Ô
Ô
6 8
x
Ô
Ô
9 :
.
Ô
Ô
: ;
Type
Ô
Ô
; ?
==
Ô
Ô
@ B

ClaimTypes
Ô
Ô
C M
.
Ô
Ô
M N
NameIdentifier
Ô
Ô
N \
)
Ô
Ô
\ ]
?
Ô
Ô
] ^
.
Ô
Ô
^ _
Value
Ô
Ô
_ d
;
Ô
Ô
d e
var


 
admin


 
=


 
await


 
_unitOfWork


 )
.


) *#
UserManagerRepository


* ?
.


? @
FindByIdAsync


@ M
(


M N
userId


N T
)


T U
;


U V
courseVersionId
Ú
Ú
 
.
Ú
Ú
 
UpdatedTime
Ú
Ú
 '
=
Ú
Ú
( )
DateTime
Ú
Ú
* 2
.
Ú
Ú
2 3
UtcNow
Ú
Ú
3 9
;
Ú
Ú
9 :
courseVersionId
Û
Û
 
.
Û
Û
 
	UpdatedBy
Û
Û
 %
=
Û
Û
& '
admin
Û
Û
( -
.
Û
Û
- .
Email
Û
Û
. 3
;
Û
Û
3 4
courseVersionId
Ù
Ù
 
.
Ù
Ù
 
Status
Ù
Ù
 "
=
Ù
Ù
# $
$num
Ù
Ù
% &
;
Ù
Ù
& '
_unitOfWork
ˆ
ˆ
 
.
ˆ
ˆ
 ,
CourseVersionCommentRepository
ˆ
ˆ
 6
.
ˆ
ˆ
6 7
Update
ˆ
ˆ
7 =
(
ˆ
ˆ
= >
courseVersionId
ˆ
ˆ
> M
)
ˆ
ˆ
M N
;
ˆ
ˆ
N O
await
˜
˜
 
_unitOfWork
˜
˜
 
.
˜
˜
 
	SaveAsync
˜
˜
 '
(
˜
˜
' (
)
˜
˜
( )
;
˜
˜
) *
return
˘
˘
 
new
˘
˘
 
ResponseDTO
˘
˘
 "
(
˘
˘
" #
)
˘
˘
# $
{
˙
˙
 
Message
˚
˚
 
=
˚
˚
 
$str
˚
˚
 8
,
˚
˚
8 9
Result
¸
¸
 
=
¸
¸
 
null
¸
¸
 
,
¸
¸
 
	IsSuccess
˝
˝
 
=
˝
˝
 
true
˝
˝
  
,
˝
˝
  !

StatusCode
˛
˛
 
=
˛
˛
 
$num
˛
˛
  
,
˛
˛
  !
}
ˇ
ˇ
 
;
ˇ
ˇ
 
}
ÄÄ 	
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
e
ÖÖ 
.
ÖÖ 
Message
ÖÖ #
,
ÖÖ# $
Result
ÜÜ 
=
ÜÜ 
null
ÜÜ 
,
ÜÜ 
	IsSuccess
áá 
=
áá 
false
áá !
,
áá! "

StatusCode
àà 
=
àà 
$num
àà  
}
ââ 
;
ââ 
}
ää 	
}
ãã 
public
çç 

async
çç 
Task
çç 
<
çç 
ResponseDTO
çç !
>
çç! ".
 UploadCourseVersionBackgroundImg
çç# C
(
éé 
ClaimsPrincipal
èè 
User
èè 
,
èè 
Guid
êê 
courseVersionId
êê 
,
êê .
 UploadCourseVersionBackgroundImg
ëë (.
 uploadCourseVersionBackgroundImg
ëë) I
)
ëëI J
{
íí 
try
ìì 
{
îî 	
if
ññ 
(
ññ .
 uploadCourseVersionBackgroundImg
ññ 0
.
ññ0 1
File
ññ1 5
==
ññ6 8
null
ññ9 =
)
ññ= >
{
óó 
return
òò 
new
òò 
ResponseDTO
òò &
(
òò& '
)
òò' (
{
ôô 
	IsSuccess
öö 
=
öö 
false
öö  %
,
öö% &

StatusCode
õõ 
=
õõ  
$num
õõ! $
,
õõ$ %
Message
úú 
=
úú 
$str
úú 1
}
ùù 
;
ùù 
}
ûû 
var
†† 
courseVersion
†† 
=
†† 
await
°° 
_unitOfWork
°° !
.
°°! "%
CourseVersionRepository
°°" 9
.
°°9 :
GetAsync
°°: B
(
°°B C
x
°°C D
=>
°°E G
x
°°H I
.
°°I J
Id
°°J L
==
°°M O
courseVersionId
°°P _
)
°°_ `
;
°°` a
if
¢¢ 
(
¢¢ 
courseVersion
¢¢ 
==
¢¢  
null
¢¢! %
)
¢¢% &
{
££ 
return
§§ 
new
§§ 
ResponseDTO
§§ &
(
§§& '
)
§§' (
{
•• 
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
,
ßß$ %
Message
®® 
=
®® 
$str
®® 9
}
©© 
;
©© 
}
™™ 
var
¨¨ 
filePath
¨¨ 
=
¨¨ 
$"
¨¨ 
$str
¨¨ $
{
¨¨$ %
courseVersion
¨¨% 2
.
¨¨2 3
CourseId
¨¨3 ;
}
¨¨; <
$str
¨¨< G
"
¨¨G H
;
¨¨H I
var
ÆÆ 
responseDto
ÆÆ 
=
ÆÆ 
await
ÆÆ #
_firebaseService
ÆÆ$ 4
.
ÆÆ4 5
UploadImage
ÆÆ5 @
(
ÆÆ@ A.
 uploadCourseVersionBackgroundImg
ÆÆA a
.
ÆÆa b
File
ÆÆb f
,
ÆÆf g
filePath
ÆÆh p
)
ÆÆp q
;
ÆÆq r
if
∞∞ 
(
∞∞ 
!
∞∞ 
responseDto
∞∞ 
.
∞∞ 
	IsSuccess
∞∞ &
)
∞∞& '
{
±± 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ &
(
≤≤& '
)
≤≤' (
{
≥≥ 
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥  %
,
¥¥% &

StatusCode
µµ 
=
µµ  
$num
µµ! $
,
µµ$ %
Message
∂∂ 
=
∂∂ 
$str
∂∂ 3
}
∑∑ 
;
∑∑ 
}
∏∏ 
courseVersion
ªª 
.
ªª 
CourseImgUrl
ªª &
=
ªª' (
responseDto
ªª) 4
.
ªª4 5
Result
ªª5 ;
?
ªª; <
.
ªª< =
ToString
ªª= E
(
ªªE F
)
ªªF G
;
ªªG H
_unitOfWork
ºº 
.
ºº %
CourseVersionRepository
ºº /
.
ºº/ 0
Update
ºº0 6
(
ºº6 7
courseVersion
ºº7 D
)
ººD E
;
ººE F
await
ΩΩ 
_unitOfWork
ΩΩ 
.
ΩΩ 
	SaveAsync
ΩΩ '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *
return
øø 
new
øø 
ResponseDTO
øø "
(
øø" #
)
øø# $
{
¿¿ 
	IsSuccess
¡¡ 
=
¡¡ 
true
¡¡  
,
¡¡  !

StatusCode
¬¬ 
=
¬¬ 
$num
¬¬  
,
¬¬  !
Result
√√ 
=
√√ 
responseDto
√√ $
.
√√$ %
Result
√√% +
,
√√+ ,
Message
ƒƒ 
=
ƒƒ 
$str
ƒƒ 4
}
≈≈ 
;
≈≈ 
}
∆∆ 	
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 	
return
…… 
new
…… 
ResponseDTO
…… "
(
……" #
)
……# $
{
   
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ !
,
ÀÀ! "

StatusCode
ÃÃ 
=
ÃÃ 
$num
ÃÃ  
,
ÃÃ  !
Result
ÕÕ 
=
ÕÕ 
null
ÕÕ 
,
ÕÕ 
Message
ŒŒ 
=
ŒŒ 
e
ŒŒ 
.
ŒŒ 
Message
ŒŒ #
}
œœ 
;
œœ 
}
–– 	
}
—— 
public
”” 

async
”” 
Task
”” 
<
”” 
MemoryStream
”” "
>
””" #/
!DisplayCourseVersionBackgroundImg
””$ E
(
””E F
ClaimsPrincipal
””F U
User
””V Z
,
””Z [
Guid
””\ `
courseVersionId
””a p
)
””p q
{
‘‘ 
try
’’ 
{
÷÷ 	
var
◊◊ 
courseVersion
◊◊ 
=
◊◊ 
await
◊◊  %
_unitOfWork
◊◊& 1
.
◊◊1 2%
CourseVersionRepository
◊◊2 I
.
◊◊I J
GetAsync
◊◊J R
(
◊◊R S
x
◊◊S T
=>
◊◊U W
x
◊◊X Y
.
◊◊Y Z
Id
◊◊Z \
==
◊◊] _
courseVersionId
◊◊` o
)
◊◊o p
;
◊◊p q
if
ŸŸ 
(
ŸŸ 
courseVersion
ŸŸ 
!=
ŸŸ  
null
ŸŸ! %
&&
ŸŸ& (
courseVersion
ŸŸ) 6
.
ŸŸ6 7
CourseImgUrl
ŸŸ7 C
.
ŸŸC D
IsNullOrEmpty
ŸŸD Q
(
ŸŸQ R
)
ŸŸR S
)
ŸŸS T
{
⁄⁄ 
return
€€ 
null
€€ 
;
€€ 
}
‹‹ 
var
ﬁﬁ 
stream
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ 
_firebaseService
ﬁﬁ /
.
ﬁﬁ/ 0
GetImage
ﬁﬁ0 8
(
ﬁﬁ8 9
courseVersion
ﬁﬁ9 F
.
ﬁﬁF G
CourseImgUrl
ﬁﬁG S
)
ﬁﬁS T
;
ﬁﬁT U
return
ﬂﬂ 
stream
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 	
return
„„ 
null
„„ 
;
„„ 
}
‰‰ 	
}
ÂÂ 
}ÊÊ Ãõ
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
CourseService 
: 
ICourseService +
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly !
IStudentCourseService *!
_studentCourseService+ @
;@ A
public 

CourseService 
( 
IUnitOfWork 

unitOfWork 
, 
IMapper 
mapper 
, !
IStudentCourseService  
studentCourseService 2
) 
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; !
_studentCourseService 
=  
studentCourseService  4
;4 5
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
CreateFrameCourse# 4
(4 5
ClaimsPrincipal5 D
UserE I
,I J
GuidK O
courseVersionIdP _
)_ `
{   
try!! 
{"" 	
var$$ 
userId$$ 
=$$ 
User$$ 
.$$ 
Claims$$ $
.$$$ %
FirstOrDefault$$% 3
($$3 4
x$$4 5
=>$$6 8
x$$9 :
.$$: ;
Type$$; ?
==$$@ B

ClaimTypes$$C M
.$$M N
NameIdentifier$$N \
)$$\ ]
?$$] ^
.$$^ _
Value$$_ d
;$$d e
var%% 

instructor%% 
=%% 
await%% "
_unitOfWork%%# .
.%%. / 
InstructorRepository%%/ C
.%%C D
GetAsync%%D L
(&& 
filter'' 
:'' 
x'' 
=>'' 
x'' 
.'' 
UserId'' %
==''& (
userId'') /
,''/ 0
includeProperties(( !
:((! "
$str((# 4
))) 
;)) 
if++ 
(++ 

instructor++ 
is++ 
null++ "
)++" #
{,, 
return-- 
new-- 
ResponseDTO-- &
(--& '
)--' (
{.. 
Message// 
=// 
$str// 9
,//9 :
	IsSuccess00 
=00 
false00  %
,00% &

StatusCode11 
=11  
$num11! $
,11$ %
Result22 
=22 
null22 !
}33 
;33 
}44 
if66 
(66 

instructor66 
.66 

IsAccepted66 %
==66& (
false66) .
)66. /
{77 
return88 
new88 
ResponseDTO88 &
(88& '
)88' (
{99 
Message:: 
=:: 
$str:: I
,::I J
	IsSuccess;; 
=;; 
true;;  $
,;;$ %

StatusCode<< 
=<<  
$num<<! $
,<<$ %
Result== 
=== 
null== !
}>> 
;>> 
}?? 
varBB 
courseBB 
=BB 
newBB 
CourseBB #
(BB# $
)BB$ %
{CC 
IdDD 
=DD 
GuidDD 
.DD 
NewGuidDD !
(DD! "
)DD" #
,DD# $
CodeEE 
=EE 
nullEE 
,EE 
InstructorIdFF 
=FF 

instructorFF )
?FF) *
.FF* +
InstructorIdFF+ 7
,FF7 8
CourseVersionIdGG 
=GG  !
courseVersionIdGG" 1
,GG1 2
StatusHH 
=HH 
$numHH 
,HH 
VersionII 
=II 
$numII 
,II 
TotalStudentJJ 
=JJ 
$numJJ  
,JJ  !
	TotalRateKK 
=KK 
$numKK 
,KK 
ActivatedByLL 
=LL 
nullLL "
,LL" #
DeactivatedByMM 
=MM 
nullMM  $
,MM$ %
ActivatedTimeNN 
=NN 
nullNN  $
,NN$ %
DeactivatedTimeOO 
=OO  !
nullOO" &
,OO& '

MergedTimePP 
=PP 
nullPP !
,PP! "
MergedByQQ 
=QQ 
nullQQ 
,QQ  
	CreatedByRR 
=RR 

instructorRR &
?RR& '
.RR' (
ApplicationUserRR( 7
.RR7 8
EmailRR8 =
,RR= >
CreatedTimeSS 
=SS 
DateTimeSS &
.SS& '
UtcNowSS' -
}TT 
;TT 
awaitVV 
_unitOfWorkVV 
.VV 
CourseRepositoryVV .
.VV. /
AddAsyncVV/ 7
(VV7 8
courseVV8 >
)VV> ?
;VV? @
awaitWW 
_unitOfWorkWW 
.WW 
	SaveAsyncWW '
(WW' (
)WW( )
;WW) *
returnYY 
newYY 
ResponseDTOYY "
(YY" #
)YY# $
{ZZ 
Message[[ 
=[[ 
$str[[ <
,[[< =
	IsSuccess\\ 
=\\ 
true\\  
,\\  !

StatusCode]] 
=]] 
$num]]  
,]]  !
Result^^ 
=^^ 
course^^ 
}__ 
;__ 
}`` 	
catchaa 
(aa 
	Exceptionaa 
eaa 
)aa 
{bb 	
returncc 
newcc 
ResponseDTOcc "
(cc" #
)cc# $
{dd 
Messageee 
=ee 
eee 
.ee 
Messageee #
,ee# $

StatusCodeff 
=ff 
$numff  
,ff  !
Resultgg 
=gg 
nullgg 
,gg 
	IsSuccesshh 
=hh 
truehh  
}ii 
;ii 
}jj 	
}kk 
publicmm 

asyncmm 
Taskmm 
<mm 
ResponseDTOmm !
>mm! "

GetCoursesmm# -
(nn 
ClaimsPrincipaloo 
Useroo 
,oo 
Guidpp 
?pp 
instructorIdpp 
,pp 
stringqq 
?qq 
filterOnqq 
,qq 
stringrr 
?rr 
filterQueryrr 
,rr 
doubless 
?ss 
	fromPricess 
,ss 
doublett 
?tt 
toPricett 
,tt 
stringuu 
?uu 
sortByuu 
,uu 
boolvv 
?vv 
isAscendingvv 
,vv 
intww 

pageNumberww 
=ww 
$numww 
,ww 
intxx 
pageSizexx 
=xx 
$numxx 
)yy 
{zz 
try{{ 
{|| 	
if}} 
(}} 
string}} 
.}} 
IsNullOrEmpty}} $
(}}$ %
instructorId}}% 1
.}}1 2
ToString}}2 :
(}}: ;
)}}; <
)}}< =
)}}= >
{~~ 
var 
userId 
= 
User !
.! "
Claims" (
.( )
FirstOrDefault) 7
(7 8
x8 9
=>: <
x= >
.> ?
Type? C
==D F

ClaimTypesG Q
.Q R
NameIdentifierR `
)` a
?a b
.b c
Valuec h
;h i
var
ÄÄ 

instructor
ÄÄ 
=
ÄÄ  
await
ÄÄ! &
_unitOfWork
ÄÄ' 2
.
ÄÄ2 3"
InstructorRepository
ÄÄ3 G
.
ÄÄG H
GetAsync
ÄÄH P
(
ÅÅ 
filter
ÇÇ 
:
ÇÇ 
x
ÇÇ 
=>
ÇÇ  
x
ÇÇ! "
.
ÇÇ" #
UserId
ÇÇ# )
==
ÇÇ* ,
userId
ÇÇ- 3
)
ÉÉ 
;
ÉÉ 
if
ÖÖ 
(
ÖÖ 

instructor
ÖÖ 
is
ÖÖ !
null
ÖÖ" &
)
ÖÖ& '
{
ÜÜ 
return
áá 
new
áá 
ResponseDTO
áá *
(
áá* +
)
áá+ ,
{
àà 
Message
ââ 
=
ââ  !
$str
ââ" 9
,
ââ9 :
	IsSuccess
ää !
=
ää" #
false
ää$ )
,
ää) *

StatusCode
ãã "
=
ãã# $
$num
ãã% (
,
ãã( )
Result
åå 
=
åå  
null
åå! %
}
çç 
;
çç 
}
éé 
instructorId
êê 
=
êê 

instructor
êê )
.
êê) *
InstructorId
êê* 6
;
êê6 7
}
ëë 
var
ìì 
courses
ìì 
=
ìì 
new
ìì 
List
ìì "
<
ìì" #
Course
ìì# )
>
ìì) *
(
ìì* +
)
ìì+ ,
;
ìì, -
if
îî 
(
îî 
string
îî 
.
îî 
IsNullOrEmpty
îî $
(
îî$ %
instructorId
îî% 1
.
îî1 2
ToString
îî2 :
(
îî: ;
)
îî; <
)
îî< =
)
îî= >
{
ïï 
courses
ññ 
=
ññ 
_unitOfWork
ññ %
.
ññ% &
CourseRepository
ññ& 6
.
óó 
GetAllAsync
óó  
(
òò 
filter
ôô 
:
ôô 
x
ôô  !
=>
ôô" $
x
ôô% &
.
ôô& '
Status
ôô' -
==
ôô. 0
$num
ôô1 2
,
ôô2 3
includeProperties
öö )
:
öö) *
$str
öö+ B
)
õõ 
.
úú 

GetAwaiter
úú 
(
úú  
)
úú  !
.
ùù 
	GetResult
ùù 
(
ùù 
)
ùù  
.
ûû 
ToList
ûû 
(
ûû 
)
ûû 
;
ûû 
}
üü 
else
†† 
{
°° 
courses
¢¢ 
=
¢¢ 
_unitOfWork
¢¢ %
.
¢¢% &
CourseRepository
¢¢& 6
.
££ 
GetAllAsync
££  
(
§§ 
filter
•• 
:
•• 
x
••  !
=>
••" $
x
••% &
.
••& '
InstructorId
••' 3
==
••4 6
instructorId
••7 C
)
¶¶ 
.
ßß 

GetAwaiter
ßß 
(
ßß  
)
ßß  !
.
®® 
	GetResult
®® 
(
®® 
)
®®  
.
©© 
ToList
©© 
(
©© 
)
©© 
;
©© 
}
™™ 
var
¨¨ 
courseVersions
¨¨ 
=
¨¨  
new
¨¨! $
List
¨¨% )
<
¨¨) *
CourseVersion
¨¨* 7
>
¨¨7 8
(
¨¨8 9
)
¨¨9 :
;
¨¨: ;
foreach
ÆÆ 
(
ÆÆ 
var
ÆÆ 
course
ÆÆ 
in
ÆÆ  "
courses
ÆÆ# *
)
ÆÆ* +
{
ØØ 
var
∞∞ 
courseVersion
∞∞ !
=
∞∞" #
await
∞∞$ )
_unitOfWork
∞∞* 5
.
∞∞5 6%
CourseVersionRepository
∞∞6 M
.
±± 
GetAsync
±± 
(
±± 
filter
≤≤ 
:
≤≤ 
x
≤≤  !
=>
≤≤" $
x
≤≤% &
.
≤≤& '
Id
≤≤' )
==
≤≤* ,
course
≤≤- 3
.
≤≤3 4
CourseVersionId
≤≤4 C
,
≤≤C D
includeProperties
≥≥ )
:
≥≥) *
$str
≥≥+ ;
)
¥¥ 
;
¥¥ 
if
µµ 
(
µµ 
courseVersion
µµ !
is
µµ" $
not
µµ% (
null
µµ) -
)
µµ- .
{
∂∂ 
courseVersions
∑∑ "
.
∑∑" #
Add
∑∑# &
(
∑∑& '
courseVersion
∑∑' 4
)
∑∑4 5
;
∑∑5 6
}
∏∏ 
}
ππ 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
string
ΩΩ 
.
ΩΩ 
IsNullOrEmpty
ΩΩ %
(
ΩΩ% &
filterOn
ΩΩ& .
)
ΩΩ. /
&&
ΩΩ0 2
!
ΩΩ3 4
string
ΩΩ4 :
.
ΩΩ: ;
IsNullOrEmpty
ΩΩ; H
(
ΩΩH I
filterQuery
ΩΩI T
)
ΩΩT U
)
ΩΩU V
{
ææ 
switch
øø 
(
øø 
filterOn
øø  
.
øø  !
Trim
øø! %
(
øø% &
)
øø& '
.
øø' (
ToLower
øø( /
(
øø/ 0
)
øø0 1
)
øø1 2
{
¿¿ 
case
¡¡ 
$str
¡¡  
:
¡¡  !
{
¬¬ 
courseVersions
√√ *
=
√√+ ,
courseVersions
√√- ;
.
√√; <
Where
√√< A
(
√√A B
x
√√B C
=>
√√D F
x
ƒƒ  !
.
ƒƒ! "
Title
ƒƒ" '
.
ƒƒ' (
Contains
ƒƒ( 0
(
ƒƒ0 1
filterQuery
ƒƒ1 <
,
ƒƒ< =
StringComparison
ƒƒ> N
.
ƒƒN O&
CurrentCultureIgnoreCase
ƒƒO g
)
ƒƒg h
)
ƒƒh i
.
ƒƒi j
ToList
ƒƒj p
(
ƒƒp q
)
ƒƒq r
;
ƒƒr s
break
≈≈ !
;
≈≈! "
}
∆∆ 
case
«« 
$str
«« 
:
««  
{
»» 
courseVersions
…… *
=
……+ ,
courseVersions
……- ;
.
……; <
Where
……< A
(
……A B
x
……B C
=>
……D F
x
    !
.
  ! "
Code
  " &
.
  & '
Contains
  ' /
(
  / 0
filterQuery
  0 ;
,
  ; <
StringComparison
  = M
.
  M N&
CurrentCultureIgnoreCase
  N f
)
  f g
)
  g h
.
  h i
ToList
  i o
(
  o p
)
  p q
;
  q r
break
ÀÀ !
;
ÀÀ! "
}
ÃÃ 
case
ÕÕ 
$str
ÕÕ &
:
ÕÕ& '
{
ŒŒ 
courseVersions
œœ *
=
œœ+ ,
courseVersions
œœ- ;
.
œœ; <
Where
œœ< A
(
œœA B
x
œœB C
=>
œœD F
x
––  !
.
––! "
Description
––" -
.
––- .
Contains
––. 6
(
––6 7
filterQuery
––7 B
,
––B C
StringComparison
––D T
.
––T U&
CurrentCultureIgnoreCase
––U m
)
––m n
)
––n o
.
––o p
ToList
––p v
(
––v w
)
––w x
;
––x y
break
—— !
;
——! "
}
““ 
case
”” 
$str
”” #
:
””# $
{
‘‘ 
courseVersions
’’ *
=
’’+ ,
courseVersions
’’- ;
.
’’; <
Where
’’< A
(
’’A B
x
’’B C
=>
’’D F
x
÷÷  !
.
÷÷! "
Category
÷÷" *
!=
÷÷+ -
null
÷÷. 2
&&
÷÷3 5
x
÷÷6 7
.
÷÷7 8
Category
÷÷8 @
.
÷÷@ A
Name
÷÷A E
.
÷÷E F
Contains
÷÷F N
(
÷÷N O
filterQuery
÷÷O Z
,
÷÷Z [
StringComparison
÷÷\ l
.
÷÷l m'
CurrentCultureIgnoreCase÷÷m Ö
)÷÷Ö Ü
)÷÷Ü á
.÷÷á à
ToList÷÷à é
(÷÷é è
)÷÷è ê
;÷÷ê ë
break
◊◊ !
;
◊◊! "
}
ÿÿ 
case
ŸŸ 
$str
ŸŸ %
:
ŸŸ% &
{
⁄⁄ 
courseVersions
€€ *
=
€€+ ,
courseVersions
€€- ;
.
€€; <
Where
€€< A
(
€€A B
x
€€B C
=>
€€D F
x
‹‹  !
.
‹‹! "
Course
‹‹" (
.
‹‹( )

Instructor
‹‹) 3
!=
‹‹4 6
null
‹‹7 ;
&&
‹‹< >
x
‹‹? @
.
‹‹@ A
Course
‹‹A G
.
‹‹G H

Instructor
‹‹H R
.
‹‹R S
ApplicationUser
‹‹S b
.
‹‹b c
FullName
‹‹c k
.
‹‹k l
Contains
‹‹l t
(
‹‹t u
filterQuery‹‹u Ä
,‹‹Ä Å 
StringComparison‹‹Ç í
.‹‹í ì(
CurrentCultureIgnoreCase‹‹ì ´
)‹‹´ ¨
)‹‹¨ ≠
.‹‹≠ Æ
ToList‹‹Æ ¥
(‹‹¥ µ
)‹‹µ ∂
;‹‹∂ ∑
break
›› !
;
››! "
}
ﬁﬁ 
case
ﬂﬂ 
$str
ﬂﬂ !
:
ﬂﬂ! "
{
‡‡ 
courseVersions
·· *
=
··+ ,
courseVersions
··- ;
.
··; <
Where
··< A
(
··A B
x
··B C
=>
··D F
x
‚‚  !
.
‚‚! "
CurrentStatus
‚‚" /
==
‚‚0 2
int
‚‚3 6
.
‚‚6 7
Parse
‚‚7 <
(
‚‚< =
filterQuery
‚‚= H
.
‚‚H I
Trim
‚‚I M
(
‚‚M N
)
‚‚N O
)
‚‚O P
)
‚‚P Q
.
‚‚Q R
ToList
‚‚R X
(
‚‚X Y
)
‚‚Y Z
;
‚‚Z [
break
„„ !
;
„„! "
}
‰‰ 
}
ÂÂ 
}
ÊÊ 
if
ÈÈ 
(
ÈÈ 
toPrice
ÈÈ 
is
ÈÈ 
not
ÈÈ 
null
ÈÈ #
&&
ÈÈ$ &
	fromPrice
ÈÈ' 0
is
ÈÈ1 3
not
ÈÈ4 7
null
ÈÈ8 <
)
ÈÈ< =
{
ÍÍ 
if
ÎÎ 
(
ÎÎ 
toPrice
ÎÎ 
>=
ÎÎ 
$num
ÎÎ  
)
ÎÎ  !
{
ÏÏ 
courseVersions
ÌÌ "
=
ÌÌ# $
	fromPrice
ÌÌ% .
>=
ÌÌ/ 1
toPrice
ÌÌ2 9
?
ÓÓ 
courseVersions
ÓÓ (
.
ÓÓ( )
Where
ÓÓ) .
(
ÓÓ. /
x
ÓÓ/ 0
=>
ÓÓ1 3
x
ÓÓ4 5
.
ÓÓ5 6
Price
ÓÓ6 ;
>=
ÓÓ< >
toPrice
ÓÓ? F
&&
ÓÓG I
x
ÓÓJ K
.
ÓÓK L
Price
ÓÓL Q
<=
ÓÓR T
	fromPrice
ÓÓU ^
)
ÓÓ^ _
.
ÓÓ_ `
ToList
ÓÓ` f
(
ÓÓf g
)
ÓÓg h
:
ÔÔ 
courseVersions
ÔÔ (
.
ÔÔ( )
Where
ÔÔ) .
(
ÔÔ. /
x
ÔÔ/ 0
=>
ÔÔ1 3
x
ÔÔ4 5
.
ÔÔ5 6
Price
ÔÔ6 ;
>=
ÔÔ< >
toPrice
ÔÔ? F
)
ÔÔF G
.
ÔÔG H
ToList
ÔÔH N
(
ÔÔN O
)
ÔÔO P
;
ÔÔP Q
}
 
}
ÒÒ 
if
ÙÙ 
(
ÙÙ 
!
ÙÙ 
string
ÙÙ 
.
ÙÙ 
IsNullOrEmpty
ÙÙ %
(
ÙÙ% &
sortBy
ÙÙ& ,
)
ÙÙ, -
)
ÙÙ- .
{
ıı 
switch
ˆˆ 
(
ˆˆ 
sortBy
ˆˆ 
.
ˆˆ 
Trim
ˆˆ #
(
ˆˆ# $
)
ˆˆ$ %
.
ˆˆ% &
ToLower
ˆˆ& -
(
ˆˆ- .
)
ˆˆ. /
)
ˆˆ/ 0
{
˜˜ 
case
¯¯ 
$str
¯¯  
:
¯¯  !
{
˘˘ 
courseVersions
˙˙ *
=
˙˙+ ,
isAscending
˙˙- 8
==
˙˙9 ;
true
˙˙< @
?
˚˚  !
[
˚˚" #
..
˚˚# %
courseVersions
˚˚& 4
.
˚˚4 5
OrderBy
˚˚5 <
(
˚˚< =
x
˚˚= >
=>
˚˚? A
x
˚˚B C
.
˚˚C D
Title
˚˚D I
)
˚˚I J
]
˚˚J K
:
¸¸  !
[
¸¸" #
..
¸¸# %
courseVersions
¸¸& 4
.
¸¸4 5
OrderByDescending
¸¸5 F
(
¸¸F G
x
¸¸G H
=>
¸¸I K
x
¸¸L M
.
¸¸M N
Title
¸¸N S
)
¸¸S T
]
¸¸T U
;
¸¸U V
break
˝˝ !
;
˝˝! "
}
˛˛ 
case
ˇˇ 
$str
ˇˇ 
:
ˇˇ  
{
ÄÄ 
courseVersions
ÅÅ *
=
ÅÅ+ ,
isAscending
ÅÅ- 8
==
ÅÅ9 ;
true
ÅÅ< @
?
ÇÇ  !
[
ÇÇ" #
..
ÇÇ# %
courseVersions
ÇÇ& 4
.
ÇÇ4 5
OrderBy
ÇÇ5 <
(
ÇÇ< =
x
ÇÇ= >
=>
ÇÇ? A
x
ÇÇB C
.
ÇÇC D
Code
ÇÇD H
)
ÇÇH I
]
ÇÇI J
:
ÉÉ  !
[
ÉÉ" #
..
ÉÉ# %
courseVersions
ÉÉ& 4
.
ÉÉ4 5
OrderByDescending
ÉÉ5 F
(
ÉÉF G
x
ÉÉG H
=>
ÉÉI K
x
ÉÉL M
.
ÉÉM N
Code
ÉÉN R
)
ÉÉR S
]
ÉÉS T
;
ÉÉT U
break
ÑÑ !
;
ÑÑ! "
}
ÖÖ 
case
ÜÜ 
$str
ÜÜ &
:
ÜÜ& '
{
áá 
courseVersions
àà *
=
àà+ ,
isAscending
àà- 8
==
àà9 ;
true
àà< @
?
ââ  !
[
ââ" #
..
ââ# %
courseVersions
ââ& 4
.
ââ4 5
OrderBy
ââ5 <
(
ââ< =
x
ââ= >
=>
ââ? A
x
ââB C
.
ââC D
Description
ââD O
)
ââO P
]
ââP Q
:
ää  !
[
ää" #
..
ää# %
courseVersions
ää& 4
.
ää4 5
OrderByDescending
ää5 F
(
ääF G
x
ääG H
=>
ääI K
x
ääL M
.
ääM N
Description
ääN Y
)
ääY Z
]
ääZ [
;
ää[ \
break
ãã !
;
ãã! "
}
åå 
case
çç 
$str
çç  
:
çç  !
{
éé 
courseVersions
èè *
=
èè+ ,
isAscending
èè- 8
==
èè9 ;
true
èè< @
?
êê  !
[
êê" #
..
êê# %
courseVersions
êê& 4
.
êê4 5
OrderBy
êê5 <
(
êê< =
x
êê= >
=>
êê? A
x
êêB C
.
êêC D
Price
êêD I
)
êêI J
]
êêJ K
:
ëë  !
[
ëë" #
..
ëë# %
courseVersions
ëë& 4
.
ëë4 5
OrderByDescending
ëë5 F
(
ëëF G
x
ëëG H
=>
ëëI K
x
ëëL M
.
ëëM N
Price
ëëN S
)
ëëS T
]
ëëT U
;
ëëU V
break
íí !
;
íí! "
}
ìì 
default
îî 
:
îî 
{
ïï 
break
ññ !
;
ññ! "
}
óó 
}
òò 
}
ôô 
courseVersions
úú 
=
úú 
courseVersions
úú +
.
úú+ ,
OrderByDescending
úú, =
(
úú= >
cv
úú> @
=>
úúA C
cv
úúD F
.
úúF G
Course
úúG M
.
úúM N
TotalStudent
úúN Z
)
úúZ [
.
úú[ \
ToList
úú\ b
(
úúb c
)
úúc d
;
úúd e
if
üü 
(
üü 

pageNumber
üü 
>
üü 
$num
üü 
&&
üü !
pageSize
üü" *
>
üü+ ,
$num
üü- .
)
üü. /
{
†† 
var
°° 

skipResult
°° 
=
°°  
(
°°! "

pageNumber
°°" ,
-
°°- .
$num
°°/ 0
)
°°0 1
*
°°2 3
pageSize
°°4 <
;
°°< =
courseVersions
¢¢ 
=
¢¢  
courseVersions
¢¢! /
.
¢¢/ 0
Skip
¢¢0 4
(
¢¢4 5

skipResult
¢¢5 ?
)
¢¢? @
.
¢¢@ A
Take
¢¢A E
(
¢¢E F
pageSize
¢¢F N
)
¢¢N O
.
¢¢O P
ToList
¢¢P V
(
¢¢V W
)
¢¢W X
;
¢¢X Y
}
££ 
var
•• 
courseVersionDto
••  
=
••! "
_mapper
••# *
.
••* +
Map
••+ .
<
••. /
List
••/ 3
<
••3 4!
GetCourseVersionDTO
••4 G
>
••G H
>
••H I
(
••I J
courseVersions
••J X
)
••X Y
;
••Y Z
return
ßß 
new
ßß 
ResponseDTO
ßß "
(
ßß" #
)
ßß# $
{
®® 
Result
©© 
=
©© 
courseVersionDto
©© )
,
©©) *
Message
™™ 
=
™™ 
$str
™™ 4
,
™™4 5
	IsSuccess
´´ 
=
´´ 
true
´´  
,
´´  !

StatusCode
¨¨ 
=
¨¨ 
$num
¨¨  
}
≠≠ 
;
≠≠ 
}
ÆÆ 	
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 	
return
±± 
new
±± 
ResponseDTO
±± "
(
±±" #
)
±±# $
{
≤≤ 
Message
≥≥ 
=
≥≥ 
e
≥≥ 
.
≥≥ 
Message
≥≥ #
,
≥≥# $

StatusCode
¥¥ 
=
¥¥ 
$num
¥¥  
,
¥¥  !
Result
µµ 
=
µµ 
null
µµ 
,
µµ 
	IsSuccess
∂∂ 
=
∂∂ 
false
∂∂ !
}
∑∑ 
;
∑∑ 
}
∏∏ 	
}
ππ 
public
ªª 

async
ªª 
Task
ªª 
<
ªª 
ResponseDTO
ªª !
>
ªª! "$
GetTopPurchasedCourses
ªª# 9
(
ªª9 :
int
ºº 
?
ºº 
year
ºº 
=
ºº 
null
ºº 
,
ºº 
int
ΩΩ 
?
ΩΩ 
month
ΩΩ 
=
ΩΩ 
null
ΩΩ 
,
ΩΩ 
int
ææ 
?
ææ 
quarter
ææ 
=
ææ 
null
ææ 
,
ææ 
int
øø 
top
øø 
=
øø 
$num
øø 
,
øø 
int
¿¿ 

pageNumber
¿¿ 
=
¿¿ 
$num
¿¿ 
,
¿¿ 
int
¡¡ 
pageSize
¡¡ 
=
¡¡ 
$num
¡¡ 
,
¡¡ 
string
¬¬ 
?
¬¬ 
byCategoryName
¬¬ 
=
¬¬  
null
¬¬! %
)
√√ 
{
ƒƒ 
try
≈≈ 
{
∆∆ 	
var
»» !
studentCoursesQuery
»» #
=
»»$ %
_unitOfWork
»»& 1
.
»»1 2%
StudentCourseRepository
»»2 I
.
»»I J
GetAllAsync
»»J U
(
»»U V
sc
…… 
=>
…… 
sc
…… 
.
…… 
CreatedTime
…… $
.
……$ %
HasValue
……% -
,
……- .
includeProperties
   !
:
  ! "
$str
  # +
)
ÀÀ 
;
ÀÀ 
var
ÕÕ 
studentCourses
ÕÕ 
=
ÕÕ  
(
ÕÕ! "
await
ÕÕ" '!
studentCoursesQuery
ÕÕ( ;
)
ÕÕ; <
.
ÕÕ< =
ToList
ÕÕ= C
(
ÕÕC D
)
ÕÕD E
;
ÕÕE F
if
–– 
(
–– 
year
–– 
.
–– 
HasValue
–– 
)
–– 
{
—— 
studentCourses
““ 
=
““  
studentCourses
““! /
.
”” 
Where
”” 
(
”” 
sc
”” 
=>
””  
sc
””! #
.
””# $
CreatedTime
””$ /
.
””/ 0
Value
””0 5
.
””5 6
Year
””6 :
==
””; =
year
””> B
.
””B C
Value
””C H
)
””H I
.
‘‘ 
ToList
‘‘ 
(
‘‘ 
)
‘‘ 
;
‘‘ 
}
’’ 
if
◊◊ 
(
◊◊ 
month
◊◊ 
.
◊◊ 
HasValue
◊◊ 
)
◊◊ 
{
ÿÿ 
studentCourses
ŸŸ 
=
ŸŸ  
studentCourses
ŸŸ! /
.
⁄⁄ 
Where
⁄⁄ 
(
⁄⁄ 
sc
⁄⁄ 
=>
⁄⁄  
sc
⁄⁄! #
.
⁄⁄# $
CreatedTime
⁄⁄$ /
.
⁄⁄/ 0
Value
⁄⁄0 5
.
⁄⁄5 6
Month
⁄⁄6 ;
==
⁄⁄< >
month
⁄⁄? D
.
⁄⁄D E
Value
⁄⁄E J
)
⁄⁄J K
.
€€ 
ToList
€€ 
(
€€ 
)
€€ 
;
€€ 
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ 
quarter
ﬁﬁ 
.
ﬁﬁ 
HasValue
ﬁﬁ  
)
ﬁﬁ  !
{
ﬂﬂ 
int
‡‡ 

startMonth
‡‡ 
=
‡‡  
(
‡‡! "
quarter
‡‡" )
.
‡‡) *
Value
‡‡* /
-
‡‡0 1
$num
‡‡2 3
)
‡‡3 4
*
‡‡5 6
$num
‡‡7 8
+
‡‡9 :
$num
‡‡; <
;
‡‡< =
int
·· 
endMonth
·· 
=
·· 

startMonth
·· )
+
··* +
$num
··, -
;
··- .
studentCourses
‚‚ 
=
‚‚  
studentCourses
‚‚! /
.
„„ 
Where
„„ 
(
„„ 
sc
„„ 
=>
„„  
sc
„„! #
.
„„# $
CreatedTime
„„$ /
.
„„/ 0
Value
„„0 5
.
„„5 6
Month
„„6 ;
>=
„„< >

startMonth
„„? I
&&
„„J L
sc
„„M O
.
„„O P
CreatedTime
„„P [
.
„„[ \
Value
„„\ a
.
„„a b
Month
„„b g
<=
„„h j
endMonth
„„k s
)
„„s t
.
‰‰ 
ToList
‰‰ 
(
‰‰ 
)
‰‰ 
;
‰‰ 
}
ÂÂ 
var
ËË 
courseVersionIds
ËË  
=
ËË! "
studentCourses
ËË# 1
.
ÈÈ 
Select
ÈÈ 
(
ÈÈ 
sc
ÈÈ 
=>
ÈÈ 
sc
ÈÈ  
.
ÈÈ  !
Course
ÈÈ! '
.
ÈÈ' (
CourseVersionId
ÈÈ( 7
)
ÈÈ7 8
.
ÍÍ 
Distinct
ÍÍ 
(
ÍÍ 
)
ÍÍ 
.
ÎÎ 
ToList
ÎÎ 
(
ÎÎ 
)
ÎÎ 
;
ÎÎ 
var
ÓÓ 
courseVersions
ÓÓ 
=
ÓÓ  
(
ÓÓ! "
await
ÓÓ" '
_unitOfWork
ÓÓ( 3
.
ÓÓ3 4%
CourseVersionRepository
ÓÓ4 K
.
ÓÓK L
GetAllAsync
ÓÓL W
(
ÓÓW X
cv
ÔÔ 
=>
ÔÔ 
courseVersionIds
ÔÔ &
.
ÔÔ& '
Contains
ÔÔ' /
(
ÔÔ/ 0
cv
ÔÔ0 2
.
ÔÔ2 3
Id
ÔÔ3 5
)
ÔÔ5 6
,
ÔÔ6 7
includeProperties
 !
:
! "
$str
# -
)
ÒÒ 
)
ÒÒ 
.
ÒÒ 
ToList
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ 
if
ÙÙ 
(
ÙÙ 
!
ÙÙ 
string
ÙÙ 
.
ÙÙ 
IsNullOrEmpty
ÙÙ %
(
ÙÙ% &
byCategoryName
ÙÙ& 4
)
ÙÙ4 5
)
ÙÙ5 6
{
ıı 
courseVersions
ˆˆ 
=
ˆˆ  
courseVersions
ˆˆ! /
.
˜˜ 
Where
˜˜ 
(
˜˜ 
cv
˜˜ 
=>
˜˜  
cv
˜˜! #
.
˜˜# $
Category
˜˜$ ,
!=
˜˜- /
null
˜˜0 4
&&
˜˜5 7
cv
¯¯! #
.
¯¯# $
Category
¯¯$ ,
.
¯¯, -
Name
¯¯- 1
.
¯¯1 2
Contains
¯¯2 :
(
¯¯: ;
byCategoryName
¯¯; I
,
¯¯I J
StringComparison
¯¯K [
.
¯¯[ \&
CurrentCultureIgnoreCase
¯¯\ t
)
¯¯t u
)
¯¯u v
.
˘˘ 
ToList
˘˘ 
(
˘˘ 
)
˘˘ 
;
˘˘ 
}
˙˙ 
studentCourses
˝˝ 
=
˝˝ 
studentCourses
˝˝ +
.
˛˛ 
Where
˛˛ 
(
˛˛ 
sc
˛˛ 
=>
˛˛ 
courseVersions
˛˛ +
.
˛˛+ ,
Any
˛˛, /
(
˛˛/ 0
cv
˛˛0 2
=>
˛˛3 5
cv
˛˛6 8
.
˛˛8 9
Id
˛˛9 ;
==
˛˛< >
sc
˛˛? A
.
˛˛A B
Course
˛˛B H
.
˛˛H I
CourseVersionId
˛˛I X
)
˛˛X Y
)
˛˛Y Z
.
ˇˇ 
ToList
ˇˇ 
(
ˇˇ 
)
ˇˇ 
;
ˇˇ 
studentCourses
ÇÇ 
=
ÇÇ 
studentCourses
ÇÇ +
.
ÇÇ+ ,
OrderByDescending
ÇÇ, =
(
ÇÇ= >
sc
ÇÇ> @
=>
ÇÇA C
sc
ÇÇD F
.
ÇÇF G
CreatedTime
ÇÇG R
)
ÇÇR S
.
ÇÇS T
ToList
ÇÇT Z
(
ÇÇZ [
)
ÇÇ[ \
;
ÇÇ\ ]
int
ÖÖ 
skip
ÖÖ 
=
ÖÖ 
(
ÖÖ 

pageNumber
ÖÖ "
-
ÖÖ# $
$num
ÖÖ% &
)
ÖÖ& '
*
ÖÖ( )
pageSize
ÖÖ* 2
;
ÖÖ2 3
studentCourses
ÜÜ 
=
ÜÜ 
studentCourses
ÜÜ +
.
áá 
Skip
áá 
(
áá 
skip
áá 
)
áá 
.
àà 
Take
àà 
(
àà 
pageSize
àà 
>
àà  
top
àà! $
?
àà% &
top
àà' *
:
àà+ ,
pageSize
àà- 5
)
àà5 6
.
ââ 
ToList
ââ 
(
ââ 
)
ââ 
;
ââ 
return
ãã 
new
ãã 
ResponseDTO
ãã "
{
åå 
Result
çç 
=
çç 
studentCourses
çç '
,
çç' (
Message
éé 
=
éé 
$str
éé B
,
ééB C
	IsSuccess
èè 
=
èè 
true
èè  
,
èè  !

StatusCode
êê 
=
êê 
$num
êê  
}
ëë 
;
ëë 
}
íí 	
catch
ìì 
(
ìì 
	Exception
ìì 
ex
ìì 
)
ìì 
{
îî 	
return
ïï 
new
ïï 
ResponseDTO
ïï "
{
ññ 
Message
óó 
=
óó 
ex
óó 
.
óó 
Message
óó $
,
óó$ %
	IsSuccess
òò 
=
òò 
false
òò !
,
òò! "

StatusCode
ôô 
=
ôô 
$num
ôô  
,
ôô  !
Result
öö 
=
öö 
null
öö 
}
õõ 
;
õõ 
}
úú 	
}
ùù 
public
†† 

async
†† 
Task
†† 
<
†† 
ResponseDTO
†† !
>
††! "&
GetLeastPurchasedCourses
††# ;
(
††; <
int
°° 
?
°° 
year
°° 
=
°° 
null
°° 
,
°° 
int
¢¢ 
?
¢¢ 
month
¢¢ 
=
¢¢ 
null
¢¢ 
,
¢¢ 
int
££ 
?
££ 
quarter
££ 
=
££ 
null
££ 
,
££ 
int
§§ 
top
§§ 
=
§§ 
$num
§§ 
,
§§ 
int
•• 

pageNumber
•• 
=
•• 
$num
•• 
,
•• 
int
¶¶ 
pageSize
¶¶ 
=
¶¶ 
$num
¶¶ 
,
¶¶ 
string
ßß 
?
ßß 
byCategoryName
ßß 
=
ßß  
null
ßß! %
)
®® 
{
©© 
try
™™ 
{
´´ 	
var
≠≠ !
studentCoursesQuery
≠≠ #
=
≠≠$ %
_unitOfWork
≠≠& 1
.
≠≠1 2%
StudentCourseRepository
≠≠2 I
.
≠≠I J
GetAllAsync
≠≠J U
(
≠≠U V
sc
ÆÆ 
=>
ÆÆ 
sc
ÆÆ 
.
ÆÆ 
CreatedTime
ÆÆ $
.
ÆÆ$ %
HasValue
ÆÆ% -
,
ÆÆ- .
includeProperties
ØØ !
:
ØØ! "
$str
ØØ# +
)
∞∞ 
;
∞∞ 
var
≤≤ 
studentCourses
≤≤ 
=
≤≤  
(
≤≤! "
await
≤≤" '!
studentCoursesQuery
≤≤( ;
)
≤≤; <
.
≤≤< =
ToList
≤≤= C
(
≤≤C D
)
≤≤D E
;
≤≤E F
if
µµ 
(
µµ 
year
µµ 
.
µµ 
HasValue
µµ 
)
µµ 
{
∂∂ 
studentCourses
∑∑ 
=
∑∑  
studentCourses
∑∑! /
.
∏∏ 
Where
∏∏ 
(
∏∏ 
sc
∏∏ 
=>
∏∏  
sc
∏∏! #
.
∏∏# $
CreatedTime
∏∏$ /
.
∏∏/ 0
Value
∏∏0 5
.
∏∏5 6
Year
∏∏6 :
==
∏∏; =
year
∏∏> B
.
∏∏B C
Value
∏∏C H
)
∏∏H I
.
ππ 
ToList
ππ 
(
ππ 
)
ππ 
;
ππ 
}
∫∫ 
if
ºº 
(
ºº 
month
ºº 
.
ºº 
HasValue
ºº 
)
ºº 
{
ΩΩ 
studentCourses
ææ 
=
ææ  
studentCourses
ææ! /
.
øø 
Where
øø 
(
øø 
sc
øø 
=>
øø  
sc
øø! #
.
øø# $
CreatedTime
øø$ /
.
øø/ 0
Value
øø0 5
.
øø5 6
Month
øø6 ;
==
øø< >
month
øø? D
.
øøD E
Value
øøE J
)
øøJ K
.
¿¿ 
ToList
¿¿ 
(
¿¿ 
)
¿¿ 
;
¿¿ 
}
¡¡ 
if
√√ 
(
√√ 
quarter
√√ 
.
√√ 
HasValue
√√  
)
√√  !
{
ƒƒ 
int
≈≈ 

startMonth
≈≈ 
=
≈≈  
(
≈≈! "
quarter
≈≈" )
.
≈≈) *
Value
≈≈* /
-
≈≈0 1
$num
≈≈2 3
)
≈≈3 4
*
≈≈5 6
$num
≈≈7 8
+
≈≈9 :
$num
≈≈; <
;
≈≈< =
int
∆∆ 
endMonth
∆∆ 
=
∆∆ 

startMonth
∆∆ )
+
∆∆* +
$num
∆∆, -
;
∆∆- .
studentCourses
«« 
=
««  
studentCourses
««! /
.
»» 
Where
»» 
(
»» 
sc
»» 
=>
»»  
sc
»»! #
.
»»# $
CreatedTime
»»$ /
.
»»/ 0
Value
»»0 5
.
»»5 6
Month
»»6 ;
>=
»»< >

startMonth
»»? I
&&
»»J L
sc
»»M O
.
»»O P
CreatedTime
»»P [
.
»»[ \
Value
»»\ a
.
»»a b
Month
»»b g
<=
»»h j
endMonth
»»k s
)
»»s t
.
…… 
ToList
…… 
(
…… 
)
…… 
;
…… 
}
   
var
ÕÕ 
courseVersionIds
ÕÕ  
=
ÕÕ! "
studentCourses
ÕÕ# 1
.
ŒŒ 
Select
ŒŒ 
(
ŒŒ 
sc
ŒŒ 
=>
ŒŒ 
sc
ŒŒ  
.
ŒŒ  !
Course
ŒŒ! '
.
ŒŒ' (
CourseVersionId
ŒŒ( 7
)
ŒŒ7 8
.
œœ 
Distinct
œœ 
(
œœ 
)
œœ 
.
–– 
ToList
–– 
(
–– 
)
–– 
;
–– 
var
”” 
courseVersions
”” 
=
””  
(
””! "
await
””" '
_unitOfWork
””( 3
.
””3 4%
CourseVersionRepository
””4 K
.
””K L
GetAllAsync
””L W
(
””W X
cv
‘‘ 
=>
‘‘ 
courseVersionIds
‘‘ &
.
‘‘& '
Contains
‘‘' /
(
‘‘/ 0
cv
‘‘0 2
.
‘‘2 3
Id
‘‘3 5
)
‘‘5 6
,
‘‘6 7
includeProperties
’’ !
:
’’! "
$str
’’# -
)
÷÷ 
)
÷÷ 
.
÷÷ 
ToList
÷÷ 
(
÷÷ 
)
÷÷ 
;
÷÷ 
if
ŸŸ 
(
ŸŸ 
!
ŸŸ 
string
ŸŸ 
.
ŸŸ 
IsNullOrEmpty
ŸŸ %
(
ŸŸ% &
byCategoryName
ŸŸ& 4
)
ŸŸ4 5
)
ŸŸ5 6
{
⁄⁄ 
courseVersions
€€ 
=
€€  
courseVersions
€€! /
.
‹‹ 
Where
‹‹ 
(
‹‹ 
cv
‹‹ 
=>
‹‹  
cv
‹‹! #
.
‹‹# $
Category
‹‹$ ,
!=
‹‹- /
null
‹‹0 4
&&
‹‹5 7
cv
››! #
.
››# $
Category
››$ ,
.
››, -
Name
››- 1
.
››1 2
Contains
››2 :
(
››: ;
byCategoryName
››; I
,
››I J
StringComparison
››K [
.
››[ \&
CurrentCultureIgnoreCase
››\ t
)
››t u
)
››u v
.
ﬁﬁ 
ToList
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
studentCourses
‚‚ 
=
‚‚ 
studentCourses
‚‚ +
.
„„ 
Where
„„ 
(
„„ 
sc
„„ 
=>
„„ 
courseVersions
„„ +
.
„„+ ,
Any
„„, /
(
„„/ 0
cv
„„0 2
=>
„„3 5
cv
„„6 8
.
„„8 9
Id
„„9 ;
==
„„< >
sc
„„? A
.
„„A B
Course
„„B H
.
„„H I
CourseVersionId
„„I X
)
„„X Y
)
„„Y Z
.
‰‰ 
ToList
‰‰ 
(
‰‰ 
)
‰‰ 
;
‰‰ 
var
ÁÁ "
coursePurchaseCounts
ÁÁ $
=
ÁÁ% &
studentCourses
ÁÁ' 5
.
ËË 
GroupBy
ËË 
(
ËË 
sc
ËË 
=>
ËË 
sc
ËË !
.
ËË! "
Course
ËË" (
.
ËË( )
CourseVersionId
ËË) 8
)
ËË8 9
.
ÈÈ 
Select
ÈÈ 
(
ÈÈ 
g
ÈÈ 
=>
ÈÈ 
new
ÈÈ  
{
ÍÍ 
CourseVersionId
ÎÎ #
=
ÎÎ$ %
g
ÎÎ& '
.
ÎÎ' (
Key
ÎÎ( +
,
ÎÎ+ ,
PurchaseCount
ÏÏ !
=
ÏÏ" #
g
ÏÏ$ %
.
ÏÏ% &
Count
ÏÏ& +
(
ÏÏ+ ,
)
ÏÏ, -
}
ÌÌ 
)
ÌÌ 
.
ÓÓ 
OrderBy
ÓÓ 
(
ÓÓ 
g
ÓÓ 
=>
ÓÓ 
g
ÓÓ 
.
ÓÓ  
PurchaseCount
ÓÓ  -
)
ÓÓ- .
.
ÔÔ 
Take
ÔÔ 
(
ÔÔ 
top
ÔÔ 
)
ÔÔ 
.
 
ToList
 
(
 
)
 
;
 
var
ÛÛ #
leastPurchasedCourses
ÛÛ %
=
ÛÛ& '
studentCourses
ÛÛ( 6
.
ÙÙ 
Where
ÙÙ 
(
ÙÙ 
sc
ÙÙ 
=>
ÙÙ "
coursePurchaseCounts
ÙÙ 1
.
ÙÙ1 2
Any
ÙÙ2 5
(
ÙÙ5 6
cpc
ÙÙ6 9
=>
ÙÙ: <
cpc
ÙÙ= @
.
ÙÙ@ A
CourseVersionId
ÙÙA P
==
ÙÙQ S
sc
ÙÙT V
.
ÙÙV W
Course
ÙÙW ]
.
ÙÙ] ^
CourseVersionId
ÙÙ^ m
)
ÙÙm n
)
ÙÙn o
.
ıı 
ToList
ıı 
(
ıı 
)
ıı 
;
ıı 
int
¯¯ 
skip
¯¯ 
=
¯¯ 
(
¯¯ 

pageNumber
¯¯ "
-
¯¯# $
$num
¯¯% &
)
¯¯& '
*
¯¯( )
pageSize
¯¯* 2
;
¯¯2 3#
leastPurchasedCourses
˘˘ !
=
˘˘" ##
leastPurchasedCourses
˘˘$ 9
.
˙˙ 
Skip
˙˙ 
(
˙˙ 
skip
˙˙ 
)
˙˙ 
.
˚˚ 
Take
˚˚ 
(
˚˚ 
pageSize
˚˚ 
)
˚˚ 
.
¸¸ 
ToList
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
return
˛˛ 
new
˛˛ 
ResponseDTO
˛˛ "
{
ˇˇ 
Result
ÄÄ 
=
ÄÄ #
leastPurchasedCourses
ÄÄ .
,
ÄÄ. /
Message
ÅÅ 
=
ÅÅ 
$str
ÅÅ D
,
ÅÅD E
	IsSuccess
ÇÇ 
=
ÇÇ 
true
ÇÇ  
,
ÇÇ  !

StatusCode
ÉÉ 
=
ÉÉ 
$num
ÉÉ  
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
ex
ÜÜ 
)
ÜÜ 
{
áá 	
return
àà 
new
àà 
ResponseDTO
àà "
{
ââ 
Message
ää 
=
ää 
ex
ää 
.
ää 
Message
ää $
,
ää$ %
	IsSuccess
ãã 
=
ãã 
false
ãã !
,
ãã! "

StatusCode
åå 
=
åå 
$num
åå  
,
åå  !
Result
çç 
=
çç 
null
çç 
}
éé 
;
éé 
}
èè 	
}
êê 
public
ìì 

async
ìì 
Task
ìì 
<
ìì 
ResponseDTO
ìì !
>
ìì! "
	GetCourse
ìì# ,
(
ìì, -
ClaimsPrincipal
ìì- <
User
ìì= A
,
ììA B
Guid
ììC G
courseId
ììH P
)
ììP Q
{
îî 
try
ïï 
{
ññ 	
var
óó 
course
óó 
=
óó 
await
óó 
_unitOfWork
óó *
.
óó* +
CourseRepository
óó+ ;
.
óó; <
GetAsync
óó< D
(
óóD E
x
óóE F
=>
óóG I
x
óóJ K
.
óóK L
Id
óóL N
==
óóO Q
courseId
óóR Z
)
óóZ [
;
óó[ \
if
ôô 
(
ôô 
course
ôô 
is
ôô 
null
ôô 
)
ôô 
{
öö 
return
õõ 
new
õõ 
ResponseDTO
õõ &
(
õõ& '
)
õõ' (
{
úú 
	IsSuccess
ùù 
=
ùù 
false
ùù  %
,
ùù% &

StatusCode
ûû 
=
ûû  
$num
ûû! $
,
ûû$ %
Result
üü 
=
üü 
null
üü !
,
üü! "
Message
†† 
=
†† 
$str
†† 4
}
°° 
;
°° 
}
¢¢ 
var
§§ 
courseVersion
§§ 
=
§§ 
await
§§  %
_unitOfWork
§§& 1
.
§§1 2%
CourseVersionRepository
§§2 I
.
§§I J
GetAsync
§§J R
(
§§R S
x
§§S T
=>
§§U W
x
§§X Y
.
§§Y Z
Id
§§Z \
==
§§] _
course
§§` f
.
§§f g
CourseVersionId
§§g v
)
§§v w
;
§§w x
if
¶¶ 
(
¶¶ 
courseVersion
¶¶ 
is
¶¶  
null
¶¶! %
)
¶¶% &
{
ßß 
return
®® 
new
®® 
ResponseDTO
®® &
(
®®& '
)
®®' (
{
©© 
	IsSuccess
™™ 
=
™™ 
false
™™  %
,
™™% &

StatusCode
´´ 
=
´´  
$num
´´! $
,
´´$ %
Result
¨¨ 
=
¨¨ 
null
¨¨ !
,
¨¨! "
Message
≠≠ 
=
≠≠ 
$str
≠≠ 6
}
ÆÆ 
;
ÆÆ 
}
ØØ 
var
±± 
courseVersionDto
±±  
=
±±! "
_mapper
±±# *
.
±±* +
Map
±±+ .
<
±±. /!
GetCourseVersionDTO
±±/ B
>
±±B C
(
±±C D
courseVersion
±±D Q
)
±±Q R
;
±±R S
return
≥≥ 
new
≥≥ 
ResponseDTO
≥≥ "
(
≥≥" #
)
≥≥# $
{
¥¥ 
	IsSuccess
µµ 
=
µµ 
true
µµ  
,
µµ  !

StatusCode
∂∂ 
=
∂∂ 
$num
∂∂  
,
∂∂  !
Result
∑∑ 
=
∑∑ 
courseVersionDto
∑∑ )
,
∑∑) *
Message
∏∏ 
=
∏∏ 
$str
∏∏ 3
}
ππ 
;
ππ 
}
∫∫ 	
catch
ªª 
(
ªª 
	Exception
ªª 
e
ªª 
)
ªª 
{
ºº 	
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ "
(
ΩΩ" #
)
ΩΩ# $
{
ææ 
	IsSuccess
øø 
=
øø 
false
øø !
,
øø! "

StatusCode
¿¿ 
=
¿¿ 
$num
¿¿  
,
¿¿  !
Result
¡¡ 
=
¡¡ 
null
¡¡ 
,
¡¡ 
Message
¬¬ 
=
¬¬ 
e
¬¬ 
.
¬¬ 
Message
¬¬ #
}
√√ 
;
√√ 
}
ƒƒ 	
}
≈≈ 
public
«« 

async
«« 
Task
«« 
<
«« 
ResponseDTO
«« !
>
««! "
GetCourseInfo
««# 0
(
««0 1
ClaimsPrincipal
««1 @
User
««A E
,
««E F
Guid
««G K
courseId
««L T
)
««T U
{
»» 
try
…… 
{
   	
var
ÀÀ 
course
ÀÀ 
=
ÀÀ 
await
ÀÀ 
_unitOfWork
ÀÀ *
.
ÀÀ* +
CourseRepository
ÀÀ+ ;
.
ÀÀ; <
GetAsync
ÀÀ< D
(
ÀÀD E
x
ÀÀE F
=>
ÀÀG I
x
ÀÀJ K
.
ÀÀK L
Id
ÀÀL N
==
ÀÀO Q
courseId
ÀÀR Z
)
ÀÀZ [
;
ÀÀ[ \
if
ÕÕ 
(
ÕÕ 
course
ÕÕ 
is
ÕÕ 
null
ÕÕ 
)
ÕÕ 
{
ŒŒ 
return
œœ 
new
œœ 
ResponseDTO
œœ &
(
œœ& '
)
œœ' (
{
–– 
	IsSuccess
—— 
=
—— 
false
——  %
,
——% &

StatusCode
““ 
=
““  
$num
““! $
,
““$ %
Result
”” 
=
”” 
null
”” !
,
””! "
Message
‘‘ 
=
‘‘ 
$str
‘‘ 4
}
’’ 
;
’’ 
}
÷÷ 
var
ÿÿ 
getCourseInfoDto
ÿÿ  
=
ÿÿ! "
_mapper
ÿÿ# *
.
ÿÿ* +
Map
ÿÿ+ .
<
ÿÿ. /
GetCourseInfoDTO
ÿÿ/ ?
>
ÿÿ? @
(
ÿÿ@ A
course
ÿÿA G
)
ÿÿG H
;
ÿÿH I
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ "
(
⁄⁄" #
)
⁄⁄# $
{
€€ 
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  
,
‹‹  !

StatusCode
›› 
=
›› 
$num
››  
,
››  !
Result
ﬁﬁ 
=
ﬁﬁ 
getCourseInfoDto
ﬁﬁ )
,
ﬁﬁ) *
Message
ﬂﬂ 
=
ﬂﬂ 
$str
ﬂﬂ ?
}
‡‡ 
;
‡‡ 
}
·· 	
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 	
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ "
(
‰‰" #
)
‰‰# $
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
,
ÊÊ# $

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
,
ÁÁ  !
Result
ËË 
=
ËË 
null
ËË 
,
ËË 
	IsSuccess
ÈÈ 
=
ÈÈ 
false
ÈÈ !
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
}
ÏÏ 
public
ÓÓ 

async
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
ResponseDTO
ÓÓ !
>
ÓÓ! "
ActivateCourse
ÓÓ# 1
(
ÓÓ1 2
ClaimsPrincipal
ÓÓ2 A
User
ÓÓB F
,
ÓÓF G
Guid
ÓÓH L
courseId
ÓÓM U
)
ÓÓU V
{
ÔÔ 
try
 
{
ÒÒ 	
var
ÚÚ 
course
ÚÚ 
=
ÚÚ 
await
ÚÚ 
_unitOfWork
ÚÚ *
.
ÚÚ* +
CourseRepository
ÚÚ+ ;
.
ÚÚ; <
GetAsync
ÚÚ< D
(
ÚÚD E
x
ÚÚE F
=>
ÚÚG I
x
ÚÚJ K
.
ÚÚK L
Id
ÚÚL N
==
ÚÚO Q
courseId
ÚÚR Z
)
ÚÚZ [
;
ÚÚ[ \
if
ÙÙ 
(
ÙÙ 
course
ÙÙ 
is
ÙÙ 
null
ÙÙ 
)
ÙÙ 
{
ıı 
return
ˆˆ 
new
ˆˆ 
ResponseDTO
ˆˆ &
(
ˆˆ& '
)
ˆˆ' (
{
˜˜ 
	IsSuccess
¯¯ 
=
¯¯ 
false
¯¯  %
,
¯¯% &

StatusCode
˘˘ 
=
˘˘  
$num
˘˘! $
,
˘˘$ %
Result
˙˙ 
=
˙˙ 
null
˙˙ !
,
˙˙! "
Message
˚˚ 
=
˚˚ 
$str
˚˚ 4
}
¸¸ 
;
¸¸ 
}
˝˝ 
course
ˇˇ 
.
ˇˇ 
Status
ˇˇ 
=
ˇˇ  
StaticCourseStatus
ˇˇ .
.
ˇˇ. /
	Activated
ˇˇ/ 8
;
ˇˇ8 9
_unitOfWork
ÅÅ 
.
ÅÅ 
CourseRepository
ÅÅ (
.
ÅÅ( )
Update
ÅÅ) /
(
ÅÅ/ 0
course
ÅÅ0 6
)
ÅÅ6 7
;
ÅÅ7 8
await
ÇÇ 
_unitOfWork
ÇÇ 
.
ÇÇ 
	SaveAsync
ÇÇ '
(
ÇÇ' (
)
ÇÇ( )
;
ÇÇ) *
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
,
áá  !
Result
àà 
=
àà 
null
àà 
,
àà 
Message
ââ 
=
ââ 
$str
ââ 9
}
ää 
;
ää 
}
ãã 	
catch
åå 
(
åå 
	Exception
åå 
e
åå 
)
åå 
{
çç 	
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
Message
êê 
=
êê 
e
êê 
.
êê 
Message
êê #
,
êê# $

StatusCode
ëë 
=
ëë 
$num
ëë  
,
ëë  !
Result
íí 
=
íí 
null
íí 
,
íí 
	IsSuccess
ìì 
=
ìì 
false
ìì !
}
îî 
;
îî 
}
ïï 	
}
ññ 
public
òò 

async
òò 
Task
òò 
<
òò 
ResponseDTO
òò !
>
òò! "
DeactivateCourse
òò# 3
(
òò3 4
ClaimsPrincipal
òò4 C
User
òòD H
,
òòH I
Guid
òòJ N
courseId
òòO W
)
òòW X
{
ôô 
try
öö 
{
õõ 	
var
úú 
course
úú 
=
úú 
await
úú 
_unitOfWork
úú *
.
úú* +
CourseRepository
úú+ ;
.
úú; <
GetAsync
úú< D
(
úúD E
x
úúE F
=>
úúG I
x
úúJ K
.
úúK L
Id
úúL N
==
úúO Q
courseId
úúR Z
)
úúZ [
;
úú[ \
if
ûû 
(
ûû 
course
ûû 
is
ûû 
null
ûû 
)
ûû 
{
üü 
return
†† 
new
†† 
ResponseDTO
†† &
(
††& '
)
††' (
{
°° 
	IsSuccess
¢¢ 
=
¢¢ 
false
¢¢  %
,
¢¢% &

StatusCode
££ 
=
££  
$num
££! $
,
££$ %
Result
§§ 
=
§§ 
null
§§ !
,
§§! "
Message
•• 
=
•• 
$str
•• 4
}
¶¶ 
;
¶¶ 
}
ßß 
course
©© 
.
©© 
Status
©© 
=
©©  
StaticCourseStatus
©© .
.
©©. /
Deactivated
©©/ :
;
©©: ;
_unitOfWork
™™ 
.
™™ 
CourseRepository
™™ (
.
™™( )
Update
™™) /
(
™™/ 0
course
™™0 6
)
™™6 7
;
™™7 8
await
´´ 
_unitOfWork
´´ 
.
´´ 
	SaveAsync
´´ '
(
´´' (
)
´´( )
;
´´) *
BackgroundJob
≠≠ 
.
≠≠ 
Enqueue
≠≠ !
<
≠≠! "
IEmailSender
≠≠" .
>
≠≠. /
(
≠≠/ 0
job
≠≠0 3
=>
≠≠4 6
job
≠≠7 :
.
≠≠: ;3
%SendDeactivatedCourseEmailForStudents
≠≠; `
(
≠≠` a
courseId
≠≠a i
)
≠≠i j
)
≠≠j k
;
≠≠k l
return
ØØ 
new
ØØ 
ResponseDTO
ØØ "
(
ØØ" #
)
ØØ# $
{
∞∞ 
	IsSuccess
±± 
=
±± 
true
±±  
,
±±  !

StatusCode
≤≤ 
=
≤≤ 
$num
≤≤  
,
≤≤  !
Result
≥≥ 
=
≥≥ 
null
≥≥ 
,
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ ;
}
µµ 
;
µµ 
}
∂∂ 	
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 	
return
ππ 
new
ππ 
ResponseDTO
ππ "
(
ππ" #
)
ππ# $
{
∫∫ 
Message
ªª 
=
ªª 
e
ªª 
.
ªª 
Message
ªª #
,
ªª# $

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
Result
ΩΩ 
=
ΩΩ 
null
ΩΩ 
,
ΩΩ 
	IsSuccess
ææ 
=
ææ 
false
ææ !
}
øø 
;
øø 
}
¿¿ 	
}
¡¡ 
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
ResponseDTO
√√ !
>
√√! "
EnrollCourse
√√# /
(
√√/ 0
ClaimsPrincipal
√√0 ?
User
√√@ D
,
√√D E
EnrollCourseDTO
√√F U
enrollCourseDto
√√V e
)
√√e f
{
ƒƒ 
try
≈≈ 
{
∆∆ 	
var
«« 
studentCourse
«« 
=
«« 
await
««  %
_unitOfWork
««& 1
.
««1 2%
StudentCourseRepository
««2 I
.
««I J
GetAsync
««J R
(
»» 
x
…… 
=>
…… 
x
…… 
.
…… 
	StudentId
……  
==
……! #
enrollCourseDto
……$ 3
.
……3 4
	studentId
……4 =
&&
……> @
x
……A B
.
……B C
CourseId
……C K
==
……L N
enrollCourseDto
……O ^
.
……^ _
courseId
……_ g
)
   
;
   
if
ÃÃ 
(
ÃÃ 
studentCourse
ÃÃ 
is
ÃÃ  
null
ÃÃ! %
)
ÃÃ% &
{
ÕÕ 
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ &
(
ŒŒ& '
)
ŒŒ' (
{
œœ 
Message
–– 
=
–– 
$str
–– ?
,
––? @
	IsSuccess
—— 
=
—— 
false
——  %
,
——% &

StatusCode
““ 
=
““  
$num
““! $
,
““$ %
Result
”” 
=
”” 
null
”” !
}
‘‘ 
;
‘‘ 
}
’’ 
if
◊◊ 
(
◊◊ 
studentCourse
◊◊ 
.
◊◊ 
Status
◊◊ $
!=
◊◊% '
StaticStatus
◊◊( 4
.
◊◊4 5
StudentCourse
◊◊5 B
.
◊◊B C
Pending
◊◊C J
)
◊◊J K
{
ÿÿ 
return
ŸŸ 
new
ŸŸ 
ResponseDTO
ŸŸ &
(
ŸŸ& '
)
ŸŸ' (
{
⁄⁄ 
Message
€€ 
=
€€ 
$str
€€ ?
,
€€? @
	IsSuccess
‹‹ 
=
‹‹ 
false
‹‹  %
,
‹‹% &

StatusCode
›› 
=
››  
$num
››! $
,
››$ %
Result
ﬁﬁ 
=
ﬁﬁ 
null
ﬁﬁ !
}
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
await
‚‚ #
_studentCourseService
‚‚ '
.
‚‚' (!
UpdateStudentCourse
‚‚( ;
(
„„ 
User
‰‰ 
,
‰‰ 
new
ÂÂ $
UpdateStudentCourseDTO
ÂÂ *
(
ÂÂ* +
)
ÂÂ+ ,
{
ÊÊ 
Status
ÁÁ 
=
ÁÁ 
StaticStatus
ÁÁ )
.
ÁÁ) *
StudentCourse
ÁÁ* 7
.
ÁÁ7 8
Enrolled
ÁÁ8 @
,
ÁÁ@ A
CourseId
ËË 
=
ËË 
enrollCourseDto
ËË .
.
ËË. /
courseId
ËË/ 7
,
ËË7 8
	StudentId
ÈÈ 
=
ÈÈ 
enrollCourseDto
ÈÈ  /
.
ÈÈ/ 0
	studentId
ÈÈ0 9
}
ÍÍ 
)
ÎÎ 
;
ÎÎ 
return
ÌÌ 
new
ÌÌ 
ResponseDTO
ÌÌ "
(
ÌÌ" #
)
ÌÌ# $
{
ÓÓ 
Message
ÔÔ 
=
ÔÔ 
$str
ÔÔ 6
,
ÔÔ6 7
	IsSuccess
 
=
 
true
  
,
  !

StatusCode
ÒÒ 
=
ÒÒ 
$num
ÒÒ  
,
ÒÒ  !
Result
ÚÚ 
=
ÚÚ 
null
ÚÚ 
}
ÛÛ 
;
ÛÛ 
}
ÙÙ 	
catch
ıı 
(
ıı 
	Exception
ıı 
e
ıı 
)
ıı 
{
ˆˆ 	
return
˜˜ 
new
˜˜ 
ResponseDTO
˜˜ "
(
˜˜" #
)
˜˜# $
{
¯¯ 
Message
˘˘ 
=
˘˘ 
e
˘˘ 
.
˘˘ 
Message
˘˘ #
,
˘˘# $

StatusCode
˙˙ 
=
˙˙ 
$num
˙˙  
,
˙˙  !
Result
˚˚ 
=
˚˚ 
null
˚˚ 
,
˚˚ 
	IsSuccess
¸¸ 
=
¸¸ 
true
¸¸  
}
˝˝ 
;
˝˝ 
}
˛˛ 	
}
ˇˇ 
public
ÅÅ 

async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
ResponseDTO
ÅÅ !
>
ÅÅ! "
SuggestCourse
ÅÅ# 0
(
ÅÅ0 1
Guid
ÅÅ1 5
	studentId
ÅÅ6 ?
)
ÅÅ? @
{
ÇÇ 
try
ÉÉ 
{
ÑÑ 	
var
ÜÜ 
id
ÜÜ 
=
ÜÜ 
await
áá 
_unitOfWork
áá !
.
áá! "%
StudentCourseRepository
áá" 9
.
áá9 :
GetAsync
áá: B
(
ááB C
i
ááC D
=>
ááE G
i
ááH I
.
ááI J
	StudentId
ááJ S
==
ááT V
	studentId
ááW `
)
áá` a
;
ááa b
if
àà 
(
àà 
id
àà 
==
àà 
null
àà 
)
àà 
{
ââ 
return
ää 
new
ää 
ResponseDTO
ää &
(
ää& '
)
ää' (
{
ãã 
Message
åå 
=
åå 
$str
åå 1
,
åå1 2
	IsSuccess
çç 
=
çç 
false
çç  %
,
çç% &

StatusCode
éé 
=
éé  
$num
éé! $
,
éé$ %
Result
èè 
=
èè 
null
èè !
}
êê 
;
êê 
}
ëë 
var
îî 
courses
îî 
=
îî 
await
îî 
_unitOfWork
îî  +
.
îî+ ,%
StudentCourseRepository
îî, C
.
îîC D
GetAllAsync
îîD O
(
ïï 
c
ïï 
=>
ïï 
c
ïï 
.
ïï 
	StudentId
ïï !
==
ïï" $
	studentId
ïï% .
&&
ïï/ 1
c
ïï2 3
.
ïï3 4
Status
ïï4 :
==
ïï; =
$num
ïï> ?
||
ïï@ B
c
ïïC D
.
ïïD E
Status
ïïE K
==
ïïL N
$num
ïïO P
||
ïïQ S
c
ïïT U
.
ïïU V
Status
ïïV \
==
ïï] _
$num
ïï` a
)
ïïa b
;
ïïb c
var
ññ 
coursesEnroll
ññ 
=
ññ 
courses
ññ  '
.
ññ' (
Select
ññ( .
(
ññ. /
c
ññ/ 0
=>
ññ1 3
c
ññ4 5
.
ññ5 6
CourseId
ññ6 >
)
ññ> ?
.
ññ? @
Distinct
ññ@ H
(
ññH I
)
ññI J
.
ññJ K
ToList
ññK Q
(
ññQ R
)
ññR S
;
ññS T
if
òò 
(
òò 
courses
òò 
==
òò 
null
òò 
||
òò  "
!
òò# $
courses
òò$ +
.
òò+ ,
Any
òò, /
(
òò/ 0
)
òò0 1
)
òò1 2
{
ôô 
return
öö 
new
öö 
ResponseDTO
öö &
(
öö& '
)
öö' (
{
õõ 
Message
úú 
=
úú 
$str
úú G
,
úúG H
	IsSuccess
ùù 
=
ùù 
false
ùù  %
,
ùù% &

StatusCode
ûû 
=
ûû  
$num
ûû! $
,
ûû$ %
Result
üü 
=
üü 
null
üü !
}
†† 
;
†† 
}
°° 
var
§§ 
suggestCourse
§§ 
=
§§ 
new
§§  #
List
§§$ (
<
§§( )
Course
§§) /
>
§§/ 0
(
§§0 1
)
§§1 2
;
§§2 3
var
•• 
redFlag
•• 
=
•• 
$num
•• 
;
•• 
foreach
ßß 
(
ßß 
var
ßß 
course
ßß 
in
ßß  "
courses
ßß# *
)
ßß* +
{
®® 
if
©© 
(
©© 
redFlag
©© 
>=
©© 
$num
©©  
)
©©  !
break
©©" '
;
©©' (
var
™™ 
courseId
™™ 
=
™™ 
course
™™ %
.
™™% &
CourseId
™™& .
;
™™. /
var
´´ 
courseVersions
´´ "
=
´´# $
await
´´% *
_unitOfWork
´´+ 6
.
´´6 7%
CourseVersionRepository
´´7 N
.
´´N O
GetAllAsync
´´O Z
(
´´Z [
cv
¨¨ 
=>
¨¨ 
cv
¨¨ 
.
¨¨ 
CourseId
¨¨ %
==
¨¨& (
courseId
¨¨) 1
,
¨¨1 2
includeProperties
≠≠ %
:
≠≠% &
$str
≠≠' 1
)
≠≠1 2
;
≠≠2 3
foreach
ØØ 
(
ØØ 
var
ØØ 
courseVersion
ØØ *
in
ØØ+ -
courseVersions
ØØ. <
)
ØØ< =
{
∞∞ 
var
±± 

categoryId
±± "
=
±±# $
courseVersion
±±% 2
.
±±2 3

CategoryId
±±3 =
;
±±= >
var
¥¥ #
relatedCourseVersions
¥¥ -
=
¥¥. /
await
¥¥0 5
_unitOfWork
¥¥6 A
.
¥¥A B%
CourseVersionRepository
¥¥B Y
.
¥¥Y Z
GetAllAsync
¥¥Z e
(
¥¥e f
cv
¥¥f h
=>
¥¥i k
cv
µµ 
.
µµ 

CategoryId
µµ %
==
µµ& (

categoryId
µµ) 3
&&
µµ4 6
!
µµ7 8
coursesEnroll
µµ8 E
.
µµE F
Contains
µµF N
(
µµN O
cv
µµO Q
.
µµQ R
CourseId
µµR Z
)
µµZ [
)
µµ[ \
;
µµ\ ]
foreach
∏∏ 
(
∏∏ 
var
∏∏  "
relatedCourseVersion
∏∏! 5
in
∏∏6 8#
relatedCourseVersions
∏∏9 N
)
∏∏N O
{
ππ 
var
∫∫ 
relatedCourse
∫∫ )
=
∫∫* +
await
ªª !
_unitOfWork
ªª" -
.
ªª- .
CourseRepository
ªª. >
.
ªª> ?
GetAsync
ªª? G
(
ªªG H
c
ªªH I
=>
ªªJ L
c
ªªM N
.
ªªN O
Id
ªªO Q
==
ªªR T"
relatedCourseVersion
ªªU i
.
ªªi j
CourseId
ªªj r
)
ªªr s
;
ªªs t
if
ºº 
(
ºº 
relatedCourse
ºº )
!=
ºº* ,
null
ºº- 1
)
ºº1 2
{
ΩΩ 
suggestCourse
ææ )
.
ææ) *
Add
ææ* -
(
ææ- .
relatedCourse
ææ. ;
)
ææ; <
;
ææ< =
}
øø 
}
¿¿ 
}
¡¡ 
}
¬¬ 
var
ƒƒ 
distinctCourses
ƒƒ 
=
ƒƒ  !
suggestCourse
ƒƒ" /
.
ƒƒ/ 0
Distinct
ƒƒ0 8
(
ƒƒ8 9
)
ƒƒ9 :
.
ƒƒ: ;
ToList
ƒƒ; A
(
ƒƒA B
)
ƒƒB C
;
ƒƒC D
return
∆∆ 
new
∆∆ 
ResponseDTO
∆∆ "
(
∆∆" #
)
∆∆# $
{
«« 
Message
»» 
=
»» 
$str
»» 7
,
»»7 8
	IsSuccess
…… 
=
…… 
true
……  
,
……  !

StatusCode
   
=
   
$num
    
,
    !
Result
ÀÀ 
=
ÀÀ 
distinctCourses
ÀÀ (
}
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 	
return
–– 
new
–– 
ResponseDTO
–– "
(
––" #
)
––# $
{
—— 
Message
““ 
=
““ 
e
““ 
.
““ 
Message
““ #
,
““# $

StatusCode
”” 
=
”” 
$num
””  
,
””  !
Result
‘‘ 
=
‘‘ 
null
‘‘ 
,
‘‘ 
	IsSuccess
’’ 
=
’’ 
true
’’  
}
÷÷ 
;
÷÷ 
}
◊◊ 	
}
ÿÿ 
public
⁄⁄ 

async
⁄⁄ 
Task
⁄⁄ 
<
⁄⁄ 
ResponseDTO
⁄⁄ !
>
⁄⁄! "
UpsertCourseTotal
⁄⁄# 4
(
⁄⁄4 5"
UpsertCourseTotalDTO
⁄⁄5 I"
upsertCourseTotalDto
⁄⁄J ^
)
⁄⁄^ _
{
€€ 
try
‹‹ 
{
›› 	
var
ﬁﬁ 
course
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ 
_unitOfWork
ﬁﬁ *
.
ﬁﬁ* +
CourseRepository
ﬁﬁ+ ;
.
ﬁﬁ; <
GetAsync
ﬁﬁ< D
(
ﬁﬁD E
x
ﬁﬁE F
=>
ﬁﬁG I
x
ﬁﬁJ K
.
ﬁﬁK L
Id
ﬁﬁL N
==
ﬁﬁO Q"
upsertCourseTotalDto
ﬁﬁR f
.
ﬁﬁf g
CourseId
ﬁﬁg o
)
ﬁﬁo p
;
ﬁﬁp q
if
‡‡ 
(
‡‡ 
course
‡‡ 
is
‡‡ 
null
‡‡ 
)
‡‡ 
{
·· 
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ &
(
‚‚& '
)
‚‚' (
{
„„ 
Message
‰‰ 
=
‰‰ 
$str
‰‰ 4
,
‰‰4 5
	IsSuccess
ÂÂ 
=
ÂÂ 
false
ÂÂ  %
,
ÂÂ% &

StatusCode
ÊÊ 
=
ÊÊ  
$num
ÊÊ! $
,
ÊÊ$ %
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ !
}
ËË 
;
ËË 
}
ÈÈ 
if
ÎÎ 
(
ÎÎ "
upsertCourseTotalDto
ÎÎ $
.
ÎÎ$ %
TotalStudent
ÎÎ% 1
is
ÎÎ2 4
not
ÎÎ5 8
null
ÎÎ9 =
)
ÎÎ= >
{
ÏÏ 
course
ÌÌ 
.
ÌÌ 
TotalStudent
ÌÌ #
+=
ÌÌ$ &"
upsertCourseTotalDto
ÌÌ' ;
.
ÌÌ; <
TotalStudent
ÌÌ< H
;
ÌÌH I
}
ÓÓ 
if
 
(
 "
upsertCourseTotalDto
 $
.
$ %
TotalEarned
% 0
is
1 3
not
4 7
null
8 <
)
< =
{
ÒÒ 
course
ÚÚ 
.
ÚÚ 
TotalEarned
ÚÚ "
+=
ÚÚ# %"
upsertCourseTotalDto
ÚÚ& :
.
ÚÚ: ;
TotalEarned
ÚÚ; F
;
ÚÚF G
course
ÛÛ 
.
ÛÛ 
TotalStudent
ÛÛ #
+=
ÛÛ$ &
$num
ÛÛ' (
;
ÛÛ( )
}
ÙÙ 
if
ˆˆ 
(
ˆˆ "
upsertCourseTotalDto
ˆˆ $
.
ˆˆ$ %
UpdateTotalRate
ˆˆ% 4
)
ˆˆ4 5
{
˜˜ 
var
¯¯ 
courseReviews
¯¯ !
=
¯¯" #
_unitOfWork
¯¯$ /
.
¯¯/ 0$
CourseReviewRepository
¯¯0 F
.
˘˘ 
GetAllAsync
˘˘  
(
˘˘  !
x
˘˘! "
=>
˘˘# %
x
˘˘& '
.
˘˘' (
CourseId
˘˘( 0
==
˘˘1 3"
upsertCourseTotalDto
˘˘4 H
.
˘˘H I
CourseId
˘˘I Q
)
˘˘Q R
.
˙˙ 

GetAwaiter
˙˙ 
(
˙˙  
)
˙˙  !
.
˚˚ 
	GetResult
˚˚ 
(
˚˚ 
)
˚˚  
.
¸¸ 
ToList
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
var
˛˛ 
	totalRate
˛˛ 
=
˛˛ 
courseReviews
˛˛  -
.
˛˛- .
ToList
˛˛. 4
(
˛˛4 5
)
˛˛5 6
.
˛˛6 7
Sum
˛˛7 :
(
˛˛: ;
x
˛˛; <
=>
˛˛= ?
x
˛˛@ A
.
˛˛A B
Rate
˛˛B F
)
˛˛F G
;
˛˛G H
var
ˇˇ 
avgRate
ˇˇ 
=
ˇˇ 
	totalRate
ˇˇ '
/
ˇˇ( )
courseReviews
ˇˇ* 7
.
ˇˇ7 8
Count
ˇˇ8 =
;
ˇˇ= >
course
ÅÅ 
.
ÅÅ 
	TotalRate
ÅÅ  
=
ÅÅ! "
avgRate
ÅÅ# *
;
ÅÅ* +
}
ÇÇ 
await
ÑÑ 
_unitOfWork
ÑÑ 
.
ÑÑ 
	SaveAsync
ÑÑ '
(
ÑÑ' (
)
ÑÑ( )
;
ÑÑ) *
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ "
(
ÜÜ" #
)
ÜÜ# $
{
áá 
Message
àà 
=
àà 
$str
àà <
,
àà< =
	IsSuccess
ââ 
=
ââ 
true
ââ  
,
ââ  !

StatusCode
ää 
=
ää 
$num
ää  
,
ää  !
Result
ãã 
=
ãã 
course
ãã 
}
åå 
;
åå 
}
çç 	
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 	
return
êê 
new
êê 
ResponseDTO
êê "
(
êê" #
)
êê# $
{
ëë 
Message
íí 
=
íí 
e
íí 
.
íí 
Message
íí #
,
íí# $
	IsSuccess
ìì 
=
ìì 
false
ìì !
,
ìì! "

StatusCode
îî 
=
îî 
$num
îî  
,
îî  !
Result
ïï 
=
ïï 
null
ïï 
}
ññ 
;
ññ 
}
óó 	
}
òò 
public
öö 

async
öö 
Task
öö 
<
öö 
ResponseDTO
öö !
>
öö! ")
GetAllBookMarkedCoursesById
öö# >
(
öö> ?
Guid
öö? C
	studentId
ööD M
,
ööM N
string
ööO U
	sortOrder
ööV _
=
öö` a
$str
ööb h
)
ööh i
{
õõ 
try
úú 
{
ùù 	
var
üü 
studentExists
üü 
=
üü 
await
üü  %
_unitOfWork
üü& 1
.
üü1 2
StudentRepository
üü2 C
.
üüC D
GetAsync
üüD L
(
üüL M
s
üüM N
=>
üüO Q
s
üüR S
.
üüS T
	StudentId
üüT ]
==
üü^ `
	studentId
üüa j
)
üüj k
!=
üül n
null
üüo s
;
üüs t
if
†† 
(
†† 
!
†† 
studentExists
†† 
)
†† 
{
°° 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ &
{
££ 
Message
§§ 
=
§§ 
$str
§§ 1
,
§§1 2
	IsSuccess
•• 
=
•• 
false
••  %
,
••% &

StatusCode
¶¶ 
=
¶¶  
$num
¶¶! $
}
ßß 
;
ßß 
}
®® 
var
´´ "
courseBookmarksQuery
´´ $
=
´´% &
_unitOfWork
´´' 2
.
´´2 3&
CourseBookmarkRepository
´´3 K
.
´´K L
GetAllAsync
´´L W
(
´´W X
cb
´´Y [
=>
´´\ ^
cb
´´_ a
.
´´a b
	StudentId
´´b k
==
´´l n
	studentId
´´o x
)
´´x y
;
´´y z
var
≠≠ 
courseBookmarks
≠≠ 
=
≠≠  !
(
≠≠" #
await
≠≠# ("
courseBookmarksQuery
≠≠) =
)
≠≠= >
.
≠≠> ?
ToList
≠≠? E
(
≠≠E F
)
≠≠F G
;
≠≠G H
switch
∞∞ 
(
∞∞ 
	sortOrder
∞∞ 
.
∞∞ 
Trim
∞∞ "
(
∞∞" #
)
∞∞# $
.
∞∞$ %
ToLower
∞∞% ,
(
∞∞, -
)
∞∞- .
)
∞∞. /
{
±± 
case
≤≤ 
$str
≤≤ 
:
≤≤ 
courseBookmarks
≥≥ #
=
≥≥$ %
courseBookmarks
≥≥& 5
.
≥≥5 6
OrderBy
≥≥6 =
(
≥≥= >
cb
≥≥> @
=>
≥≥A C
cb
≥≥D F
.
≥≥F G
CreatedTime
≥≥G R
)
≥≥R S
.
≥≥S T
ToList
≥≥T Z
(
≥≥Z [
)
≥≥[ \
;
≥≥\ ]
break
¥¥ 
;
¥¥ 
case
µµ 
$str
µµ 
:
µµ 
courseBookmarks
∂∂ #
=
∂∂$ %
courseBookmarks
∂∂& 5
.
∂∂5 6
OrderByDescending
∂∂6 G
(
∂∂G H
cb
∂∂H J
=>
∂∂K M
cb
∂∂N P
.
∂∂P Q
CreatedTime
∂∂Q \
)
∂∂\ ]
.
∂∂] ^
ToList
∂∂^ d
(
∂∂d e
)
∂∂e f
;
∂∂f g
break
∑∑ 
;
∑∑ 
default
∏∏ 
:
∏∏ 
courseBookmarks
∫∫ #
=
∫∫$ %
courseBookmarks
∫∫& 5
.
∫∫5 6
OrderByDescending
∫∫6 G
(
∫∫G H
cb
∫∫H J
=>
∫∫K M
cb
∫∫N P
.
∫∫P Q
CreatedTime
∫∫Q \
)
∫∫\ ]
.
∫∫] ^
ToList
∫∫^ d
(
∫∫d e
)
∫∫e f
;
∫∫f g
break
ªª 
;
ªª 
}
ºº 
return
ææ 
new
ææ 
ResponseDTO
ææ "
{
øø 
Message
¿¿ 
=
¿¿ 
$str
¿¿ Q
,
¿¿Q R
	IsSuccess
¡¡ 
=
¡¡ 
true
¡¡  
,
¡¡  !

StatusCode
¬¬ 
=
¬¬ 
$num
¬¬  
,
¬¬  !
Result
√√ 
=
√√ 
courseBookmarks
√√ (
}
ƒƒ 
;
ƒƒ 
}
≈≈ 	
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
ex
∆∆ 
)
∆∆ 
{
«« 	
return
»» 
new
»» 
ResponseDTO
»» "
{
…… 
Message
   
=
   
ex
   
.
   
Message
   $
,
  $ %
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ !
,
ÀÀ! "

StatusCode
ÃÃ 
=
ÃÃ 
$num
ÃÃ  
}
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
œœ 
public
—— 

async
—— 
Task
—— 
<
—— 
ResponseDTO
—— !
>
——! "$
CreateBookMarkedCourse
——# 9
(
——9 :
ClaimsPrincipal
——: I
User
——J N
,
——N O%
CreateCourseBookmarkDTO
——P g%
createCourseBookmarkDTO
——h 
)—— Ä
{
““ 
try
”” 
{
‘‘ 	
var
÷÷ 
id
÷÷ 
=
÷÷ 
await
÷÷ 
_unitOfWork
÷÷ &
.
÷÷& '
StudentRepository
÷÷' 8
.
÷÷8 9
GetAsync
÷÷9 A
(
÷÷A B
i
÷÷B C
=>
÷÷D F
i
÷÷G H
.
÷÷H I
	StudentId
÷÷I R
==
÷÷S U%
createCourseBookmarkDTO
÷÷V m
.
÷÷m n
	StudentId
÷÷n w
)
÷÷w x
;
÷÷x y
if
◊◊ 
(
◊◊ 
id
◊◊ 
==
◊◊ 
null
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
new
ŸŸ 
ResponseDTO
ŸŸ &
(
ŸŸ& '
)
ŸŸ' (
{
⁄⁄ 
Message
€€ 
=
€€ 
$str
€€ 1
,
€€1 2
	IsSuccess
‹‹ 
=
‹‹ 
false
‹‹  %
,
‹‹% &

StatusCode
›› 
=
››  
$num
››! $
,
››$ %
Result
ﬁﬁ 
=
ﬁﬁ 
null
ﬁﬁ !
}
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
var
‚‚ 
course
‚‚ 
=
‚‚ 
await
‚‚ 
_unitOfWork
‚‚ *
.
‚‚* +&
CourseBookmarkRepository
‚‚+ C
.
‚‚C D
GetAsync
‚‚D L
(
‚‚L M
c
‚‚N O
=>
‚‚P R
c
‚‚S T
.
‚‚T U
CourseId
‚‚U ]
==
‚‚^ `%
createCourseBookmarkDTO
‚‚a x
.
‚‚x y
CourseId‚‚y Å
&&‚‚Ç Ñ
c‚‚Ö Ü
.‚‚Ü á
	StudentId‚‚á ê
==‚‚ë ì'
createCourseBookmarkDTO‚‚î ´
.‚‚´ ¨
	StudentId‚‚¨ µ
)‚‚µ ∂
;‚‚∂ ∑
if
„„ 
(
„„ 
course
„„ 
!=
„„ 
null
„„ 
)
„„ 
{
‰‰ 
return
ÂÂ 
new
ÂÂ 
ResponseDTO
ÂÂ &
(
ÂÂ& '
)
ÂÂ' (
{
ÊÊ 
Message
ÁÁ 
=
ÁÁ 
$str
ÁÁ <
,
ÁÁ< =
	IsSuccess
ËË 
=
ËË 
false
ËË  %
,
ËË% &

StatusCode
ÈÈ 
=
ÈÈ  
$num
ÈÈ! $
,
ÈÈ$ %
Result
ÍÍ 
=
ÍÍ 
null
ÍÍ !
}
ÎÎ 
;
ÎÎ 
}
ÏÏ 
var
ÓÓ 
courseBookmark
ÓÓ 
=
ÓÓ  
new
ÓÓ! $
CourseBookmark
ÓÓ% 3
(
ÓÓ3 4
)
ÓÓ4 5
{
ÔÔ 
	StudentId
 
=
 %
createCourseBookmarkDTO
 3
.
3 4
	StudentId
4 =
,
= >
CourseId
ÒÒ 
=
ÒÒ %
createCourseBookmarkDTO
ÒÒ 2
.
ÒÒ2 3
CourseId
ÒÒ3 ;
,
ÒÒ; <
CreatedTime
ÚÚ 
=
ÚÚ 
DateTime
ÚÚ &
.
ÚÚ& '
UtcNow
ÚÚ' -
,
ÚÚ- .
	CreatedBy
ÛÛ 
=
ÛÛ 
User
ÛÛ  
.
ÛÛ  !
Identity
ÛÛ! )
.
ÛÛ) *
Name
ÛÛ* .
,
ÛÛ. /
}
ÙÙ 
;
ÙÙ 
await
ˆˆ 
_unitOfWork
ˆˆ 
.
ˆˆ &
CourseBookmarkRepository
ˆˆ 6
.
ˆˆ6 7
AddAsync
ˆˆ7 ?
(
ˆˆ? @
courseBookmark
ˆˆ@ N
)
ˆˆN O
;
ˆˆO P
await
˜˜ 
_unitOfWork
˜˜ 
.
˜˜ 
	SaveAsync
˜˜ '
(
˜˜' (
)
˜˜( )
;
˜˜) *
return
˘˘ 
new
˘˘ 
ResponseDTO
˘˘ "
(
˘˘" #
)
˘˘# $
{
˙˙ 
Message
˚˚ 
=
˚˚ 
$str
˚˚ ;
,
˚˚; <
Result
¸¸ 
=
¸¸ 
null
¸¸ 
,
¸¸ 
	IsSuccess
˝˝ 
=
˝˝ 
true
˝˝  
,
˝˝  !

StatusCode
˛˛ 
=
˛˛ 
$num
˛˛  
}
ˇˇ 
;
ˇˇ 
}
ÄÄ 	
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
ex
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
ex
ÖÖ 
.
ÖÖ 
Message
ÖÖ $
,
ÖÖ$ %
	IsSuccess
ÜÜ 
=
ÜÜ 
false
ÜÜ !
,
ÜÜ! "

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
}
ää 
public
åå 

async
åå 
Task
åå 
<
åå 
ResponseDTO
åå !
>
åå! "$
DeleteBookMarkedCourse
åå# 9
(
åå9 :
Guid
åå: >
Id
åå? A
)
ååA B
{
çç 
try
éé 
{
èè 	
var
êê 
courseBookmark
êê 
=
êê  
await
êê! &
_unitOfWork
êê' 2
.
êê2 3&
CourseBookmarkRepository
êê3 K
.
êêK L
GetAsync
êêL T
(
êêT U
x
ëë 
=>
ëë 
x
ëë 
.
ëë 
Id
ëë 
==
ëë 
Id
ëë 
)
ëë  
;
ëë  !
if
ìì 
(
ìì 
courseBookmark
ìì 
is
ìì !
null
ìì" &
)
ìì& '
{
îî 
return
ïï 
new
ïï 
ResponseDTO
ïï &
{
ññ 
Message
óó 
=
óó 
$str
óó :
,
óó: ;
	IsSuccess
òò 
=
òò 
false
òò  %
,
òò% &

StatusCode
ôô 
=
ôô  
$num
ôô! $
}
öö 
;
öö 
}
õõ 
_unitOfWork
ùù 
.
ùù &
CourseBookmarkRepository
ùù 0
.
ùù0 1
Remove
ùù1 7
(
ùù7 8
courseBookmark
ùù8 F
)
ùùF G
;
ùùG H
await
ûû 
_unitOfWork
ûû 
.
ûû 
	SaveAsync
ûû '
(
ûû' (
)
ûû( )
;
ûû) *
return
†† 
new
†† 
ResponseDTO
†† "
{
°° 
Message
¢¢ 
=
¢¢ 
$str
¢¢ A
,
¢¢A B
	IsSuccess
££ 
=
££ 
true
££  
,
££  !

StatusCode
§§ 
=
§§ 
$num
§§  
}
•• 
;
•• 
}
¶¶ 	
catch
ßß 
(
ßß 
	Exception
ßß 
ex
ßß 
)
ßß 
{
®® 	
return
©© 
new
©© 
ResponseDTO
©© "
{
™™ 
Message
´´ 
=
´´ 
ex
´´ 
.
´´ 
Message
´´ $
,
´´$ %
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨ !
,
¨¨! "

StatusCode
≠≠ 
=
≠≠ 
$num
≠≠  
}
ÆÆ 
;
ÆÆ 
}
ØØ 	
}
∞∞ 
}±± ‡ˆ
tD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseSectionVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class '
CourseSectionVersionService (
:) *(
ICourseSectionVersionService+ G
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly )
ISectionDetailsVersionService 2)
_sectionDetailsVersionService3 P
;P Q
private 
IMapper 
_mapper 
; 
public 
'
CourseSectionVersionService &
( 
IUnitOfWork 

unitOfWork 
, 
IMapper 
mapper 
, )
ISectionDetailsVersionService %(
sectionDetailsVersionService& B
) 
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; )
_sectionDetailsVersionService %
=& '(
sectionDetailsVersionService( D
;D E
} 
public   

async   
Task   
<   
ResponseDTO   !
>  ! "%
CloneCourseSectionVersion  # <
(!! 
ClaimsPrincipal"" 
User"" 
,"" (
CloneCourseSectionVersionDTO## $(
cloneCourseSectionVersionDto##% A
)$$ 
{%% 
try&& 
{'' 	
var(( !
courseSectionVersions(( %
=((& '
await)) 
_unitOfWork)) !
.))! "*
CourseSectionVersionRepository))" @
.))@ A8
,GetCourseSectionVersionsOfCourseVersionAsync))A m
(** (
cloneCourseSectionVersionDto++ 0
.++0 1
OldCourseVersionId++1 C
,++C D
asNoTracking,,  
:,,  !
true,," &
)-- 
;-- 
if// 
(// !
courseSectionVersions// %
.//% &
IsNullOrEmpty//& 3
(//3 4
)//4 5
)//5 6
{00 
return11 
new11 
ResponseDTO11 &
(11& '
)11' (
{22 
	IsSuccess33 
=33 
false33  %
,33% &

StatusCode44 
=44  
$num44! $
,44$ %
Result55 
=55 
null55 !
,55! "
Message66 
=66 
$str66 G
}77 
;77 
}88 
var:: +
cloneSectionsDetailsVersionsDto:: /
=::0 1
new::2 5
List::6 :
<::: ;*
CloneSectionsDetailsVersionDTO::; Y
>::Y Z
(::Z [
)::[ \
;::\ ]
foreach<< 
(<< 
var<<  
courseSectionVersion<< -
in<<. 0!
courseSectionVersions<<1 F
)<<F G
{== 
var>> *
cloneSectionsDetailsVersionDto>> 2
=>>3 4
new>>5 8*
CloneSectionsDetailsVersionDTO>>9 W
(>>W X
)>>X Y
;>>Y Z*
cloneSectionsDetailsVersionDto@@ .
.@@. /%
OldCourseSectionVersionId@@/ H
=@@I J 
courseSectionVersion@@K _
.@@_ `
Id@@` b
;@@b c 
courseSectionVersionAA $
.AA$ %
IdAA% '
=AA( )
GuidAA* .
.AA. /
NewGuidAA/ 6
(AA6 7
)AA7 8
;AA8 9*
cloneSectionsDetailsVersionDtoBB .
.BB. /%
NewCourseSectionVersionIdBB/ H
=BBI J 
courseSectionVersionBBK _
.BB_ `
IdBB` b
;BBb c 
courseSectionVersionDD $
.DD$ %
CourseVersionIdDD% 4
=DD5 6(
cloneCourseSectionVersionDtoDD7 S
.DDS T
NewCourseVersionIdDDT f
;DDf g+
cloneSectionsDetailsVersionsDtoFF /
.FF/ 0
AddFF0 3
(FF3 4*
cloneSectionsDetailsVersionDtoFF4 R
)FFR S
;FFS T
}GG 
awaitII 
_unitOfWorkII 
.II *
CourseSectionVersionRepositoryII <
.II< =
AddRangeAsyncII= J
(IIJ K!
courseSectionVersionsIIK `
)II` a
;IIa b
awaitJJ 
_unitOfWorkJJ 
.JJ 
	SaveAsyncJJ '
(JJ' (
)JJ( )
;JJ) *
foreachMM 
(MM 
varMM *
cloneSectionsDetailsVersionDtoMM 7
inMM8 :+
cloneSectionsDetailsVersionsDtoMM; Z
)MMZ [
{NN 
varOO 
responseDtoOO 
=OO  !
awaitPP )
_sectionDetailsVersionServicePP 7
.PP7 8'
CloneSectionsDetailsVersionPP8 S
(QQ 
UserRR 
,RR 
newSS *
CloneSectionsDetailsVersionDTOSS :
(SS: ;
)SS; <
{TT %
OldCourseSectionVersionIdUU 5
=UU6 7*
cloneSectionsDetailsVersionDtoUU8 V
.UUV W%
OldCourseSectionVersionIdUUW p
,UUp q%
NewCourseSectionVersionIdVV 5
=VV6 7*
cloneSectionsDetailsVersionDtoVV8 V
.VVV W%
NewCourseSectionVersionIdVVW p
,VVp q
}WW 
)XX 
;XX 
ifYY 
(YY 
responseDtoYY 
.YY  

StatusCodeYY  *
==YY+ -
$numYY. 1
)YY1 2
{ZZ 
return[[ 
responseDto[[ &
;[[& '
}\\ 
}]] 
return__ 
new__ 
ResponseDTO__ "
(__" #
)__# $
{`` 
	IsSuccessaa 
=aa 
trueaa  
,aa  !

StatusCodebb 
=bb 
$numbb  
,bb  !
Messagecc 
=cc 
$strcc O
,ccO P
Resultdd 
=dd 
nulldd 
}ee 
;ee 
}ff 	
catchgg 
(gg 
	Exceptiongg 
egg 
)gg 
{hh 	
returnii 
newii 
ResponseDTOii "
(ii" #
)ii# $
{jj 
	IsSuccesskk 
=kk 
falsekk !
,kk! "

StatusCodell 
=ll 
$numll  
,ll  !
Messagemm 
=mm 
emm 
.mm 
Messagemm #
,mm# $
Resultnn 
=nn 
nullnn 
}oo 
;oo 
}pp 	
}qq 
publicss 

asyncss 
Taskss 
<ss 
ResponseDTOss !
>ss! "
GetCourseSectionsss# 4
(tt 
ClaimsPrincipaluu 
Useruu 
,uu 
Guidvv 
?vv 
courseVersionIdvv 
,vv 
stringww 
?ww 
filterOnww 
,ww 
stringxx 
?xx 
filterQueryxx 
,xx 
stringyy 
?yy 
sortByyy 
,yy 
intzz 

pageNumberzz 
,zz 
int{{ 
pageSize{{ 
)|| 
{}} 
try~~ 
{ 	
var
ÅÅ 
userRole
ÅÅ 
=
ÅÅ 
User
ÅÅ 
.
ÅÅ  
Claims
ÅÅ  &
.
ÅÅ& '
FirstOrDefault
ÅÅ' 5
(
ÅÅ5 6
x
ÅÅ6 7
=>
ÅÅ8 :
x
ÅÅ; <
.
ÅÅ< =
Type
ÅÅ= A
==
ÅÅB D

ClaimTypes
ÅÅE O
.
ÅÅO P
Role
ÅÅP T
)
ÅÅT U
?
ÅÅU V
.
ÅÅV W
Value
ÅÅW \
;
ÅÅ\ ]
IEnumerable
ÉÉ 
<
ÉÉ "
CourseSectionVersion
ÉÉ ,
>
ÉÉ, -
sectionVersions
ÉÉ. =
;
ÉÉ= >
if
ÖÖ 
(
ÖÖ 
userRole
ÖÖ 
==
ÖÖ 
StaticUserRoles
ÖÖ +
.
ÖÖ+ ,
Admin
ÖÖ, 1
)
ÖÖ1 2
{
ÜÜ 
sectionVersions
àà 
=
àà  !
await
àà" '
_unitOfWork
àà( 3
.
àà3 4,
CourseSectionVersionRepository
àà4 R
.
ààR S
GetAllAsync
ààS ^
(
àà^ _
x
àà_ `
=>
ààa c
x
ââ 
.
ââ 
CourseVersionId
ââ %
==
ââ& (
courseVersionId
ââ) 8
)
ââ8 9
;
ââ9 :
}
ää 
else
ãã 
{
åå 
sectionVersions
éé 
=
éé  !
await
éé" '
_unitOfWork
éé( 3
.
éé3 4,
CourseSectionVersionRepository
éé4 R
.
ééR S
GetAllAsync
ééS ^
(
éé^ _
x
éé_ `
=>
ééa c
x
èè 
.
èè 
CourseVersionId
èè %
==
èè& (
courseVersionId
èè) 8
&&
èè9 ;
x
èè< =
.
èè= >
CurrentStatus
èè> K
<=
èèL N
StaticStatus
èèO [
.
èè[ \
Category
èè\ d
.
èèd e
	Activated
èèe n
)
èèn o
;
èèo p
}
êê 
if
ìì 
(
ìì 
!
ìì 
sectionVersions
ìì  
.
ìì  !
Any
ìì! $
(
ìì$ %
)
ìì% &
)
ìì& '
{
îî 
return
ïï 
new
ïï 
ResponseDTO
ïï &
(
ïï& '
)
ïï' (
{
ññ 
Message
óó 
=
óó 
$str
óó <
,
óó< =
	IsSuccess
òò 
=
òò 
true
òò  $
,
òò$ %

StatusCode
ôô 
=
ôô  
$num
ôô! $
,
ôô$ %
Result
öö 
=
öö 
sectionVersions
öö ,
}
õõ 
;
õõ 
}
úú 
var
ûû 
listSections
ûû 
=
ûû 
sectionVersions
ûû .
.
ûû. /
ToList
ûû/ 5
(
ûû5 6
)
ûû6 7
;
ûû7 8
if
°° 
(
°° 
!
°° 
string
°° 
.
°° 
IsNullOrEmpty
°° %
(
°°% &
filterOn
°°& .
)
°°. /
&&
°°0 2
!
°°3 4
string
°°4 :
.
°°: ;
IsNullOrEmpty
°°; H
(
°°H I
filterQuery
°°I T
)
°°T U
)
°°U V
{
¢¢ 
switch
££ 
(
££ 
filterOn
££  
.
££  !
Trim
££! %
(
££% &
)
££& '
.
££' (
ToLower
££( /
(
££/ 0
)
££0 1
)
££1 2
{
§§ 
case
•• 
$str
••  
:
••  !
listSections
¶¶ $
=
¶¶% &
listSections
¶¶' 3
.
¶¶3 4
Where
¶¶4 9
(
¶¶9 :
x
¶¶: ;
=>
¶¶< >
x
ßß 
.
ßß 
Title
ßß #
.
ßß# $
Contains
ßß$ ,
(
ßß, -
filterQuery
ßß- 8
,
ßß8 9
StringComparison
ßß: J
.
ßßJ K&
CurrentCultureIgnoreCase
ßßK c
)
ßßc d
)
ßßd e
.
ßße f
ToList
ßßf l
(
ßßl m
)
ßßm n
;
ßßn o
break
®® 
;
®® 
case
©© 
$str
©© &
:
©©& '
listSections
™™ $
=
™™% &
listSections
™™' 3
.
™™3 4
Where
™™4 9
(
™™9 :
x
™™: ;
=>
™™< >
x
´´ 
.
´´ 
Description
´´ )
.
´´) *
Contains
´´* 2
(
´´2 3
filterQuery
´´3 >
,
´´> ?
StringComparison
´´@ P
.
´´P Q&
CurrentCultureIgnoreCase
´´Q i
)
´´i j
)
´´j k
.
´´k l
ToList
´´l r
(
´´r s
)
´´s t
;
´´t u
break
¨¨ 
;
¨¨ 
case
≠≠ 
$str
≠≠ (
:
≠≠( )
if
ÆÆ 
(
ÆÆ 
int
ÆÆ 
.
ÆÆ  
TryParse
ÆÆ  (
(
ÆÆ( )
filterQuery
ÆÆ) 4
,
ÆÆ4 5
out
ÆÆ6 9
var
ÆÆ: =
status
ÆÆ> D
)
ÆÆD E
)
ÆÆE F
{
ØØ 
listSections
∞∞ (
=
∞∞) *
listSections
∞∞+ 7
.
∞∞7 8
Where
∞∞8 =
(
∞∞= >
x
∞∞> ?
=>
∞∞@ B
x
∞∞C D
.
∞∞D E
CurrentStatus
∞∞E R
==
∞∞S U
status
∞∞V \
)
∞∞\ ]
.
∞∞] ^
ToList
∞∞^ d
(
∞∞d e
)
∞∞e f
;
∞∞f g
}
±± 
break
≥≥ 
;
≥≥ 
default
¥¥ 
:
¥¥ 
break
µµ 
;
µµ 
}
∂∂ 
}
∑∑ 
if
∫∫ 
(
∫∫ 
!
∫∫ 
string
∫∫ 
.
∫∫ 
IsNullOrEmpty
∫∫ %
(
∫∫% &
sortBy
∫∫& ,
)
∫∫, -
)
∫∫- .
{
ªª 
switch
ºº 
(
ºº 
sortBy
ºº 
.
ºº 
Trim
ºº #
(
ºº# $
)
ºº$ %
.
ºº% &
ToLower
ºº& -
(
ºº- .
)
ºº. /
)
ºº/ 0
{
ΩΩ 
case
ææ 
$str
ææ  
:
ææ  !
listSections
øø $
=
øø% &
listSections
øø' 3
.
øø3 4
OrderBy
øø4 ;
(
øø; <
x
øø< =
=>
øø> @
x
øøA B
.
øøB C
Title
øøC H
)
øøH I
.
øøI J
ToList
øøJ P
(
øøP Q
)
øøQ R
;
øøR S
break
¿¿ 
;
¿¿ 
case
¡¡ 
$str
¡¡ &
:
¡¡& '
listSections
¬¬ $
=
¬¬% &
listSections
¬¬' 3
.
¬¬3 4
OrderBy
¬¬4 ;
(
¬¬; <
x
¬¬< =
=>
¬¬> @
x
¬¬A B
.
¬¬B C
Description
¬¬C N
)
¬¬N O
.
¬¬O P
ToList
¬¬P V
(
¬¬V W
)
¬¬W X
;
¬¬X Y
break
√√ 
;
√√ 
case
ƒƒ 
$str
ƒƒ (
:
ƒƒ( )
listSections
≈≈ $
=
≈≈% &
listSections
≈≈' 3
.
≈≈3 4
OrderBy
≈≈4 ;
(
≈≈; <
x
≈≈< =
=>
≈≈> @
x
≈≈A B
.
≈≈B C
CurrentStatus
≈≈C P
)
≈≈P Q
.
≈≈Q R
ToList
≈≈R X
(
≈≈X Y
)
≈≈Y Z
;
≈≈Z [
break
∆∆ 
;
∆∆ 
default
«« 
:
«« 
break
»» 
;
»» 
}
…… 
}
   
else
ÀÀ 
{
ÃÃ 
listSections
ŒŒ 
=
ŒŒ 
listSections
ŒŒ +
.
ŒŒ+ ,
OrderBy
ŒŒ, 3
(
ŒŒ3 4
x
ŒŒ4 5
=>
ŒŒ6 8
x
ŒŒ9 :
.
ŒŒ: ;
Title
ŒŒ; @
)
ŒŒ@ A
.
ŒŒA B
ToList
ŒŒB H
(
ŒŒH I
)
ŒŒI J
;
ŒŒJ K
}
œœ 
if
““ 
(
““ 

pageNumber
““ 
>
““ 
$num
““ 
&&
““ !
pageSize
““" *
>
““+ ,
$num
““- .
)
““. /
{
”” 
var
‘‘ 

skipResult
‘‘ 
=
‘‘  
(
‘‘! "

pageNumber
‘‘" ,
-
‘‘- .
$num
‘‘/ 0
)
‘‘0 1
*
‘‘2 3
pageSize
‘‘4 <
;
‘‘< =
listSections
’’ 
=
’’ 
listSections
’’ +
.
’’+ ,
Skip
’’, 0
(
’’0 1

skipResult
’’1 ;
)
’’; <
.
’’< =
Take
’’= A
(
’’A B
pageSize
’’B J
)
’’J K
.
’’K L
ToList
’’L R
(
’’R S
)
’’S T
;
’’T U
}
÷÷ 
var
ŸŸ 
sectionsDto
ŸŸ 
=
ŸŸ 
listSections
ŸŸ *
.
ŸŸ* +
Select
ŸŸ+ 1
(
ŸŸ1 2
section
ŸŸ2 9
=>
ŸŸ: <
new
ŸŸ= @
GetAllSectionsDTO
ŸŸA R
{
⁄⁄ 
Id
€€ 
=
€€ 
section
€€ 
.
€€ 
Id
€€ 
,
€€  
Title
‹‹ 
=
‹‹ 
section
‹‹ 
.
‹‹  
Title
‹‹  %
,
‹‹% &
Description
›› 
=
›› 
section
›› %
.
››% &
Description
››& 1
,
››1 2
CurrentStatus
ﬁﬁ 
=
ﬁﬁ 
(
ﬁﬁ  !
int
ﬁﬁ! $
)
ﬁﬁ$ %
section
ﬁﬁ% ,
.
ﬁﬁ, -
CurrentStatus
ﬁﬁ- :
}
ﬂﬂ 
)
ﬂﬂ 
.
ﬂﬂ 
ToList
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Message
„„ 
=
„„ 
$str
„„ D
,
„„D E
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Result
ÊÊ 
=
ÊÊ 
sectionsDto
ÊÊ $
}
ÁÁ 
;
ÁÁ 
}
ËË 	
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ "
(
ÎÎ" #
)
ÎÎ# $
{
ÏÏ 
Message
ÌÌ 
=
ÌÌ 
e
ÌÌ 
.
ÌÌ 
Message
ÌÌ #
,
ÌÌ# $
Result
ÓÓ 
=
ÓÓ 
null
ÓÓ 
,
ÓÓ 
	IsSuccess
ÔÔ 
=
ÔÔ 
false
ÔÔ !
,
ÔÔ! "

StatusCode
 
=
 
$num
  
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
}
ÛÛ 
public
ıı 

async
ıı 
Task
ıı 
<
ıı 
ResponseDTO
ıı !
>
ıı! "
GetCourseSection
ıı# 3
(
ˆˆ 
ClaimsPrincipal
˜˜ 
User
˜˜ 
,
˜˜ 
Guid
¯¯ $
courseSectionVersionId
¯¯ #
)
˘˘ 
{
˙˙ 
try
˚˚ 
{
¸¸ 	
var
˝˝ "
courseSectionVersion
˝˝ $
=
˝˝% &
await
˛˛ 
_unitOfWork
˛˛ !
.
˛˛! ",
CourseSectionVersionRepository
˛˛" @
.
˛˛@ A
GetAsync
˛˛A I
(
˛˛I J
c
˛˛J K
=>
˛˛L N
c
ˇˇ 
.
ˇˇ 
Id
ˇˇ 
==
ˇˇ $
courseSectionVersionId
ˇˇ 2
)
ˇˇ2 3
;
ˇˇ3 4
if
ÅÅ 
(
ÅÅ "
courseSectionVersion
ÅÅ $
is
ÅÅ% '
null
ÅÅ( ,
)
ÅÅ, -
{
ÇÇ 
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ &
(
ÉÉ& '
)
ÉÉ' (
{
ÑÑ 
Result
ÖÖ 
=
ÖÖ 
$str
ÖÖ 
,
ÖÖ  
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ C
,
ÜÜC D
	IsSuccess
áá 
=
áá 
true
áá  $
,
áá$ %

StatusCode
àà 
=
àà  
$num
àà! $
}
ââ 
;
ââ 
}
ää 
var
åå %
courseSectionVersionDto
åå '
=
åå( )
_mapper
åå* 1
.
åå1 2
Map
åå2 5
<
åå5 6!
GetCourseSectionDTO
åå6 I
>
ååI J
(
ååJ K"
courseSectionVersion
ååK _
)
åå_ `
;
åå` a
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
Result
êê 
=
êê %
courseSectionVersionDto
êê 0
,
êê0 1
Message
ëë 
=
ëë 
$str
ëë C
,
ëëC D
	IsSuccess
íí 
=
íí 
true
íí  
,
íí  !

StatusCode
ìì 
=
ìì 
$num
ìì  
}
îî 
;
îî 
}
ïï 	
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 	
return
òò 
new
òò 
ResponseDTO
òò "
(
òò" #
)
òò# $
{
ôô 
Result
öö 
=
öö 
null
öö 
,
öö 
Message
õõ 
=
õõ 
e
õõ 
.
õõ 
Message
õõ #
,
õõ# $
	IsSuccess
úú 
=
úú 
true
úú  
,
úú  !

StatusCode
ùù 
=
ùù 
$num
ùù  
}
ûû 
;
ûû 
}
üü 	
}
†† 
public
¢¢ 

async
¢¢ 
Task
¢¢ 
<
¢¢ 
ResponseDTO
¢¢ !
>
¢¢! "!
CreateCourseSection
¢¢# 6
(
££ 
ClaimsPrincipal
§§ 
User
§§ 
,
§§ +
CreateCourseSectionVersionDTO
•• %+
createCourseSectionVersionDTO
••& C
)
¶¶ 
{
ßß 
try
®® 
{
©© 	
var
™™ 
courseVersionId
™™ 
=
™™  !
await
´´ 
_unitOfWork
´´ !
.
´´! "%
CourseVersionRepository
´´" 9
.
´´9 :
GetAsync
´´: B
(
´´B C
c
´´C D
=>
´´E G
c
¨¨ 
.
¨¨ 
Id
¨¨ 
==
¨¨ +
createCourseSectionVersionDTO
¨¨ 9
.
¨¨9 :
CourseVersionId
¨¨: I
)
¨¨I J
;
¨¨J K
if
≠≠ 
(
≠≠ 
courseVersionId
≠≠ 
==
≠≠  "
null
≠≠# '
)
≠≠' (
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
(
ØØ& '
)
ØØ' (
{
∞∞ 
Message
±± 
=
±± 
$str
±± 7
,
±±7 8
Result
≤≤ 
=
≤≤ 
null
≤≤ !
,
≤≤! "
	IsSuccess
≥≥ 
=
≥≥ 
false
≥≥  %
,
≥≥% &

StatusCode
¥¥ 
=
¥¥  
$num
¥¥! $
}
µµ 
;
µµ 
}
∂∂ 
var
ππ "
courseSectionVersion
ππ $
=
ππ% &
new
ππ' *"
CourseSectionVersion
ππ+ ?
(
ππ? @
)
ππ@ A
{
∫∫ 
Id
ªª 
=
ªª 
Guid
ªª 
.
ªª 
NewGuid
ªª !
(
ªª! "
)
ªª" #
,
ªª# $
CourseVersionId
ºº 
=
ºº  !+
createCourseSectionVersionDTO
ºº" ?
.
ºº? @
CourseVersionId
ºº@ O
,
ººO P
Title
ΩΩ 
=
ΩΩ +
createCourseSectionVersionDTO
ΩΩ 5
.
ΩΩ5 6
Title
ΩΩ6 ;
,
ΩΩ; <
Description
ææ 
=
ææ +
createCourseSectionVersionDTO
ææ ;
.
ææ; <
Description
ææ< G
,
ææG H
CurrentStatus
øø 
=
øø 
$num
øø  !
}
¿¿ 
;
¿¿ 
await
√√ 
_unitOfWork
√√ 
.
√√ ,
CourseSectionVersionRepository
√√ <
.
√√< =
AddAsync
√√= E
(
√√E F"
courseSectionVersion
√√F Z
)
√√Z [
;
√√[ \
await
ƒƒ 
_unitOfWork
ƒƒ 
.
ƒƒ 
	SaveAsync
ƒƒ '
(
ƒƒ' (
)
ƒƒ( )
;
ƒƒ) *
return
∆∆ 
new
∆∆ 
ResponseDTO
∆∆ "
(
∆∆" #
)
∆∆# $
{
«« 
Result
»» 
=
»» "
courseSectionVersion
»» -
.
»»- .
Id
»». 0
,
»»0 1
Message
…… 
=
…… 
$str
…… J
,
……J K
	IsSuccess
   
=
   
true
    
,
    !

StatusCode
ÀÀ 
=
ÀÀ 
$num
ÀÀ  
}
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 	
return
–– 
new
–– 
ResponseDTO
–– "
(
––" #
)
––# $
{
—— 
Result
““ 
=
““ 
null
““ 
,
““ 
	IsSuccess
”” 
=
”” 
false
”” !
,
””! "
Message
‘‘ 
=
‘‘ 
e
‘‘ 
.
‘‘ 
Message
‘‘ #
,
‘‘# $

StatusCode
’’ 
=
’’ 
$num
’’  
}
÷÷ 
;
÷÷ 
}
◊◊ 	
}
ÿÿ 
public
⁄⁄ 

async
⁄⁄ 
Task
⁄⁄ 
<
⁄⁄ 
ResponseDTO
⁄⁄ !
>
⁄⁄! "
EditCourseSection
⁄⁄# 4
(
€€ 
ClaimsPrincipal
‹‹ 
User
‹‹ 
,
‹‹ )
EditCourseSectionVersionDTO
›› #)
editCourseSectionVersionDTO
››$ ?
)
ﬁﬁ 
{
ﬂﬂ 
try
‡‡ 
{
·· 	
var
„„ $
courseSectionVersionId
„„ &
=
„„' (
await
‰‰ 
_unitOfWork
‰‰ !
.
‰‰! ",
CourseSectionVersionRepository
‰‰" @
.
‰‰@ A
GetAsync
‰‰A I
(
‰‰I J
c
‰‰J K
=>
‰‰L N
c
ÂÂ 
.
ÂÂ 
Id
ÂÂ 
==
ÂÂ )
editCourseSectionVersionDTO
ÂÂ 7
.
ÂÂ7 8$
CourseSectionVersionId
ÂÂ8 N
)
ÂÂN O
;
ÂÂO P
if
ÊÊ 
(
ÊÊ $
courseSectionVersionId
ÊÊ &
==
ÊÊ' )
null
ÊÊ* .
)
ÊÊ. /
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË &
(
ËË& '
)
ËË' (
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
$str
ÍÍ >
,
ÍÍ> ?
Result
ÎÎ 
=
ÎÎ 
null
ÎÎ !
,
ÎÎ! "
	IsSuccess
ÏÏ 
=
ÏÏ 
false
ÏÏ  %
,
ÏÏ% &

StatusCode
ÌÌ 
=
ÌÌ  
$num
ÌÌ! $
}
ÓÓ 
;
ÓÓ 
}
ÔÔ $
courseSectionVersionId
ıı "
.
ıı" #
Title
ıı# (
=
ıı) *)
editCourseSectionVersionDTO
ıı+ F
.
ııF G
Title
ııG L
;
ııL M$
courseSectionVersionId
ˆˆ "
.
ˆˆ" #
Description
ˆˆ# .
=
ˆˆ/ 0)
editCourseSectionVersionDTO
ˆˆ1 L
.
ˆˆL M
Description
ˆˆM X
;
ˆˆX Y$
courseSectionVersionId
˜˜ "
.
˜˜" #
CurrentStatus
˜˜# 0
=
˜˜1 2
$num
˜˜3 4
;
˜˜4 5
_unitOfWork
˘˘ 
.
˘˘ ,
CourseSectionVersionRepository
˘˘ 6
.
˘˘6 7
Update
˘˘7 =
(
˘˘= >$
courseSectionVersionId
˘˘> T
)
˘˘T U
;
˘˘U V
await
˙˙ 
_unitOfWork
˙˙ 
.
˙˙ 
	SaveAsync
˙˙ '
(
˙˙' (
)
˙˙( )
;
˙˙) *
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ "
(
¸¸" #
)
¸¸# $
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ D
,
˛˛D E
Result
ˇˇ 
=
ˇˇ 
null
ˇˇ 
,
ˇˇ 
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  
,
ÄÄ  !

StatusCode
ÅÅ 
=
ÅÅ 
$num
ÅÅ  
,
ÅÅ  !
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ "
{
áá 
Message
àà 
=
àà 
e
àà 
.
àà 
Message
àà #
,
àà# $
Result
ââ 
=
ââ 
null
ââ 
,
ââ 
	IsSuccess
ää 
=
ää 
false
ää !
,
ää! "

StatusCode
ãã 
=
ãã 
$num
ãã  
}
åå 
;
åå 
}
çç 	
}
éé 
public
êê 

async
êê 
Task
êê 
<
êê 
ResponseDTO
êê !
>
êê! "!
RemoveCourseSection
êê# 6
(
ëë 
ClaimsPrincipal
íí 
User
íí 
,
íí 
Guid
ìì 
sectionVersionId
ìì 
)
îî 
{
ïï 
try
ññ 
{
óó 	
var
ôô "
courseSectionVersion
ôô $
=
ôô% &
await
öö 
_unitOfWork
öö !
.
öö! ",
CourseSectionVersionRepository
öö" @
.
öö@ A
GetAsync
ööA I
(
ööI J
c
ööJ K
=>
ööL N
c
õõ 
.
õõ 
Id
õõ 
==
õõ 
sectionVersionId
õõ ,
)
õõ, -
;
õõ- .
if
úú 
(
úú "
courseSectionVersion
úú $
==
úú% '
null
úú( ,
)
úú, -
{
ùù 
return
ûû 
new
ûû 
ResponseDTO
ûû &
(
ûû& '
)
ûû' (
{
üü 
Message
†† 
=
†† 
$str
†† D
,
††D E
Result
°° 
=
°° 
null
°° !
,
°°! "
	IsSuccess
¢¢ 
=
¢¢ 
false
¢¢  %
,
¢¢% &

StatusCode
££ 
=
££  
$num
££! $
}
§§ 
;
§§ 
}
•• 
var
™™ "
sectionDetailVersion
™™ $
=
™™% &
await
´´ 
_unitOfWork
´´ !
.
´´! "-
SectionDetailsVersionRepository
´´" A
.
´´A B
GetAllAsync
´´B M
(
´´M N
x
´´N O
=>
´´P R
x
¨¨ 
.
¨¨ $
CourseSectionVersionId
¨¨ ,
==
¨¨- /"
courseSectionVersion
¨¨0 D
.
¨¨D E
Id
¨¨E G
)
¨¨G H
;
¨¨H I
_unitOfWork
ÆÆ 
.
ÆÆ -
SectionDetailsVersionRepository
ÆÆ 7
.
ÆÆ7 8
RemoveRange
ÆÆ8 C
(
ÆÆC D"
sectionDetailVersion
ÆÆD X
)
ÆÆX Y
;
ÆÆY Z
_unitOfWork
ØØ 
.
ØØ ,
CourseSectionVersionRepository
ØØ 6
.
ØØ6 7
Remove
ØØ7 =
(
ØØ= >"
courseSectionVersion
ØØ> R
)
ØØR S
;
ØØS T
await
∞∞ 
_unitOfWork
∞∞ 
.
∞∞ 
	SaveAsync
∞∞ '
(
∞∞' (
)
∞∞( )
;
∞∞) *
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ G
,
¥¥G H
Result
µµ 
=
µµ 
null
µµ 
,
µµ 
	IsSuccess
∂∂ 
=
∂∂ 
true
∂∂  
,
∂∂  !

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
,
∑∑  !
}
∏∏ 
;
∏∏ 
}
ππ 	
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 	
return
ºº 
new
ºº 
ResponseDTO
ºº "
{
ΩΩ 
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $
Result
øø 
=
øø 
null
øø 
,
øø 
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿ !
,
¿¿! "

StatusCode
¡¡ 
=
¡¡ 
$num
¡¡  
}
¬¬ 
;
¬¬ 
}
√√ 	
}
ƒƒ 
}≈≈ ≈÷
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseReviewService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
{		 
public

 

class

 
CourseReviewService

 $
:

% & 
ICourseReviewService

' ;
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
private 
readonly 
ICourseService '
_courseService( 6
;6 7
private 
readonly 
IMapper  
_mapper! (
;( )
public 
CourseReviewService "
(" #
IUnitOfWork# .

unitOfWork/ 9
,9 :
IMapper; B
mapperC I
,I J
ICourseServiceK Y
courseServiceZ g
)g h
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
_mapper 
= 
mapper 
; 
_courseService 
= 
courseService *
;* +
} 	
public 
async 
Task 
< 
ResponseDTO %
>% &
GetCourseReviews' 7
( 	
ClaimsPrincipal 
User  
,  !
Guid 
? 
courseId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
,  
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int   
pageSize   
)!! 	
{"" 	
try## 
{$$ 
if%% 
(%% 
courseId%% 
==%% 
null%%  $
)%%$ %
{&& 
return'' 
new'' 
ResponseDTO'' *
(''* +
)''+ ,
{(( 
Message)) 
=))  !
$str))" 9
,))9 :
	IsSuccess** !
=**" #
false**$ )
,**) *

StatusCode++ "
=++# $
$num++% (
,++( )
Result,, 
=,,  
null,,! %
}-- 
;-- 
}.. 
var00 
courseReviews00 !
=00" #
await00$ )
_unitOfWork00* 5
.005 6"
CourseReviewRepository006 L
.00L M
GetAllAsync00M X
(00X Y
filter11 
:11 
x11 
=>11  
x11! "
.11" #
CourseId11# +
==11, .
courseId11/ 7
)22 
;22 
if44 
(44 
!44 
courseReviews44 "
.44" #
Any44# &
(44& '
)44' (
)44( )
{55 
return66 
new66 
ResponseDTO66 *
(66* +
)66+ ,
{77 
Message88 
=88  !
$str88" ?
,88? @
Result99 
=99  
courseReviews99! .
,99. /
	IsSuccess:: !
=::" #
false::$ )
,::) *

StatusCode;; "
=;;# $
$num;;% (
}<< 
;<< 
}== 
if@@ 
(@@ 
!@@ 
string@@ 
.@@ 
IsNullOrEmpty@@ )
(@@) *
filterOn@@* 2
)@@2 3
&&@@4 6
!@@7 8
string@@8 >
.@@> ?
IsNullOrEmpty@@? L
(@@L M
filterQuery@@M X
)@@X Y
)@@Y Z
{AA 
switchBB 
(BB 
filterOnBB $
.BB$ %
TrimBB% )
(BB) *
)BB* +
.BB+ ,
ToLowerBB, 3
(BB3 4
)BB4 5
)BB5 6
{CC 
caseDD 
$strDD &
:DD& '
courseReviewsEE )
=EE* +
courseReviewsEE, 9
.EE9 :
WhereEE: ?
(EE? @
xEE@ A
=>EEB D
xFF  !
.FF! "
MessageFF" )
.FF) *
ContainsFF* 2
(FF2 3
filterQueryFF3 >
,FF> ?
StringComparisonFF@ P
.FFP Q$
CurrentCultureIgnoreCaseFFQ i
)FFi j
)FFj k
.FFk l
ToListFFl r
(FFr s
)FFs t
;FFt u
breakGG !
;GG! "
caseHH 
$strHH #
:HH# $
courseReviewsII )
=II* +
courseReviewsII, 9
.II9 :
WhereII: ?
(II? @
xII@ A
=>IIB D
xJJ  !
.JJ! "
RateJJ" &
.JJ& '
ToStringJJ' /
(JJ/ 0
)JJ0 1
==JJ2 4
filterQueryJJ5 @
)JJ@ A
.JJA B
ToListJJB H
(JJH I
)JJI J
;JJJ K
breakKK !
;KK! "
}LL 
}MM 
ifPP 
(PP 
!PP 
stringPP 
.PP 
IsNullOrEmptyPP )
(PP) *
sortByPP* 0
)PP0 1
)PP1 2
{QQ 
switchRR 
(RR 
sortByRR "
.RR" #
TrimRR# '
(RR' (
)RR( )
.RR) *
ToLowerRR* 1
(RR1 2
)RR2 3
)RR3 4
{SS 
caseTT 
$strTT &
:TT& '
courseReviewsUU )
=UU* +
isAscendingUU, 7
==UU8 :
trueUU; ?
?VV  !
courseReviewsVV" /
.VV/ 0
OrderByVV0 7
(VV7 8
xVV8 9
=>VV: <
xVV= >
.VV> ?
MessageVV? F
)VVF G
.VVG H
ToListVVH N
(VVN O
)VVO P
:WW  !
courseReviewsWW" /
.WW/ 0
OrderByDescendingWW0 A
(WWA B
xWWB C
=>WWD F
xWWG H
.WWH I
MessageWWI P
)WWP Q
.WWQ R
ToListWWR X
(WWX Y
)WWY Z
;WWZ [
breakXX !
;XX! "
caseYY 
$strYY #
:YY# $
courseReviewsZZ )
=ZZ* +
isAscendingZZ, 7
==ZZ8 :
trueZZ; ?
?[[  !
courseReviews[[" /
.[[/ 0
OrderBy[[0 7
([[7 8
x[[8 9
=>[[: <
x[[= >
.[[> ?
Rate[[? C
)[[C D
.[[D E
ToList[[E K
([[K L
)[[L M
:\\  !
courseReviews\\" /
.\\/ 0
OrderByDescending\\0 A
(\\A B
x\\B C
=>\\D F
x\\G H
.\\H I
Rate\\I M
)\\M N
.\\N O
ToList\\O U
(\\U V
)\\V W
;\\W X
break]] !
;]]! "
default^^ 
:^^  
break__ !
;__! "
}`` 
}aa 
ifdd 
(dd 

pageNumberdd 
>dd  
$numdd! "
&&dd# %
pageSizedd& .
>dd/ 0
$numdd1 2
)dd2 3
{ee 
varff 

skipResultff "
=ff# $
(ff% &

pageNumberff& 0
-ff1 2
$numff3 4
)ff4 5
*ff6 7
pageSizeff8 @
;ff@ A
courseReviewsgg !
=gg" #
courseReviewsgg$ 1
.gg1 2
Skipgg2 6
(gg6 7

skipResultgg7 A
)ggA B
.ggB C
TakeggC G
(ggG H
pageSizeggH P
)ggP Q
.ggQ R
ToListggR X
(ggX Y
)ggY Z
;ggZ [
}hh 
ifjj 
(jj 
!jj 
courseReviewsjj "
.jj" #
Anyjj# &
(jj& '
)jj' (
)jj( )
{kk 
returnll 
newll 
ResponseDTOll *
(ll* +
)ll+ ,
{mm 
Messagenn 
=nn  !
$strnn" ?
,nn? @
Resultoo 
=oo  
courseReviewsoo! .
,oo. /
	IsSuccesspp !
=pp" #
falsepp$ )
,pp) *

StatusCodeqq "
=qq# $
$numqq% (
}rr 
;rr 
}ss 
varuu 
courseReviewDtouu #
=uu$ %
_mapperuu& -
.uu- .
Mapuu. 1
<uu1 2
Listuu2 6
<uu6 7
GetCourseReviewDTOuu7 I
>uuI J
>uuJ K
(uuK L
courseReviewsuuL Y
)uuY Z
;uuZ [
returnww 
newww 
ResponseDTOww &
(ww& '
)ww' (
{xx 
Resultyy 
=yy 
courseReviewDtoyy ,
,yy, -
Messagezz 
=zz 
$strzz ?
,zz? @
	IsSuccess{{ 
={{ 
true{{  $
,{{$ %

StatusCode|| 
=||  
$num||! $
}}} 
;}} 
}~~ 
catch 
( 
	Exception 
ex 
)  
{
ÄÄ 
return
ÅÅ 
new
ÅÅ 
ResponseDTO
ÅÅ &
(
ÅÅ& '
)
ÅÅ' (
{
ÇÇ 
Result
ÉÉ 
=
ÉÉ 
null
ÉÉ !
,
ÉÉ! "
Message
ÑÑ 
=
ÑÑ 
ex
ÑÑ  
.
ÑÑ  !
Message
ÑÑ! (
,
ÑÑ( )
	IsSuccess
ÖÖ 
=
ÖÖ 
false
ÖÖ  %
,
ÖÖ% &

StatusCode
ÜÜ 
=
ÜÜ  
$num
ÜÜ! $
}
áá 
;
áá 
}
àà 
}
ââ 	
public
ãã 
async
ãã 
Task
ãã 
<
ãã 
ResponseDTO
ãã %
>
ãã% &!
GetCourseReviewById
ãã' :
(
ãã: ;
Guid
ãã; ?
id
ãã@ B
)
ããB C
{
åå 	
try
çç 
{
éé 
var
èè 
courseReview
èè  
=
èè! "
await
èè# (
_unitOfWork
èè) 4
.
èè4 5$
CourseReviewRepository
èè5 K
.
èèK L
GetById
èèL S
(
èèS T
id
èèT V
)
èèV W
;
èèW X
if
êê 
(
êê 
courseReview
êê  
==
êê! #
null
êê$ (
)
êê( )
{
ëë 
return
íí 
new
íí 
ResponseDTO
íí *
{
ìì 
Message
îî 
=
îî  !
$str
îî" ;
,
îî; <
	IsSuccess
ïï !
=
ïï" #
false
ïï$ )
,
ïï) *

StatusCode
ññ "
=
ññ# $
$num
ññ% (
,
ññ( )
Result
óó 
=
óó  
null
óó! %
}
òò 
;
òò 
}
ôô 
return
õõ 
new
õõ 
ResponseDTO
õõ &
{
úú 
Message
ùù 
=
ùù 
$str
ùù D
,
ùùD E
	IsSuccess
ûû 
=
ûû 
true
ûû  $
,
ûû$ %

StatusCode
üü 
=
üü  
$num
üü! $
,
üü$ %
Result
†† 
=
†† 
courseReview
†† )
}
°° 
;
°° 
}
¢¢ 
catch
££ 
(
££ 
	Exception
££ 
ex
££ 
)
££  
{
§§ 
return
•• 
new
•• 
ResponseDTO
•• &
{
¶¶ 
Message
ßß 
=
ßß 
ex
ßß  
.
ßß  !
Message
ßß! (
,
ßß( )
	IsSuccess
®® 
=
®® 
false
®®  %
,
®®% &

StatusCode
©© 
=
©©  
$num
©©! $
,
©©$ %
Result
™™ 
=
™™ 
null
™™ !
}
´´ 
;
´´ 
}
¨¨ 
}
≠≠ 	
public
ØØ 
async
ØØ 
Task
ØØ 
<
ØØ 
ResponseDTO
ØØ %
>
ØØ% & 
CreateCourseReview
ØØ' 9
(
ØØ9 :#
CreateCourseReviewDTO
ØØ: O#
createCourseReviewDTO
ØØP e
)
ØØe f
{
∞∞ 	
try
±± 
{
≤≤ 
var
¥¥ 
course
¥¥ 
=
¥¥ 
await
¥¥ "
_unitOfWork
¥¥# .
.
¥¥. /
CourseRepository
¥¥/ ?
.
¥¥? @
GetById
¥¥@ G
(
¥¥G H#
createCourseReviewDTO
¥¥H ]
.
¥¥] ^
CourseId
¥¥^ f
)
¥¥f g
;
¥¥g h
if
µµ 
(
µµ 
course
µµ 
==
µµ 
null
µµ "
)
µµ" #
{
∂∂ 
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ *
{
∏∏ 
Message
ππ 
=
ππ  !
$str
ππ" 4
,
ππ4 5
	IsSuccess
∫∫ !
=
∫∫" #
false
∫∫$ )
,
∫∫) *

StatusCode
ªª "
=
ªª# $
$num
ªª% (
,
ªª( )
Result
ºº 
=
ºº  
null
ºº! %
}
ΩΩ 
;
ΩΩ 
}
ææ 
var
¡¡ 
student
¡¡ 
=
¡¡ 
await
¡¡ #
_unitOfWork
¡¡$ /
.
¡¡/ 0
StudentRepository
¡¡0 A
.
¡¡A B
GetById
¡¡B I
(
¡¡I J#
createCourseReviewDTO
¡¡J _
.
¡¡_ `
	StudentId
¡¡` i
)
¡¡i j
;
¡¡j k
if
¬¬ 
(
¬¬ 
student
¬¬ 
==
¬¬ 
null
¬¬ #
)
¬¬# $
{
√√ 
return
ƒƒ 
new
ƒƒ 
ResponseDTO
ƒƒ *
{
≈≈ 
Message
∆∆ 
=
∆∆  !
$str
∆∆" 5
,
∆∆5 6
	IsSuccess
«« !
=
««" #
false
««$ )
,
««) *

StatusCode
»» "
=
»»# $
$num
»»% (
,
»»( )
Result
…… 
=
……  
null
……! %
}
   
;
   
}
ÀÀ 
var
ŒŒ 
courseReview
ŒŒ  
=
ŒŒ! "
new
ŒŒ# &
CourseReview
ŒŒ' 3
{
œœ 
Id
–– 
=
–– 
Guid
–– 
.
–– 
NewGuid
–– %
(
––% &
)
––& '
,
––' (
CourseId
—— 
=
—— #
createCourseReviewDTO
—— 4
.
——4 5
CourseId
——5 =
,
——= >
	StudentId
““ 
=
““ #
createCourseReviewDTO
““  5
.
““5 6
	StudentId
““6 ?
,
““? @
Rate
”” 
=
”” #
createCourseReviewDTO
”” 0
.
””0 1
Rate
””1 5
,
””5 6
Message
‘‘ 
=
‘‘ #
createCourseReviewDTO
‘‘ 3
.
‘‘3 4
Message
‘‘4 ;
,
‘‘; <
	CreatedBy
’’ 
=
’’ #
createCourseReviewDTO
’’  5
.
’’5 6
	StudentId
’’6 ?
.
’’? @
ToString
’’@ H
(
’’H I
)
’’I J
,
’’J K
CreatedTime
÷÷ 
=
÷÷  !
DateTime
÷÷" *
.
÷÷* +
UtcNow
÷÷+ 1
,
÷÷1 2
Status
◊◊ 
=
◊◊ 
$num
◊◊ 
}
ÿÿ 
;
ÿÿ 
await
⁄⁄ 
_unitOfWork
⁄⁄ !
.
⁄⁄! "$
CourseReviewRepository
⁄⁄" 8
.
⁄⁄8 9
AddAsync
⁄⁄9 A
(
⁄⁄A B
courseReview
⁄⁄B N
)
⁄⁄N O
;
⁄⁄O P
await
€€ 
_unitOfWork
€€ !
.
€€! "
	SaveAsync
€€" +
(
€€+ ,
)
€€, -
;
€€- .
await
›› 
_courseService
›› $
.
››$ %
UpsertCourseTotal
››% 6
(
ﬁﬁ 
new
ﬂﬂ "
UpsertCourseTotalDTO
ﬂﬂ ,
(
ﬂﬂ, -
)
ﬂﬂ- .
{
‡‡ 
CourseId
··  
=
··! "
course
··# )
.
··) *
Id
··* ,
,
··, -
UpdateTotalRate
‚‚ '
=
‚‚( )
true
‚‚* .
}
„„ 
)
‰‰ 
;
‰‰ 
return
ÊÊ 
new
ÊÊ 
ResponseDTO
ÊÊ &
{
ÁÁ 
Message
ËË 
=
ËË 
$str
ËË B
,
ËËB C
	IsSuccess
ÈÈ 
=
ÈÈ 
true
ÈÈ  $
,
ÈÈ$ %

StatusCode
ÍÍ 
=
ÍÍ  
$num
ÍÍ! $
,
ÍÍ$ %
Result
ÎÎ 
=
ÎÎ 
courseReview
ÎÎ )
.
ÎÎ) *
Id
ÎÎ* ,
}
ÏÏ 
;
ÏÏ 
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
ex
ÓÓ 
)
ÓÓ  
{
ÔÔ 
return
 
new
 
ResponseDTO
 &
{
ÒÒ 
Message
ÚÚ 
=
ÚÚ 
ex
ÚÚ  
.
ÚÚ  !
Message
ÚÚ! (
,
ÚÚ( )
	IsSuccess
ÛÛ 
=
ÛÛ 
false
ÛÛ  %
,
ÛÛ% &

StatusCode
ÙÙ 
=
ÙÙ  
$num
ÙÙ! $
,
ÙÙ$ %
Result
ıı 
=
ıı 
null
ıı !
}
ˆˆ 
;
ˆˆ 
}
˜˜ 
}
¯¯ 	
public
˙˙ 
async
˙˙ 
Task
˙˙ 
<
˙˙ 
ResponseDTO
˙˙ %
>
˙˙% & 
UpdateCourseReview
˙˙' 9
(
˙˙9 :
ClaimsPrincipal
˙˙: I
User
˙˙J N
,
˙˙N O#
UpdateCourseReviewDTO
˚˚ !#
updateCourseReviewDTO
˚˚" 7
)
˚˚7 8
{
¸¸ 	
try
˝˝ 
{
˛˛ 
var
ˇˇ 
userId
ˇˇ 
=
ˇˇ 
User
ˇˇ !
.
ˇˇ! "
Claims
ˇˇ" (
.
ˇˇ( )
FirstOrDefault
ˇˇ) 7
(
ˇˇ7 8
x
ˇˇ8 9
=>
ˇˇ: <
x
ˇˇ= >
.
ˇˇ> ?
Type
ˇˇ? C
==
ˇˇD F

ClaimTypes
ˇˇG Q
.
ˇˇQ R
NameIdentifier
ˇˇR `
)
ˇˇ` a
?
ˇˇa b
.
ˇˇb c
Value
ˇˇc h
;
ˇˇh i
if
ÅÅ 
(
ÅÅ 
userId
ÅÅ 
is
ÅÅ 
null
ÅÅ "
)
ÅÅ" #
{
ÇÇ 
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ *
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ  !
$str
ÖÖ" 2
,
ÖÖ2 3
Result
ÜÜ 
=
ÜÜ  
null
ÜÜ! %
,
ÜÜ% &
	IsSuccess
áá !
=
áá" #
false
áá$ )
,
áá) *

StatusCode
àà "
=
àà# $
$num
àà% (
}
ââ 
;
ââ 
}
ää 
var
åå 
courseReview
åå  
=
åå! "
await
åå# (
_unitOfWork
åå) 4
.
åå4 5$
CourseReviewRepository
åå5 K
.
ååK L
GetById
ååL S
(
ååS T#
updateCourseReviewDTO
ååT i
.
ååi j
Id
ååj l
)
åål m
;
ååm n
if
çç 
(
çç 
courseReview
çç  
==
çç! #
null
çç$ (
)
çç( )
{
éé 
return
èè 
new
èè 
ResponseDTO
èè *
{
êê 
Message
ëë 
=
ëë  !
$str
ëë" ;
,
ëë; <
	IsSuccess
íí !
=
íí" #
false
íí$ )
,
íí) *

StatusCode
ìì "
=
ìì# $
$num
ìì% (
,
ìì( )
Result
îî 
=
îî  
null
îî! %
}
ïï 
;
ïï 
}
ññ 
courseReview
òò 
.
òò 
Rate
òò !
=
òò" ##
updateCourseReviewDTO
òò$ 9
.
òò9 :
Rate
òò: >
;
òò> ?
courseReview
ôô 
.
ôô 
Message
ôô $
=
ôô% &#
updateCourseReviewDTO
ôô' <
.
ôô< =
Message
ôô= D
;
ôôD E
courseReview
öö 
.
öö 
	UpdatedBy
öö &
=
öö' (
userId
öö) /
;
öö/ 0
courseReview
õõ 
.
õõ 
UpdatedTime
õõ (
=
õõ) *
DateTime
õõ+ 3
.
õõ3 4
UtcNow
õõ4 :
;
õõ: ;
_unitOfWork
ùù 
.
ùù $
CourseReviewRepository
ùù 2
.
ùù2 3
Update
ùù3 9
(
ùù9 :
courseReview
ùù: F
)
ùùF G
;
ùùG H
await
ûû 
_unitOfWork
ûû !
.
ûû! "
	SaveAsync
ûû" +
(
ûû+ ,
)
ûû, -
;
ûû- .
return
†† 
new
†† 
ResponseDTO
†† &
{
°° 
Message
¢¢ 
=
¢¢ 
$str
¢¢ B
,
¢¢B C
	IsSuccess
££ 
=
££ 
true
££  $
,
££$ %

StatusCode
§§ 
=
§§  
$num
§§! $
,
§§$ %
Result
•• 
=
•• 
courseReview
•• )
.
••) *
Id
••* ,
}
¶¶ 
;
¶¶ 
}
ßß 
catch
®® 
(
®® 
	Exception
®® 
ex
®® 
)
®®  
{
©© 
return
™™ 
new
™™ 
ResponseDTO
™™ &
{
´´ 
Message
¨¨ 
=
¨¨ 
ex
¨¨  
.
¨¨  !
Message
¨¨! (
,
¨¨( )
	IsSuccess
≠≠ 
=
≠≠ 
false
≠≠  %
,
≠≠% &

StatusCode
ÆÆ 
=
ÆÆ  
$num
ÆÆ! $
,
ÆÆ$ %
Result
ØØ 
=
ØØ 
null
ØØ !
}
∞∞ 
;
∞∞ 
}
±± 
}
≤≤ 	
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 
ResponseDTO
¥¥ %
>
¥¥% & 
DeleteCourseReview
¥¥' 9
(
¥¥9 :
Guid
¥¥: >
id
¥¥? A
)
¥¥A B
{
µµ 	
try
∂∂ 
{
∑∑ 
var
∏∏ 
courseReview
∏∏  
=
∏∏! "
await
∏∏# (
_unitOfWork
∏∏) 4
.
∏∏4 5$
CourseReviewRepository
∏∏5 K
.
∏∏K L
GetById
∏∏L S
(
∏∏S T
id
∏∏T V
)
∏∏V W
;
∏∏W X
if
ππ 
(
ππ 
courseReview
ππ  
==
ππ! #
null
ππ$ (
)
ππ( )
{
∫∫ 
return
ªª 
new
ªª 
ResponseDTO
ªª *
{
ºº 
Message
ΩΩ 
=
ΩΩ  !
$str
ΩΩ" ;
,
ΩΩ; <
	IsSuccess
ææ !
=
ææ" #
false
ææ$ )
,
ææ) *

StatusCode
øø "
=
øø# $
$num
øø% (
,
øø( )
Result
¿¿ 
=
¿¿  
null
¿¿! %
}
¡¡ 
;
¡¡ 
}
¬¬ 
_unitOfWork
ƒƒ 
.
ƒƒ $
CourseReviewRepository
ƒƒ 2
.
ƒƒ2 3
Remove
ƒƒ3 9
(
ƒƒ9 :
courseReview
ƒƒ: F
)
ƒƒF G
;
ƒƒG H
await
≈≈ 
_unitOfWork
≈≈ !
.
≈≈! "
	SaveAsync
≈≈" +
(
≈≈+ ,
)
≈≈, -
;
≈≈- .
await
«« 
_courseService
«« $
.
««$ %
UpsertCourseTotal
««% 6
(
»» 
new
…… "
UpsertCourseTotalDTO
…… ,
(
……, -
)
……- .
{
   
CourseId
ÀÀ  
=
ÀÀ! "
courseReview
ÀÀ# /
.
ÀÀ/ 0
CourseId
ÀÀ0 8
,
ÀÀ8 9
UpdateTotalRate
ÃÃ '
=
ÃÃ( )
true
ÃÃ* .
}
ÕÕ 
)
ŒŒ 
;
ŒŒ 
return
–– 
new
–– 
ResponseDTO
–– &
{
—— 
Message
““ 
=
““ 
$str
““ B
,
““B C
	IsSuccess
”” 
=
”” 
true
””  $
,
””$ %

StatusCode
‘‘ 
=
‘‘  
$num
‘‘! $
,
‘‘$ %
Result
’’ 
=
’’ 
null
’’ !
}
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
ex
ÿÿ 
)
ÿÿ  
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
{
€€ 
Message
‹‹ 
=
‹‹ 
ex
‹‹  
.
‹‹  !
Message
‹‹! (
,
‹‹( )
	IsSuccess
›› 
=
›› 
false
››  %
,
››% &

StatusCode
ﬁﬁ 
=
ﬁﬁ  
$num
ﬁﬁ! $
,
ﬁﬁ$ %
Result
ﬂﬂ 
=
ﬂﬂ 
null
ﬂﬂ !
}
‡‡ 
;
‡‡ 
}
·· 
}
‚‚ 	
public
‰‰ 
async
‰‰ 
Task
‰‰ 
<
‰‰ 
ResponseDTO
‰‰ %
>
‰‰% &
MarkCourseReview
‰‰' 7
(
‰‰7 8
Guid
‰‰8 <
id
‰‰= ?
)
‰‰? @
{
ÂÂ 	
try
ÊÊ 
{
ÁÁ 
var
ËË 
courseReview
ËË  
=
ËË! "
await
ËË# (
_unitOfWork
ËË) 4
.
ËË4 5$
CourseReviewRepository
ËË5 K
.
ËËK L
GetById
ËËL S
(
ËËS T
id
ËËT V
)
ËËV W
;
ËËW X
if
ÈÈ 
(
ÈÈ 
courseReview
ÈÈ  
==
ÈÈ! #
null
ÈÈ$ (
)
ÈÈ( )
{
ÍÍ 
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ *
{
ÏÏ 
Message
ÌÌ 
=
ÌÌ  !
$str
ÌÌ" ;
,
ÌÌ; <
	IsSuccess
ÓÓ !
=
ÓÓ" #
false
ÓÓ$ )
,
ÓÓ) *

StatusCode
ÔÔ "
=
ÔÔ# $
$num
ÔÔ% (
,
ÔÔ( )
Result
 
=
  
null
! %
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 
courseReview
ÙÙ 
.
ÙÙ 
IsMarked
ÙÙ %
=
ÙÙ& '
!
ÙÙ( )
courseReview
ÙÙ) 5
.
ÙÙ5 6
IsMarked
ÙÙ6 >
;
ÙÙ> ?
_unitOfWork
ˆˆ 
.
ˆˆ $
CourseReviewRepository
ˆˆ 2
.
ˆˆ2 3
Update
ˆˆ3 9
(
ˆˆ9 :
courseReview
ˆˆ: F
)
ˆˆF G
;
ˆˆG H
await
˜˜ 
_unitOfWork
˜˜ !
.
˜˜! "
	SaveAsync
˜˜" +
(
˜˜+ ,
)
˜˜, -
;
˜˜- .
string
˘˘ 
message
˘˘ 
=
˘˘  
courseReview
˘˘! -
.
˘˘- .
IsMarked
˘˘. 6
?
˙˙ 
$str
˙˙ 6
:
˚˚ 
$str
˚˚ 8
;
˚˚8 9
return
˝˝ 
new
˝˝ 
ResponseDTO
˝˝ &
{
˛˛ 
Message
ˇˇ 
=
ˇˇ 
message
ˇˇ %
,
ˇˇ% &
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  $
,
ÄÄ$ %

StatusCode
ÅÅ 
=
ÅÅ  
$num
ÅÅ! $
,
ÅÅ$ %
Result
ÇÇ 
=
ÇÇ 
courseReview
ÇÇ )
.
ÇÇ) *
Id
ÇÇ* ,
}
ÉÉ 
;
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
ex
ÖÖ 
)
ÖÖ  
{
ÜÜ 
return
áá 
new
áá 
ResponseDTO
áá &
{
àà 
Message
ââ 
=
ââ 
ex
ââ  
.
ââ  !
Message
ââ! (
,
ââ( )
	IsSuccess
ää 
=
ää 
false
ää  %
,
ää% &

StatusCode
ãã 
=
ãã  
$num
ãã! $
,
ãã$ %
Result
åå 
=
åå 
null
åå !
}
çç 
;
çç 
}
éé 
}
èè 	
}
êê 
}ëë Ëö
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseReportService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
{ 
public 

class 
CourseReportService $
:% & 
ICourseReportService' ;
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
public 
CourseReportService "
(" #
IUnitOfWork# .

unitOfWork/ 9
,9 :
IMapper; B
mapperC I
)I J
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
ResponseDTO %
>% &
GetCourseReports' 7
(7 8
ClaimsPrincipal8 G
UserH L
,L M
GuidN R
?R S
courseIdT \
,\ ]
string^ d
?d e
filterOnf n
,n o
stringp v
?v w
filterQuery	x É
,
É Ñ
string
Ö ã
?
ã å
sortBy
ç ì
,
ì î
bool
ï ô
?
ô ö
isAscending
õ ¶
,
¶ ß
int
® ´

pageNumber
¨ ∂
,
∂ ∑
int
∏ ª
pageSize
º ƒ
)
ƒ ≈
{ 	
try 
{ 
var 
courseReports !
=" #
await$ )
_unitOfWork* 5
.5 6"
CourseReportRepository6 L
.L M
GetAllAsyncM X
(X Y
filter   
:   
x   
=>    
!  ! "
courseId  " *
.  * +
HasValue  + 3
||  4 6
x  7 8
.  8 9
CourseId  9 A
==  B D
courseId  E M
,  M N
includeProperties!! %
:!!% &
$str!!' /
)"" 
;"" 
if%% 
(%% 
!%% 
string%% 
.%% 
IsNullOrEmpty%% )
(%%) *
filterOn%%* 2
)%%2 3
&&%%4 6
!%%7 8
string%%8 >
.%%> ?
IsNullOrEmpty%%? L
(%%L M
filterQuery%%M X
)%%X Y
)%%Y Z
{&& 
courseReports'' !
=''" #
courseReports''$ 1
.''1 2
Where''2 7
(''7 8
cr''8 :
=>''; =
((( 
filterOn(( !
.((! "
ToLower((" )
((() *
)((* +
==((, .
$str((/ 8
&&((9 ;
cr((< >
.((> ?
Message((? F
.((F G
Contains((G O
(((O P
filterQuery((P [
,(([ \
StringComparison((] m
.((m n
OrdinalIgnoreCase((n 
)	(( Ä
)
((Ä Å
))) 
.)) 
ToList)) 
()) 
))) 
;)) 
}** 
if-- 
(-- 
!-- 
string-- 
.-- 
IsNullOrEmpty-- )
(--) *
sortBy--* 0
)--0 1
)--1 2
{.. 
courseReports// !
=//" #
isAscending//$ /
==//0 2
true//3 7
?00 
courseReports00 '
.00' (
OrderBy00( /
(00/ 0
cr000 2
=>003 5
EF006 8
.008 9
Property009 A
<00A B
object00B H
>00H I
(00I J
cr00J L
,00L M
sortBy00N T
)00T U
)00U V
.00V W
ToList00W ]
(00] ^
)00^ _
:11 
courseReports11 '
.11' (
OrderByDescending11( 9
(119 :
cr11: <
=>11= ?
EF11@ B
.11B C
Property11C K
<11K L
object11L R
>11R S
(11S T
cr11T V
,11V W
sortBy11X ^
)11^ _
)11_ `
.11` a
ToList11a g
(11g h
)11h i
;11i j
}22 
courseReports55 
=55 
courseReports55  -
.55- .
Skip55. 2
(552 3
(553 4

pageNumber554 >
-55? @
$num55A B
)55B C
*55D E
pageSize55F N
)55N O
.55O P
Take55P T
(55T U
pageSize55U ]
)55] ^
.55^ _
ToList55_ e
(55e f
)55f g
;55g h
var77 
courseReportDTOs77 $
=77% &
_mapper77' .
.77. /
Map77/ 2
<772 3
List773 7
<777 8
CourseReportDTO778 G
>77G H
>77H I
(77I J
courseReports77J W
)77W X
;77X Y
return99 
new99 
ResponseDTO99 &
{:: 
Message;; 
=;; 
$str;; E
,;;E F
	IsSuccess<< 
=<< 
true<<  $
,<<$ %

StatusCode== 
===  
$num==! $
,==$ %
Result>> 
=>> 
courseReportDTOs>> -
}?? 
;?? 
}@@ 
catchAA 
(AA 
	ExceptionAA 
exAA 
)AA  
{BB 
returnCC 
newCC 
ResponseDTOCC &
{DD 
MessageEE 
=EE 
exEE  
.EE  !
MessageEE! (
,EE( )
	IsSuccessFF 
=FF 
falseFF  %
,FF% &

StatusCodeGG 
=GG  
$numGG! $
,GG$ %
ResultHH 
=HH 
nullHH !
}II 
;II 
}JJ 
}KK 	
publicMM 
asyncMM 
TaskMM 
<MM 
ResponseDTOMM %
>MM% &
GetCourseReportByIdMM' :
(MM: ;
GuidMM; ?
idMM@ B
)MMB C
{NN 	
tryOO 
{PP 
varQQ 
courseReportQQ  
=QQ! "
awaitQQ# (
_unitOfWorkQQ) 4
.QQ4 5"
CourseReportRepositoryQQ5 K
.QQK L
GetByIdQQL S
(QQS T
idQQT V
)QQV W
;QQW X
ifRR 
(RR 
courseReportRR  
==RR! #
nullRR$ (
)RR( )
{SS 
returnTT 
newTT 
ResponseDTOTT *
{UU 
MessageVV 
=VV  !
$strVV" ;
,VV; <
	IsSuccessWW !
=WW" #
falseWW$ )
,WW) *

StatusCodeXX "
=XX# $
$numXX% (
,XX( )
ResultYY 
=YY  
nullYY! %
}ZZ 
;ZZ 
}[[ 
var]] 
courseReportDTO]] #
=]]$ %
_mapper]]& -
.]]- .
Map]]. 1
<]]1 2
CourseReportDTO]]2 A
>]]A B
(]]B C
courseReport]]C O
)]]O P
;]]P Q
return__ 
new__ 
ResponseDTO__ &
{`` 
Messageaa 
=aa 
$straa D
,aaD E
	IsSuccessbb 
=bb 
truebb  $
,bb$ %

StatusCodecc 
=cc  
$numcc! $
,cc$ %
Resultdd 
=dd 
courseReportDTOdd ,
}ee 
;ee 
}ff 
catchgg 
(gg 
	Exceptiongg 
exgg 
)gg  
{hh 
returnii 
newii 
ResponseDTOii &
{jj 
Messagekk 
=kk 
exkk  
.kk  !
Messagekk! (
,kk( )
	IsSuccessll 
=ll 
falsell  %
,ll% &

StatusCodemm 
=mm  
$nummm! $
,mm$ %
Resultnn 
=nn 
nullnn !
}oo 
;oo 
}pp 
}qq 	
publicss 
asyncss 
Taskss 
<ss 
ResponseDTOss %
>ss% &
CreateCourseReportss' 9
(ss9 :!
CreateCourseReportDTOss: O!
createCourseReportDTOssP e
)sse f
{tt 	
tryuu 
{vv 
varww 
courseww 
=ww 
awaitww "
_unitOfWorkww# .
.ww. /
CourseRepositoryww/ ?
.ww? @
GetByIdww@ G
(wwG H!
createCourseReportDTOwwH ]
.ww] ^
CourseIdww^ f
)wwf g
;wwg h
ifxx 
(xx 
coursexx 
==xx 
nullxx "
)xx" #
{yy 
returnzz 
newzz 
ResponseDTOzz *
{{{ 
Message|| 
=||  !
$str||" 4
,||4 5
	IsSuccess}} !
=}}" #
false}}$ )
,}}) *

StatusCode~~ "
=~~# $
$num~~% (
,~~( )
Result 
=  
null! %
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ 
student
ÉÉ 
=
ÉÉ 
await
ÉÉ #
_unitOfWork
ÉÉ$ /
.
ÉÉ/ 0
StudentRepository
ÉÉ0 A
.
ÉÉA B
GetById
ÉÉB I
(
ÉÉI J#
createCourseReportDTO
ÉÉJ _
.
ÉÉ_ `
	StudentId
ÉÉ` i
)
ÉÉi j
;
ÉÉj k
if
ÑÑ 
(
ÑÑ 
student
ÑÑ 
==
ÑÑ 
null
ÑÑ #
)
ÑÑ# $
{
ÖÖ 
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ *
{
áá 
Message
àà 
=
àà  !
$str
àà" 5
,
àà5 6
	IsSuccess
ââ !
=
ââ" #
false
ââ$ )
,
ââ) *

StatusCode
ää "
=
ää# $
$num
ää% (
,
ää( )
Result
ãã 
=
ãã  
null
ãã! %
}
åå 
;
åå 
}
çç 
var
èè 
courseReport
èè  
=
èè! "
new
èè# &
CourseReport
èè' 3
{
êê 
Id
ëë 
=
ëë 
Guid
ëë 
.
ëë 
NewGuid
ëë %
(
ëë% &
)
ëë& '
,
ëë' (
CourseId
íí 
=
íí #
createCourseReportDTO
íí 4
.
íí4 5
CourseId
íí5 =
,
íí= >
	StudentId
ìì 
=
ìì #
createCourseReportDTO
ìì  5
.
ìì5 6
	StudentId
ìì6 ?
,
ìì? @
Message
îî 
=
îî #
createCourseReportDTO
îî 3
.
îî3 4
Message
îî4 ;
,
îî; <
	CreatedBy
ïï 
=
ïï #
createCourseReportDTO
ïï  5
.
ïï5 6
	StudentId
ïï6 ?
.
ïï? @
ToString
ïï@ H
(
ïïH I
)
ïïI J
,
ïïJ K
CreatedTime
ññ 
=
ññ  !
DateTime
ññ" *
.
ññ* +
UtcNow
ññ+ 1
,
ññ1 2
Status
óó 
=
óó 
$num
óó 
}
òò 
;
òò 
await
öö 
_unitOfWork
öö !
.
öö! "$
CourseReportRepository
öö" 8
.
öö8 9
AddAsync
öö9 A
(
ööA B
courseReport
ööB N
)
ööN O
;
ööO P
await
õõ 
_unitOfWork
õõ !
.
õõ! "
	SaveAsync
õõ" +
(
õõ+ ,
)
õõ, -
;
õõ- .
return
ùù 
new
ùù 
ResponseDTO
ùù &
{
ûû 
Message
üü 
=
üü 
$str
üü B
,
üüB C
	IsSuccess
†† 
=
†† 
true
††  $
,
††$ %

StatusCode
°° 
=
°°  
$num
°°! $
,
°°$ %
Result
¢¢ 
=
¢¢ 
courseReport
¢¢ )
.
¢¢) *
Id
¢¢* ,
}
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
ex
•• 
)
••  
{
¶¶ 
return
ßß 
new
ßß 
ResponseDTO
ßß &
{
®® 
Message
©© 
=
©© 
ex
©©  
.
©©  !
Message
©©! (
,
©©( )
	IsSuccess
™™ 
=
™™ 
false
™™  %
,
™™% &

StatusCode
´´ 
=
´´  
$num
´´! $
,
´´$ %
Result
¨¨ 
=
¨¨ 
null
¨¨ !
}
≠≠ 
;
≠≠ 
}
ÆÆ 
}
ØØ 	
public
±± 
async
±± 
Task
±± 
<
±± 
ResponseDTO
±± %
>
±±% & 
UpdateCourseReport
±±' 9
(
±±9 :
ClaimsPrincipal
±±: I
User
±±J N
,
±±N O#
UpdateCourseReportDTO
±±O d#
updateCourseReportDTO
±±e z
)
±±z {
{
≤≤ 	
try
≥≥ 
{
¥¥ 
var
µµ 
userId
µµ 
=
µµ 
User
µµ !
.
µµ! "
Claims
µµ" (
.
µµ( )
FirstOrDefault
µµ) 7
(
µµ7 8
x
µµ8 9
=>
µµ: <
x
µµ= >
.
µµ> ?
Type
µµ? C
==
µµD F

ClaimTypes
µµG Q
.
µµQ R
NameIdentifier
µµR `
)
µµ` a
?
µµa b
.
µµb c
Value
µµc h
;
µµh i
if
∑∑ 
(
∑∑ 
userId
∑∑ 
is
∑∑ 
null
∑∑ "
)
∑∑" #
{
∏∏ 
return
ππ 
new
ππ 
ResponseDTO
ππ *
{
∫∫ 
Message
ªª 
=
ªª  !
$str
ªª" 2
,
ªª2 3
Result
ºº 
=
ºº  
null
ºº! %
,
ºº% &
	IsSuccess
ΩΩ !
=
ΩΩ" #
false
ΩΩ$ )
,
ΩΩ) *

StatusCode
ææ "
=
ææ# $
$num
ææ% (
}
øø 
;
øø 
}
¿¿ 
var
¬¬ 
courseReport
¬¬  
=
¬¬! "
await
¬¬# (
_unitOfWork
¬¬) 4
.
¬¬4 5$
CourseReportRepository
¬¬5 K
.
¬¬K L
GetById
¬¬L S
(
¬¬S T#
updateCourseReportDTO
¬¬T i
.
¬¬i j
Id
¬¬j l
)
¬¬l m
;
¬¬m n
if
√√ 
(
√√ 
courseReport
√√  
==
√√! #
null
√√$ (
)
√√( )
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ *
{
∆∆ 
Message
«« 
=
««  !
$str
««" ;
,
««; <
	IsSuccess
»» !
=
»»" #
false
»»$ )
,
»») *

StatusCode
…… "
=
……# $
$num
……% (
,
……( )
Result
   
=
    
null
  ! %
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
courseReport
ŒŒ 
.
ŒŒ 
Message
ŒŒ $
=
ŒŒ% &#
updateCourseReportDTO
ŒŒ' <
.
ŒŒ< =
Message
ŒŒ= D
;
ŒŒD E
courseReport
œœ 
.
œœ 
	UpdatedBy
œœ &
=
œœ' (
userId
œœ) /
;
œœ/ 0
courseReport
–– 
.
–– 
UpdatedTime
–– (
=
––) *
DateTime
––+ 3
.
––3 4
UtcNow
––4 :
;
––: ;
_unitOfWork
““ 
.
““ $
CourseReportRepository
““ 2
.
““2 3
Update
““3 9
(
““9 :
courseReport
““: F
)
““F G
;
““G H
await
”” 
_unitOfWork
”” !
.
””! "
	SaveAsync
””" +
(
””+ ,
)
””, -
;
””- .
return
’’ 
new
’’ 
ResponseDTO
’’ &
{
÷÷ 
Message
◊◊ 
=
◊◊ 
$str
◊◊ B
,
◊◊B C
	IsSuccess
ÿÿ 
=
ÿÿ 
true
ÿÿ  $
,
ÿÿ$ %

StatusCode
ŸŸ 
=
ŸŸ  
$num
ŸŸ! $
,
ŸŸ$ %
Result
⁄⁄ 
=
⁄⁄ 
courseReport
⁄⁄ )
.
⁄⁄) *
Id
⁄⁄* ,
}
€€ 
;
€€ 
}
‹‹ 
catch
›› 
(
›› 
	Exception
›› 
ex
›› 
)
››  
{
ﬁﬁ 
return
ﬂﬂ 
new
ﬂﬂ 
ResponseDTO
ﬂﬂ &
{
‡‡ 
Message
·· 
=
·· 
ex
··  
.
··  !
Message
··! (
,
··( )
	IsSuccess
‚‚ 
=
‚‚ 
false
‚‚  %
,
‚‚% &

StatusCode
„„ 
=
„„  
$num
„„! $
,
„„$ %
Result
‰‰ 
=
‰‰ 
null
‰‰ !
}
ÂÂ 
;
ÂÂ 
}
ÊÊ 
}
ÁÁ 	
public
ÈÈ 
async
ÈÈ 
Task
ÈÈ 
<
ÈÈ 
ResponseDTO
ÈÈ %
>
ÈÈ% & 
DeleteCourseReport
ÈÈ' 9
(
ÈÈ9 :
Guid
ÈÈ: >
id
ÈÈ? A
)
ÈÈA B
{
ÍÍ 	
try
ÎÎ 
{
ÏÏ 
var
ÌÌ 
courseReport
ÌÌ  
=
ÌÌ! "
await
ÌÌ# (
_unitOfWork
ÌÌ) 4
.
ÌÌ4 5$
CourseReportRepository
ÌÌ5 K
.
ÌÌK L
GetById
ÌÌL S
(
ÌÌS T
id
ÌÌT V
)
ÌÌV W
;
ÌÌW X
if
ÓÓ 
(
ÓÓ 
courseReport
ÓÓ  
==
ÓÓ! #
null
ÓÓ$ (
)
ÓÓ( )
{
ÔÔ 
return
 
new
 
ResponseDTO
 *
{
ÒÒ 
Message
ÚÚ 
=
ÚÚ  !
$str
ÚÚ" ;
,
ÚÚ; <
	IsSuccess
ÛÛ !
=
ÛÛ" #
false
ÛÛ$ )
,
ÛÛ) *

StatusCode
ÙÙ "
=
ÙÙ# $
$num
ÙÙ% (
,
ÙÙ( )
Result
ıı 
=
ıı  
null
ıı! %
}
ˆˆ 
;
ˆˆ 
}
˜˜ 
courseReport
˘˘ 
.
˘˘ 
Status
˘˘ #
=
˘˘$ %
$num
˘˘& '
;
˘˘' (
courseReport
˙˙ 
.
˙˙ 
UpdatedTime
˙˙ (
=
˙˙) *
DateTime
˙˙+ 3
.
˙˙3 4
UtcNow
˙˙4 :
;
˙˙: ;
_unitOfWork
¸¸ 
.
¸¸ $
CourseReportRepository
¸¸ 2
.
¸¸2 3
Update
¸¸3 9
(
¸¸9 :
courseReport
¸¸: F
)
¸¸F G
;
¸¸G H
await
˝˝ 
_unitOfWork
˝˝ !
.
˝˝! "
	SaveAsync
˝˝" +
(
˝˝+ ,
)
˝˝, -
;
˝˝- .
return
ˇˇ 
new
ˇˇ 
ResponseDTO
ˇˇ &
{
ÄÄ 
Message
ÅÅ 
=
ÅÅ 
$str
ÅÅ B
,
ÅÅB C
	IsSuccess
ÇÇ 
=
ÇÇ 
true
ÇÇ  $
,
ÇÇ$ %

StatusCode
ÉÉ 
=
ÉÉ  
$num
ÉÉ! $
,
ÉÉ$ %
Result
ÑÑ 
=
ÑÑ 
null
ÑÑ !
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
ex
áá 
)
áá  
{
àà 
return
ââ 
new
ââ 
ResponseDTO
ââ &
{
ää 
Message
ãã 
=
ãã 
ex
ãã  
.
ãã  !
Message
ãã! (
,
ãã( )
	IsSuccess
åå 
=
åå 
false
åå  %
,
åå% &

StatusCode
çç 
=
çç  
$num
çç! $
,
çç$ %
Result
éé 
=
éé 
null
éé !
}
èè 
;
èè 
}
êê 
}
ëë 	
}
íí 
}îî ªû
iD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\ClosedXMLService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public		 
class		 
ClosedXMLService		 
:		 
IClosedXMLService		  1
{

 
private 
readonly 
IWebHostEnvironment (
_env) -
;- .
private 
readonly 
IConfiguration #
_config$ +
;+ ,
public 

ClosedXMLService 
( 
IWebHostEnvironment /
env0 3
,3 4
IConfiguration5 C
configD J
)J K
{ 
_env 
= 
env 
; 
_config 
= 
config 
; 
} 
public 

async 
Task 
< 
string 
> !
ExportInstructorExcel 3
(3 4
List4 8
<8 9
InstructorInfoDTO9 J
>J K
instructorInfoDtosL ^
)^ _
{ 
string 
exportFolderPath 
=  !
Path" &
.& '
Combine' .
(. /
_env/ 3
.3 4
ContentRootPath4 C
,C D
_configE L
[L M
$strM o
]o p
)p q
;q r
if 

( 
! 
	Directory 
. 
Exists 
( 
exportFolderPath .
). /
)/ 0
{ 	
	Directory 
. 
CreateDirectory %
(% &
exportFolderPath& 6
)6 7
;7 8
} 	
string   
fileName   
=   
$"   
$str   (
{  ( )
DateTime  ) 1
.  1 2
Now  2 5
:  5 6
$str  6 E
}  E F
$str  F K
"  K L
;  L M
string!! 
filePath!! 
=!! 
Path!! 
.!! 
Combine!! &
(!!& '
exportFolderPath!!' 7
,!!7 8
fileName!!9 A
)!!A B
;!!B C
using## 
(## 
var## 
workBook## 
=## 
new## !

XLWorkbook##" ,
(##, -
)##- .
)##. /
{$$ 	
var%% 
	workSheet%% 
=%% 
workBook%% $
.%%$ %

Worksheets%%% /
.%%/ 0
Add%%0 3
(%%3 4
$str%%4 A
)%%A B
;%%B C
	workSheet(( 
.(( 
Cell(( 
((( 
$num(( 
,(( 
$num(( 
)((  
.((  !
Value((! &
=((' (
$str(() 8
;((8 9
	workSheet)) 
.)) 
Cell)) 
()) 
$num)) 
,)) 
$num)) 
)))  
.))  !
Value))! &
=))' (
$str))) 1
;))1 2
	workSheet** 
.** 
Cell** 
(** 
$num** 
,** 
$num** 
)**  
.**  !
Value**! &
=**' (
$str**) 3
;**3 4
	workSheet++ 
.++ 
Cell++ 
(++ 
$num++ 
,++ 
$num++ 
)++  
.++  !
Value++! &
=++' (
$str++) 0
;++0 1
	workSheet,, 
.,, 
Cell,, 
(,, 
$num,, 
,,, 
$num,, 
),,  
.,,  !
Value,,! &
=,,' (
$str,,) 6
;,,6 7
	workSheet-- 
.-- 
Cell-- 
(-- 
$num-- 
,-- 
$num-- 
)--  
.--  !
Value--! &
=--' (
$str--) 1
;--1 2
	workSheet.. 
... 
Cell.. 
(.. 
$num.. 
,.. 
$num.. 
)..  
...  !
Value..! &
=..' (
$str..) 4
;..4 5
	workSheet// 
.// 
Cell// 
(// 
$num// 
,// 
$num// 
)//  
.//  !
Value//! &
=//' (
$str//) 2
;//2 3
	workSheet00 
.00 
Cell00 
(00 
$num00 
,00 
$num00 
)00  
.00  !
Value00! &
=00' (
$str00) 2
;002 3
	workSheet11 
.11 
Cell11 
(11 
$num11 
,11 
$num11  
)11  !
.11! "
Value11" '
=11( )
$str11* 2
;112 3
	workSheet22 
.22 
Cell22 
(22 
$num22 
,22 
$num22  
)22  !
.22! "
Value22" '
=22( )
$str22* 4
;224 5
	workSheet33 
.33 
Cell33 
(33 
$num33 
,33 
$num33  
)33  !
.33! "
Value33" '
=33( )
$str33* 8
;338 9
	workSheet44 
.44 
Cell44 
(44 
$num44 
,44 
$num44  
)44  !
.44! "
Value44" '
=44( )
$str44* 5
;445 6
	workSheet55 
.55 
Cell55 
(55 
$num55 
,55 
$num55  
)55  !
.55! "
Value55" '
=55( )
$str55* 6
;556 7
forAA 
(AA 
intAA 
iAA 
=AA 
$numAA 
;AA 
iAA 
<AA 
instructorInfoDtosAA  2
.AA2 3
CountAA3 8
;AA8 9
iAA: ;
++AA; =
)AA= >
{BB 
	workSheetCC 
.CC 
CellCC 
(CC 
iCC  
+CC! "
$numCC# $
,CC$ %
$numCC& '
)CC' (
.CC( )
ValueCC) .
=CC/ 0
instructorInfoDtosCC1 C
[CCC D
iCCD E
]CCE F
.CCF G
InstructorIdCCG S
.CCS T
ToStringCCT \
(CC\ ]
)CC] ^
;CC^ _
	workSheetDD 
.DD 
CellDD 
(DD 
iDD  
+DD! "
$numDD# $
,DD$ %
$numDD& '
)DD' (
.DD( )
ValueDD) .
=DD/ 0
instructorInfoDtosDD1 C
[DDC D
iDDD E
]DDE F
.DDF G
UserIdDDG M
;DDM N
	workSheetEE 
.EE 
CellEE 
(EE 
iEE  
+EE! "
$numEE# $
,EE$ %
$numEE& '
)EE' (
.EE( )
ValueEE) .
=EE/ 0
instructorInfoDtosEE1 C
[EEC D
iEED E
]EEE F
.EEF G
FullNameEEG O
;EEO P
	workSheetFF 
.FF 
CellFF 
(FF 
iFF  
+FF! "
$numFF# $
,FF$ %
$numFF& '
)FF' (
.FF( )
ValueFF) .
=FF/ 0
instructorInfoDtosFF1 C
[FFC D
iFFD E
]FFE F
.FFF G
EmailFFG L
;FFL M
	workSheetGG 
.GG 
CellGG 
(GG 
iGG  
+GG! "
$numGG# $
,GG$ %
$numGG& '
)GG' (
.GG( )
ValueGG) .
=GG/ 0
instructorInfoDtosGG1 C
[GGC D
iGGD E
]GGE F
.GGF G
PhoneNumberGGG R
;GGR S
	workSheetHH 
.HH 
CellHH 
(HH 
iHH  
+HH! "
$numHH# $
,HH$ %
$numHH& '
)HH' (
.HH( )
ValueHH) .
=HH/ 0
instructorInfoDtosHH1 C
[HHC D
iHHD E
]HHE F
.HHF G
GenderHHG M
;HHM N
	workSheetII 
.II 
CellII 
(II 
iII  
+II! "
$numII# $
,II$ %
$numII& '
)II' (
.II( )
ValueII) .
=II/ 0
instructorInfoDtosII1 C
[IIC D
iIID E
]IIE F
.IIF G
	BirthDateIIG P
;IIP Q
	workSheetJJ 
.JJ 
CellJJ 
(JJ 
iJJ  
+JJ! "
$numJJ# $
,JJ$ %
$numJJ& '
)JJ' (
.JJ( )
ValueJJ) .
=JJ/ 0
instructorInfoDtosJJ1 C
[JJC D
iJJD E
]JJE F
.JJF G
CountryJJG N
;JJN O
	workSheetKK 
.KK 
CellKK 
(KK 
iKK  
+KK! "
$numKK# $
,KK$ %
$numKK& '
)KK' (
.KK( )
ValueKK) .
=KK/ 0
instructorInfoDtosKK1 C
[KKC D
iKKD E
]KKE F
.KKF G
AddressKKG N
;KKN O
	workSheetLL 
.LL 
CellLL 
(LL 
iLL  
+LL! "
$numLL# $
,LL$ %
$numLL& (
)LL( )
.LL) *
ValueLL* /
=LL0 1
instructorInfoDtosLL2 D
[LLD E
iLLE F
]LLF G
.LLG H
DegreeLLH N
;LLN O
	workSheetMM 
.MM 
CellMM 
(MM 
iMM  
+MM! "
$numMM# $
,MM$ %
$numMM& (
)MM( )
.MM) *
ValueMM* /
=MM0 1
instructorInfoDtosMM2 D
[MMD E
iMME F
]MMF G
.MMG H
IndustryMMH P
;MMP Q
	workSheetNN 
.NN 
CellNN 
(NN 
iNN  
+NN! "
$numNN# $
,NN$ %
$numNN& (
)NN( )
.NN) *
ValueNN* /
=NN0 1
instructorInfoDtosNN2 D
[NND E
iNNE F
]NNF G
.NNG H
IntroductionNNH T
;NNT U
	workSheetOO 
.OO 
CellOO 
(OO 
iOO  
+OO! "
$numOO# $
,OO$ %
$numOO& (
)OO( )
.OO) *
ValueOO* /
=OO0 1
instructorInfoDtosOO2 D
[OOD E
iOOE F
]OOF G
.OOG H
	TaxNumberOOH Q
;OOQ R
	workSheetPP 
.PP 
CellPP 
(PP 
iPP  
+PP! "
$numPP# $
,PP$ %
$numPP& (
)PP( )
.PP) *
ValuePP* /
=PP0 1
instructorInfoDtosPP2 D
[PPD E
iPPE F
]PPF G
.PPG H

IsAcceptedPPH R
.PPR S
ToStringPPS [
(PP[ \
)PP\ ]
;PP] ^
}QQ 
	workSheetSS 
.SS 
ColumnsSS 
(SS 
)SS 
.SS  
AdjustToContentsSS  0
(SS0 1
)SS1 2
;SS2 3
workBook__ 
.__ 
SaveAs__ 
(__ 
filePath__ $
)__$ %
;__% &
returnpp 
fileNamepp 
;pp 
}qq 	
}rr 
publictt 

asynctt 
Tasktt 
<tt 
stringtt 
>tt 
ExportStudentExceltt 0
(tt0 1
Listtt1 5
<tt5 6
StudentFullInfoDTOtt6 H
>ttH I
studentInfoDtosttJ Y
)ttY Z
{uu 
stringww 

exportFolderPathww 
=ww 
Pathww "
.ww" #
Combineww# *
(ww* +
_envww+ /
.ww/ 0
ContentRootPathww0 ?
,ww? @
_configwwA H
[wwH I
$strwwI m
]wwm n
)wwn o
;wwo p
ifzz 
(zz 
!zz 	
	Directoryzz	 
.zz 
Existszz 
(zz 
exportFolderPathzz *
)zz* +
)zz+ ,
{{{ 
	Directory|| 
.|| 
CreateDirectory|| !
(||! "
exportFolderPath||" 2
)||2 3
;||3 4
}}} 
string
ÄÄ 

fileNameStudent
ÄÄ 
=
ÄÄ 
$"
ÄÄ 
$str
ÄÄ (
{
ÄÄ( )
DateTime
ÄÄ) 1
.
ÄÄ1 2
Now
ÄÄ2 5
:
ÄÄ5 6
$str
ÄÄ6 E
}
ÄÄE F
$str
ÄÄF K
"
ÄÄK L
;
ÄÄL M
string
ÅÅ 

filePath
ÅÅ 
=
ÅÅ 
Path
ÅÅ 
.
ÅÅ 
Combine
ÅÅ "
(
ÅÅ" #
exportFolderPath
ÅÅ# 3
,
ÅÅ3 4
fileNameStudent
ÅÅ5 D
)
ÅÅD E
;
ÅÅE F
using
ÉÉ 	
(
ÉÉ
 
var
ÉÉ 
workBook
ÉÉ 
=
ÉÉ 
new
ÉÉ 

XLWorkbook
ÉÉ (
(
ÉÉ( )
)
ÉÉ) *
)
ÉÉ* +
{
ÑÑ 
var
ÖÖ 
	workSheet
ÖÖ 
=
ÖÖ 
workBook
ÖÖ  
.
ÖÖ  !

Worksheets
ÖÖ! +
.
ÖÖ+ ,
Add
ÖÖ, /
(
ÖÖ/ 0
$str
ÖÖ0 :
)
ÖÖ: ;
;
ÖÖ; <
	workSheet
àà 
.
àà 
Cell
àà 
(
àà 
$num
àà 
,
àà 
$num
àà 
)
àà 
.
àà 
Value
àà "
=
àà# $
$str
àà% 1
;
àà1 2
	workSheet
ââ 
.
ââ 
Cell
ââ 
(
ââ 
$num
ââ 
,
ââ 
$num
ââ 
)
ââ 
.
ââ 
Value
ââ "
=
ââ# $
$str
ââ% -
;
ââ- .
	workSheet
ää 
.
ää 
Cell
ää 
(
ää 
$num
ää 
,
ää 
$num
ää 
)
ää 
.
ää 
Value
ää "
=
ää# $
$str
ää% /
;
ää/ 0
	workSheet
ãã 
.
ãã 
Cell
ãã 
(
ãã 
$num
ãã 
,
ãã 
$num
ãã 
)
ãã 
.
ãã 
Value
ãã "
=
ãã# $
$str
ãã% ,
;
ãã, -
	workSheet
åå 
.
åå 
Cell
åå 
(
åå 
$num
åå 
,
åå 
$num
åå 
)
åå 
.
åå 
Value
åå "
=
åå# $
$str
åå% 2
;
åå2 3
	workSheet
çç 
.
çç 
Cell
çç 
(
çç 
$num
çç 
,
çç 
$num
çç 
)
çç 
.
çç 
Value
çç "
=
çç# $
$str
çç% -
;
çç- .
	workSheet
éé 
.
éé 
Cell
éé 
(
éé 
$num
éé 
,
éé 
$num
éé 
)
éé 
.
éé 
Value
éé "
=
éé# $
$str
éé% 0
;
éé0 1
	workSheet
èè 
.
èè 
Cell
èè 
(
èè 
$num
èè 
,
èè 
$num
èè 
)
èè 
.
èè 
Value
èè "
=
èè# $
$str
èè% .
;
èè. /
	workSheet
êê 
.
êê 
Cell
êê 
(
êê 
$num
êê 
,
êê 
$num
êê 
)
êê 
.
êê 
Value
êê "
=
êê# $
$str
êê% .
;
êê. /
	workSheet
ëë 
.
ëë 
Cell
ëë 
(
ëë 
$num
ëë 
,
ëë 
$num
ëë 
)
ëë 
.
ëë 
Value
ëë #
=
ëë$ %
$str
ëë& 2
;
ëë2 3
for
îî 
(
îî 
int
îî 
i
îî 
=
îî 
$num
îî 
;
îî 
i
îî 
<
îî 
studentInfoDtos
îî +
.
îî+ ,
Count
îî, 1
;
îî1 2
i
îî3 4
++
îî4 6
)
îî6 7
{
ïï 	
var
ññ 
student
ññ 
=
ññ 
studentInfoDtos
ññ )
[
ññ) *
i
ññ* +
]
ññ+ ,
;
ññ, -
	workSheet
òò 
.
òò 
Cell
òò 
(
òò 
i
òò 
+
òò 
$num
òò  
,
òò  !
$num
òò" #
)
òò# $
.
òò$ %
Value
òò% *
=
òò+ ,
student
òò- 4
.
òò4 5
	StudentId
òò5 >
.
òò> ?
ToString
òò? G
(
òòG H
)
òòH I
;
òòI J
	workSheet
ôô 
.
ôô 
Cell
ôô 
(
ôô 
i
ôô 
+
ôô 
$num
ôô  
,
ôô  !
$num
ôô" #
)
ôô# $
.
ôô$ %
Value
ôô% *
=
ôô+ ,
student
ôô- 4
.
ôô4 5
UserId
ôô5 ;
;
ôô; <
	workSheet
öö 
.
öö 
Cell
öö 
(
öö 
i
öö 
+
öö 
$num
öö  
,
öö  !
$num
öö" #
)
öö# $
.
öö$ %
Value
öö% *
=
öö+ ,
student
öö- 4
.
öö4 5
FullName
öö5 =
;
öö= >
	workSheet
õõ 
.
õõ 
Cell
õõ 
(
õõ 
i
õõ 
+
õõ 
$num
õõ  
,
õõ  !
$num
õõ" #
)
õõ# $
.
õõ$ %
Value
õõ% *
=
õõ+ ,
student
õõ- 4
.
õõ4 5
Email
õõ5 :
;
õõ: ;
	workSheet
úú 
.
úú 
Cell
úú 
(
úú 
i
úú 
+
úú 
$num
úú  
,
úú  !
$num
úú" #
)
úú# $
.
úú$ %
Value
úú% *
=
úú+ ,
student
úú- 4
.
úú4 5
PhoneNumber
úú5 @
;
úú@ A
	workSheet
ùù 
.
ùù 
Cell
ùù 
(
ùù 
i
ùù 
+
ùù 
$num
ùù  
,
ùù  !
$num
ùù" #
)
ùù# $
.
ùù$ %
Value
ùù% *
=
ùù+ ,
student
ùù- 4
.
ùù4 5
Gender
ùù5 ;
;
ùù; <
	workSheet
ûû 
.
ûû 
Cell
ûû 
(
ûû 
i
ûû 
+
ûû 
$num
ûû  
,
ûû  !
$num
ûû" #
)
ûû# $
.
ûû$ %
Value
ûû% *
=
ûû+ ,
student
ûû- 4
.
ûû4 5
	BirthDate
ûû5 >
?
ûû> ?
.
ûû? @
ToString
ûû@ H
(
ûûH I
$str
ûûI U
)
ûûU V
;
ûûV W
	workSheet
üü 
.
üü 
Cell
üü 
(
üü 
i
üü 
+
üü 
$num
üü  
,
üü  !
$num
üü" #
)
üü# $
.
üü$ %
Value
üü% *
=
üü+ ,
student
üü- 4
.
üü4 5
Country
üü5 <
;
üü< =
	workSheet
†† 
.
†† 
Cell
†† 
(
†† 
i
†† 
+
†† 
$num
††  
,
††  !
$num
††" #
)
††# $
.
††$ %
Value
††% *
=
††+ ,
student
††- 4
.
††4 5
Address
††5 <
;
††< =
	workSheet
°° 
.
°° 
Cell
°° 
(
°° 
i
°° 
+
°° 
$num
°°  
,
°°  !
$num
°°" $
)
°°$ %
.
°°% &
Value
°°& +
=
°°, -
student
°°. 5
.
°°5 6

University
°°6 @
;
°°@ A
}
¢¢ 	
	workSheet
§§ 
.
§§ 
Columns
§§ 
(
§§ 
)
§§ 
.
§§ 
AdjustToContents
§§ ,
(
§§, -
)
§§- .
;
§§. /
workBook
ßß 
.
ßß 
SaveAs
ßß 
(
ßß 
filePath
ßß  
)
ßß  !
;
ßß! "
return
©© 
fileNameStudent
©© 
;
©© 
}
™™ 
}´´ 
}¨¨ †Ä
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CategoryService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
CategoryService 
: 
ICategoryService /
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

CategoryService 
( 
IUnitOfWork &

unitOfWork' 1
,1 2
IMapper3 :
mapper; A
)A B
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetAll# )
( 
ClaimsPrincipal 
User 
, 
string   
?   
filterOn   
,   
string!! 
?!! 
filterQuery!! 
,!! 
string"" 
?"" 
sortBy"" 
,"" 
bool## 
?## 
isAscending## 
,## 
int$$ 

pageNumber$$ 
,$$ 
int%% 
pageSize%% 
)%% 
{&& 
try'' 
{(( 	
var)) 
userRole)) 
=)) 
User)) 
.))  
Claims))  &
.))& '
FirstOrDefault))' 5
())5 6
x))6 7
=>))8 :
x)); <
.))< =
Type))= A
==))B D

ClaimTypes))E O
.))O P
Role))P T
)))T U
?))U V
.))V W
Value))W \
;))\ ]
IEnumerable++ 
<++ 
Category++  
>++  !

categories++" ,
;++, -
if.. 
(.. 
userRole.. 
==.. 
StaticUserRoles.. +
...+ ,
Admin.., 1
)..1 2
{// 

categories00 
=00 
await11 
_unitOfWork11 %
.11% &
CategoryRepository11& 8
.118 9
GetAllAsync119 D
(11D E
)11E F
;11F G
}22 
else33 
{44 

categories55 
=55 
await66 
_unitOfWork66 %
.66% &
CategoryRepository66& 8
.668 9
GetAllAsync669 D
(66D E
x66E F
=>66G I
x77 
.77 
Status77  
<=77! #
StaticStatus77$ 0
.770 1
Category771 9
.779 :
	Activated77: C
)77C D
;77D E
}88 
if:: 
(:: 

categories:: 
.:: 
IsNullOrEmpty:: (
(::( )
)::) *
)::* +
{;; 
return<< 
new<< 
ResponseDTO<< &
(<<& '
)<<' (
{== 
Message>> 
=>> 
$str>> 5
,>>5 6
Result?? 
=?? 
null?? !
,??! "
	IsSuccess@@ 
=@@ 
true@@  $
,@@$ %

StatusCodeAA 
=AA  
$numAA! $
}BB 
;BB 
}CC 
varEE 
listCategoryEE 
=EE 

categoriesEE )
.EE) *
ToListEE* 0
(EE0 1
)EE1 2
;EE2 3
varJJ  
categoriesDictionaryJJ $
=JJ% &
listCategoryJJ' 3
.JJ3 4
ToDictionaryJJ4 @
(JJ@ A
xJJA B
=>JJC E
xJJF G
.JJG H
IdJJH J
,JJJ K
xJJL M
=>JJN P
xJJQ R
)JJR S
;JJS T
varLL 
rootCategoriesLL 
=LL  
newLL! $
ListLL% )
<LL) *
CategoryLL* 2
>LL2 3
(LL3 4
)LL4 5
;LL5 6
foreachNN 
(NN 
varNN 
categoryNN !
inNN" $
listCategoryNN% 1
)NN1 2
{OO 
ifQQ 
(QQ 
categoryQQ 
.QQ 
ParentIdQQ %
.QQ% &
HasValueQQ& .
)QQ. /
{RR 
ifTT 
(TT  
categoriesDictionaryTT ,
.TT, -
TryGetValueTT- 8
(TT8 9
categoryTT9 A
.TTA B
ParentIdTTB J
.TTJ K
ValueTTK P
,TTP Q
outTTR U
varTTV Y
parentCategoryTTZ h
)TTh i
)TTi j
{UU 
parentCategoryWW &
.WW& '
SubCategoriesWW' 4
.WW4 5
AddWW5 8
(WW8 9
categoryWW9 A
)WWA B
;WWB C
}XX 
}YY 
elseZZ 
{[[ 
rootCategories]] "
.]]" #
Add]]# &
(]]& '
category]]' /
)]]/ 0
;]]0 1
}^^ 
}__ 
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrEmptygg %
(gg% &
filterOngg& .
)gg. /
&&gg0 2
!gg3 4
stringgg4 :
.gg: ;
IsNullOrEmptygg; H
(ggH I
filterQueryggI T
)ggT U
)ggU V
{hh 
switchii 
(ii 
filterOnii  
.ii  !
Trimii! %
(ii% &
)ii& '
.ii' (
ToLowerii( /
(ii/ 0
)ii0 1
)ii1 2
{jj 
casekk 
$strkk 
:kk  
{ll 
rootCategoriesmm &
=mm' (
rootCategoriesmm) 7
.mm7 8
Wheremm8 =
(mm= >
xmm> ?
=>mm@ B
xnn 
.nn 
Namenn "
.nn" #
Containsnn# +
(nn+ ,
filterQuerynn, 7
,nn7 8
StringComparisonnn9 I
.nnI J$
CurrentCultureIgnoreCasennJ b
)nnb c
)nnc d
.nnd e
ToListnne k
(nnk l
)nnl m
;nnm n
breakoo 
;oo 
}pp 
caseqq 
$strqq &
:qq& '
{rr 
rootCategoriesss &
=ss' (
rootCategoriesss) 7
.ss7 8
Wheress8 =
(ss= >
xss> ?
=>ss@ B
xtt 
.tt 
Namett "
.tt" #
Containstt# +
(tt+ ,
filterQuerytt, 7
,tt7 8
StringComparisontt9 I
.ttI J$
CurrentCultureIgnoreCasettJ b
)ttb c
)ttc d
.ttd e
ToListtte k
(ttk l
)ttl m
;ttm n
breakuu 
;uu 
}vv 
defaultww 
:ww 
{xx 
breakyy 
;yy 
}zz 
}{{ 
}|| 
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
sortBy& ,
), -
)- .
{
ÄÄ 
switch
ÅÅ 
(
ÅÅ 
sortBy
ÅÅ 
.
ÅÅ 
Trim
ÅÅ #
(
ÅÅ# $
)
ÅÅ$ %
.
ÅÅ% &
ToLower
ÅÅ& -
(
ÅÅ- .
)
ÅÅ. /
)
ÅÅ/ 0
{
ÇÇ 
case
ÉÉ 
$str
ÉÉ 
:
ÉÉ  
{
ÑÑ 
rootCategories
ÖÖ &
=
ÖÖ' (
isAscending
ÖÖ) 4
==
ÖÖ5 7
true
ÖÖ8 <
?
ÜÜ 
[
ÜÜ 
..
ÜÜ !
rootCategories
ÜÜ" 0
.
ÜÜ0 1
OrderBy
ÜÜ1 8
(
ÜÜ8 9
x
ÜÜ9 :
=>
ÜÜ; =
x
ÜÜ> ?
.
ÜÜ? @
Name
ÜÜ@ D
)
ÜÜD E
]
ÜÜE F
:
áá 
[
áá 
..
áá !
rootCategories
áá" 0
.
áá0 1
OrderByDescending
áá1 B
(
ááB C
x
ááC D
=>
ááE G
x
ááH I
.
ááI J
Name
ááJ N
)
ááN O
]
ááO P
;
ááP Q
break
àà 
;
àà 
}
ââ 
case
ää 
$str
ää &
:
ää& '
{
ãã 
rootCategories
åå &
=
åå' (
isAscending
åå) 4
==
åå5 7
true
åå8 <
?
çç 
[
çç 
..
çç !
rootCategories
çç" 0
.
çç0 1
OrderBy
çç1 8
(
çç8 9
x
çç9 :
=>
çç; =
x
çç> ?
.
çç? @
Description
çç@ K
)
ççK L
]
ççL M
:
éé 
[
éé 
..
éé !
rootCategories
éé" 0
.
éé0 1
OrderByDescending
éé1 B
(
ééB C
x
ééC D
=>
ééE G
x
ééH I
.
ééI J
Description
ééJ U
)
ééU V
]
ééV W
;
ééW X
break
èè 
;
èè 
}
êê 
default
ëë 
:
ëë 
{
íí 
break
ìì 
;
ìì 
}
îî 
}
ïï 
}
ññ 
if
ôô 
(
ôô 

pageNumber
ôô 
>
ôô 
$num
ôô 
&&
ôô !
pageSize
ôô" *
>
ôô+ ,
$num
ôô- .
)
ôô. /
{
öö 
var
õõ 

skipResult
õõ 
=
õõ  
(
õõ! "

pageNumber
õõ" ,
-
õõ- .
$num
õõ/ 0
)
õõ0 1
*
õõ2 3
pageSize
õõ4 <
;
õõ< =
rootCategories
úú 
=
úú  
rootCategories
úú! /
.
úú/ 0
Skip
úú0 4
(
úú4 5

skipResult
úú5 ?
)
úú? @
.
úú@ A
Take
úúA E
(
úúE F
pageSize
úúF N
)
úúN O
.
úúO P
ToList
úúP V
(
úúV W
)
úúW X
;
úúX Y
}
ùù 
object
¢¢ 
rootCategoriesDto
¢¢ $
;
¢¢$ %
if
££ 
(
££ 
userRole
££ 
==
££ 
StaticUserRoles
££ +
.
££+ ,
Admin
££, 1
)
££1 2
{
§§ 
rootCategoriesDto
•• !
=
••" #
_mapper
••$ +
.
••+ ,
Map
••, /
<
••/ 0
List
••0 4
<
••4 5
AdminCategoryDTO
••5 E
>
••E F
>
••F G
(
••G H
rootCategories
••H V
)
••V W
;
••W X
}
¶¶ 
else
ßß 
{
®® 
rootCategoriesDto
©© !
=
©©" #
_mapper
©©$ +
.
©©+ ,
Map
©©, /
<
©©/ 0
List
©©0 4
<
©©4 5
CategoryDTO
©©5 @
>
©©@ A
>
©©A B
(
©©B C
rootCategories
©©C Q
)
©©Q R
;
©©R S
}
™™ 
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ 9
,
ÆÆ9 :
Result
ØØ 
=
ØØ 
rootCategoriesDto
ØØ *
,
ØØ* +
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  
,
∞∞  !

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
Message
∏∏ 
=
∏∏ 
e
∏∏ 
.
∏∏ 
Message
∏∏ #
,
∏∏# $
Result
ππ 
=
ππ 
null
ππ 
,
ππ 
	IsSuccess
∫∫ 
=
∫∫ 
false
∫∫ !
,
∫∫! "

StatusCode
ªª 
=
ªª 
$num
ªª  
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
¿¿ 

async
¿¿ 
Task
¿¿ 
<
¿¿ 
ResponseDTO
¿¿ !
>
¿¿! "
Search
¿¿# )
(
¡¡ 
ClaimsPrincipal
¬¬ 
User
¬¬ 
,
¬¬ 
string
√√ 
?
√√ 
filterOn
√√ 
,
√√ 
string
ƒƒ 
?
ƒƒ 
filterQuery
ƒƒ 
,
ƒƒ 
string
≈≈ 
?
≈≈ 
sortBy
≈≈ 
,
≈≈ 
bool
∆∆ 
?
∆∆ 
isAscending
∆∆ 
,
∆∆ 
int
«« 

pageNumber
«« 
,
«« 
int
»» 
pageSize
»» 
)
»» 
{
…… 
try
   
{
ÀÀ 	
var
ÃÃ 
userRole
ÃÃ 
=
ÃÃ 
User
ÃÃ 
.
ÃÃ  
Claims
ÃÃ  &
.
ÃÃ& '
FirstOrDefault
ÃÃ' 5
(
ÃÃ5 6
x
ÃÃ6 7
=>
ÃÃ8 :
x
ÃÃ; <
.
ÃÃ< =
Type
ÃÃ= A
==
ÃÃB D

ClaimTypes
ÃÃE O
.
ÃÃO P
Role
ÃÃP T
)
ÃÃT U
?
ÃÃU V
.
ÃÃV W
Value
ÃÃW \
;
ÃÃ\ ]
IEnumerable
ŒŒ 
<
ŒŒ 
Category
ŒŒ  
>
ŒŒ  !

categories
ŒŒ" ,
;
ŒŒ, -
if
—— 
(
—— 
userRole
—— 
==
—— 
StaticUserRoles
—— +
.
——+ ,
Admin
——, 1
)
——1 2
{
““ 

categories
”” 
=
”” 
await
‘‘ 
_unitOfWork
‘‘ %
.
‘‘% & 
CategoryRepository
‘‘& 8
.
‘‘8 9
GetAllAsync
‘‘9 D
(
‘‘D E
includeProperties
‘‘E V
:
‘‘V W
$str
‘‘X h
)
‘‘h i
;
‘‘i j
}
’’ 
else
÷÷ 
{
◊◊ 

categories
ÿÿ 
=
ÿÿ 
await
ŸŸ 
_unitOfWork
ŸŸ %
.
ŸŸ% & 
CategoryRepository
ŸŸ& 8
.
ŸŸ8 9
GetAllAsync
ŸŸ9 D
(
ŸŸD E
x
ŸŸE F
=>
ŸŸG I
x
⁄⁄ 
.
⁄⁄ 
Status
⁄⁄  
<=
⁄⁄! #
StaticStatus
⁄⁄$ 0
.
⁄⁄0 1
Category
⁄⁄1 9
.
⁄⁄9 :
	Activated
⁄⁄: C
,
⁄⁄C D
includeProperties
⁄⁄E V
:
⁄⁄V W
$str
⁄⁄X h
)
⁄⁄h i
;
⁄⁄i j
}
€€ 
if
›› 
(
›› 

categories
›› 
.
›› 
IsNullOrEmpty
›› (
(
››( )
)
››) *
)
››* +
{
ﬁﬁ 
return
ﬂﬂ 
new
ﬂﬂ 
ResponseDTO
ﬂﬂ &
(
ﬂﬂ& '
)
ﬂﬂ' (
{
‡‡ 
Message
·· 
=
·· 
$str
·· 5
,
··5 6
Result
‚‚ 
=
‚‚ 
null
‚‚ !
,
‚‚! "
	IsSuccess
„„ 
=
„„ 
true
„„  $
,
„„$ %

StatusCode
‰‰ 
=
‰‰  
$num
‰‰! $
}
ÂÂ 
;
ÂÂ 
}
ÊÊ 
var
ËË 
listCategory
ËË 
=
ËË 

categories
ËË )
.
ËË) *
ToList
ËË* 0
(
ËË0 1
)
ËË1 2
;
ËË2 3
if
ÌÌ 
(
ÌÌ 
!
ÌÌ 
string
ÌÌ 
.
ÌÌ 
IsNullOrEmpty
ÌÌ %
(
ÌÌ% &
filterOn
ÌÌ& .
)
ÌÌ. /
&&
ÌÌ0 2
!
ÌÌ3 4
string
ÌÌ4 :
.
ÌÌ: ;
IsNullOrEmpty
ÌÌ; H
(
ÌÌH I
filterQuery
ÌÌI T
)
ÌÌT U
)
ÌÌU V
{
ÓÓ 
switch
ÔÔ 
(
ÔÔ 
filterOn
ÔÔ  
.
ÔÔ  !
Trim
ÔÔ! %
(
ÔÔ% &
)
ÔÔ& '
.
ÔÔ' (
ToLower
ÔÔ( /
(
ÔÔ/ 0
)
ÔÔ0 1
)
ÔÔ1 2
{
 
case
ÒÒ 
$str
ÒÒ 
:
ÒÒ  
{
ÚÚ 
listCategory
ÛÛ $
=
ÛÛ% &
listCategory
ÛÛ' 3
.
ÛÛ3 4
Where
ÛÛ4 9
(
ÛÛ9 :
x
ÛÛ: ;
=>
ÛÛ< >
x
ÙÙ 
.
ÙÙ 
Name
ÙÙ "
.
ÙÙ" #
Contains
ÙÙ# +
(
ÙÙ+ ,
filterQuery
ÙÙ, 7
,
ÙÙ7 8
StringComparison
ÙÙ9 I
.
ÙÙI J&
CurrentCultureIgnoreCase
ÙÙJ b
)
ÙÙb c
)
ÙÙc d
.
ÙÙd e
ToList
ÙÙe k
(
ÙÙk l
)
ÙÙl m
;
ÙÙm n
break
ıı 
;
ıı 
}
ˆˆ 
case
˜˜ 
$str
˜˜ &
:
˜˜& '
{
¯¯ 
listCategory
˘˘ $
=
˘˘% &
listCategory
˘˘' 3
.
˘˘3 4
Where
˘˘4 9
(
˘˘9 :
x
˘˘: ;
=>
˘˘< >
x
˙˙ 
.
˙˙ 
Name
˙˙ "
.
˙˙" #
Contains
˙˙# +
(
˙˙+ ,
filterQuery
˙˙, 7
,
˙˙7 8
StringComparison
˙˙9 I
.
˙˙I J&
CurrentCultureIgnoreCase
˙˙J b
)
˙˙b c
)
˙˙c d
.
˙˙d e
ToList
˙˙e k
(
˙˙k l
)
˙˙l m
;
˙˙m n
break
˚˚ 
;
˚˚ 
}
¸¸ 
default
˝˝ 
:
˝˝ 
{
˛˛ 
break
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 
}
ÇÇ 
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 
string
ÖÖ 
.
ÖÖ 
IsNullOrEmpty
ÖÖ %
(
ÖÖ% &
sortBy
ÖÖ& ,
)
ÖÖ, -
)
ÖÖ- .
{
ÜÜ 
switch
áá 
(
áá 
sortBy
áá 
.
áá 
Trim
áá #
(
áá# $
)
áá$ %
.
áá% &
ToLower
áá& -
(
áá- .
)
áá. /
)
áá/ 0
{
àà 
case
ââ 
$str
ââ 
:
ââ  
{
ää 
listCategory
ãã $
=
ãã% &
isAscending
ãã' 2
==
ãã3 5
true
ãã6 :
?
åå 
[
åå 
..
åå !
listCategory
åå" .
.
åå. /
OrderBy
åå/ 6
(
åå6 7
x
åå7 8
=>
åå9 ;
x
åå< =
.
åå= >
Name
åå> B
)
ååB C
]
ååC D
:
çç 
[
çç 
..
çç !
listCategory
çç" .
.
çç. /
OrderByDescending
çç/ @
(
çç@ A
x
ççA B
=>
ççC E
x
ççF G
.
ççG H
Name
ççH L
)
ççL M
]
ççM N
;
ççN O
break
éé 
;
éé 
}
èè 
case
êê 
$str
êê &
:
êê& '
{
ëë 
listCategory
íí $
=
íí% &
isAscending
íí' 2
==
íí3 5
true
íí6 :
?
ìì 
[
ìì 
..
ìì !
listCategory
ìì" .
.
ìì. /
OrderBy
ìì/ 6
(
ìì6 7
x
ìì7 8
=>
ìì9 ;
x
ìì< =
.
ìì= >
Description
ìì> I
)
ììI J
]
ììJ K
:
îî 
[
îî 
..
îî !
listCategory
îî" .
.
îî. /
OrderByDescending
îî/ @
(
îî@ A
x
îîA B
=>
îîC E
x
îîF G
.
îîG H
Description
îîH S
)
îîS T
]
îîT U
;
îîU V
break
ïï 
;
ïï 
}
ññ 
default
óó 
:
óó 
{
òò 
break
ôô 
;
ôô 
}
öö 
}
õõ 
}
úú 
if
üü 
(
üü 

pageNumber
üü 
>
üü 
$num
üü 
&&
üü !
pageSize
üü" *
>
üü+ ,
$num
üü- .
)
üü. /
{
†† 
var
°° 

skipResult
°° 
=
°°  
(
°°! "

pageNumber
°°" ,
-
°°- .
$num
°°/ 0
)
°°0 1
*
°°2 3
pageSize
°°4 <
;
°°< =
listCategory
¢¢ 
=
¢¢ 
listCategory
¢¢ +
.
¢¢+ ,
Skip
¢¢, 0
(
¢¢0 1

skipResult
¢¢1 ;
)
¢¢; <
.
¢¢< =
Take
¢¢= A
(
¢¢A B
pageSize
¢¢B J
)
¢¢J K
.
¢¢K L
ToList
¢¢L R
(
¢¢R S
)
¢¢S T
;
¢¢T U
}
££ 
object
ßß 
listCategoryDto
ßß "
;
ßß" #
if
®® 
(
®® 
userRole
®® 
==
®® 
StaticUserRoles
®® +
.
®®+ ,
Admin
®®, 1
)
®®1 2
{
©© 
listCategoryDto
™™ 
=
™™  !
_mapper
™™" )
.
™™) *
Map
™™* -
<
™™- .
List
™™. 2
<
™™2 3
AdminCategoryDTO
™™3 C
>
™™C D
>
™™D E
(
™™E F
listCategory
™™F R
)
™™R S
;
™™S T
}
´´ 
else
¨¨ 
{
≠≠ 
listCategoryDto
ÆÆ 
=
ÆÆ  !
_mapper
ÆÆ" )
.
ÆÆ) *
Map
ÆÆ* -
<
ÆÆ- .
List
ÆÆ. 2
<
ÆÆ2 3
CategoryDTO
ÆÆ3 >
>
ÆÆ> ?
>
ÆÆ? @
(
ÆÆ@ A
listCategory
ÆÆA M
)
ÆÆM N
;
ÆÆN O
}
ØØ 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ 9
,
¥¥9 :
Result
µµ 
=
µµ 
listCategoryDto
µµ (
,
µµ( )
	IsSuccess
∂∂ 
=
∂∂ 
true
∂∂  
,
∂∂  !

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
}
∏∏ 
;
∏∏ 
}
ππ 	
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 	
return
ºº 
new
ºº 
ResponseDTO
ºº "
(
ºº" #
)
ºº# $
{
ΩΩ 
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $
Result
øø 
=
øø 
null
øø 
,
øø 
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿ !
,
¿¿! "

StatusCode
¡¡ 
=
¡¡ 
$num
¡¡  
}
¬¬ 
;
¬¬ 
}
√√ 	
}
ƒƒ 
public
∆∆ 

async
∆∆ 
Task
∆∆ 
<
∆∆ 
ResponseDTO
∆∆ !
>
∆∆! "
GetSubCategory
∆∆# 1
(
∆∆1 2
Guid
∆∆2 6
id
∆∆7 9
)
∆∆9 :
{
«« 
try
»» 
{
…… 	
var
   

categories
   
=
   
await
ÀÀ 
_unitOfWork
ÀÀ !
.
ÀÀ! " 
CategoryRepository
ÀÀ" 4
.
ÀÀ4 5
GetAllAsync
ÀÀ5 @
(
ÀÀ@ A
filter
ÀÀA G
:
ÀÀG H
x
ÀÀI J
=>
ÀÀK M
x
ÀÀN O
.
ÀÀO P
ParentId
ÀÀP X
==
ÀÀY [
id
ÀÀ\ ^
)
ÀÀ^ _
;
ÀÀ_ `
if
ÕÕ 
(
ÕÕ 

categories
ÕÕ 
is
ÕÕ 
null
ÕÕ "
)
ÕÕ" #
{
ŒŒ 
return
œœ 
new
œœ 
ResponseDTO
œœ &
(
œœ& '
)
œœ' (
{
–– 
Message
—— 
=
—— 
$str
—— 6
,
——6 7
	IsSuccess
““ 
=
““ 
false
““  %
,
““% &

StatusCode
”” 
=
””  
$num
””! $
,
””$ %
Result
‘‘ 
=
‘‘ 
null
‘‘ !
,
‘‘! "
}
’’ 
;
’’ 
}
÷÷ 
var
ÿÿ 
categoryDto
ÿÿ 
=
ÿÿ 
_mapper
ÿÿ %
.
ÿÿ% &
Map
ÿÿ& )
<
ÿÿ) *
List
ÿÿ* .
<
ÿÿ. /
CategoryDTO
ÿÿ/ :
>
ÿÿ: ;
>
ÿÿ; <
(
ÿÿ< =

categories
ÿÿ= G
)
ÿÿG H
;
ÿÿH I
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ "
(
⁄⁄" #
)
⁄⁄# $
{
€€ 
Message
‹‹ 
=
‹‹ 
$str
‹‹ 9
,
‹‹9 :
Result
›› 
=
›› 
categoryDto
›› $
,
››$ %
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  
,
ﬁﬁ  !

StatusCode
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ  
}
‡‡ 
;
‡‡ 
}
·· 	
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 	
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ "
(
‰‰" #
)
‰‰# $
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
,
ÊÊ# $
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ 
,
ÁÁ 
	IsSuccess
ËË 
=
ËË 
false
ËË !
,
ËË! "

StatusCode
ÈÈ 
=
ÈÈ 
$num
ÈÈ  
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
}
ÏÏ 
public
ÓÓ 

async
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
ResponseDTO
ÓÓ !
>
ÓÓ! "
GetParentCategory
ÓÓ# 4
(
ÓÓ4 5
Guid
ÓÓ5 9
id
ÓÓ: <
)
ÓÓ< =
{
ÔÔ 
try
 
{
ÒÒ 	
var
ÚÚ 
category
ÚÚ 
=
ÚÚ 
await
ÛÛ 
_unitOfWork
ÛÛ !
.
ÛÛ! " 
CategoryRepository
ÛÛ" 4
.
ÛÛ4 5
GetAsync
ÛÛ5 =
(
ÛÛ= >
filter
ÛÛ> D
:
ÛÛD E
x
ÛÛF G
=>
ÛÛH J
x
ÛÛK L
.
ÛÛL M
Id
ÛÛM O
==
ÛÛP R
id
ÛÛS U
)
ÛÛU V
;
ÛÛV W
if
ıı 
(
ıı 
category
ıı 
is
ıı 
null
ıı  
)
ıı  !
{
ˆˆ 
return
˜˜ 
new
˜˜ 
ResponseDTO
˜˜ &
(
˜˜& '
)
˜˜' (
{
¯¯ 
Message
˘˘ 
=
˘˘ 
$str
˘˘ 6
,
˘˘6 7
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
,
˚˚$ %
Result
¸¸ 
=
¸¸ 
null
¸¸ !
,
¸¸! "
}
˝˝ 
;
˝˝ 
}
˛˛ 
var
ÄÄ 
parentCategory
ÄÄ 
=
ÄÄ  
await
ÄÄ! &
_unitOfWork
ÄÄ' 2
.
ÄÄ2 3 
CategoryRepository
ÄÄ3 E
.
ÄÄE F
GetAsync
ÄÄF N
(
ÄÄN O
filter
ÄÄO U
:
ÄÄU V
x
ÄÄW X
=>
ÄÄY [
x
ÄÄ\ ]
.
ÄÄ] ^
Id
ÄÄ^ `
==
ÄÄa c
category
ÄÄd l
.
ÄÄl m
ParentId
ÄÄm u
)
ÄÄu v
;
ÄÄv w
if
ÇÇ 
(
ÇÇ 
parentCategory
ÇÇ 
is
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ &
(
ÑÑ& '
)
ÑÑ' (
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ D
,
ÜÜD E
	IsSuccess
áá 
=
áá 
false
áá  %
,
áá% &

StatusCode
àà 
=
àà  
$num
àà! $
,
àà$ %
Result
ââ 
=
ââ 
null
ââ !
,
ââ! "
}
ää 
;
ää 
}
ãã 
var
çç 
parentCategoryDto
çç !
=
çç" #
_mapper
çç$ +
.
çç+ ,
Map
çç, /
<
çç/ 0
CategoryDTO
çç0 ;
>
çç; <
(
çç< =
parentCategory
çç= K
)
ççK L
;
ççL M
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Message
ëë 
=
ëë 
$str
ëë <
,
ëë< =
Result
íí 
=
íí 
parentCategoryDto
íí *
,
íí* +
	IsSuccess
ìì 
=
ìì 
true
ìì  
,
ìì  !

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 	
return
ôô 
new
ôô 
ResponseDTO
ôô "
(
ôô" #
)
ôô# $
{
öö 
Message
õõ 
=
õõ 
e
õõ 
.
õõ 
Message
õõ #
,
õõ# $
Result
úú 
=
úú 
null
úú 
,
úú 
	IsSuccess
ùù 
=
ùù 
false
ùù !
,
ùù! "

StatusCode
ûû 
=
ûû 
$num
ûû  
}
üü 
;
üü 
}
†† 	
}
°° 
public
®® 

async
®® 
Task
®® 
<
®® 
ResponseDTO
®® !
>
®®! "
Get
®®# &
(
®®& '
ClaimsPrincipal
®®' 6
User
®®7 ;
,
®®; <
Guid
®®= A
id
®®B D
)
®®D E
{
©© 
try
™™ 
{
´´ 	
var
¨¨ 
category
¨¨ 
=
¨¨ 
await
≠≠ 
_unitOfWork
≠≠ !
.
≠≠! " 
CategoryRepository
≠≠" 4
.
≠≠4 5
GetAsync
≠≠5 =
(
≠≠= >
filter
≠≠> D
:
≠≠D E
x
≠≠F G
=>
≠≠H J
x
≠≠K L
.
≠≠L M
Id
≠≠M O
==
≠≠P R
id
≠≠S U
,
≠≠U V
includeProperties
ÆÆ %
:
ÆÆ% &
$str
ÆÆ' 7
)
ÆÆ7 8
;
ÆÆ8 9
if
∞∞ 
(
∞∞ 
category
∞∞ 
is
∞∞ 
null
∞∞  
)
∞∞  !
{
±± 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ &
(
≤≤& '
)
≤≤' (
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ 6
,
¥¥6 7
	IsSuccess
µµ 
=
µµ 
false
µµ  %
,
µµ% &

StatusCode
∂∂ 
=
∂∂  
$num
∂∂! $
,
∂∂$ %
Result
∑∑ 
=
∑∑ 
null
∑∑ !
,
∑∑! "
}
∏∏ 
;
∏∏ 
}
ππ 
var
ªª 
userRole
ªª 
=
ªª 
User
ªª 
.
ªª  
Claims
ªª  &
.
ªª& '
FirstOrDefault
ªª' 5
(
ªª5 6
x
ªª6 7
=>
ªª8 :
x
ªª; <
.
ªª< =
Type
ªª= A
==
ªªB D

ClaimTypes
ªªE O
.
ªªO P
Role
ªªP T
)
ªªT U
?
ªªU V
.
ªªV W
Value
ªªW \
;
ªª\ ]
object
ææ 
rootCategoryDto
ææ "
;
ææ" #
if
øø 
(
øø 
userRole
øø 
==
øø 
StaticUserRoles
øø +
.
øø+ ,
Admin
øø, 1
)
øø1 2
{
¿¿ 
rootCategoryDto
¡¡ 
=
¡¡  !
_mapper
¡¡" )
.
¡¡) *
Map
¡¡* -
<
¡¡- .
AdminCategoryDTO
¡¡. >
>
¡¡> ?
(
¡¡? @
category
¡¡@ H
)
¡¡H I
;
¡¡I J
}
¬¬ 
else
√√ 
{
ƒƒ 
rootCategoryDto
≈≈ 
=
≈≈  !
_mapper
≈≈" )
.
≈≈) *
Map
≈≈* -
<
≈≈- .
CategoryDTO
≈≈. 9
>
≈≈9 :
(
≈≈: ;
category
≈≈; C
)
≈≈C D
;
≈≈D E
}
∆∆ 
return
»» 
new
»» 
ResponseDTO
»» "
(
»»" #
)
»»# $
{
…… 
Message
   
=
   
$str
   9
,
  9 :
Result
ÀÀ 
=
ÀÀ 
rootCategoryDto
ÀÀ (
,
ÀÀ( )
	IsSuccess
ÃÃ 
=
ÃÃ 
true
ÃÃ  
,
ÃÃ  !

StatusCode
ÕÕ 
=
ÕÕ 
$num
ÕÕ  
}
ŒŒ 
;
ŒŒ 
}
œœ 	
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 	
return
““ 
new
““ 
ResponseDTO
““ "
(
““" #
)
““# $
{
”” 
Message
‘‘ 
=
‘‘ 
e
‘‘ 
.
‘‘ 
Message
‘‘ #
,
‘‘# $
Result
’’ 
=
’’ 
null
’’ 
,
’’ 
	IsSuccess
÷÷ 
=
÷÷ 
false
÷÷ !
,
÷÷! "

StatusCode
◊◊ 
=
◊◊ 
$num
◊◊  
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 	
}
⁄⁄ 
public
·· 

async
·· 
Task
·· 
<
·· 
ResponseDTO
·· !
>
··! "
CreateCategory
··# 1
(
··1 2
ClaimsPrincipal
··2 A
User
··B F
,
··F G
CreateCategoryDTO
··H Y
createCategoryDto
··Z k
)
··k l
{
‚‚ 
try
„„ 
{
‰‰ 	
Guid
ÂÂ 

guidOutput
ÂÂ 
;
ÂÂ 
var
ÊÊ 
isGuid
ÊÊ 
=
ÊÊ 
Guid
ÊÊ 
.
ÊÊ 
TryParse
ÊÊ &
(
ÊÊ& '
createCategoryDto
ÊÊ' 8
.
ÊÊ8 9
ParentId
ÊÊ9 A
,
ÊÊA B
out
ÊÊC F

guidOutput
ÊÊG Q
)
ÊÊQ R
;
ÊÊR S
var
ËË 
category
ËË 
=
ËË 
new
ËË 
Category
ËË '
{
ÈÈ 
Id
ÍÍ 
=
ÍÍ 
Guid
ÍÍ 
.
ÍÍ 
NewGuid
ÍÍ !
(
ÍÍ! "
)
ÍÍ" #
,
ÍÍ# $
Name
ÎÎ 
=
ÎÎ 
createCategoryDto
ÎÎ (
.
ÎÎ( )
Name
ÎÎ) -
,
ÎÎ- .
Description
ÏÏ 
=
ÏÏ 
createCategoryDto
ÏÏ /
.
ÏÏ/ 0
Description
ÏÏ0 ;
,
ÏÏ; <
ParentId
ÌÌ 
=
ÌÌ 
isGuid
ÌÌ !
?
ÌÌ" #

guidOutput
ÌÌ$ .
:
ÌÌ/ 0
null
ÌÌ1 5
,
ÌÌ5 6
CreatedTime
ÓÓ 
=
ÓÓ 
DateTime
ÓÓ &
.
ÓÓ& '
Now
ÓÓ' *
,
ÓÓ* +
UpdatedTime
ÔÔ 
=
ÔÔ 
null
ÔÔ "
,
ÔÔ" #
	CreatedBy
 
=
 
User
  
.
  !
Identity
! )
.
) *
Name
* .
,
. /
	UpdatedBy
ÒÒ 
=
ÒÒ 
$str
ÒÒ 
,
ÒÒ 
Status
ÚÚ 
=
ÚÚ 
$num
ÚÚ 
,
ÚÚ 
}
ÛÛ 
;
ÛÛ 
var
ˆˆ  
existingCategories
ˆˆ "
=
ˆˆ# $
await
ˆˆ% *
_unitOfWork
ˆˆ+ 6
.
ˆˆ6 7 
CategoryRepository
ˆˆ7 I
.
ˆˆI J
GetAllAsync
ˆˆJ U
(
ˆˆU V
)
ˆˆV W
;
ˆˆW X
if
˜˜ 
(
˜˜  
existingCategories
˜˜ "
==
˜˜# %
null
˜˜& *
||
˜˜+ -
!
˜˜. / 
existingCategories
˜˜/ A
.
˜˜A B
Any
˜˜B E
(
˜˜E F
)
˜˜F G
)
˜˜G H
{
¯¯ 
await
˙˙ 
_unitOfWork
˙˙ !
.
˙˙! " 
CategoryRepository
˙˙" 4
.
˙˙4 5
AddAsync
˙˙5 =
(
˙˙= >
category
˙˙> F
)
˙˙F G
;
˙˙G H
await
˚˚ 
_unitOfWork
˚˚ !
.
˚˚! "
	SaveAsync
˚˚" +
(
˚˚+ ,
)
˚˚, -
;
˚˚- .
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ &
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ =
,
˛˛= >
Result
ˇˇ 
=
ˇˇ 
category
ˇˇ %
,
ˇˇ% &
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  $
,
ÄÄ$ %

StatusCode
ÅÅ 
=
ÅÅ  
$num
ÅÅ! $
,
ÅÅ$ %
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
else
ÜÜ 
if
ÜÜ 
(
ÜÜ 
category
ÜÜ 
.
ÜÜ 
ParentId
ÜÜ &
==
ÜÜ' )
null
ÜÜ* .
)
ÜÜ. /
{
áá 
await
àà 
_unitOfWork
àà !
.
àà! " 
CategoryRepository
àà" 4
.
àà4 5
AddAsync
àà5 =
(
àà= >
category
àà> F
)
ààF G
;
ààG H
await
ââ 
_unitOfWork
ââ !
.
ââ! "
	SaveAsync
ââ" +
(
ââ+ ,
)
ââ, -
;
ââ- .
return
ãã 
new
ãã 
ResponseDTO
ãã &
{
åå 
Message
çç 
=
çç 
$str
çç =
,
çç= >
Result
éé 
=
éé 
category
éé %
,
éé% &
	IsSuccess
èè 
=
èè 
true
èè  $
,
èè$ %

StatusCode
êê 
=
êê  
$num
êê! $
,
êê$ %
}
ëë 
;
ëë 
}
íí 
await
ïï 
_unitOfWork
ïï 
.
ïï  
CategoryRepository
ïï 0
.
ïï0 1
AddAsync
ïï1 9
(
ïï9 :
category
ïï: B
)
ïïB C
;
ïïC D
var
ññ 
save
ññ 
=
ññ 
await
ññ 
_unitOfWork
ññ (
.
ññ( )
	SaveAsync
ññ) 2
(
ññ2 3
)
ññ3 4
;
ññ4 5
if
óó 
(
óó 
save
óó 
<=
óó 
$num
óó 
)
óó 
{
òò 
return
ôô 
new
ôô 
ResponseDTO
ôô &
{
öö 
Message
õõ 
=
õõ 
$str
õõ  
,
õõ  !
Result
úú 
=
úú 
null
úú !
,
úú! "
	IsSuccess
ùù 
=
ùù 
false
ùù  %
,
ùù% &

StatusCode
ûû 
=
ûû  
$num
ûû! $
}
üü 
;
üü 
}
†† 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ "
{
££ 
Message
§§ 
=
§§ 
$str
§§ 9
,
§§9 :
Result
•• 
=
•• 
category
•• !
,
••! "
	IsSuccess
¶¶ 
=
¶¶ 
true
¶¶  
,
¶¶  !

StatusCode
ßß 
=
ßß 
$num
ßß  
}
®® 
;
®® 
}
©© 	
catch
™™ 
(
™™ 
	Exception
™™ 
e
™™ 
)
™™ 
{
´´ 	
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
e
ÆÆ 
.
ÆÆ 
Message
ÆÆ #
,
ÆÆ# $
Result
ØØ 
=
ØØ 
null
ØØ 
,
ØØ 
	IsSuccess
∞∞ 
=
∞∞ 
false
∞∞ !
,
∞∞! "

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
}
¥¥ 
public
ªª 

async
ªª 
Task
ªª 
<
ªª 
ResponseDTO
ªª !
>
ªª! "
Update
ªª# )
(
ªª) *
ClaimsPrincipal
ªª* 9
User
ªª: >
,
ªª> ?
UpdateCategoryDTO
ªª@ Q
updateCategoryDTO
ªªR c
)
ªªc d
{
ºº 
try
ΩΩ 
{
ææ 	
var
¿¿ 
categoryToUpdate
¿¿  
=
¿¿! "
await
¿¿# (
_unitOfWork
¿¿) 4
.
¿¿4 5 
CategoryRepository
¿¿5 G
.
¿¿G H
GetAsync
¿¿H P
(
¿¿P Q
c
¿¿Q R
=>
¿¿S U
c
¿¿V W
.
¿¿W X
Id
¿¿X Z
==
¿¿[ ]
updateCategoryDTO
¿¿^ o
.
¿¿o p
Id
¿¿p r
)
¿¿r s
;
¿¿s t
if
√√ 
(
√√ 
categoryToUpdate
√√  
==
√√! #
null
√√$ (
)
√√( )
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
{
∆∆ 
Message
«« 
=
«« 
$str
«« 2
,
««2 3
Result
»» 
=
»» 
null
»» !
,
»»! "
	IsSuccess
…… 
=
…… 
false
……  %
,
……% &

StatusCode
   
=
    
$num
  ! $
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
categoryToUpdate
œœ 
.
œœ 
Name
œœ !
=
œœ" #
updateCategoryDTO
œœ$ 5
.
œœ5 6
Name
œœ6 :
;
œœ: ;
categoryToUpdate
–– 
.
–– 
Description
–– (
=
––) *
updateCategoryDTO
––+ <
.
––< =
Description
––= H
;
––H I
categoryToUpdate
—— 
.
—— 
ParentId
—— %
=
——& '
!
——( )
string
——) /
.
——/ 0
IsNullOrEmpty
——0 =
(
——= >
updateCategoryDTO
——> O
.
——O P
ParentId
——P X
)
——X Y
?
““ 
Guid
““ 
.
““ 
Parse
““ 
(
““ 
updateCategoryDTO
““ .
.
““. /
ParentId
““/ 7
)
““7 8
:
”” 
(
”” 
Guid
”” 
?
”” 
)
”” 
null
”” 
;
”” 
categoryToUpdate
‘‘ 
.
‘‘ 
UpdatedTime
‘‘ (
=
‘‘) *
DateTime
‘‘+ 3
.
‘‘3 4
Now
‘‘4 7
;
‘‘7 8
categoryToUpdate
’’ 
.
’’ 
	UpdatedBy
’’ &
=
’’' (
User
’’) -
.
’’- .
Identity
’’. 6
.
’’6 7
Name
’’7 ;
;
’’; <
categoryToUpdate
÷÷ 
.
÷÷ 
Status
÷÷ #
=
÷÷$ %
updateCategoryDTO
÷÷& 7
.
÷÷7 8
Status
÷÷8 >
;
÷÷> ?
_unitOfWork
⁄⁄ 
.
⁄⁄  
CategoryRepository
⁄⁄ *
.
⁄⁄* +
Update
⁄⁄+ 1
(
⁄⁄1 2
categoryToUpdate
⁄⁄2 B
)
⁄⁄B C
;
⁄⁄C D
var
›› 
save
›› 
=
›› 
await
›› 
_unitOfWork
›› (
.
››( )
	SaveAsync
››) 2
(
››2 3
)
››3 4
;
››4 5
if
ﬁﬁ 
(
ﬁﬁ 
save
ﬁﬁ 
<=
ﬁﬁ 
$num
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
new
‡‡ 
ResponseDTO
‡‡ &
{
·· 
Message
‚‚ 
=
‚‚ 
$str
‚‚ 9
,
‚‚9 :
Result
„„ 
=
„„ 
null
„„ !
,
„„! "
	IsSuccess
‰‰ 
=
‰‰ 
false
‰‰  %
,
‰‰% &

StatusCode
ÂÂ 
=
ÂÂ  
$num
ÂÂ! $
}
ÊÊ 
;
ÊÊ 
}
ÁÁ 
return
ÈÈ 
new
ÈÈ 
ResponseDTO
ÈÈ "
{
ÍÍ 
Message
ÎÎ 
=
ÎÎ 
$str
ÎÎ 9
,
ÎÎ9 :
Result
ÏÏ 
=
ÏÏ 
categoryToUpdate
ÏÏ )
,
ÏÏ) *
	IsSuccess
ÌÌ 
=
ÌÌ 
true
ÌÌ  
,
ÌÌ  !

StatusCode
ÓÓ 
=
ÓÓ 
$num
ÓÓ  
}
ÔÔ 
;
ÔÔ 
}
 	
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 	
return
ÛÛ 
new
ÛÛ 
ResponseDTO
ÛÛ "
{
ÙÙ 
Message
ıı 
=
ıı 
e
ıı 
.
ıı 
Message
ıı #
,
ıı# $
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ 
,
ˆˆ 
	IsSuccess
˜˜ 
=
˜˜ 
false
˜˜ !
,
˜˜! "

StatusCode
¯¯ 
=
¯¯ 
$num
¯¯  
}
˘˘ 
;
˘˘ 
}
˙˙ 	
}
˚˚ 
public
ÇÇ 

async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
ResponseDTO
ÇÇ !
>
ÇÇ! "
Delete
ÇÇ# )
(
ÇÇ) *
ClaimsPrincipal
ÇÇ* 9
User
ÇÇ: >
,
ÇÇ> ?
Guid
ÇÇ@ D
id
ÇÇE G
)
ÇÇG H
{
ÉÉ 
try
ÑÑ 
{
ÖÖ 	
var
áá 
category
áá 
=
áá 
await
áá  
_unitOfWork
áá! ,
.
áá, - 
CategoryRepository
áá- ?
.
áá? @
GetAsync
áá@ H
(
ááH I
c
ááI J
=>
ááK M
c
ááN O
.
ááO P
Id
ááP R
==
ááS U
id
ááV X
)
ááX Y
;
ááY Z
if
ää 
(
ää 
category
ää 
==
ää 
null
ää  
)
ää  !
{
ãã 
return
åå 
new
åå 
ResponseDTO
åå &
{
çç 
Message
éé 
=
éé 
$str
éé 2
,
éé2 3
	IsSuccess
èè 
=
èè 
false
èè  %
,
èè% &

StatusCode
êê 
=
êê  
$num
êê! $
,
êê$ %
Result
ëë 
=
ëë 
null
ëë !
}
íí 
;
íí 
}
ìì 
var
ññ 
subCategories
ññ 
=
ññ 
await
ññ  %
_unitOfWork
ññ& 1
.
ññ1 2 
CategoryRepository
ññ2 D
.
ññD E
GetAllAsync
ññE P
(
ññP Q
c
ññQ R
=>
ññS U
c
ññV W
.
ññW X
ParentId
ññX `
==
ñña c
id
ññd f
)
ññf g
;
ññg h
if
ôô 
(
ôô 
subCategories
ôô 
.
ôô 
Any
ôô !
(
ôô! "
)
ôô" #
)
ôô# $
{
öö 
return
õõ 
new
õõ 
ResponseDTO
õõ &
{
úú 
Message
ùù 
=
ùù 
$str
ùù X
,
ùùX Y
	IsSuccess
ûû 
=
ûû 
false
ûû  %
,
ûû% &

StatusCode
üü 
=
üü  
$num
üü! $
,
üü$ %
Result
†† 
=
†† 
subCategories
†† *
.
††* +
Select
††+ 1
(
††1 2
x
††2 3
=>
††4 6
new
††7 :
{
††; <
x
††= >
.
††> ?
Id
††? A
,
††A B
x
††C D
.
††D E
Name
††E I
}
††J K
)
††K L
.
††L M
ToList
††M S
(
††S T
)
††T U
}
°° 
;
°° 
}
¢¢ 
category
•• 
.
•• 
Status
•• 
=
•• 
$num
•• 
;
••  
category
¶¶ 
.
¶¶ 
UpdatedTime
¶¶  
=
¶¶! "
DateTime
¶¶# +
.
¶¶+ ,
Now
¶¶, /
;
¶¶/ 0
category
ßß 
.
ßß 
	UpdatedBy
ßß 
=
ßß  
User
ßß! %
.
ßß% &
Identity
ßß& .
.
ßß. /
Name
ßß/ 3
;
ßß3 4
_unitOfWork
™™ 
.
™™  
CategoryRepository
™™ *
.
™™* +
Update
™™+ 1
(
™™1 2
category
™™2 :
)
™™: ;
;
™™; <
var
´´ 

saveResult
´´ 
=
´´ 
await
´´ "
_unitOfWork
´´# .
.
´´. /
	SaveAsync
´´/ 8
(
´´8 9
)
´´9 :
;
´´: ;
if
≠≠ 
(
≠≠ 

saveResult
≠≠ 
<=
≠≠ 
$num
≠≠ 
)
≠≠  
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
{
∞∞ 
Message
±± 
=
±± 
$str
±± 9
,
±±9 :
	IsSuccess
≤≤ 
=
≤≤ 
false
≤≤  %
,
≤≤% &

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
,
≥≥$ %
Result
¥¥ 
=
¥¥ 
null
¥¥ !
}
µµ 
;
µµ 
}
∂∂ 
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
{
ππ 
Message
∫∫ 
=
∫∫ 
$str
∫∫ 9
,
∫∫9 :
	IsSuccess
ªª 
=
ªª 
true
ªª  
,
ªª  !

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
Result
ΩΩ 
=
ΩΩ 
category
ΩΩ !
.
ΩΩ! "
Id
ΩΩ" $
}
ææ 
;
ææ 
}
øø 	
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 	
return
¬¬ 
new
¬¬ 
ResponseDTO
¬¬ "
{
√√ 
Message
ƒƒ 
=
ƒƒ 
e
ƒƒ 
.
ƒƒ 
Message
ƒƒ #
,
ƒƒ# $
Result
≈≈ 
=
≈≈ 
null
≈≈ 
,
≈≈ 
	IsSuccess
∆∆ 
=
∆∆ 
false
∆∆ !
,
∆∆! "

StatusCode
«« 
=
«« 
$num
««  
}
»» 
;
»» 
}
…… 	
}
   
}ÀÀ ≠©
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CartService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public

 
class

 
CartService

 
:

 
ICartService

 '
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

CartService 
( 
IUnitOfWork "

unitOfWork# -
,- .
IMapper/ 6
mapper7 =
)= >
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetCart# *
(* +
ClaimsPrincipal+ :
User; ?
)? @
{ 
try 
{ 	
var 
userId 
= 
User 
. 
Claims $
.$ %
FirstOrDefault% 3
(3 4
x4 5
=>6 8
x9 :
.: ;
Type; ?
==@ B

ClaimTypesC M
.M N
NameIdentifierN \
)\ ]
?] ^
.^ _
Value_ d
;d e
var 
student 
= 
await 
_unitOfWork  +
.+ ,
StudentRepository, =
.= >
GetAsync> F
(F G
xG H
=>I K
xL M
.M N
UserIdN T
==U W
userIdX ^
)^ _
;_ `
if 
( 
student 
is 
null 
)  
{ 
return 
new 
ResponseDTO &
(& '
)' (
{ 
Message   
=   
$str   5
,  5 6
	IsSuccess!! 
=!! 
false!!  %
,!!% &

StatusCode"" 
=""  
$num""! $
,""$ %
Result## 
=## 
null## !
}$$ 
;$$ 
}%% 
var'' 

cartHeader'' 
='' 
await'' "
_unitOfWork''# .
.''. / 
CartHeaderRepository''/ C
.''C D
GetAsync''D L
(''L M
x''M N
=>''O Q
x''R S
.''S T
	StudentId''T ]
==''^ `
student''a h
.''h i
	StudentId''i r
)''r s
;''s t
if)) 
()) 

cartHeader)) 
is)) 
null)) "
)))" #
{** 

cartHeader++ 
=++ 
new++  

CartHeader++! +
(+++ ,
)++, -
{,, 
Id-- 
=-- 
Guid-- 
.-- 
NewGuid-- %
(--% &
)--& '
,--' (
	StudentId.. 
=.. 
student..  '
...' (
	StudentId..( 1
,..1 2

TotalPrice// 
=//  
$num//! "
}00 
;00 
await11 
_unitOfWork11 !
.11! " 
CartHeaderRepository11" 6
.116 7
AddAsync117 ?
(11? @

cartHeader11@ J
)11J K
;11K L
await22 
_unitOfWork22 !
.22! "
	SaveAsync22" +
(22+ ,
)22, -
;22- .
}33 
var55 
cartsDetails55 
=55 
await66 
_unitOfWork66 !
.66! "!
CartDetailsRepository66" 7
.667 8
GetAllAsync668 C
(66C D
x66D E
=>66F H
x66I J
.66J K
CartHeaderId66K W
==66X Z

cartHeader66[ e
.66e f
Id66f h
)66h i
;66i j
var88 
cartHeaderDto88 
=88 
_mapper88  '
.88' (
Map88( +
<88+ ,
CartHeaderDTO88, 9
>889 :
(88: ;

cartHeader88; E
)88E F
;88F G
var99 
cartDetailsDto99 
=99  
_mapper99! (
.99( )
Map99) ,
<99, -
IEnumerable99- 8
<998 9
CartDetailsDTO999 G
>99G H
>99H I
(99I J
cartsDetails99J V
)99V W
;99W X
cartHeaderDto:: 
.:: 
CartDetailsDtos:: )
=::* +
cartDetailsDto::, :
;::: ;
return<< 
new<< 
ResponseDTO<< "
(<<" #
)<<# $
{== 
Message>> 
=>> 
$str>> 1
,>>1 2
	IsSuccess?? 
=?? 
true??  
,??  !

StatusCode@@ 
=@@ 
$num@@  
,@@  !
ResultAA 
=AA 
cartHeaderDtoAA &
}BB 
;BB 
}CC 	
catchDD 
(DD 
	ExceptionDD 
eDD 
)DD 
{EE 	
returnFF 
newFF 
ResponseDTOFF "
(FF" #
)FF# $
{GG 
MessageHH 
=HH 
eHH 
.HH 
MessageHH #
,HH# $
	IsSuccessII 
=II 
falseII !
,II! "

StatusCodeJJ 
=JJ 
$numJJ  
,JJ  !
ResultKK 
=KK 
nullKK 
}LL 
;LL 
}MM 	
}NN 
publicPP 

asyncPP 
TaskPP 
<PP 
ResponseDTOPP !
>PP! "
	AddToCartPP# ,
(PP, -
ClaimsPrincipalPP- <
UserPP= A
,PPA B
AddToCartDTOPPC O
addToCartDtoPPP \
)PP\ ]
{QQ 
tryRR 
{SS 	
varTT 
userIdTT 
=TT 
UserTT 
.TT 
ClaimsTT $
.TT$ %
FirstOrDefaultTT% 3
(TT3 4
xTT4 5
=>TT6 8
xTT9 :
.TT: ;
TypeTT; ?
==TT@ B

ClaimTypesTTC M
.TTM N
NameIdentifierTTN \
)TT\ ]
?TT] ^
.TT^ _
ValueTT_ d
;TTd e
varVV 
studentVV 
=VV 
awaitVV 
_unitOfWorkVV  +
.VV+ ,
StudentRepositoryVV, =
.VV= >
GetAsyncVV> F
(VVF G
xVVG H
=>VVI K
xVVL M
.VVM N
UserIdVVN T
==VVU W
userIdVVX ^
)VV^ _
;VV_ `
ifWW 
(WW 
studentWW 
isWW 
nullWW 
)WW  
{XX 
returnYY 
newYY 
ResponseDTOYY &
(YY& '
)YY' (
{ZZ 
Message[[ 
=[[ 
$str[[ 5
,[[5 6
	IsSuccess\\ 
=\\ 
false\\  %
,\\% &

StatusCode]] 
=]]  
$num]]! $
,]]$ %
Result^^ 
=^^ 
null^^ !
}__ 
;__ 
}`` 
varbb 
coursebb 
=bb 
awaitbb 
_unitOfWorkbb *
.bb* +
CourseRepositorybb+ ;
.bb; <
GetAsyncbb< D
(bbD E
xbbE F
=>bbG I
xbbJ K
.bbK L
IdbbL N
==bbO Q
addToCartDtobbR ^
.bb^ _
CourseIdbb_ g
)bbg h
;bbh i
ifcc 
(cc 
coursecc 
iscc 
nullcc 
)cc 
{dd 
returnee 
newee 
ResponseDTOee &
(ee& '
)ee' (
{ff 
Messagegg 
=gg 
$strgg 4
,gg4 5
	IsSuccesshh 
=hh 
falsehh  %
,hh% &

StatusCodeii 
=ii  
$numii! $
,ii$ %
Resultjj 
=jj 
nulljj !
}kk 
;kk 
}ll 
varnn 
courseVersionnn 
=nn 
awaitnn  %
_unitOfWorknn& 1
.nn1 2#
CourseVersionRepositorynn2 I
.nnI J
GetAsyncnnJ R
(nnR S
xnnS T
=>nnU W
xnnX Y
.nnY Z
IdnnZ \
==nn] _
coursenn` f
.nnf g
CourseVersionIdnng v
)nnv w
;nnw x
ifoo 
(oo 
courseVersionoo 
isoo  
nulloo! %
)oo% &
{pp 
returnqq 
newqq 
ResponseDTOqq &
(qq& '
)qq' (
{rr 
Messagess 
=ss 
$strss <
,ss< =

StatusCodett 
=tt  
$numtt! $
,tt$ %
Resultuu 
=uu 
nulluu !
,uu! "
	IsSuccessvv 
=vv 
falsevv  %
}ww 
;ww 
}xx 
varzz 

cartHeaderzz 
=zz 
awaitzz "
_unitOfWorkzz# .
.zz. / 
CartHeaderRepositoryzz/ C
.zzC D
GetAsynczzD L
(zzL M
xzzM N
=>zzO Q
xzzR S
.zzS T
	StudentIdzzT ]
==zz^ `
studentzza h
.zzh i
	StudentIdzzi r
)zzr s
;zzs t
if{{ 
({{ 

cartHeader{{ 
is{{ 
null{{ "
){{" #
{|| 

cartHeader}} 
=}} 
new}}  

CartHeader}}! +
(}}+ ,
)}}, -
{~~ 
Id 
= 
Guid 
. 
NewGuid %
(% &
)& '
,' (
	StudentId
ÄÄ 
=
ÄÄ 
student
ÄÄ  '
.
ÄÄ' (
	StudentId
ÄÄ( 1
,
ÄÄ1 2

TotalPrice
ÅÅ 
=
ÅÅ  
$num
ÅÅ! "
}
ÇÇ 
;
ÇÇ 
await
ÉÉ 
_unitOfWork
ÉÉ !
.
ÉÉ! ""
CartHeaderRepository
ÉÉ" 6
.
ÉÉ6 7
AddAsync
ÉÉ7 ?
(
ÉÉ? @

cartHeader
ÉÉ@ J
)
ÉÉJ K
;
ÉÉK L
await
ÑÑ 
_unitOfWork
ÑÑ !
.
ÑÑ! "
	SaveAsync
ÑÑ" +
(
ÑÑ+ ,
)
ÑÑ, -
;
ÑÑ- .
}
ÖÖ 
var
áá 
cartDetails
áá 
=
áá 
await
àà 
_unitOfWork
àà !
.
àà! "#
CartDetailsRepository
àà" 7
.
àà7 8
GetAsync
àà8 @
(
ââ 
filter
ää 
:
ää 
x
ää 
=>
ää  
x
ää! "
.
ää" #
CartHeaderId
ää# /
==
ää0 2

cartHeader
ää3 =
.
ää= >
Id
ää> @
&&
ääA C
x
ääD E
.
ääE F
CourseId
ääF N
==
ääO Q
course
ääR X
.
ääX Y
Id
ääY [
)
ãã 
;
ãã 
if
çç 
(
çç 
cartDetails
çç 
is
çç 
not
çç "
null
çç# '
)
çç' (
{
éé 
return
èè 
new
èè 
ResponseDTO
èè &
(
èè& '
)
èè' (
{
êê 
	IsSuccess
ëë 
=
ëë 
true
ëë  $
,
ëë$ %
Result
íí 
=
íí 
null
íí !
,
íí! "

StatusCode
ìì 
=
ìì  
$num
ìì! $
,
ìì$ %
Message
îî 
=
îî 
$str
îî A
}
ïï 
;
ïï 
}
ññ 
cartDetails
òò 
=
òò 
new
òò 
CartDetails
òò )
(
òò) *
)
òò* +
{
ôô 
Id
öö 
=
öö 
Guid
öö 
.
öö 
NewGuid
öö !
(
öö! "
)
öö" #
,
öö# $
CartHeaderId
õõ 
=
õõ 

cartHeader
õõ )
.
õõ) *
Id
õõ* ,
,
õõ, -
CourseId
úú 
=
úú 
course
úú !
.
úú! "
Id
úú" $
,
úú$ %
CoursePrice
ùù 
=
ùù 
courseVersion
ùù +
.
ùù+ ,
Price
ùù, 1
,
ùù1 2
CourseTitle
ûû 
=
ûû 
courseVersion
ûû +
.
ûû+ ,
Title
ûû, 1
}
üü 
;
üü 

cartHeader
°° 
.
°° 

TotalPrice
°° !
+=
°°" $
cartDetails
°°% 0
.
°°0 1
CoursePrice
°°1 <
;
°°< =
_unitOfWork
¢¢ 
.
¢¢ "
CartHeaderRepository
¢¢ ,
.
¢¢, -
Update
¢¢- 3
(
¢¢3 4

cartHeader
¢¢4 >
)
¢¢> ?
;
¢¢? @
await
§§ 
_unitOfWork
§§ 
.
§§ #
CartDetailsRepository
§§ 3
.
§§3 4
AddAsync
§§4 <
(
§§< =
cartDetails
§§= H
)
§§H I
;
§§I J
await
•• 
_unitOfWork
•• 
.
•• 
	SaveAsync
•• '
(
••' (
)
••( )
;
••) *
return
ßß 
new
ßß 
ResponseDTO
ßß "
(
ßß" #
)
ßß# $
{
®® 
Message
©© 
=
©© 
$str
©© ;
,
©©; <
	IsSuccess
™™ 
=
™™ 
true
™™  
,
™™  !

StatusCode
´´ 
=
´´ 
$num
´´  
,
´´  !
Result
¨¨ 
=
¨¨ 
addToCartDto
¨¨ %
}
≠≠ 
;
≠≠ 
}
ÆÆ 	
catch
ØØ 
(
ØØ 
	Exception
ØØ 
e
ØØ 
)
ØØ 
{
∞∞ 	
return
±± 
new
±± 
ResponseDTO
±± "
(
±±" #
)
±±# $
{
≤≤ 
Message
≥≥ 
=
≥≥ 
e
≥≥ 
.
≥≥ 
Message
≥≥ #
,
≥≥# $
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥ !
,
¥¥! "

StatusCode
µµ 
=
µµ 
$num
µµ  
,
µµ  !
Result
∂∂ 
=
∂∂ 
null
∂∂ 
}
∑∑ 
;
∑∑ 
}
∏∏ 	
}
ππ 
public
ªª 

async
ªª 
Task
ªª 
<
ªª 
ResponseDTO
ªª !
>
ªª! "
RemoveFromCart
ªª# 1
(
ªª1 2
ClaimsPrincipal
ªª2 A
User
ªªB F
,
ªªF G
Guid
ªªH L
courseId
ªªM U
)
ªªU V
{
ºº 
try
ΩΩ 
{
ææ 	
var
øø 
userId
øø 
=
øø 
User
øø 
.
øø 
Claims
øø $
.
øø$ %
FirstOrDefault
øø% 3
(
øø3 4
x
øø4 5
=>
øø6 8
x
øø9 :
.
øø: ;
Type
øø; ?
==
øø@ B

ClaimTypes
øøC M
.
øøM N
NameIdentifier
øøN \
)
øø\ ]
?
øø] ^
.
øø^ _
Value
øø_ d
;
øød e
var
¡¡ 
student
¡¡ 
=
¡¡ 
await
¡¡ 
_unitOfWork
¡¡  +
.
¡¡+ ,
StudentRepository
¡¡, =
.
¡¡= >
GetAsync
¡¡> F
(
¬¬ 
filter
√√ 
:
√√ 
x
√√ 
=>
√√ 
x
√√ 
.
√√ 
UserId
√√ %
==
√√& (
userId
√√) /
)
ƒƒ 
;
ƒƒ 
if
≈≈ 
(
≈≈ 
student
≈≈ 
is
≈≈ 
null
≈≈ 
)
≈≈  
{
∆∆ 
return
«« 
new
«« 
ResponseDTO
«« &
(
««& '
)
««' (
{
»» 
Message
…… 
=
…… 
$str
…… 5
,
……5 6
	IsSuccess
   
=
   
false
    %
,
  % &

StatusCode
ÀÀ 
=
ÀÀ  
$num
ÀÀ! $
,
ÀÀ$ %
Result
ÃÃ 
=
ÃÃ 
null
ÃÃ !
}
ÕÕ 
;
ÕÕ 
}
ŒŒ 
var
–– 

cartHeader
–– 
=
–– 
await
–– "
_unitOfWork
––# .
.
––. /"
CartHeaderRepository
––/ C
.
––C D
GetAsync
––D L
(
—— 
filter
““ 
:
““ 
x
““ 
=>
““ 
x
““ 
.
““ 
	StudentId
““ (
==
““) +
student
““, 3
.
““3 4
	StudentId
““4 =
)
”” 
;
”” 
if
‘‘ 
(
‘‘ 

cartHeader
‘‘ 
is
‘‘ 
null
‘‘ "
)
‘‘" #
{
’’ 

cartHeader
÷÷ 
=
÷÷ 
new
÷÷  

CartHeader
÷÷! +
(
÷÷+ ,
)
÷÷, -
{
◊◊ 
Id
ÿÿ 
=
ÿÿ 
Guid
ÿÿ 
.
ÿÿ 
NewGuid
ÿÿ %
(
ÿÿ% &
)
ÿÿ& '
,
ÿÿ' (
	StudentId
ŸŸ 
=
ŸŸ 
student
ŸŸ  '
.
ŸŸ' (
	StudentId
ŸŸ( 1
,
ŸŸ1 2

TotalPrice
⁄⁄ 
=
⁄⁄  
$num
⁄⁄! "
}
€€ 
;
€€ 
await
‹‹ 
_unitOfWork
‹‹ !
.
‹‹! ""
CartHeaderRepository
‹‹" 6
.
‹‹6 7
AddAsync
‹‹7 ?
(
‹‹? @

cartHeader
‹‹@ J
)
‹‹J K
;
‹‹K L
await
›› 
_unitOfWork
›› !
.
››! "
	SaveAsync
››" +
(
››+ ,
)
››, -
;
››- .
return
ﬂﬂ 
new
ﬂﬂ 
ResponseDTO
ﬂﬂ &
(
ﬂﬂ& '
)
ﬂﬂ' (
{
‡‡ 
Message
·· 
=
·· 
$str
·· 2
,
··2 3

StatusCode
‚‚ 
=
‚‚  
$num
‚‚! $
,
‚‚$ %
Result
„„ 
=
„„ 
null
„„ !
,
„„! "
	IsSuccess
‰‰ 
=
‰‰ 
false
‰‰  %
}
ÂÂ 
;
ÂÂ 
}
ÊÊ 
var
ËË 
cartDetails
ËË 
=
ËË 
await
ËË #
_unitOfWork
ËË$ /
.
ËË/ 0#
CartDetailsRepository
ËË0 E
.
ËËE F
GetAsync
ËËF N
(
ÈÈ 
filter
ÍÍ 
:
ÍÍ 
x
ÍÍ 
=>
ÍÍ 
x
ÍÍ 
.
ÍÍ 
CourseId
ÍÍ '
==
ÍÍ( *
courseId
ÍÍ+ 3
&&
ÍÍ4 6
x
ÍÍ7 8
.
ÍÍ8 9
CartHeaderId
ÍÍ9 E
==
ÍÍF H

cartHeader
ÍÍI S
.
ÍÍS T
Id
ÍÍT V
)
ÎÎ 
;
ÎÎ 
if
ÏÏ 
(
ÏÏ 
cartDetails
ÏÏ 
is
ÏÏ 
null
ÏÏ #
)
ÏÏ# $
{
ÌÌ 
return
ÓÓ 
new
ÓÓ 
ResponseDTO
ÓÓ &
(
ÓÓ& '
)
ÓÓ' (
{
ÔÔ 
Message
 
=
 
$str
 B
,
B C

StatusCode
ÒÒ 
=
ÒÒ  
$num
ÒÒ! $
,
ÒÒ$ %
Result
ÚÚ 
=
ÚÚ 
null
ÚÚ !
,
ÚÚ! "
	IsSuccess
ÛÛ 
=
ÛÛ 
false
ÛÛ  %
}
ÙÙ 
;
ÙÙ 
}
ıı 

cartHeader
˜˜ 
.
˜˜ 

TotalPrice
˜˜ !
-=
˜˜" $
cartDetails
˜˜% 0
.
˜˜0 1
CoursePrice
˜˜1 <
;
˜˜< =
_unitOfWork
¯¯ 
.
¯¯ "
CartHeaderRepository
¯¯ ,
.
¯¯, -
Update
¯¯- 3
(
¯¯3 4

cartHeader
¯¯4 >
)
¯¯> ?
;
¯¯? @
_unitOfWork
˙˙ 
.
˙˙ #
CartDetailsRepository
˙˙ -
.
˙˙- .
Remove
˙˙. 4
(
˙˙4 5
cartDetails
˙˙5 @
)
˙˙@ A
;
˙˙A B
await
˚˚ 
_unitOfWork
˚˚ 
.
˚˚ 
	SaveAsync
˚˚ '
(
˚˚' (
)
˚˚( )
;
˚˚) *
return
˝˝ 
new
˝˝ 
ResponseDTO
˝˝ "
(
˝˝" #
)
˝˝# $
{
˛˛ 
Message
ˇˇ 
=
ˇˇ 
$str
ˇˇ >
,
ˇˇ> ?
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  
,
ÄÄ  !

StatusCode
ÅÅ 
=
ÅÅ 
$num
ÅÅ  
,
ÅÅ  !
Result
ÇÇ 
=
ÇÇ 
null
ÇÇ 
}
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 	
return
áá 
new
áá 
ResponseDTO
áá "
(
áá" #
)
áá# $
{
àà 
Message
ââ 
=
ââ 
e
ââ 
.
ââ 
Message
ââ #
,
ââ# $
	IsSuccess
ää 
=
ää 
false
ää !
,
ää! "

StatusCode
ãã 
=
ãã 
$num
ãã  
,
ãã  !
Result
åå 
=
åå 
null
åå 
}
çç 
;
çç 
}
éé 	
}
èè 
public
ëë 

Task
ëë 
<
ëë 
ResponseDTO
ëë 
>
ëë 
Checkout
ëë %
(
ëë% &
ClaimsPrincipal
ëë& 5
User
ëë6 :
)
ëë: ;
{
íí 
throw
ìì 
new
ìì %
NotImplementedException
ìì )
(
ìì) *
)
ìì* +
;
ìì+ ,
}
îî 
}ïï ö>
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\BaseService.cs
	namespace		 	
Cursus		
 
.		 
LMS		 
.		 
Service		 
.		 
Service		 $
;		$ %
public 
class 
BaseService 
: 
IBaseService '
{ 
private 
readonly 
IHttpClientFactory '
_httpClientFactory( :
;: ;
public 

BaseService 
( 
IHttpClientFactory )
httpClientFactory* ;
); <
{ 
_httpClientFactory 
= 
httpClientFactory .
;. /
} 
public 

async 
Task 
< 
ResponseDTO !
?! "
>" #
	SendAsync$ -
(- .

RequestDTO. 8

RequestDTO9 C
,C D
stringE K
?K L
apiKeyM S
)S T
{ 
try 
{ 	

HttpClient 
client 
= 
_httpClientFactory  2
.2 3
CreateClient3 ?
(? @
$str@ K
)K L
;L M
HttpRequestMessage 
message &
=' (
new) ,
(, -
)- .
;. /
message 
. 
Headers 
. 
Add 
(  
$str  (
,( )
$str* <
)< =
;= >
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
apiKey& ,
), -
)- .
{ 
var 
token 
= 
apiKey "
;" #
message   
.   
Headers   
.    
Add    #
(  # $
$str  $ 3
,  3 4
$"  5 7
$str  7 >
{  > ?
token  ? D
}  D E
"  E F
)  F G
;  G H
}!! 
message## 
.## 

RequestUri## 
=##  
new##! $
Uri##% (
(##( )

RequestDTO##) 3
.##3 4
Url##4 7
)##7 8
;##8 9
if%% 
(%% 

RequestDTO%% 
.%% 
Data%% 
is%%  "
not%%# &
null%%' +
)%%+ ,
{&& 
message'' 
.'' 
Content'' 
=''  !
new''" %
StringContent''& 3
(''3 4
JsonConvert''4 ?
.''? @
SerializeObject''@ O
(''O P

RequestDTO''P Z
.''Z [
Data''[ _
)''_ `
,''` a
Encoding''b j
.''j k
UTF8''k o
,''o p
$str(( &
)((& '
;((' (
})) 
HttpResponseMessage++ 
?++  
responseMessage++! 0
=++1 2
null++3 7
;++7 8
switch-- 
(-- 

RequestDTO-- 
.-- 
ApiType-- &
)--& '
{.. 
case// 

StaticEnum// 
.//  
ApiType//  '
.//' (
GET//( +
://+ ,
{00 
message11 
.11 
Method11 "
=11# $

HttpMethod11% /
.11/ 0
Get110 3
;113 4
break22 
;22 
}33 
case44 

StaticEnum44 
.44  
ApiType44  '
.44' (
POST44( ,
:44, -
{55 
message66 
.66 
Method66 "
=66# $

HttpMethod66% /
.66/ 0
Post660 4
;664 5
break77 
;77 
}88 
case99 

StaticEnum99 
.99  
ApiType99  '
.99' (
PUT99( +
:99+ ,
{:: 
message;; 
.;; 
Method;; "
=;;# $

HttpMethod;;% /
.;;/ 0
Put;;0 3
;;;3 4
break<< 
;<< 
}== 
case>> 

StaticEnum>> 
.>>  
ApiType>>  '
.>>' (
DELETE>>( .
:>>. /
{?? 
message@@ 
.@@ 
Method@@ "
=@@# $

HttpMethod@@% /
.@@/ 0
Delete@@0 6
;@@6 7
breakAA 
;AA 
}BB 
}CC 
responseMessageEE 
=EE 
awaitEE #
clientEE$ *
.EE* +
	SendAsyncEE+ 4
(EE4 5
messageEE5 <
)EE< =
;EE= >
switchGG 
(GG 
responseMessageGG #
.GG# $

StatusCodeGG$ .
)GG. /
{HH 
caseII 
HttpStatusCodeII #
.II# $
NotFoundII$ ,
:II, -
{JJ 
returnKK 
newKK 
(KK 
)KK  
{LL 
	IsSuccessMM !
=MM" #
falseMM$ )
,MM) *
MessageNN 
=NN  !
$strNN" -
,NN- .
}OO 
;OO 
}PP 
caseQQ 
HttpStatusCodeQQ #
.QQ# $
	ForbiddenQQ$ -
:QQ- .
{RR 
returnSS 
newSS 
(SS 
)SS  
{TT 
	IsSuccessUU !
=UU" #
falseUU$ )
,UU) *
MessageVV 
=VV  !
$strVV" -
,VV- .
}WW 
;WW 
}XX 
caseYY 
HttpStatusCodeYY #
.YY# $
UnauthorizedYY$ 0
:YY0 1
{ZZ 
return[[ 
new[[ 
([[ 
)[[  
{\\ 
	IsSuccess]] !
=]]" #
false]]$ )
,]]) *
Message^^ 
=^^  !
$str^^" 0
,^^0 1
}__ 
;__ 
}`` 
caseaa 
HttpStatusCodeaa #
.aa# $

BadRequestaa$ .
:aa. /
{bb 
returncc 
newcc 
(cc 
)cc  
{dd 
	IsSuccessee !
=ee" #
falseee$ )
,ee) *
Messageff 
=ff  !
$strff" .
,ff. /
}gg 
;gg 
}hh 
caseii 
HttpStatusCodeii #
.ii# $
InternalServerErrorii$ 7
:ii7 8
{jj 
returnkk 
newkk 
(kk 
)kk  
{ll 
	IsSuccessmm !
=mm" #
falsemm$ )
,mm) *
Messagenn 
=nn  !
$strnn" 7
,nn7 8
}oo 
;oo 
}pp 
defaultqq 
:qq 
{rr 
varss 

apiContentss "
=ss# $
awaitss% *
responseMessagess+ :
.ss: ;
Contentss; B
.ssB C
ReadAsStringAsyncssC T
(ssT U
)ssU V
;ssV W
varuu 
apiResponseDTOuu &
=uu' (
JsonConvertuu) 4
.uu4 5
DeserializeObjectuu5 F
<uuF G
ResponseDTOuuG R
>uuR S
(uuS T

apiContentuuT ^
)uu^ _
;uu_ `
returnvv 
apiResponseDTOvv )
;vv) *
}ww 
}xx 
}yy 	
catchzz 
(zz 
	Exceptionzz 
ezz 
)zz 
{{{ 	
return|| 
new|| 
(|| 
)|| 
{}} 
Message~~ 
=~~ 
e~~ 
.~~ 
Message~~ #
.~~# $
ToString~~$ ,
(~~, -
)~~- .
,~~. /
	IsSuccess 
= 
false !
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
}ÉÉ ò'
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\BalanceService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
BalanceService 
: 
IBalanceService -
{		 
private

 
readonly

 
IUnitOfWork

  
_unitOfWork

! ,
;

, -
public 

BalanceService 
( 
IUnitOfWork %

unitOfWork& 0
)0 1
{ 
_unitOfWork 
= 

unitOfWork  
;  !
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
UpsertBalance# 0
(0 1
UpsertBalanceDTO1 A
upsertBalanceDtoB R
)R S
{ 
try 
{ 	
var 
balance 
= 
await 
_unitOfWork  +
.+ ,
BalanceRepository, =
.= >
GetAsync> F
(F G
xG H
=>I K
xL M
.M N
UserIdN T
==U W
upsertBalanceDtoX h
.h i
UserIdi o
)o p
;p q
if 
( 
balance 
is 
null 
)  
{ 
balance 
= 
new 
Balance %
(% &
)& '
{ 
Currency 
= 
$str $
,$ %
UserId 
= 
upsertBalanceDto -
.- .
UserId. 4
,4 5
TotalBalance  
=! "
upsertBalanceDto# 3
.3 4
TotalBalance4 @
,@ A
AvailableBalance $
=% &
upsertBalanceDto' 7
.7 8
AvailableBalance8 H
,H I
PayoutBalance !
=" #
upsertBalanceDto$ 4
.4 5
PayoutBalance5 B
,B C
UpdatedTime 
=  !
DateTime" *
.* +
UtcNow+ 1
}   
;   
await"" 
_unitOfWork"" !
.""! "
BalanceRepository""" 3
.""3 4
AddAsync""4 <
(""< =
balance""= D
)""D E
;""E F
await## 
_unitOfWork## !
.##! "
	SaveAsync##" +
(##+ ,
)##, -
;##- .
return%% 
new%% 
ResponseDTO%% &
(%%& '
)%%' (
{&& 
	IsSuccess'' 
='' 
true''  $
,''$ %
Message(( 
=(( 
$str(( ;
,((; <
Result)) 
=)) 
null)) !
,))! "

StatusCode** 
=**  
$num**! $
}++ 
;++ 
},, 
balance.. 
... 
TotalBalance..  
+=..! #
upsertBalanceDto..$ 4
...4 5
TotalBalance..5 A
;..A B
balance// 
.// 
AvailableBalance// $
+=//% '
upsertBalanceDto//( 8
.//8 9
AvailableBalance//9 I
;//I J
balance00 
.00 
PayoutBalance00 !
+=00" $
upsertBalanceDto00% 5
.005 6
PayoutBalance006 C
;00C D
balance11 
.11 
UpdatedTime11 
=11  !
DateTime11" *
.11* +
UtcNow11+ 1
;111 2
_unitOfWork33 
.33 
BalanceRepository33 )
.33) *
Update33* 0
(330 1
balance331 8
)338 9
;339 :
await44 
_unitOfWork44 
.44 
	SaveAsync44 '
(44' (
)44( )
;44) *
return66 
new66 
ResponseDTO66 "
(66" #
)66# $
{77 
	IsSuccess88 
=88 
true88  
,88  !
Message99 
=99 
$str99 7
,997 8
Result:: 
=:: 
null:: 
,:: 

StatusCode;; 
=;; 
$num;;  
}<< 
;<< 
}== 	
catch>> 
(>> 
	Exception>> 
e>> 
)>> 
{?? 	
return@@ 
new@@ 
ResponseDTO@@ "
(@@" #
)@@# $
{AA 
	IsSuccessBB 
=BB 
falseBB !
,BB! "
MessageCC 
=CC 
eCC 
.CC 
MessageCC #
,CC# $
ResultDD 
=DD 
nullDD 
,DD 

StatusCodeEE 
=EE 
$numEE  
}FF 
;FF 
}GG 	
}HH 
}II „ù
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\AuthService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
AuthService 
: 
IAuthService '
{ 
private 
readonly "
IUserManagerRepository +"
_userManagerRepository, B
;B C
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
RoleManager  
<  !
IdentityRole! -
>- .
_roleManager/ ;
;; <
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
ITokenService "
_tokenService# 0
;0 1
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IEmailService "
_emailService# 0
;0 1
private   
readonly   
IFirebaseService   %
_firebaseService  & 6
;  6 7
private!! 
readonly!!  
IHttpContextAccessor!! ) 
_httpContextAccessor!!* >
;!!> ?
private## 
static## 
readonly##  
ConcurrentDictionary## 0
<##0 1
string##1 7
,##7 8
(##9 :
int##: =
Count##> C
,##C D
DateTime##E M
LastRequest##N Y
)##Y Z
>##Z [!
ResetPasswordAttempts##\ q
=##r s
new$$ 
($$ 
)$$ 
;$$ 
public&& 

AuthService&& 
(&& "
IUserManagerRepository'' !
userManagerRepository'' 4
,''4 5
UserManager(( 
<(( 
ApplicationUser(( #
>((# $
userManager((% 0
,((0 1
RoleManager)) 
<)) 
IdentityRole))  
>))  !
roleManager))" -
,))- .
IConfiguration** 
configuration** $
,**$ %
IMapper++ 
mapper++ 
,++ 
IEmailService,, 
emailService,, "
,,," #
IFirebaseService-- 
firebaseService-- (
,--( ) 
IHttpContextAccessor.. 
httpContextAccessor.. 0
,..0 1
ITokenService// 
tokenService// "
,//" #
IUnitOfWork//$ /

unitOfWork//0 :
)//: ;
{00 "
_userManagerRepository11 
=11  !
userManagerRepository11! 6
;116 7
_userManager22 
=22 
userManager22 "
;22" #
_roleManager33 
=33 
roleManager33 "
;33" #
_configuration44 
=44 
configuration44 &
;44& '
_mapper55 
=55 
mapper55 
;55 
_emailService66 
=66 
emailService66 $
;66$ %
_firebaseService77 
=77 
firebaseService77 *
;77* + 
_httpContextAccessor88 
=88 
httpContextAccessor88 2
;882 3
_tokenService99 
=99 
tokenService99 $
;99$ %
_unitOfWork:: 
=:: 

unitOfWork::  
;::  !
};; 
public== 

AuthService== 
(== 
UserManager== "
<==" #
ApplicationUser==# 2
>==2 3
object1==4 ;
,==; <
RoleManager=== H
<==H I
IdentityRole==I U
>==U V
object2==W ^
,==^ _
IConfiguration==` n
object3==o v
,==v w
IMapper>> 
object4>> 
,>> 
IEmailService>> &
object5>>' .
,>>. /
IFirebaseService>>0 @
object6>>A H
,>>H I 
IHttpContextAccessor>>J ^
object7>>_ f
,>>f g
ITokenService?? 
object9?? 
,?? 
IUnitOfWork?? *
object10??+ 3
)??3 4
{@@ 
}AA 
publicCC 

asyncCC 
TaskCC 
<CC 
ResponseDTOCC !
>CC! "
SignUpStudentCC# 0
(CC0 1
RegisterStudentDTOCC1 C
registerStudentDTOCCD V
)CCV W
{DD 
tryEE 
{FF 	
varGG 
isEmailExitGG 
=GG 
awaitGG #"
_userManagerRepositoryGG$ :
.GG: ;
FindByEmailAsyncGG; K
(GGK L
registerStudentDTOGGL ^
.GG^ _
EmailGG_ d
)GGd e
;GGe f
ifHH 
(HH 
isEmailExitHH 
isHH 
notHH "
nullHH# '
)HH' (
{II 
returnJJ 
newJJ 
ResponseDTOJJ &
(JJ& '
)JJ' (
{KK 
MessageLL 
=LL 
$strLL >
,LL> ?
ResultMM 
=MM 
registerStudentDTOMM /
,MM/ 0
	IsSuccessNN 
=NN 
falseNN  %
,NN% &

StatusCodeOO 
=OO  
$numOO! $
}PP 
;PP 
}QQ 
varSS 
isPhonenumerExitSS  
=SS! "
awaitTT "
_userManagerRepositoryTT ,
.TT, -)
CheckIfPhoneNumberExistsAsyncTT- J
(TTJ K
registerStudentDTOTTK ]
.TT] ^
PhoneNumberTT^ i
)TTi j
;TTj k
ifUU 
(UU 
isPhonenumerExitUU  
)UU  !
{VV 
returnWW 
newWW 
ResponseDTOWW &
(WW& '
)WW' (
{XX 
MessageYY 
=YY 
$strYY E
,YYE F
ResultZZ 
=ZZ 
registerStudentDTOZZ /
,ZZ/ 0
	IsSuccess[[ 
=[[ 
false[[  %
,[[% &

StatusCode\\ 
=\\  
$num\\! $
}]] 
;]] 
}^^ 
var`` 
isCardExist`` 
=`` 
awaitaa 
_unitOfWorkaa !
.aa! "!
PaymentCardRepositoryaa" 7
.aa7 8!
CardNumberExistsAsyncaa8 M
(aaM N
registerStudentDTOaaN `
.aa` a

CardNumberaaa k
)aak l
;aal m
ifbb 
(bb 
isCardExistbb 
isbb 
notbb "
nullbb# '
)bb' (
{cc 
returndd 
newdd 
ResponseDTOdd &
(dd& '
)dd' (
{ee 
Messageff 
=ff 
$strff D
,ffD E

StatusCodegg 
=gg  
$numgg! $
,gg$ %
Resulthh 
=hh 
registerStudentDTOhh /
,hh/ 0
	IsSuccessii 
=ii 
falseii  %
}jj 
;jj 
}kk 
ApplicationUsernn 
newUsernn #
=nn$ %
newnn& )
ApplicationUsernn* 9
(nn9 :
)nn: ;
{oo 
Addresspp 
=pp 
registerStudentDTOpp ,
.pp, -
Addresspp- 4
,pp4 5
Emailqq 
=qq 
registerStudentDTOqq *
.qq* +
Emailqq+ 0
,qq0 1
	BirthDaterr 
=rr 
registerStudentDTOrr .
.rr. /
	BirthDaterr/ 8
,rr8 9
UserNamess 
=ss 
registerStudentDTOss -
.ss- .
Emailss. 3
,ss3 4
FullNamett 
=tt 
registerStudentDTOtt -
.tt- .
FullNamett. 6
,tt6 7
Genderuu 
=uu 
registerStudentDTOuu +
.uu+ ,
Genderuu, 2
,uu2 3
Countryvv 
=vv 
registerStudentDTOvv ,
.vv, -
Countryvv- 4
,vv4 5
PhoneNumberww 
=ww 
registerStudentDTOww 0
.ww0 1
PhoneNumberww1 <
,ww< =

UpdateTimexx 
=xx 
DateTimexx %
.xx% &
Nowxx& )
,xx) *
	AvatarUrlyy 
=yy 
$stryy 
,yy 
	TaxNumberzz 
=zz 
$strzz 
}{{ 
;{{ 
var~~ 
createUserResult~~  
=~~! "
await~~# ("
_userManagerRepository~~) ?
.~~? @
CreateAsync~~@ K
(~~K L
newUser~~L S
,~~S T
registerStudentDTO~~U g
.~~g h
Password~~h p
)~~p q
;~~q r
if
ÅÅ 
(
ÅÅ 
!
ÅÅ 
createUserResult
ÅÅ !
.
ÅÅ! "
	Succeeded
ÅÅ" +
)
ÅÅ+ ,
{
ÇÇ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ &
(
ÑÑ& '
)
ÑÑ' (
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
createUserResult
ÜÜ .
.
ÜÜ. /
Errors
ÜÜ/ 5
.
ÜÜ5 6
ToString
ÜÜ6 >
(
ÜÜ> ?
)
ÜÜ? @
,
ÜÜ@ A
	IsSuccess
áá 
=
áá 
false
áá  %
,
áá% &

StatusCode
àà 
=
àà  
$num
àà! $
,
àà$ %
Result
ââ 
=
ââ  
registerStudentDTO
ââ /
}
ää 
;
ää 
}
ãã 
var
çç 
user
çç 
=
çç 
await
çç $
_userManagerRepository
çç 3
.
çç3 4
FindByPhoneAsync
çç4 D
(
ççD E 
registerStudentDTO
ççE W
.
ççW X
PhoneNumber
ççX c
)
ççc d
;
ççd e
Student
èè 
student
èè 
=
èè 
new
èè !
Student
èè" )
(
èè) *
)
èè* +
{
êê 
UserId
ëë 
=
ëë 
user
ëë 
.
ëë 
Id
ëë  
,
ëë  !

University
íí 
=
íí  
registerStudentDTO
íí /
.
íí/ 0

University
íí0 :
}
ìì 
;
ìì 
PaymentCard
ïï 
paymentCard
ïï #
=
ïï$ %
new
ïï& )
PaymentCard
ïï* 5
(
ïï5 6
)
ïï6 7
{
ññ 
CardName
óó 
=
óó  
registerStudentDTO
óó -
.
óó- .
CardName
óó. 6
,
óó6 7

CardNumber
òò 
=
òò  
registerStudentDTO
òò /
.
òò/ 0

CardNumber
òò0 :
,
òò: ;
CardProvider
ôô 
=
ôô  
registerStudentDTO
ôô 1
.
ôô1 2
CardProvider
ôô2 >
,
ôô> ?
UserId
öö 
=
öö 
user
öö 
.
öö 
Id
öö  
}
õõ 
;
õõ 
var
ûû 
isRoleExist
ûû 
=
ûû 
await
ûû #
_roleManager
ûû$ 0
.
ûû0 1
RoleExistsAsync
ûû1 @
(
ûû@ A
StaticUserRoles
ûûA P
.
ûûP Q
Student
ûûQ X
)
ûûX Y
;
ûûY Z
if
°° 
(
°° 
isRoleExist
°° 
is
°° 
false
°° $
)
°°$ %
{
¢¢ 
await
££ 
_roleManager
££ "
.
££" #
CreateAsync
££# .
(
££. /
new
££/ 2
IdentityRole
££3 ?
(
££? @
StaticUserRoles
££@ O
.
££O P
Student
££P W
)
££W X
)
££X Y
;
££Y Z
}
§§ 
var
ßß 
	isRoleAdd
ßß 
=
ßß 
await
ßß !$
_userManagerRepository
ßß" 8
.
ßß8 9
AddToRoleAsync
ßß9 G
(
ßßG H
user
ßßH L
,
ßßL M
StaticUserRoles
ßßN ]
.
ßß] ^
Student
ßß^ e
)
ßße f
;
ßßf g
if
©© 
(
©© 
!
©© 
	isRoleAdd
©© 
.
©© 
	Succeeded
©© $
)
©©$ %
{
™™ 
return
´´ 
new
´´ 
ResponseDTO
´´ &
(
´´& '
)
´´' (
{
¨¨ 
Message
≠≠ 
=
≠≠ 
$str
≠≠ 1
,
≠≠1 2
	IsSuccess
ÆÆ 
=
ÆÆ 
false
ÆÆ  %
,
ÆÆ% &

StatusCode
ØØ 
=
ØØ  
$num
ØØ! $
,
ØØ$ %
Result
∞∞ 
=
∞∞  
registerStudentDTO
∞∞ /
}
±± 
;
±± 
}
≤≤ 
var
µµ 
isStudentAdd
µµ 
=
µµ 
await
µµ $
_unitOfWork
µµ% 0
.
µµ0 1
StudentRepository
µµ1 B
.
µµB C
AddAsync
µµC K
(
µµK L
student
µµL S
)
µµS T
;
µµT U
if
∂∂ 
(
∂∂ 
isStudentAdd
∂∂ 
==
∂∂ 
null
∂∂  $
)
∂∂$ %
{
∑∑ 
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ &
(
∏∏& '
)
∏∏' (
{
ππ 
Message
∫∫ 
=
∫∫ 
$str
∫∫ 5
,
∫∫5 6
	IsSuccess
ªª 
=
ªª 
false
ªª  %
,
ªª% &

StatusCode
ºº 
=
ºº  
$num
ºº! $
,
ºº$ %
Result
ΩΩ 
=
ΩΩ  
registerStudentDTO
ΩΩ /
}
ææ 
;
ææ 
}
øø 
var
¬¬ 
isPaymentAdd
¬¬ 
=
¬¬ 
await
¬¬ $
_unitOfWork
¬¬% 0
.
¬¬0 1#
PaymentCardRepository
¬¬1 F
.
¬¬F G
AddAsync
¬¬G O
(
¬¬O P
paymentCard
¬¬P [
)
¬¬[ \
;
¬¬\ ]
if
√√ 
(
√√ 
isPaymentAdd
√√ 
==
√√ 
null
√√  $
)
√√$ %
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
(
≈≈& '
)
≈≈' (
{
∆∆ 
Message
«« 
=
«« 
$str
«« :
,
««: ;
	IsSuccess
»» 
=
»» 
false
»»  %
,
»»% &

StatusCode
…… 
=
……  
$num
……! $
,
……$ %
Result
   
=
    
registerStudentDTO
   /
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
var
œœ 
	isSuccess
œœ 
=
œœ 
await
œœ !
_unitOfWork
œœ" -
.
œœ- .
	SaveAsync
œœ. 7
(
œœ7 8
)
œœ8 9
;
œœ9 :
if
–– 
(
–– 
	isSuccess
–– 
<=
–– 
$num
–– 
)
–– 
{
—— 
return
““ 
new
““ 
ResponseDTO
““ &
(
““& '
)
““' (
{
”” 
Message
‘‘ 
=
‘‘ 
$str
‘‘ F
,
‘‘F G
	IsSuccess
’’ 
=
’’ 
false
’’  %
,
’’% &

StatusCode
÷÷ 
=
÷÷  
$num
÷÷! $
,
÷÷$ %
Result
◊◊ 
=
◊◊  
registerStudentDTO
◊◊ /
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
return
‹‹ 
new
‹‹ 
ResponseDTO
‹‹ "
(
‹‹" #
)
‹‹# $
{
›› 
Message
ﬁﬁ 
=
ﬁﬁ 
$str
ﬁﬁ 8
,
ﬁﬁ8 9
	IsSuccess
ﬂﬂ 
=
ﬂﬂ 
true
ﬂﬂ  
,
ﬂﬂ  !

StatusCode
‡‡ 
=
‡‡ 
$num
‡‡  
,
‡‡  !
Result
·· 
=
··  
registerStudentDTO
·· +
}
‚‚ 
;
‚‚ 
}
„„ 	
catch
‰‰ 
(
‰‰ 
	Exception
‰‰ 
e
‰‰ 
)
‰‰ 
{
ÂÂ 	
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ "
(
ÁÁ" #
)
ÁÁ# $
{
ËË 
Message
ÈÈ 
=
ÈÈ 
e
ÈÈ 
.
ÈÈ 
Message
ÈÈ #
,
ÈÈ# $
Result
ÍÍ 
=
ÍÍ  
registerStudentDTO
ÍÍ +
,
ÍÍ+ ,
	IsSuccess
ÎÎ 
=
ÎÎ 
false
ÎÎ !
,
ÎÎ! "

StatusCode
ÏÏ 
=
ÏÏ 
$num
ÏÏ  
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 	
}
ÔÔ 
public
ˆˆ 

async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
ResponseDTO
ˆˆ !
>
ˆˆ! "
SignUpInstructor
ˆˆ# 3
(
ˆˆ3 4!
SignUpInstructorDTO
ˆˆ4 G!
signUpInstructorDto
ˆˆH [
)
ˆˆ[ \
{
˜˜ 
try
¯¯ 
{
˘˘ 	
var
˚˚ 
user
˚˚ 
=
˚˚ 
await
˚˚ 
_userManager
˚˚ )
.
˚˚) *
FindByEmailAsync
˚˚* :
(
˚˚: ;!
signUpInstructorDto
˚˚; N
.
˚˚N O
Email
˚˚O T
)
˚˚T U
;
˚˚U V
if
˛˛ 
(
˛˛ 
user
˛˛ 
is
˛˛ 
not
˛˛ 
null
˛˛  
)
˛˛  !
{
ˇˇ 
return
ÄÄ 
new
ÄÄ 
ResponseDTO
ÄÄ &
(
ÄÄ& '
)
ÄÄ' (
{
ÅÅ 
Message
ÇÇ 
=
ÇÇ 
$str
ÇÇ >
,
ÇÇ> ?
Result
ÉÉ 
=
ÉÉ !
signUpInstructorDto
ÉÉ 0
,
ÉÉ0 1
	IsSuccess
ÑÑ 
=
ÑÑ 
false
ÑÑ  %
,
ÑÑ% &

StatusCode
ÖÖ 
=
ÖÖ  
$num
ÖÖ! $
}
ÜÜ 
;
ÜÜ 
}
áá 
var
ââ 
isPhonenumerExit
ââ  
=
ââ! "
await
ää 
_userManager
ää "
.
ää" #
Users
ää# (
.
ää( )
AnyAsync
ää) 1
(
ää1 2
u
ää2 3
=>
ää4 6
u
ää7 8
.
ää8 9
PhoneNumber
ää9 D
==
ääE G!
signUpInstructorDto
ääH [
.
ää[ \
PhoneNumber
ää\ g
)
ääg h
;
ääh i
if
ãã 
(
ãã 
isPhonenumerExit
ãã  
)
ãã  !
{
åå 
return
çç 
new
çç 
ResponseDTO
çç &
(
çç& '
)
çç' (
{
éé 
Message
èè 
=
èè 
$str
èè E
,
èèE F
Result
êê 
=
êê !
signUpInstructorDto
êê 0
,
êê0 1
	IsSuccess
ëë 
=
ëë 
false
ëë  %
,
ëë% &

StatusCode
íí 
=
íí  
$num
íí! $
}
ìì 
;
ìì 
}
îî 
var
ññ 
isCardExist
ññ 
=
ññ 
await
óó 
_unitOfWork
óó !
.
óó! "#
PaymentCardRepository
óó" 7
.
óó7 8
GetAsync
óó8 @
(
óó@ A
x
óóA B
=>
óóC E
x
óóF G
.
óóG H

CardNumber
óóH R
==
óóS U!
signUpInstructorDto
óóV i
.
óói j

CardNumber
óój t
)
óót u
;
óóu v
if
òò 
(
òò 
isCardExist
òò 
is
òò 
not
òò "
null
òò# '
)
òò' (
{
ôô 
return
öö 
new
öö 
ResponseDTO
öö &
{
õõ 
	IsSuccess
úú 
=
úú 
false
úú  %
,
úú% &

StatusCode
ùù 
=
ùù  
$num
ùù! $
,
ùù$ %
Message
ûû 
=
ûû 
$str
ûû D
,
ûûD E
Result
üü 
=
üü 
null
üü !
}
†† 
;
†† 
}
°° 
ApplicationUser
§§ 
newUser
§§ #
=
§§$ %
new
§§& )
ApplicationUser
§§* 9
(
§§9 :
)
§§: ;
{
•• 
Address
¶¶ 
=
¶¶ !
signUpInstructorDto
¶¶ -
.
¶¶- .
Address
¶¶. 5
,
¶¶5 6
Email
ßß 
=
ßß !
signUpInstructorDto
ßß +
.
ßß+ ,
Email
ßß, 1
,
ßß1 2
	BirthDate
®® 
=
®® !
signUpInstructorDto
®® /
.
®®/ 0
	BirthDate
®®0 9
,
®®9 :
UserName
©© 
=
©© !
signUpInstructorDto
©© .
.
©©. /
Email
©©/ 4
,
©©4 5
FullName
™™ 
=
™™ !
signUpInstructorDto
™™ .
.
™™. /
FullName
™™/ 7
,
™™7 8
Gender
´´ 
=
´´ !
signUpInstructorDto
´´ ,
.
´´, -
Gender
´´- 3
,
´´3 4
Country
¨¨ 
=
¨¨ !
signUpInstructorDto
¨¨ -
.
¨¨- .
Country
¨¨. 5
,
¨¨5 6
PhoneNumber
≠≠ 
=
≠≠ !
signUpInstructorDto
≠≠ 1
.
≠≠1 2
PhoneNumber
≠≠2 =
,
≠≠= >
	TaxNumber
ÆÆ 
=
ÆÆ !
signUpInstructorDto
ÆÆ /
.
ÆÆ/ 0
	TaxNumber
ÆÆ0 9
,
ÆÆ9 :

UpdateTime
ØØ 
=
ØØ 
DateTime
ØØ %
.
ØØ% &
Now
ØØ& )
}
∞∞ 
;
∞∞ 
var
≥≥ 
createUserResult
≥≥  
=
≥≥! "
await
≥≥# (
_userManager
≥≥) 5
.
≥≥5 6
CreateAsync
≥≥6 A
(
≥≥A B
newUser
≥≥B I
,
≥≥I J!
signUpInstructorDto
≥≥K ^
.
≥≥^ _
Password
≥≥_ g
)
≥≥g h
;
≥≥h i
if
∑∑ 
(
∑∑ 
!
∑∑ 
createUserResult
∑∑ !
.
∑∑! "
	Succeeded
∑∑" +
)
∑∑+ ,
{
∏∏ 
return
∫∫ 
new
∫∫ 
ResponseDTO
∫∫ &
(
∫∫& '
)
∫∫' (
{
ªª 
Message
ºº 
=
ºº 
createUserResult
ºº .
.
ºº. /
Errors
ºº/ 5
.
ºº5 6
ToString
ºº6 >
(
ºº> ?
)
ºº? @
,
ºº@ A
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ  %
,
ΩΩ% &

StatusCode
ææ 
=
ææ  
$num
ææ! $
,
ææ$ %
Result
øø 
=
øø !
signUpInstructorDto
øø 0
}
¿¿ 
;
¿¿ 
}
¡¡ 
user
ƒƒ 
=
ƒƒ 
await
ƒƒ 
_userManager
ƒƒ %
.
ƒƒ% &
FindByEmailAsync
ƒƒ& 6
(
ƒƒ6 7!
signUpInstructorDto
ƒƒ7 J
.
ƒƒJ K
Email
ƒƒK P
)
ƒƒP Q
;
ƒƒQ R

Instructor
»» 

instructor
»» !
=
»»" #
new
»»$ '

Instructor
»»( 2
(
»»2 3
)
»»3 4
{
…… 
UserId
   
=
   
user
   
.
   
Id
    
,
    !
Degree
ÀÀ 
=
ÀÀ !
signUpInstructorDto
ÀÀ ,
.
ÀÀ, -
Degree
ÀÀ- 3
,
ÀÀ3 4
Industry
ÃÃ 
=
ÃÃ !
signUpInstructorDto
ÃÃ .
.
ÃÃ. /
Industry
ÃÃ/ 7
,
ÃÃ7 8
Introduction
ÕÕ 
=
ÕÕ !
signUpInstructorDto
ÕÕ 2
.
ÕÕ2 3
Introduction
ÕÕ3 ?
,
ÕÕ? @

AcceptedBy
ŒŒ 
=
ŒŒ 
$str
ŒŒ 
,
ŒŒ  
AcceptedTime
œœ 
=
œœ 
null
œœ #
,
œœ# $

RejectedBy
–– 
=
–– 
$str
–– 
,
––  
RejectedTime
—— 
=
—— 
null
—— #
,
——# $

IsAccepted
““ 
=
““ 
null
““ !
}
”” 
;
”” 
PaymentCard
÷÷ 
paymentCard
÷÷ #
=
÷÷$ %
new
÷÷& )
PaymentCard
÷÷* 5
(
÷÷5 6
)
÷÷6 7
{
◊◊ 
CardName
ÿÿ 
=
ÿÿ !
signUpInstructorDto
ÿÿ .
.
ÿÿ. /
CardName
ÿÿ/ 7
,
ÿÿ7 8

CardNumber
ŸŸ 
=
ŸŸ !
signUpInstructorDto
ŸŸ 0
.
ŸŸ0 1

CardNumber
ŸŸ1 ;
,
ŸŸ; <
CardProvider
⁄⁄ 
=
⁄⁄ !
signUpInstructorDto
⁄⁄ 2
.
⁄⁄2 3
CardProvider
⁄⁄3 ?
,
⁄⁄? @
UserId
€€ 
=
€€ 
user
€€ 
.
€€ 
Id
€€  
}
‹‹ 
;
‹‹ 
var
ﬂﬂ 
isRoleExist
ﬂﬂ 
=
ﬂﬂ 
await
ﬂﬂ #
_roleManager
ﬂﬂ$ 0
.
ﬂﬂ0 1
RoleExistsAsync
ﬂﬂ1 @
(
ﬂﬂ@ A
StaticUserRoles
ﬂﬂA P
.
ﬂﬂP Q

Instructor
ﬂﬂQ [
)
ﬂﬂ[ \
;
ﬂﬂ\ ]
if
‚‚ 
(
‚‚ 
isRoleExist
‚‚ 
is
‚‚ 
false
‚‚ $
)
‚‚$ %
{
„„ 
await
‰‰ 
_roleManager
‰‰ "
.
‰‰" #
CreateAsync
‰‰# .
(
‰‰. /
new
‰‰/ 2
IdentityRole
‰‰3 ?
(
‰‰? @
StaticUserRoles
‰‰@ O
.
‰‰O P

Instructor
‰‰P Z
)
‰‰Z [
)
‰‰[ \
;
‰‰\ ]
}
ÂÂ 
await
ËË 
_userManager
ËË 
.
ËË 
AddToRoleAsync
ËË -
(
ËË- .
user
ËË. 2
,
ËË2 3
StaticUserRoles
ËË4 C
.
ËËC D

Instructor
ËËD N
)
ËËN O
;
ËËO P
await
ÎÎ 
_unitOfWork
ÎÎ 
.
ÎÎ "
InstructorRepository
ÎÎ 2
.
ÎÎ2 3
AddAsync
ÎÎ3 ;
(
ÎÎ; <

instructor
ÎÎ< F
)
ÎÎF G
;
ÎÎG H
await
ÓÓ 
_unitOfWork
ÓÓ 
.
ÓÓ #
PaymentCardRepository
ÓÓ 3
.
ÓÓ3 4
AddAsync
ÓÓ4 <
(
ÓÓ< =
paymentCard
ÓÓ= H
)
ÓÓH I
;
ÓÓI J
await
ÒÒ 
_unitOfWork
ÒÒ 
.
ÒÒ 
	SaveAsync
ÒÒ '
(
ÒÒ' (
)
ÒÒ( )
;
ÒÒ) *
return
ÙÙ 
new
ÙÙ 
ResponseDTO
ÙÙ "
(
ÙÙ" #
)
ÙÙ# $
{
ıı 
Message
ˆˆ 
=
ˆˆ 
$str
ˆˆ 8
,
ˆˆ8 9
	IsSuccess
˜˜ 
=
˜˜ 
true
˜˜  
,
˜˜  !

StatusCode
¯¯ 
=
¯¯ 
$num
¯¯  
,
¯¯  !
Result
˘˘ 
=
˘˘ !
signUpInstructorDto
˘˘ ,
}
˙˙ 
;
˙˙ 
}
˚˚ 	
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 	
return
ˇˇ 
new
ˇˇ 
ResponseDTO
ˇˇ "
(
ˇˇ" #
)
ˇˇ# $
{
ÄÄ 
Message
ÅÅ 
=
ÅÅ 
e
ÅÅ 
.
ÅÅ 
Message
ÅÅ #
,
ÅÅ# $
Result
ÇÇ 
=
ÇÇ !
signUpInstructorDto
ÇÇ ,
,
ÇÇ, -
	IsSuccess
ÉÉ 
=
ÉÉ 
false
ÉÉ !
,
ÉÉ! "

StatusCode
ÑÑ 
=
ÑÑ 
$num
ÑÑ  
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
}
áá 
public
èè 

async
èè 
Task
èè 
<
èè 
ResponseDTO
èè !
>
èè! "$
UploadInstructorDegree
èè# 9
(
èè9 :
	IFormFile
èè: C
file
èèD H
,
èèH I
ClaimsPrincipal
èèJ Y
User
èèZ ^
)
èè^ _
{
êê 
try
ëë 
{
íí 	
var
ìì 
userId
ìì 
=
ìì 
User
ìì 
.
ìì 
Claims
ìì $
.
ìì$ %
FirstOrDefault
ìì% 3
(
ìì3 4
x
ìì4 5
=>
ìì6 8
x
ìì9 :
.
ìì: ;
Type
ìì; ?
==
ìì@ B

ClaimTypes
ììC M
.
ììM N
NameIdentifier
ììN \
)
ìì\ ]
?
ìì] ^
.
ìì^ _
Value
ìì_ d
;
ììd e
if
ïï 
(
ïï 
userId
ïï 
is
ïï 
null
ïï 
)
ïï 
{
ññ 
throw
óó 
new
óó 
	Exception
óó #
(
óó# $
$str
óó$ 9
)
óó9 :
;
óó: ;
}
òò 
var
öö 

instructor
öö 
=
öö 
await
öö "
_unitOfWork
öö# .
.
öö. /"
InstructorRepository
öö/ C
.
ööC D
GetAsync
ööD L
(
ööL M
x
ööM N
=>
ööO Q
x
ööR S
.
ööS T
UserId
ööT Z
==
öö[ ]
userId
öö^ d
)
ööd e
;
ööe f
if
úú 
(
úú 

instructor
úú 
is
úú 
null
úú "
)
úú" #
{
ùù 
throw
ûû 
new
ûû 
	Exception
ûû #
(
ûû# $
$str
ûû$ ?
)
ûû? @
;
ûû@ A
}
üü 
var
°° 
responseDto
°° 
=
°° 
await
°° #
_firebaseService
°°$ 4
.
°°4 5
UploadImage
°°5 @
(
°°@ A
file
°°A E
,
°°E F#
StaticFirebaseFolders
°°G \
.
°°\ ]
InstructorDegrees
°°] n
)
°°n o
;
°°o p
if
££ 
(
££ 
!
££ 
responseDto
££ 
.
££ 
	IsSuccess
££ &
)
££& '
{
§§ 
throw
•• 
new
•• 
	Exception
•• #
(
••# $
$str
••$ 8
)
••8 9
;
••9 :
}
¶¶ 

instructor
®® 
.
®® 
DegreeImageUrl
®® %
=
®®& '
responseDto
®®( 3
.
®®3 4
Result
®®4 :
.
®®: ;
ToString
®®; C
(
®®C D
)
®®D E
;
®®E F
await
™™ 
_unitOfWork
™™ 
.
™™ 
	SaveAsync
™™ '
(
™™' (
)
™™( )
;
™™) *
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
	IsSuccess
ÆÆ 
=
ÆÆ 
true
ÆÆ  
,
ÆÆ  !

StatusCode
ØØ 
=
ØØ 
$num
ØØ  
,
ØØ  !
Result
∞∞ 
=
∞∞ 
responseDto
∞∞ $
.
∞∞$ %
Result
∞∞% +
,
∞∞+ ,
Message
±± 
=
±± 
$str
±± A
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
	IsSuccess
∏∏ 
=
∏∏ 
false
∏∏ !
,
∏∏! "

StatusCode
ππ 
=
ππ 
$num
ππ  
,
ππ  !
Result
∫∫ 
=
∫∫ 
null
∫∫ 
,
∫∫ 
Message
ªª 
=
ªª 
e
ªª 
.
ªª 
Message
ªª #
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
≈≈ 

async
≈≈ 
Task
≈≈ 
<
≈≈ 
DegreeResponseDTO
≈≈ '
>
≈≈' (!
GetInstructorDegree
≈≈) <
(
≈≈< =
ClaimsPrincipal
≈≈= L
User
≈≈M Q
)
≈≈Q R
{
∆∆ 
try
«« 
{
»» 	
var
…… 
userId
…… 
=
…… 
User
…… 
.
…… 
Claims
…… $
.
……$ %
FirstOrDefault
……% 3
(
……3 4
x
……4 5
=>
……6 8
x
……9 :
.
……: ;
Type
……; ?
==
……@ B

ClaimTypes
……C M
.
……M N
NameIdentifier
……N \
)
……\ ]
?
……] ^
.
……^ _
Value
……_ d
;
……d e
if
ÀÀ 
(
ÀÀ 
userId
ÀÀ 
is
ÀÀ 
null
ÀÀ 
)
ÀÀ 
{
ÃÃ 
throw
ÕÕ 
new
ÕÕ 
	Exception
ÕÕ #
(
ÕÕ# $
$str
ÕÕ$ ;
)
ÕÕ; <
;
ÕÕ< =
}
ŒŒ 
var
–– 

instructor
–– 
=
–– 
await
–– "
_unitOfWork
––# .
.
––. /"
InstructorRepository
––/ C
.
––C D
GetAsync
––D L
(
––L M
x
––M N
=>
––O Q
x
––R S
.
––S T
UserId
––T Z
==
––[ ]
userId
––^ d
)
––d e
;
––e f
if
““ 
(
““ 

instructor
““ 
is
““ 
null
““ "
)
““" #
{
”” 
throw
‘‘ 
new
‘‘ 
	Exception
‘‘ #
(
‘‘# $
$str
‘‘$ @
)
‘‘@ A
;
‘‘A B
}
’’ 
var
◊◊ 

degreePath
◊◊ 
=
◊◊ 

instructor
◊◊ '
?
◊◊' (
.
◊◊( )
DegreeImageUrl
◊◊) 7
;
◊◊7 8
if
ÿÿ 
(
ÿÿ 

degreePath
ÿÿ 
.
ÿÿ 
IsNullOrEmpty
ÿÿ (
(
ÿÿ( )
)
ÿÿ) *
)
ÿÿ* +
{
ŸŸ 
throw
⁄⁄ 
new
⁄⁄ 
	Exception
⁄⁄ #
(
⁄⁄# $
$str
⁄⁄$ H
)
⁄⁄H I
;
⁄⁄I J
}
€€ 
var
›› 
stream
›› 
=
›› 
await
›› 
_firebaseService
›› /
.
››/ 0
GetImage
››0 8
(
››8 9

instructor
››9 C
.
››C D
DegreeImageUrl
››D R
)
››R S
;
››S T
if
ﬂﬂ 
(
ﬂﬂ 
stream
ﬂﬂ 
is
ﬂﬂ 
null
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
throw
·· 
new
·· 
	Exception
·· #
(
··# $
$str
··$ F
)
··F G
;
··G H
}
‚‚ 
var
‰‰ 
contentType
‰‰ 
=
‰‰ 
$str
‰‰ 7
;
‰‰7 8
if
ÊÊ 
(
ÊÊ 

degreePath
ÊÊ 
.
ÊÊ 
EndsWith
ÊÊ #
(
ÊÊ# $
$str
ÊÊ$ *
)
ÊÊ* +
)
ÊÊ+ ,
{
ÁÁ 
contentType
ËË 
=
ËË "
StaticFileExtensions
ËË 2
.
ËË2 3
Pdf
ËË3 6
;
ËË6 7
}
ÈÈ 
if
ÎÎ 
(
ÎÎ 

degreePath
ÎÎ 
.
ÎÎ 
EndsWith
ÎÎ #
(
ÎÎ# $
$str
ÎÎ$ *
)
ÎÎ* +
)
ÎÎ+ ,
{
ÏÏ 
contentType
ÌÌ 
=
ÌÌ "
StaticFileExtensions
ÌÌ 2
.
ÌÌ2 3
Png
ÌÌ3 6
;
ÌÌ6 7
}
ÓÓ 
if
 
(
 

degreePath
 
.
 
EndsWith
 #
(
# $
$str
$ *
)
* +
||
, .

degreePath
/ 9
.
9 :
EndsWith
: B
(
B C
$str
C J
)
J K
)
K L
{
ÒÒ 
contentType
ÚÚ 
=
ÚÚ "
StaticFileExtensions
ÚÚ 2
.
ÚÚ2 3
Jpeg
ÚÚ3 7
;
ÚÚ7 8
}
ÛÛ 
return
ıı 
new
ıı 
DegreeResponseDTO
ıı (
(
ıı( )
)
ıı) *
{
ˆˆ 
Message
˜˜ 
=
˜˜ 
$str
˜˜ 1
,
˜˜1 2
Stream
¯¯ 
=
¯¯ 
stream
¯¯ 
,
¯¯  
ContentType
˘˘ 
=
˘˘ 
contentType
˘˘ )
,
˘˘) *
FileName
˙˙ 
=
˙˙ 
Path
˙˙ 
.
˙˙  
GetFileName
˙˙  +
(
˙˙+ ,

degreePath
˙˙, 6
)
˙˙6 7
}
˚˚ 
;
˚˚ 
}
¸¸ 	
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 	
return
ˇˇ 
new
ˇˇ 
DegreeResponseDTO
ˇˇ (
(
ˇˇ( )
)
ˇˇ) *
{
ÄÄ 
ContentType
ÅÅ 
=
ÅÅ 
null
ÅÅ "
,
ÅÅ" #
Message
ÇÇ 
=
ÇÇ 
e
ÇÇ 
.
ÇÇ 
Message
ÇÇ #
,
ÇÇ# $
Stream
ÉÉ 
=
ÉÉ 
null
ÉÉ 
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
public
éé 

async
éé 
Task
éé 
<
éé 
ResponseDTO
éé !
>
éé! "
UploadUserAvatar
éé# 3
(
éé3 4
	IFormFile
éé4 =
file
éé> B
,
ééB C
ClaimsPrincipal
ééD S
User
ééT X
)
ééX Y
{
èè 
try
êê 
{
ëë 	
var
íí 
userId
íí 
=
íí 
User
íí 
.
íí 
Claims
íí $
.
íí$ %
FirstOrDefault
íí% 3
(
íí3 4
x
íí4 5
=>
íí6 8
x
íí9 :
.
íí: ;
Type
íí; ?
==
íí@ B

ClaimTypes
ííC M
.
ííM N
NameIdentifier
ííN \
)
íí\ ]
?
íí] ^
.
íí^ _
Value
íí_ d
;
ííd e
if
îî 
(
îî 
userId
îî 
is
îî 
null
îî 
)
îî 
{
ïï 
throw
ññ 
new
ññ 
	Exception
ññ #
(
ññ# $
$str
ññ$ 9
)
ññ9 :
;
ññ: ;
}
óó 
var
ôô 
user
ôô 
=
ôô 
await
ôô 
_userManager
ôô )
.
ôô) *
FindByIdAsync
ôô* 7
(
ôô7 8
userId
ôô8 >
)
ôô> ?
;
ôô? @
if
õõ 
(
õõ 
user
õõ 
is
õõ 
null
õõ 
)
õõ 
{
úú 
throw
ùù 
new
ùù 
	Exception
ùù #
(
ùù# $
$str
ùù$ 9
)
ùù9 :
;
ùù: ;
}
ûû 
var
†† 
responseDto
†† 
=
†† 
await
†† #
_firebaseService
††$ 4
.
††4 5
UploadImage
††5 @
(
††@ A
file
††A E
,
††E F#
StaticFirebaseFolders
††G \
.
††\ ]
UserAvatars
††] h
)
††h i
;
††i j
if
¢¢ 
(
¢¢ 
!
¢¢ 
responseDto
¢¢ 
.
¢¢ 
	IsSuccess
¢¢ &
)
¢¢& '
{
££ 
throw
§§ 
new
§§ 
	Exception
§§ #
(
§§# $
$str
§§$ 8
)
§§8 9
;
§§9 :
}
•• 
user
ßß 
.
ßß 
	AvatarUrl
ßß 
=
ßß 
responseDto
ßß (
.
ßß( )
Result
ßß) /
?
ßß/ 0
.
ßß0 1
ToString
ßß1 9
(
ßß9 :
)
ßß: ;
;
ßß; <
var
©© 
updateResult
©© 
=
©© 
await
©© $
_userManager
©©% 1
.
©©1 2
UpdateAsync
©©2 =
(
©©= >
user
©©> B
)
©©B C
;
©©C D
if
´´ 
(
´´ 
!
´´ 
updateResult
´´ 
.
´´ 
	Succeeded
´´ '
)
´´' (
{
¨¨ 
throw
≠≠ 
new
≠≠ 
	Exception
≠≠ #
(
≠≠# $
$str
≠≠$ >
)
≠≠> ?
;
≠≠? @
}
ÆÆ 
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ "
(
∞∞" #
)
∞∞# $
{
±± 
Message
≤≤ 
=
≤≤ 
$str
≤≤ <
,
≤≤< =
Result
≥≥ 
=
≥≥ 
null
≥≥ 
,
≥≥ 
	IsSuccess
¥¥ 
=
¥¥ 
true
¥¥  
,
¥¥  !

StatusCode
µµ 
=
µµ 
$num
µµ  
}
∂∂ 
;
∂∂ 
}
∑∑ 	
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 	
return
∫∫ 
new
∫∫ 
ResponseDTO
∫∫ "
(
∫∫" #
)
∫∫# $
{
ªª 
Message
ºº 
=
ºº 
e
ºº 
.
ºº 
Message
ºº #
,
ºº# $
Result
ΩΩ 
=
ΩΩ 
null
ΩΩ 
,
ΩΩ 
	IsSuccess
ææ 
=
ææ 
false
ææ !
,
ææ! "

StatusCode
øø 
=
øø 
$num
øø  
}
¿¿ 
;
¿¿ 
}
¡¡ 	
}
¬¬ 
public
…… 

async
…… 
Task
…… 
<
…… 
MemoryStream
…… "
>
……" #
GetUserAvatar
……$ 1
(
……1 2
ClaimsPrincipal
……2 A
User
……B F
)
……F G
{
   
try
ÀÀ 
{
ÃÃ 	
var
ÕÕ 
userId
ÕÕ 
=
ÕÕ 
User
ÕÕ 
.
ÕÕ 
Claims
ÕÕ $
.
ÕÕ$ %
FirstOrDefault
ÕÕ% 3
(
ÕÕ3 4
x
ÕÕ4 5
=>
ÕÕ6 8
x
ÕÕ9 :
.
ÕÕ: ;
Type
ÕÕ; ?
==
ÕÕ@ B

ClaimTypes
ÕÕC M
.
ÕÕM N
NameIdentifier
ÕÕN \
)
ÕÕ\ ]
?
ÕÕ] ^
.
ÕÕ^ _
Value
ÕÕ_ d
;
ÕÕd e
var
œœ 
user
œœ 
=
œœ 
await
œœ 
_userManager
œœ )
.
œœ) *
FindByIdAsync
œœ* 7
(
œœ7 8
userId
œœ8 >
)
œœ> ?
;
œœ? @
var
—— 
stream
—— 
=
—— 
await
—— 
_firebaseService
—— /
.
——/ 0
GetImage
——0 8
(
——8 9
user
——9 =
.
——= >
	AvatarUrl
——> G
)
——G H
;
——H I
return
”” 
stream
”” 
;
”” 
}
‘‘ 	
catch
’’ 
(
’’ 
	Exception
’’ 
e
’’ 
)
’’ 
{
÷÷ 	
return
◊◊ 
null
◊◊ 
;
◊◊ 
}
ÿÿ 	
}
ŸŸ 
public
›› 

async
›› 
Task
›› 
<
›› 
ResponseDTO
›› !
>
››! "
SignIn
››# )
(
››) *
SignDTO
››* 1
signDTO
››2 9
)
››9 :
{
ﬁﬁ 
try
ﬂﬂ 
{
‡‡ 	
var
·· 
user
·· 
=
·· 
await
·· 
_userManager
·· )
.
··) *
FindByEmailAsync
··* :
(
··: ;
signDTO
··; B
.
··B C
Email
··C H
)
··H I
;
··I J
if
‚‚ 
(
‚‚ 
user
‚‚ 
==
‚‚ 
null
‚‚ 
)
‚‚ 
{
„„ 
new
‰‰ 
ResponseDTO
‰‰ 
(
‰‰  
)
‰‰  !
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
$str
ÊÊ 4
,
ÊÊ4 5
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ !
,
ÁÁ! "
	IsSuccess
ËË 
=
ËË 
false
ËË  %
,
ËË% &

StatusCode
ÈÈ 
=
ÈÈ  
$num
ÈÈ! $
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 
var
ÌÌ 
isPasswordCorrect
ÌÌ !
=
ÌÌ" #
await
ÌÌ$ )
_userManager
ÌÌ* 6
.
ÌÌ6 7 
CheckPasswordAsync
ÌÌ7 I
(
ÌÌI J
user
ÌÌJ N
,
ÌÌN O
signDTO
ÌÌP W
.
ÌÌW X
Password
ÌÌX `
)
ÌÌ` a
;
ÌÌa b
if
ÔÔ 
(
ÔÔ 
!
ÔÔ 
isPasswordCorrect
ÔÔ "
)
ÔÔ" #
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ &
(
ÒÒ& '
)
ÒÒ' (
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ 
$str
ÛÛ ;
,
ÛÛ; <
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ !
,
ÙÙ! "
	IsSuccess
ıı 
=
ıı 
false
ıı  %
,
ıı% &

StatusCode
ˆˆ 
=
ˆˆ  
$num
ˆˆ! $
}
˜˜ 
;
˜˜ 
}
¯¯ 
if
˙˙ 
(
˙˙ 
!
˙˙ 
user
˙˙ 
.
˙˙ 
EmailConfirmed
˙˙ $
)
˙˙$ %
{
˚˚ 
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ &
(
¸¸& '
)
¸¸' (
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ :
,
˛˛: ;
Result
ˇˇ 
=
ˇˇ 
null
ˇˇ !
,
ˇˇ! "
	IsSuccess
ÄÄ 
=
ÄÄ 
false
ÄÄ  %
,
ÄÄ% &

StatusCode
ÅÅ 
=
ÅÅ  
$num
ÅÅ! $
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
var
ÖÖ 
accessToken
ÖÖ 
=
ÖÖ 
await
ÖÖ #
_tokenService
ÖÖ$ 1
.
ÖÖ1 2)
GenerateJwtAccessTokenAsync
ÖÖ2 M
(
ÖÖM N
user
ÖÖN R
)
ÖÖR S
;
ÖÖS T
var
ÜÜ 
refreshToken
ÜÜ 
=
ÜÜ 
await
ÜÜ $
_tokenService
ÜÜ% 2
.
ÜÜ2 3*
GenerateJwtRefreshTokenAsync
ÜÜ3 O
(
ÜÜO P
user
ÜÜP T
)
ÜÜT U
;
ÜÜU V
await
áá 
_tokenService
áá 
.
áá  
StoreRefreshToken
áá  1
(
áá1 2
user
áá2 6
.
áá6 7
Id
áá7 9
,
áá9 :
refreshToken
áá; G
)
ááG H
;
ááH I
return
ââ 
new
ââ 
ResponseDTO
ââ "
(
ââ" #
)
ââ# $
{
ää 
Result
ãã 
=
ãã 
new
ãã 
SignResponseDTO
ãã ,
(
ãã, -
)
ãã- .
{
åå 
AccessToken
çç 
=
çç  !
accessToken
çç" -
,
çç- .
RefreshToken
éé  
=
éé! "
refreshToken
éé# /
,
éé/ 0
}
èè 
,
èè 
Message
êê 
=
êê 
$str
êê 0
,
êê0 1
	IsSuccess
ëë 
=
ëë 
true
ëë  
,
ëë  !

StatusCode
íí 
=
íí 
$num
íí  
}
ìì 
;
ìì 
}
îî 	
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 	
return
óó 
new
óó 
ResponseDTO
óó "
(
óó" #
)
óó# $
{
òò 
Message
ôô 
=
ôô 
e
ôô 
.
ôô 
Message
ôô #
,
ôô# $
	IsSuccess
öö 
=
öö 
false
öö !
,
öö! "

StatusCode
õõ 
=
õõ 
$num
õõ  
,
õõ  !
Result
úú 
=
úú 
null
úú 
}
ùù 
;
ùù 
}
ûû 	
}
üü 
public
¶¶ 

async
¶¶ 
Task
¶¶ 
<
¶¶ 
ResponseDTO
¶¶ !
>
¶¶! "
Refresh
¶¶# *
(
¶¶* +
string
¶¶+ 1
token
¶¶2 7
)
¶¶7 8
{
ßß 
try
®® 
{
©© 	
ClaimsPrincipal
™™ 
user
™™  
=
™™! "
await
™™# (
_tokenService
™™) 6
.
™™6 7#
GetPrincipalFromToken
™™7 L
(
™™L M
token
™™M R
)
™™R S
;
™™S T
var
¨¨ 
userId
¨¨ 
=
¨¨ 
user
¨¨ 
.
¨¨ 
Claims
¨¨ $
.
¨¨$ %
FirstOrDefault
¨¨% 3
(
¨¨3 4
x
¨¨4 5
=>
¨¨6 8
x
¨¨9 :
.
¨¨: ;
Type
¨¨; ?
==
¨¨@ B

ClaimTypes
¨¨C M
.
¨¨M N
NameIdentifier
¨¨N \
)
¨¨\ ]
?
¨¨] ^
.
¨¨^ _
Value
¨¨_ d
;
¨¨d e
if
≠≠ 
(
≠≠ 
userId
≠≠ 
is
≠≠ 
null
≠≠ 
)
≠≠ 
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
(
ØØ& '
)
ØØ' (
{
∞∞ 
Message
±± 
=
±± 
$str
±± 2
,
±±2 3
	IsSuccess
≤≤ 
=
≤≤ 
false
≤≤  %
,
≤≤% &

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
,
≥≥$ %
Result
¥¥ 
=
¥¥ 
null
¥¥ !
}
µµ 
;
µµ 
}
∂∂ 
var
∏∏ 
applicationUser
∏∏ 
=
∏∏  !
await
∏∏" '
_userManager
∏∏( 4
.
∏∏4 5
FindByIdAsync
∏∏5 B
(
∏∏B C
userId
∏∏C I
)
∏∏I J
;
∏∏J K
if
ππ 
(
ππ 
applicationUser
ππ 
is
ππ  "
null
ππ# '
)
ππ' (
{
∫∫ 
return
ªª 
new
ªª 
ResponseDTO
ªª &
(
ªª& '
)
ªª' (
{
ºº 
Message
ΩΩ 
=
ΩΩ 
$str
ΩΩ 3
,
ΩΩ3 4
	IsSuccess
ææ 
=
ææ 
false
ææ  %
,
ææ% &

StatusCode
øø 
=
øø  
$num
øø! $
,
øø$ %
Result
¿¿ 
=
¿¿ 
null
¿¿ !
}
¡¡ 
;
¡¡ 
}
¬¬ 
var
≈≈ 
tokenOnRedis
≈≈ 
=
≈≈ 
await
≈≈ $
_tokenService
≈≈% 2
.
≈≈2 3"
RetrieveRefreshToken
≈≈3 G
(
≈≈G H
applicationUser
≈≈H W
.
≈≈W X
Id
≈≈X Z
)
≈≈Z [
;
≈≈[ \
if
∆∆ 
(
∆∆ 
tokenOnRedis
∆∆ 
!=
∆∆ 
token
∆∆  %
)
∆∆% &
{
«« 
return
»» 
new
»» 
ResponseDTO
»» &
(
»»& '
)
»»' (
{
…… 
Message
   
=
   
$str
   2
,
  2 3
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ  %
,
ÀÀ% &

StatusCode
ÃÃ 
=
ÃÃ  
$num
ÃÃ! $
,
ÃÃ$ %
Result
ÕÕ 
=
ÕÕ 
null
ÕÕ !
}
ŒŒ 
;
ŒŒ 
}
œœ 
var
—— 
accessToken
—— 
=
—— 
await
—— #
_tokenService
——$ 1
.
——1 2)
GenerateJwtAccessTokenAsync
——2 M
(
——M N
applicationUser
——N ]
)
——] ^
;
——^ _
var
““ 
refreshToken
““ 
=
““ 
await
““ $
_tokenService
““% 2
.
““2 3*
GenerateJwtRefreshTokenAsync
““3 O
(
““O P
applicationUser
““P _
)
““_ `
;
““` a
await
‘‘ 
_tokenService
‘‘ 
.
‘‘   
DeleteRefreshToken
‘‘  2
(
‘‘2 3
applicationUser
‘‘3 B
.
‘‘B C
Id
‘‘C E
)
‘‘E F
;
‘‘F G
await
’’ 
_tokenService
’’ 
.
’’  
StoreRefreshToken
’’  1
(
’’1 2
applicationUser
’’2 A
.
’’A B
Id
’’B D
,
’’D E
refreshToken
’’F R
)
’’R S
;
’’S T
return
◊◊ 
new
◊◊ 
ResponseDTO
◊◊ "
(
◊◊" #
)
◊◊# $
{
ÿÿ 
Result
ŸŸ 
=
ŸŸ 
new
ŸŸ 
JwtTokenDTO
ŸŸ (
(
ŸŸ( )
)
ŸŸ) *
{
⁄⁄ 
AccessToken
€€ 
=
€€  !
accessToken
€€" -
,
€€- .
RefreshToken
‹‹  
=
‹‹! "
refreshToken
‹‹# /
}
›› 
,
›› 
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  
,
ﬁﬁ  !

StatusCode
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ  
,
ﬂﬂ  !
Message
‡‡ 
=
‡‡ 
$str
‡‡ 7
}
·· 
;
·· 
}
‚‚ 	
catch
„„ 
(
„„ 
	Exception
„„ 
e
„„ 
)
„„ 
{
‰‰ 	
return
ÂÂ 
new
ÂÂ 
ResponseDTO
ÂÂ "
(
ÂÂ" #
)
ÂÂ# $
{
ÊÊ 
Message
ÁÁ 
=
ÁÁ 
e
ÁÁ 
.
ÁÁ 
Message
ÁÁ #
,
ÁÁ# $
	IsSuccess
ËË 
=
ËË 
false
ËË !
,
ËË! "

StatusCode
ÈÈ 
=
ÈÈ 
$num
ÈÈ  
,
ÈÈ  !
Result
ÍÍ 
=
ÍÍ 
null
ÍÍ 
}
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
}
ÌÌ 
private
ÒÒ 
string
ÒÒ 
ip
ÒÒ 
;
ÒÒ 
private
ÚÚ 
string
ÚÚ 
city
ÚÚ 
;
ÚÚ 
private
ÛÛ 
string
ÛÛ 
region
ÛÛ 
;
ÛÛ 
private
ÙÙ 
string
ÙÙ 
country
ÙÙ 
;
ÙÙ 
private
ıı 
const
ıı 
int
ıı 
MaxAttemptsPerDay
ıı '
=
ıı( )
$num
ıı* +
;
ıı+ ,
public
˜˜ 

async
˜˜ 
Task
˜˜ 
<
˜˜ 
ResponseDTO
˜˜ !
>
˜˜! "
ForgotPassword
˜˜# 1
(
˜˜1 2
ForgotPasswordDTO
˜˜2 C
forgotPasswordDto
˜˜D U
)
˜˜U V
{
¯¯ 
try
˘˘ 
{
˙˙ 	
var
¸¸ 
user
¸¸ 
=
¸¸ 
await
¸¸ 
_userManager
¸¸ )
.
¸¸) *
FindByEmailAsync
¸¸* :
(
¸¸: ;
forgotPasswordDto
¸¸; L
.
¸¸L M
EmailOrPhone
¸¸M Y
)
¸¸Y Z
;
¸¸Z [
if
˝˝ 
(
˝˝ 
user
˝˝ 
==
˝˝ 
null
˝˝ 
)
˝˝ 
{
˛˛ 
user
ˇˇ 
=
ˇˇ 
await
ˇˇ 
_userManager
ˇˇ )
.
ˇˇ) *
Users
ˇˇ* /
.
ˇˇ/ 0!
FirstOrDefaultAsync
ˇˇ0 C
(
ˇˇC D
u
ÄÄ 
=>
ÄÄ 
u
ÄÄ 
.
ÄÄ 
PhoneNumber
ÄÄ &
==
ÄÄ' )
forgotPasswordDto
ÄÄ* ;
.
ÄÄ; <
EmailOrPhone
ÄÄ< H
)
ÄÄH I
;
ÄÄI J
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
user
ÉÉ 
==
ÉÉ 
null
ÉÉ 
||
ÉÉ 
!
ÉÉ  !
user
ÉÉ! %
.
ÉÉ% &
EmailConfirmed
ÉÉ& 4
)
ÉÉ4 5
{
ÑÑ 
return
ÖÖ 
new
ÖÖ 
ResponseDTO
ÖÖ &
{
ÜÜ 
	IsSuccess
áá 
=
áá 
false
áá  %
,
áá% &
Message
àà 
=
àà 
$str
àà G
,
ààG H

StatusCode
ââ 
=
ââ  
$num
ââ! $
}
ää 
;
ää 
}
ãã 
var
éé 
email
éé 
=
éé 
user
éé 
.
éé 
Email
éé "
;
éé" #
var
èè 
now
èè 
=
èè 
DateTime
èè 
.
èè 
Now
èè "
;
èè" #
if
ëë 
(
ëë #
ResetPasswordAttempts
ëë %
.
ëë% &
TryGetValue
ëë& 1
(
ëë1 2
email
ëë2 7
,
ëë7 8
out
ëë9 <
var
ëë= @
attempts
ëëA I
)
ëëI J
)
ëëJ K
{
íí 
if
îî 
(
îî 
now
îî 
-
îî 
attempts
îî "
.
îî" #
LastRequest
îî# .
>=
îî/ 1
TimeSpan
îî2 :
.
îî: ;
FromSeconds
îî; F
(
îîF G
$num
îîG H
)
îîH I
)
îîI J
{
ïï #
ResetPasswordAttempts
óó )
[
óó) *
email
óó* /
]
óó/ 0
=
óó1 2
(
óó3 4
$num
óó4 5
,
óó5 6
now
óó7 :
)
óó: ;
;
óó; <
}
òò 
else
ôô 
if
ôô 
(
ôô 
attempts
ôô !
.
ôô! "
Count
ôô" '
>=
ôô( *
MaxAttemptsPerDay
ôô+ <
)
ôô< =
{
öö 
await
úú 
_emailService
úú '
.
úú' (
SendEmailAsync
úú( 6
(
úú6 7
user
úú7 ;
.
úú; <
Email
úú< A
,
úúA B
$str
ùù ?
,
ùù? @
$"
ûû 
$str
ûû y
"
ûûy z
)
üü 
;
üü 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ *
{
££ 
	IsSuccess
§§ !
=
§§" #
false
§§$ )
,
§§) *
Message
•• 
=
••  !
$str
¶¶ }
,
¶¶} ~

StatusCode
ßß "
=
ßß# $
$num
ßß% (
}
®® 
;
®® 
}
©© 
else
™™ 
{
´´ #
ResetPasswordAttempts
≠≠ )
[
≠≠) *
email
≠≠* /
]
≠≠/ 0
=
≠≠1 2
(
≠≠3 4
attempts
≠≠4 <
.
≠≠< =
Count
≠≠= B
+
≠≠C D
$num
≠≠E F
,
≠≠F G
now
≠≠H K
)
≠≠K L
;
≠≠L M
}
ÆÆ 
}
ØØ 
else
∞∞ 
{
±± #
ResetPasswordAttempts
≥≥ %
.
≥≥% &
AddOrUpdate
≥≥& 1
(
≥≥1 2
email
≥≥2 7
,
≥≥7 8
(
≥≥9 :
$num
≥≥: ;
,
≥≥; <
now
≥≥= @
)
≥≥@ A
,
≥≥A B
(
≥≥C D
key
≥≥D G
,
≥≥G H
old
≥≥I L
)
≥≥L M
=>
≥≥N P
(
≥≥Q R
old
≥≥R U
.
≥≥U V
Count
≥≥V [
+
≥≥\ ]
$num
≥≥^ _
,
≥≥_ `
now
≥≥a d
)
≥≥d e
)
≥≥e f
;
≥≥f g
}
¥¥ 
var
∑∑ 
token
∑∑ 
=
∑∑ 
await
∑∑ 
_userManager
∑∑ *
.
∑∑* +-
GeneratePasswordResetTokenAsync
∑∑+ J
(
∑∑J K
user
∑∑K O
)
∑∑O P
;
∑∑P Q
var
ªª 
	resetLink
ªª 
=
ªª 
$"
ªª 
$str
ªª A
{
ªªA B
token
ªªB G
}
ªªG H
$str
ªªH O
{
ªªO P
user
ªªP T
.
ªªT U
Email
ªªU Z
}
ªªZ [
"
ªª[ \
;
ªª\ ]
var
ææ 
currentDate
ææ 
=
ææ 
DateTime
ææ &
.
ææ& '
Now
ææ' *
.
ææ* +
ToString
ææ+ 3
(
ææ3 4
$str
ææ4 B
)
ææB C
;
ææC D
var
¿¿ 
	userAgent
¿¿ 
=
¿¿ "
_httpContextAccessor
¿¿ 0
.
¿¿0 1
HttpContext
¿¿1 <
?
¿¿< =
.
¿¿= >
Request
¿¿> E
.
¿¿E F
Headers
¿¿F M
[
¿¿M N
$str
¿¿N Z
]
¿¿Z [
;
¿¿[ \
var
√√ 
operatingSystem
√√ 
=
√√  !)
GetUserAgentOperatingSystem
√√" =
(
√√= >
	userAgent
√√> G
)
√√G H
;
√√H I
var
∆∆ 
browser
∆∆ 
=
∆∆ !
GetUserAgentBrowser
∆∆ -
(
∆∆- .
	userAgent
∆∆. 7
)
∆∆7 8
;
∆∆8 9
var
…… 
url
…… 
=
…… 
$str
…… Q
;
……Q R
using
   
(
   

HttpClient
   
client
   $
=
  % &
new
  ' *

HttpClient
  + 5
(
  5 6
)
  6 7
)
  7 8
{
ÀÀ !
HttpResponseMessage
ÃÃ #
response
ÃÃ$ ,
=
ÃÃ- .
await
ÃÃ/ 4
client
ÃÃ5 ;
.
ÃÃ; <
GetAsync
ÃÃ< D
(
ÃÃD E
url
ÃÃE H
)
ÃÃH I
;
ÃÃI J
if
ÕÕ 
(
ÕÕ 
response
ÕÕ 
.
ÕÕ !
IsSuccessStatusCode
ÕÕ 0
)
ÕÕ0 1
{
ŒŒ 
string
œœ 
jsonContent
œœ &
=
œœ' (
await
œœ) .
response
œœ/ 7
.
œœ7 8
Content
œœ8 ?
.
œœ? @
ReadAsStringAsync
œœ@ Q
(
œœQ R
)
œœR S
;
œœS T
JObject
–– 
data
––  
=
––! "
JObject
––# *
.
––* +
Parse
––+ 0
(
––0 1
jsonContent
––1 <
)
––< =
;
––= >
this
““ 
.
““ 
ip
““ 
=
““ 
data
““ "
[
““" #
$str
““# '
]
““' (
.
““( )
ToString
““) 1
(
““1 2
)
““2 3
;
““3 4
this
”” 
.
”” 
city
”” 
=
”” 
data
””  $
[
””$ %
$str
””% +
]
””+ ,
.
””, -
ToString
””- 5
(
””5 6
)
””6 7
;
””7 8
this
‘‘ 
.
‘‘ 
region
‘‘ 
=
‘‘  !
data
‘‘" &
[
‘‘& '
$str
‘‘' /
]
‘‘/ 0
.
‘‘0 1
ToString
‘‘1 9
(
‘‘9 :
)
‘‘: ;
;
‘‘; <
this
’’ 
.
’’ 
country
’’  
=
’’! "
data
’’# '
[
’’' (
$str
’’( 1
]
’’1 2
.
’’2 3
ToString
’’3 ;
(
’’; <
)
’’< =
;
’’= >
}
÷÷ 
else
◊◊ 
{
ÿÿ 
return
ŸŸ 
new
ŸŸ 
ResponseDTO
ŸŸ *
{
⁄⁄ 
	IsSuccess
€€ !
=
€€" #
false
€€$ )
,
€€) *
Message
‹‹ 
=
‹‹  !
$str
‹‹" C
,
‹‹C D

StatusCode
›› "
=
››# $
$num
››% (
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 
await
„„ 
_emailService
„„ 
.
„„  !
SendEmailResetAsync
„„  3
(
„„3 4
user
„„4 8
.
„„8 9
Email
„„9 >
,
„„> ?
$str
„„@ h
,
„„h i
user
„„j n
,
„„n o
currentDate
‰‰ 
,
‰‰ 
	resetLink
‰‰ &
,
‰‰& '
operatingSystem
‰‰( 7
,
‰‰7 8
browser
‰‰9 @
,
‰‰@ A
ip
‰‰B D
,
‰‰D E
region
‰‰F L
,
‰‰L M
city
‰‰N R
,
‰‰R S
country
‰‰T [
)
‰‰[ \
;
‰‰\ ]
string
ÁÁ )
GetUserAgentOperatingSystem
ÁÁ .
(
ÁÁ. /
string
ÁÁ/ 5
	userAgent
ÁÁ6 ?
)
ÁÁ? @
{
ËË 
if
ÎÎ 
(
ÎÎ 
	userAgent
ÎÎ 
.
ÎÎ 
Contains
ÎÎ &
(
ÎÎ& '
$str
ÎÎ' 0
)
ÎÎ0 1
)
ÎÎ1 2
return
ÎÎ3 9
$str
ÎÎ: C
;
ÎÎC D
else
ÏÏ 
if
ÏÏ 
(
ÏÏ 
	userAgent
ÏÏ "
.
ÏÏ" #
Contains
ÏÏ# +
(
ÏÏ+ ,
$str
ÏÏ, 1
)
ÏÏ1 2
)
ÏÏ2 3
return
ÏÏ4 :
$str
ÏÏ; B
;
ÏÏB C
else
ÌÌ 
if
ÌÌ 
(
ÌÌ 
	userAgent
ÌÌ "
.
ÌÌ" #
Contains
ÌÌ# +
(
ÌÌ+ ,
$str
ÌÌ, 3
)
ÌÌ3 4
)
ÌÌ4 5
return
ÌÌ6 <
$str
ÌÌ= D
;
ÌÌD E
else
ÓÓ 
return
ÓÓ 
$str
ÓÓ %
;
ÓÓ% &
}
ÔÔ 
string
ÒÒ !
GetUserAgentBrowser
ÒÒ &
(
ÒÒ& '
string
ÒÒ' -
	userAgent
ÒÒ. 7
)
ÒÒ7 8
{
ÚÚ 
if
ıı 
(
ıı 
	userAgent
ıı 
.
ıı 
Contains
ıı &
(
ıı& '
$str
ıı' /
)
ıı/ 0
)
ıı0 1
return
ıı2 8
$str
ıı9 A
;
ııA B
else
ˆˆ 
if
ˆˆ 
(
ˆˆ 
	userAgent
ˆˆ "
.
ˆˆ" #
Contains
ˆˆ# +
(
ˆˆ+ ,
$str
ˆˆ, 5
)
ˆˆ5 6
)
ˆˆ6 7
return
ˆˆ8 >
$str
ˆˆ? H
;
ˆˆH I
else
˜˜ 
if
˜˜ 
(
˜˜ 
	userAgent
˜˜ "
.
˜˜" #
Contains
˜˜# +
(
˜˜+ ,
$str
˜˜, 4
)
˜˜4 5
)
˜˜5 6
return
˜˜7 =
$str
˜˜> F
;
˜˜F G
else
¯¯ 
return
¯¯ 
$str
¯¯ %
;
¯¯% &
}
˘˘ 
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ "
{
¸¸ 
	IsSuccess
˝˝ 
=
˝˝ 
true
˝˝  
,
˝˝  !
Message
˛˛ 
=
˛˛ 
$str
˛˛ P
,
˛˛P Q

StatusCode
ˇˇ 
=
ˇˇ 
$num
ˇˇ  
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
catch
ÇÇ 
(
ÇÇ 
	Exception
ÇÇ 
e
ÇÇ 
)
ÇÇ 
{
ÉÉ 	
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ "
{
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
false
ÜÜ !
,
ÜÜ! "
Message
áá 
=
áá 
e
áá 
.
áá 
Message
áá #
,
áá# $

StatusCode
àà 
=
àà 
$num
àà  
}
ââ 
;
ââ 
}
ää 	
}
ãã 
public
éé 

async
éé 
Task
éé 
<
éé 
ResponseDTO
éé !
>
éé! "
ResetPassword
éé# 0
(
éé0 1
string
éé1 7
email
éé8 =
,
éé= >
string
éé? E
token
ééF K
,
ééK L
string
ééM S
password
ééT \
)
éé\ ]
{
èè 
try
êê 
{
ëë 	
var
ìì 
user
ìì 
=
ìì 
await
ìì 
_userManager
ìì )
.
ìì) *
FindByEmailAsync
ìì* :
(
ìì: ;
email
ìì; @
)
ìì@ A
;
ììA B
if
îî 
(
îî 
user
îî 
==
îî 
null
îî 
)
îî 
{
ïï 
return
ññ 
new
ññ 
ResponseDTO
ññ &
{
óó 
	IsSuccess
òò 
=
òò 
false
òò  %
,
òò% &
Message
ôô 
=
ôô 
$str
ôô /
,
ôô/ 0

StatusCode
öö 
=
öö  
$num
öö! $
}
õõ 
;
õõ 
}
úú 
if
üü 
(
üü 
await
üü 
_userManager
üü "
.
üü" # 
CheckPasswordAsync
üü# 5
(
üü5 6
user
üü6 :
,
üü: ;
password
üü< D
)
üüD E
)
üüE F
{
†† 
return
°° 
new
°° 
ResponseDTO
°° &
{
¢¢ 
	IsSuccess
££ 
=
££ 
false
££  %
,
££% &
Message
§§ 
=
§§ 
$str
§§ T
,
§§T U

StatusCode
•• 
=
••  
$num
••! $
}
¶¶ 
;
¶¶ 
}
ßß 
var
™™ 
result
™™ 
=
™™ 
await
™™ 
_userManager
™™ +
.
™™+ , 
ResetPasswordAsync
™™, >
(
™™> ?
user
™™? C
,
™™C D
token
™™E J
,
™™J K
password
™™L T
)
™™T U
;
™™U V
if
´´ 
(
´´ 
result
´´ 
.
´´ 
	Succeeded
´´  
)
´´  !
{
¨¨ 
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ &
{
ÆÆ 
	IsSuccess
ØØ 
=
ØØ 
true
ØØ  $
,
ØØ$ %
Message
∞∞ 
=
∞∞ 
$str
∞∞ <
,
∞∞< =

StatusCode
±± 
=
±±  
$num
±±! $
}
≤≤ 
;
≤≤ 
}
≥≥ 
else
¥¥ 
{
µµ 
StringBuilder
∑∑ 
errors
∑∑ $
=
∑∑% &
new
∑∑' *
StringBuilder
∑∑+ 8
(
∑∑8 9
)
∑∑9 :
;
∑∑: ;
foreach
∏∏ 
(
∏∏ 
var
∏∏ 
error
∏∏ "
in
∏∏# %
result
∏∏& ,
.
∏∏, -
Errors
∏∏- 3
)
∏∏3 4
{
ππ 
errors
∫∫ 
.
∫∫ 

AppendLine
∫∫ %
(
∫∫% &
error
∫∫& +
.
∫∫+ ,
Description
∫∫, 7
)
∫∫7 8
;
∫∫8 9
}
ªª 
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ &
{
ææ 
	IsSuccess
øø 
=
øø 
false
øø  %
,
øø% &
Message
¿¿ 
=
¿¿ 
errors
¿¿ $
.
¿¿$ %
ToString
¿¿% -
(
¿¿- .
)
¿¿. /
,
¿¿/ 0

StatusCode
¡¡ 
=
¡¡  
$num
¡¡! $
}
¬¬ 
;
¬¬ 
}
√√ 
}
ƒƒ 	
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
e
≈≈ 
)
≈≈ 
{
∆∆ 	
return
«« 
new
«« 
ResponseDTO
«« "
{
»» 
	IsSuccess
…… 
=
…… 
false
…… !
,
……! "
Message
   
=
   
e
   
.
   
Message
   #
,
  # $

StatusCode
ÀÀ 
=
ÀÀ 
$num
ÀÀ  
}
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
}
ŒŒ 
public
—— 

async
—— 
Task
—— 
<
—— 
ResponseDTO
—— !
>
——! "
ChangePassword
——# 1
(
——1 2
string
——2 8
userId
——9 ?
,
——? @
string
——A G
oldPassword
——H S
,
——S T
string
——U [
newPassword
——\ g
,
——g h
string
““  
confirmNewPassword
““ !
)
““! "
{
”” 
try
‘‘ 
{
’’ 	
var
◊◊ 
user
◊◊ 
=
◊◊ 
await
◊◊ 
_userManager
◊◊ )
.
◊◊) *
FindByIdAsync
◊◊* 7
(
◊◊7 8
userId
◊◊8 >
)
◊◊> ?
;
◊◊? @
if
ÿÿ 
(
ÿÿ 
user
ÿÿ 
==
ÿÿ 
null
ÿÿ 
)
ÿÿ 
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
{
⁄⁄' (
	IsSuccess
⁄⁄) 2
=
⁄⁄3 4
false
⁄⁄5 :
,
⁄⁄: ;
Message
⁄⁄< C
=
⁄⁄D E
$str
⁄⁄F W
}
⁄⁄X Y
;
⁄⁄Y Z
}
€€ 
if
‡‡ 
(
‡‡ 
newPassword
‡‡ 
!=
‡‡  
confirmNewPassword
‡‡ 1
)
‡‡1 2
{
·· 
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ &
{
„„ 
	IsSuccess
„„ 
=
„„  !
false
„„" '
,
„„' (
Message
„„) 0
=
„„1 2
$str
„„3 e
}
„„f g
;
„„g h
}
‰‰ 
if
ÁÁ 
(
ÁÁ 
newPassword
ÁÁ 
==
ÁÁ 
oldPassword
ÁÁ *
)
ÁÁ* +
{
ËË 
return
ÈÈ 
new
ÈÈ 
ResponseDTO
ÈÈ &
{
ÍÍ 
	IsSuccess
ÍÍ 
=
ÍÍ  !
false
ÍÍ" '
,
ÍÍ' (
Message
ÍÍ) 0
=
ÍÍ1 2
$str
ÍÍ3 i
}
ÍÍj k
;
ÍÍk l
}
ÎÎ 
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
await
ÓÓ 
_userManager
ÓÓ +
.
ÓÓ+ ,!
ChangePasswordAsync
ÓÓ, ?
(
ÓÓ? @
user
ÓÓ@ D
,
ÓÓD E
oldPassword
ÓÓF Q
,
ÓÓQ R
newPassword
ÓÓS ^
)
ÓÓ^ _
;
ÓÓ_ `
if
ÔÔ 
(
ÔÔ 
result
ÔÔ 
.
ÔÔ 
	Succeeded
ÔÔ  
)
ÔÔ  !
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ &
{
ÒÒ' (
	IsSuccess
ÒÒ) 2
=
ÒÒ3 4
true
ÒÒ5 9
,
ÒÒ9 :
Message
ÒÒ; B
=
ÒÒC D
$str
ÒÒE e
}
ÒÒf g
;
ÒÒg h
}
ÚÚ 
else
ÛÛ 
{
ÙÙ 
return
ıı 
new
ıı 
ResponseDTO
ıı &
{
ˆˆ 
	IsSuccess
˜˜ 
=
˜˜ 
false
˜˜  %
,
˜˜% &
Message
¯¯ 
=
¯¯ 
$str
¯¯ b
}
˘˘ 
;
˘˘ 
}
˙˙ 
}
˚˚ 	
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 	
return
˛˛ 
new
˛˛ 
ResponseDTO
˛˛ "
{
˛˛# $
	IsSuccess
˛˛% .
=
˛˛/ 0
false
˛˛1 6
,
˛˛6 7
Message
˛˛8 ?
=
˛˛@ A
e
˛˛B C
.
˛˛C D
Message
˛˛D K
}
˛˛L M
;
˛˛M N
}
ˇˇ 	
}
ÄÄ 
public
áá 

async
áá 
Task
áá 
<
áá 
ResponseDTO
áá !
>
áá! "
SendVerifyEmail
áá# 2
(
áá2 3
string
áá3 9
email
áá: ?
,
áá? @
string
ááA G
confirmationLink
ááH X
)
ááX Y
{
àà 
try
ââ 
{
ää 	
await
ãã 
_emailService
ãã 
.
ãã  
SendVerifyEmail
ãã  /
(
ãã/ 0
email
ãã0 5
,
ãã5 6
confirmationLink
ãã7 G
)
ããG H
;
ããH I
return
åå 
new
åå 
(
åå 
)
åå 
{
çç 
Message
éé 
=
éé 
$str
éé :
,
éé: ;
	IsSuccess
èè 
=
èè 
true
èè  
,
èè  !

StatusCode
êê 
=
êê 
$num
êê  
,
êê  !
Result
ëë 
=
ëë 
null
ëë 
}
íí 
;
íí 
}
ìì 	
catch
îî 
(
îî 
	Exception
îî 
e
îî 
)
îî 
{
ïï 	
return
ññ 
new
ññ 
(
ññ 
)
ññ 
{
óó 
Message
òò 
=
òò 
e
òò 
.
òò 
Message
òò #
,
òò# $
	IsSuccess
ôô 
=
ôô 
false
ôô !
,
ôô! "

StatusCode
öö 
=
öö 
$num
öö  
,
öö  !
Result
õõ 
=
õõ 
null
õõ 
}
úú 
;
úú 
}
ùù 	
}
ûû 
public
¶¶ 

async
¶¶ 
Task
¶¶ 
<
¶¶ 
ResponseDTO
¶¶ !
>
¶¶! "
VerifyEmail
¶¶# .
(
¶¶. /
string
¶¶/ 5
userId
¶¶6 <
,
¶¶< =
string
¶¶> D
token
¶¶E J
)
¶¶J K
{
ßß 
var
®® 
user
®® 
=
®® 
await
®® 
_userManager
®® %
.
®®% &
FindByIdAsync
®®& 3
(
®®3 4
userId
®®4 :
)
®®: ;
;
®®; <
if
™™ 

(
™™ 
user
™™ 
.
™™ 
EmailConfirmed
™™ 
)
™™  
{
´´ 	
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ :
,
ÆÆ: ;
	IsSuccess
ØØ 
=
ØØ 
true
ØØ  
,
ØØ  !

StatusCode
∞∞ 
=
∞∞ 
$num
∞∞  
,
∞∞  !
Result
±± 
=
±± 
null
±± 
}
≤≤ 
;
≤≤ 
}
≥≥ 	
var
µµ 
confirmResult
µµ 
=
µµ 
await
µµ !
_userManager
µµ" .
.
µµ. /
ConfirmEmailAsync
µµ/ @
(
µµ@ A
user
µµA E
,
µµE F
token
µµG L
)
µµL M
;
µµM N
if
∑∑ 

(
∑∑ 
!
∑∑ 
confirmResult
∑∑ 
.
∑∑ 
	Succeeded
∑∑ $
)
∑∑$ %
{
∏∏ 	
return
ππ 
new
ππ 
(
ππ 
)
ππ 
{
∫∫ 
Message
ªª 
=
ªª 
confirmResult
ªª '
.
ªª' (
Errors
ªª( .
.
ªª. /
ToString
ªª/ 7
(
ªª7 8
)
ªª8 9
,
ªª9 :

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ !
,
ΩΩ! "
Result
ææ 
=
ææ 
null
ææ 
}
øø 
;
øø 
}
¿¿ 	
return
¬¬ 
new
¬¬ 
(
¬¬ 
)
¬¬ 
{
√√ 	
Message
ƒƒ 
=
ƒƒ 
$str
ƒƒ 2
,
ƒƒ2 3
	IsSuccess
≈≈ 
=
≈≈ 
true
≈≈ 
,
≈≈ 

StatusCode
∆∆ 
=
∆∆ 
$num
∆∆ 
,
∆∆ 
Result
«« 
=
«« 
null
«« 
}
»» 	
;
»»	 

}
…… 
public
–– 

async
–– 
Task
–– 
<
–– 
ResponseDTO
–– !
>
––! "
CheckEmailExist
––# 2
(
––2 3
string
––3 9
email
––: ?
)
––? @
{
—— 
try
““ 
{
”” 	
var
‘‘ 
user
‘‘ 
=
‘‘ 
await
‘‘ 
_userManager
‘‘ )
.
‘‘) *
FindByEmailAsync
‘‘* :
(
‘‘: ;
email
‘‘; @
)
‘‘@ A
;
‘‘A B
return
’’ 
new
’’ 
(
’’ 
)
’’ 
{
÷÷ 
Result
◊◊ 
=
◊◊ 
user
◊◊ 
is
◊◊  
not
◊◊! $
null
◊◊% )
,
◊◊) *
Message
ÿÿ 
=
ÿÿ 
user
ÿÿ 
is
ÿÿ !
null
ÿÿ" &
?
ÿÿ' (
$str
ÿÿ) ?
:
ÿÿ@ A
$str
ÿÿB T
,
ÿÿT U
	IsSuccess
ŸŸ 
=
ŸŸ 
true
ŸŸ  
,
ŸŸ  !

StatusCode
⁄⁄ 
=
⁄⁄ 
$num
⁄⁄  
}
€€ 
;
€€ 
}
‹‹ 	
catch
›› 
(
›› 
	Exception
›› 
e
›› 
)
›› 
{
ﬁﬁ 	
return
ﬂﬂ 
new
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
Message
·· 
=
·· 
e
·· 
.
·· 
Message
·· #
,
··# $
	IsSuccess
‚‚ 
=
‚‚ 
false
‚‚ !
,
‚‚! "

StatusCode
„„ 
=
„„ 
$num
„„  
,
„„  !
Result
‰‰ 
=
‰‰ 
null
‰‰ 
}
ÂÂ 
;
ÂÂ 
}
ÊÊ 	
}
ÁÁ 
public
ÓÓ 

async
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
ResponseDTO
ÓÓ !
>
ÓÓ! "#
CheckPhoneNumberExist
ÓÓ# 8
(
ÓÓ8 9
string
ÓÓ9 ?
phoneNumber
ÓÓ@ K
)
ÓÓK L
{
ÔÔ 
try
 
{
ÒÒ 	
var
ÚÚ 
user
ÚÚ 
=
ÚÚ 
await
ÚÚ 
_userManager
ÚÚ )
.
ÚÚ) *
Users
ÚÚ* /
.
ÚÚ/ 0!
FirstOrDefaultAsync
ÚÚ0 C
(
ÚÚC D
x
ÚÚD E
=>
ÚÚF H
x
ÚÚI J
.
ÚÚJ K
PhoneNumber
ÚÚK V
==
ÚÚW Y
phoneNumber
ÚÚZ e
)
ÚÚe f
;
ÚÚf g
return
ÛÛ 
new
ÛÛ 
(
ÛÛ 
)
ÛÛ 
{
ÙÙ 
Result
ıı 
=
ıı 
user
ıı 
is
ıı  
not
ıı! $
null
ıı% )
,
ıı) *
Message
ˆˆ 
=
ˆˆ 
user
ˆˆ 
is
ˆˆ !
null
ˆˆ" &
?
ˆˆ' (
$str
ˆˆ) G
:
ˆˆH I
$str
ˆˆJ d
,
ˆˆd e
	IsSuccess
˜˜ 
=
˜˜ 
true
˜˜  
,
˜˜  !

StatusCode
¯¯ 
=
¯¯ 
$num
¯¯  
}
˘˘ 
;
˘˘ 
}
˙˙ 	
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 	
return
˝˝ 
new
˝˝ 
(
˝˝ 
)
˝˝ 
{
˛˛ 
Message
ˇˇ 
=
ˇˇ 
e
ˇˇ 
.
ˇˇ 
Message
ˇˇ #
,
ˇˇ# $
Result
Ä	Ä	 
=
Ä	Ä	 
null
Ä	Ä	 
,
Ä	Ä	 
	IsSuccess
Å	Å	 
=
Å	Å	 
false
Å	Å	 !
,
Å	Å	! "

StatusCode
Ç	Ç	 
=
Ç	Ç	 
$num
Ç	Ç	  
}
É	É	 
;
É	É	 
}
Ñ	Ñ	 	
}
Ö	Ö	 
public
é	é	 

async
é	é	 
Task
é	é	 
<
é	é	 
ResponseDTO
é	é	 !
>
é	é	! "$
CompleteStudentProfile
é	é	# 9
(
é	é	9 :
ClaimsPrincipal
è	è	 
User
è	è	 
,
è	è	 '
CompleteStudentProfileDTO
ê	ê	 !
studentProfileDto
ê	ê	" 3
)
ê	ê	3 4
{
ë	ë	 
try
í	í	 
{
ì	ì	 	
var
ï	ï	 
userId
ï	ï	 
=
ï	ï	 
User
ï	ï	 
.
ï	ï	 
Claims
ï	ï	 $
.
ï	ï	$ %
FirstOrDefault
ï	ï	% 3
(
ï	ï	3 4
x
ï	ï	4 5
=>
ï	ï	6 8
x
ï	ï	9 :
.
ï	ï	: ;
Type
ï	ï	; ?
==
ï	ï	@ B

ClaimTypes
ï	ï	C M
.
ï	ï	M N
NameIdentifier
ï	ï	N \
)
ï	ï	\ ]
?
ï	ï	] ^
.
ï	ï	^ _
Value
ï	ï	_ d
;
ï	ï	d e
var
ñ	ñ	 
user
ñ	ñ	 
=
ñ	ñ	 
await
ñ	ñ	 
_userManager
ñ	ñ	 )
.
ñ	ñ	) *
FindByIdAsync
ñ	ñ	* 7
(
ñ	ñ	7 8
userId
ñ	ñ	8 >
)
ñ	ñ	> ?
;
ñ	ñ	? @
if
ô	ô	 
(
ô	ô	 
user
ô	ô	 
is
ô	ô	 
null
ô	ô	 
)
ô	ô	 
{
ö	ö	 
return
õ	õ	 
new
õ	õ	 
ResponseDTO
õ	õ	 &
(
õ	õ	& '
)
õ	õ	' (
{
ú	ú	 
Message
ù	ù	 
=
ù	ù	 
$str
ù	ù	 4
,
ù	ù	4 5
	IsSuccess
û	û	 
=
û	û	 
false
û	û	  %
,
û	û	% &

StatusCode
ü	ü	 
=
ü	ü	  
$num
ü	ü	! $
,
ü	ü	$ %
Result
†	†	 
=
†	†	 
studentProfileDto
†	†	 .
,
†	†	. /
}
°	°	 
;
°	°	 
}
¢	¢	 
var
•	•	 
isPhonenumerExit
•	•	  
=
•	•	! "
await
¶	¶	 
_userManager
¶	¶	 "
.
¶	¶	" #
Users
¶	¶	# (
.
¶	¶	( )
AnyAsync
¶	¶	) 1
(
¶	¶	1 2
u
ß	ß	 
=>
ß	ß	 
u
ß	ß	 
.
ß	ß	 
PhoneNumber
ß	ß	 &
==
ß	ß	' )
studentProfileDto
ß	ß	* ;
.
ß	ß	; <
PhoneNumber
ß	ß	< G
&&
ß	ß	H J
u
ß	ß	K L
.
ß	ß	L M
Id
ß	ß	M O
!=
ß	ß	P R
user
ß	ß	S W
.
ß	ß	W X
Id
ß	ß	X Z
)
ß	ß	Z [
;
ß	ß	[ \
if
®	®	 
(
®	®	 
isPhonenumerExit
®	®	  
)
®	®	  !
{
©	©	 
return
™	™	 
new
™	™	 
ResponseDTO
™	™	 &
(
™	™	& '
)
™	™	' (
{
´	´	 
Message
¨	¨	 
=
¨	¨	 
$str
¨	¨	 E
,
¨	¨	E F
Result
≠	≠	 
=
≠	≠	 
studentProfileDto
≠	≠	 .
,
≠	≠	. /
	IsSuccess
Æ	Æ	 
=
Æ	Æ	 
false
Æ	Æ	  %
,
Æ	Æ	% &

StatusCode
Ø	Ø	 
=
Ø	Ø	  
$num
Ø	Ø	! $
}
∞	∞	 
;
∞	∞	 
}
±	±	 
var
¥	¥	 
isCardExist
¥	¥	 
=
¥	¥	 
await
µ	µ	 
_unitOfWork
µ	µ	 !
.
µ	µ	! "#
PaymentCardRepository
µ	µ	" 7
.
µ	µ	7 8
GetAsync
µ	µ	8 @
(
µ	µ	@ A
x
µ	µ	A B
=>
µ	µ	C E
x
∂	∂	 
.
∂	∂	 

CardNumber
∂	∂	  
==
∂	∂	! #
studentProfileDto
∂	∂	$ 5
.
∂	∂	5 6

CardNumber
∂	∂	6 @
&&
∂	∂	A C
x
∂	∂	D E
.
∂	∂	E F
UserId
∂	∂	F L
!=
∂	∂	M O
user
∂	∂	P T
.
∂	∂	T U
Id
∂	∂	U W
)
∂	∂	W X
;
∂	∂	X Y
if
∑	∑	 
(
∑	∑	 
isCardExist
∑	∑	 
is
∑	∑	 
not
∑	∑	 "
null
∑	∑	# '
)
∑	∑	' (
{
∏	∏	 
return
π	π	 
new
π	π	 
ResponseDTO
π	π	 &
(
π	π	& '
)
π	π	' (
{
∫	∫	 
Message
ª	ª	 
=
ª	ª	 
$str
ª	ª	 D
,
ª	ª	D E

StatusCode
º	º	 
=
º	º	  
$num
º	º	! $
,
º	º	$ %
Result
Ω	Ω	 
=
Ω	Ω	 
studentProfileDto
Ω	Ω	 .
,
Ω	Ω	. /
	IsSuccess
æ	æ	 
=
æ	æ	 
false
æ	æ	  %
}
ø	ø	 
;
ø	ø	 
}
¿	¿	 
user
¬	¬	 
.
¬	¬	 
	BirthDate
¬	¬	 
=
¬	¬	 
studentProfileDto
¬	¬	 .
.
¬	¬	. /
	BirthDate
¬	¬	/ 8
;
¬	¬	8 9
user
√	√	 
.
√	√	 
PhoneNumber
√	√	 
=
√	√	 
studentProfileDto
√	√	 0
.
√	√	0 1
PhoneNumber
√	√	1 <
;
√	√	< =
user
ƒ	ƒ	 
.
ƒ	ƒ	 
Address
ƒ	ƒ	 
=
ƒ	ƒ	 
studentProfileDto
ƒ	ƒ	 ,
.
ƒ	ƒ	, -
Address
ƒ	ƒ	- 4
;
ƒ	ƒ	4 5
user
≈	≈	 
.
≈	≈	 
Country
≈	≈	 
=
≈	≈	 
studentProfileDto
≈	≈	 ,
.
≈	≈	, -
Country
≈	≈	- 4
;
≈	≈	4 5
user
∆	∆	 
.
∆	∆	 
Gender
∆	∆	 
=
∆	∆	 
studentProfileDto
∆	∆	 +
.
∆	∆	+ ,
Gender
∆	∆	, 2
;
∆	∆	2 3
var
»	»	 
student
»	»	 
=
»	»	 
await
»	»	 
_unitOfWork
»	»	  +
.
»	»	+ ,
StudentRepository
»	»	, =
.
»	»	= >
GetAsync
»	»	> F
(
»	»	F G
x
»	»	G H
=>
»	»	I K
x
»	»	L M
.
»	»	M N
UserId
»	»	N T
==
»	»	U W
userId
»	»	X ^
)
»	»	^ _
;
»	»	_ `
if
…	…	 
(
…	…	 
student
…	…	 
is
…	…	 
null
…	…	 
)
…	…	  
{
 	 	 
student
À	À	 
=
À	À	 
new
À	À	 
Student
À	À	 %
(
À	À	% &
)
À	À	& '
{
Ã	Ã	 
UserId
Õ	Õ	 
=
Õ	Õ	 
user
Õ	Õ	 !
.
Õ	Õ	! "
Id
Õ	Õ	" $
,
Õ	Õ	$ %

University
Œ	Œ	 
=
Œ	Œ	  
studentProfileDto
Œ	Œ	! 2
.
Œ	Œ	2 3

University
Œ	Œ	3 =
}
œ	œ	 
;
œ	œ	 
await
–	–	 
_unitOfWork
–	–	 !
.
–	–	! "
StudentRepository
–	–	" 3
.
–	–	3 4
AddAsync
–	–	4 <
(
–	–	< =
student
–	–	= D
)
–	–	D E
;
–	–	E F
}
—	—	 
else
“	“	 
{
”	”	 
student
‘	‘	 
.
‘	‘	 

University
‘	‘	 "
=
‘	‘	# $
studentProfileDto
‘	‘	% 6
.
‘	‘	6 7

University
‘	‘	7 A
;
‘	‘	A B
}
’	’	 
var
◊	◊	 
paymentCard
◊	◊	 
=
◊	◊	 
await
ÿ	ÿ	 
_unitOfWork
ÿ	ÿ	 !
.
ÿ	ÿ	! "#
PaymentCardRepository
ÿ	ÿ	" 7
.
ÿ	ÿ	7 8
GetAsync
ÿ	ÿ	8 @
(
ÿ	ÿ	@ A
x
ÿ	ÿ	A B
=>
ÿ	ÿ	C E
x
Ÿ	Ÿ	 
.
Ÿ	Ÿ	 

CardNumber
Ÿ	Ÿ	  
==
Ÿ	Ÿ	! #
studentProfileDto
Ÿ	Ÿ	$ 5
.
Ÿ	Ÿ	5 6

CardNumber
Ÿ	Ÿ	6 @
&&
Ÿ	Ÿ	A C
x
Ÿ	Ÿ	D E
.
Ÿ	Ÿ	E F
UserId
Ÿ	Ÿ	F L
==
Ÿ	Ÿ	M O
user
Ÿ	Ÿ	P T
.
Ÿ	Ÿ	T U
Id
Ÿ	Ÿ	U W
)
Ÿ	Ÿ	W X
;
Ÿ	Ÿ	X Y
if
⁄	⁄	 
(
⁄	⁄	 
paymentCard
⁄	⁄	 
is
⁄	⁄	 
null
⁄	⁄	 #
)
⁄	⁄	# $
{
€	€	 
paymentCard
‹	‹	 
=
‹	‹	 
new
‹	‹	 !
PaymentCard
‹	‹	" -
(
‹	‹	- .
)
‹	‹	. /
{
›	›	 
CardName
ﬁ	ﬁ	 
=
ﬁ	ﬁ	 
studentProfileDto
ﬁ	ﬁ	 0
.
ﬁ	ﬁ	0 1
CardName
ﬁ	ﬁ	1 9
,
ﬁ	ﬁ	9 :

CardNumber
ﬂ	ﬂ	 
=
ﬂ	ﬂ	  
studentProfileDto
ﬂ	ﬂ	! 2
.
ﬂ	ﬂ	2 3

CardNumber
ﬂ	ﬂ	3 =
,
ﬂ	ﬂ	= >
CardProvider
‡	‡	  
=
‡	‡	! "
studentProfileDto
‡	‡	# 4
.
‡	‡	4 5
CardProvider
‡	‡	5 A
,
‡	‡	A B
UserId
·	·	 
=
·	·	 
user
·	·	 !
.
·	·	! "
Id
·	·	" $
}
‚	‚	 
;
‚	‚	 
await
„	„	 
_unitOfWork
„	„	 !
.
„	„	! "#
PaymentCardRepository
„	„	" 7
.
„	„	7 8
AddAsync
„	„	8 @
(
„	„	@ A
paymentCard
„	„	A L
)
„	„	L M
;
„	„	M N
}
‰	‰	 
var
Ê	Ê	 
isRoleExist
Ê	Ê	 
=
Ê	Ê	 
await
Ê	Ê	 #
_roleManager
Ê	Ê	$ 0
.
Ê	Ê	0 1
RoleExistsAsync
Ê	Ê	1 @
(
Ê	Ê	@ A
StaticUserRoles
Ê	Ê	A P
.
Ê	Ê	P Q
Student
Ê	Ê	Q X
)
Ê	Ê	X Y
;
Ê	Ê	Y Z
if
È	È	 
(
È	È	 
isRoleExist
È	È	 
is
È	È	 
false
È	È	 $
)
È	È	$ %
{
Í	Í	 
await
Î	Î	 
_roleManager
Î	Î	 "
.
Î	Î	" #
CreateAsync
Î	Î	# .
(
Î	Î	. /
new
Î	Î	/ 2
IdentityRole
Î	Î	3 ?
(
Î	Î	? @
StaticUserRoles
Î	Î	@ O
.
Î	Î	O P
Student
Î	Î	P W
)
Î	Î	W X
)
Î	Î	X Y
;
Î	Î	Y Z
}
Ï	Ï	 
await
Ô	Ô	 
_userManager
Ô	Ô	 
.
Ô	Ô	 
AddToRoleAsync
Ô	Ô	 -
(
Ô	Ô	- .
user
Ô	Ô	. 2
,
Ô	Ô	2 3
StaticUserRoles
Ô	Ô	4 C
.
Ô	Ô	C D
Student
Ô	Ô	D K
)
Ô	Ô	K L
;
Ô	Ô	L M
await
Ò	Ò	 
_unitOfWork
Ò	Ò	 
.
Ò	Ò	 
	SaveAsync
Ò	Ò	 '
(
Ò	Ò	' (
)
Ò	Ò	( )
;
Ò	Ò	) *
return
Û	Û	 
new
Û	Û	 
ResponseDTO
Û	Û	 "
(
Û	Û	" #
)
Û	Û	# $
{
Ù	Ù	 
Message
ı	ı	 
=
ı	ı	 
$str
ı	ı	 ?
,
ı	ı	? @
	IsSuccess
ˆ	ˆ	 
=
ˆ	ˆ	 
true
ˆ	ˆ	  
,
ˆ	ˆ	  !

StatusCode
˜	˜	 
=
˜	˜	 
$num
˜	˜	  
,
˜	˜	  !
Result
¯	¯	 
=
¯	¯	 
studentProfileDto
¯	¯	 *
}
˘	˘	 
;
˘	˘	 
}
˙	˙	 	
catch
˚	˚	 
(
˚	˚	 
	Exception
˚	˚	 
e
˚	˚	 
)
˚	˚	 
{
¸	¸	 	
return
˝	˝	 
new
˝	˝	 
ResponseDTO
˝	˝	 "
(
˝	˝	" #
)
˝	˝	# $
{
˛	˛	 
Message
ˇ	ˇ	 
=
ˇ	ˇ	 
e
ˇ	ˇ	 
.
ˇ	ˇ	 
Message
ˇ	ˇ	 #
,
ˇ	ˇ	# $
	IsSuccess
Ä
Ä
 
=
Ä
Ä
 
false
Ä
Ä
 !
,
Ä
Ä
! "

StatusCode
Å
Å
 
=
Å
Å
 
$num
Å
Å
  
,
Å
Å
  !
Result
Ç
Ç
 
=
Ç
Ç
 
null
Ç
Ç
 
}
É
É
 
;
É
É
 
}
Ñ
Ñ
 	
}
Ö
Ö
 
public
é
é
 

async
é
é
 
Task
é
é
 
<
é
é
 
ResponseDTO
é
é
 !
>
é
é
! "'
CompleteInstructorProfile
é
é
# <
(
é
é
< =
ClaimsPrincipal
è
è
 
User
è
è
 
,
è
è
 *
CompleteInstructorProfileDTO
ê
ê
 $"
instructorProfileDto
ê
ê
% 9
)
ê
ê
9 :
{
ë
ë
 
try
í
í
 
{
ì
ì
 	
var
ï
ï
 
userId
ï
ï
 
=
ï
ï
 
User
ï
ï
 
.
ï
ï
 
Claims
ï
ï
 $
.
ï
ï
$ %
FirstOrDefault
ï
ï
% 3
(
ï
ï
3 4
x
ï
ï
4 5
=>
ï
ï
6 8
x
ï
ï
9 :
.
ï
ï
: ;
Type
ï
ï
; ?
==
ï
ï
@ B

ClaimTypes
ï
ï
C M
.
ï
ï
M N
NameIdentifier
ï
ï
N \
)
ï
ï
\ ]
?
ï
ï
] ^
.
ï
ï
^ _
Value
ï
ï
_ d
;
ï
ï
d e
var
ñ
ñ
 
user
ñ
ñ
 
=
ñ
ñ
 
await
ñ
ñ
 
_userManager
ñ
ñ
 )
.
ñ
ñ
) *
FindByIdAsync
ñ
ñ
* 7
(
ñ
ñ
7 8
userId
ñ
ñ
8 >
)
ñ
ñ
> ?
;
ñ
ñ
? @
if
ô
ô
 
(
ô
ô
 
user
ô
ô
 
is
ô
ô
 
null
ô
ô
 
)
ô
ô
 
{
ö
ö
 
return
õ
õ
 
new
õ
õ
 
ResponseDTO
õ
õ
 &
(
õ
õ
& '
)
õ
õ
' (
{
ú
ú
 
Message
ù
ù
 
=
ù
ù
 
$str
ù
ù
 4
,
ù
ù
4 5
	IsSuccess
û
û
 
=
û
û
 
false
û
û
  %
,
û
û
% &

StatusCode
ü
ü
 
=
ü
ü
  
$num
ü
ü
! $
,
ü
ü
$ %
Result
†
†
 
=
†
†
 "
instructorProfileDto
†
†
 1
,
†
†
1 2
}
°
°
 
;
°
°
 
}
¢
¢
 
var
•
•
 
isPhonenumerExit
•
•
  
=
•
•
! "
await
¶
¶
 
_userManager
¶
¶
 "
.
¶
¶
" #
Users
¶
¶
# (
.
¶
¶
( )
AnyAsync
¶
¶
) 1
(
¶
¶
1 2
u
ß
ß
 
=>
ß
ß
 
u
ß
ß
 
.
ß
ß
 
PhoneNumber
ß
ß
 &
==
ß
ß
' )"
instructorProfileDto
ß
ß
* >
.
ß
ß
> ?
PhoneNumber
ß
ß
? J
&&
ß
ß
K M
u
ß
ß
N O
.
ß
ß
O P
Id
ß
ß
P R
!=
ß
ß
S U
user
ß
ß
V Z
.
ß
ß
Z [
Id
ß
ß
[ ]
)
ß
ß
] ^
;
ß
ß
^ _
if
®
®
 
(
®
®
 
isPhonenumerExit
®
®
  
)
®
®
  !
{
©
©
 
return
™
™
 
new
™
™
 
ResponseDTO
™
™
 &
(
™
™
& '
)
™
™
' (
{
´
´
 
Message
¨
¨
 
=
¨
¨
 
$str
¨
¨
 E
,
¨
¨
E F
Result
≠
≠
 
=
≠
≠
 "
instructorProfileDto
≠
≠
 1
,
≠
≠
1 2
	IsSuccess
Æ
Æ
 
=
Æ
Æ
 
false
Æ
Æ
  %
,
Æ
Æ
% &

StatusCode
Ø
Ø
 
=
Ø
Ø
  
$num
Ø
Ø
! $
}
∞
∞
 
;
∞
∞
 
}
±
±
 
var
¥
¥
 
isCardExist
¥
¥
 
=
¥
¥
 
await
µ
µ
 
_unitOfWork
µ
µ
 !
.
µ
µ
! "#
PaymentCardRepository
µ
µ
" 7
.
µ
µ
7 8
GetAsync
µ
µ
8 @
(
µ
µ
@ A
x
µ
µ
A B
=>
µ
µ
C E
x
∂
∂
 
.
∂
∂
 

CardNumber
∂
∂
  
==
∂
∂
! #"
instructorProfileDto
∂
∂
$ 8
.
∂
∂
8 9

CardNumber
∂
∂
9 C
&&
∂
∂
D F
x
∂
∂
G H
.
∂
∂
H I
UserId
∂
∂
I O
!=
∂
∂
P R
user
∂
∂
S W
.
∂
∂
W X
Id
∂
∂
X Z
)
∂
∂
Z [
;
∂
∂
[ \
if
∑
∑
 
(
∑
∑
 
isCardExist
∑
∑
 
is
∑
∑
 
not
∑
∑
 "
null
∑
∑
# '
)
∑
∑
' (
{
∏
∏
 
return
π
π
 
new
π
π
 
ResponseDTO
π
π
 &
(
π
π
& '
)
π
π
' (
{
∫
∫
 
Message
ª
ª
 
=
ª
ª
 
$str
ª
ª
 D
,
ª
ª
D E

StatusCode
º
º
 
=
º
º
  
$num
º
º
! $
,
º
º
$ %
Result
Ω
Ω
 
=
Ω
Ω
 "
instructorProfileDto
Ω
Ω
 1
,
Ω
Ω
1 2
	IsSuccess
æ
æ
 
=
æ
æ
 
false
æ
æ
  %
}
ø
ø
 
;
ø
ø
 
}
¿
¿
 
user
¬
¬
 
.
¬
¬
 
	BirthDate
¬
¬
 
=
¬
¬
 "
instructorProfileDto
¬
¬
 1
.
¬
¬
1 2
	BirthDate
¬
¬
2 ;
;
¬
¬
; <
user
√
√
 
.
√
√
 
PhoneNumber
√
√
 
=
√
√
 "
instructorProfileDto
√
√
 3
.
√
√
3 4
PhoneNumber
√
√
4 ?
;
√
√
? @
user
ƒ
ƒ
 
.
ƒ
ƒ
 
Address
ƒ
ƒ
 
=
ƒ
ƒ
 "
instructorProfileDto
ƒ
ƒ
 /
.
ƒ
ƒ
/ 0
Address
ƒ
ƒ
0 7
;
ƒ
ƒ
7 8
user
≈
≈
 
.
≈
≈
 
Country
≈
≈
 
=
≈
≈
 "
instructorProfileDto
≈
≈
 /
.
≈
≈
/ 0
Country
≈
≈
0 7
;
≈
≈
7 8
user
∆
∆
 
.
∆
∆
 
Gender
∆
∆
 
=
∆
∆
 "
instructorProfileDto
∆
∆
 .
.
∆
∆
. /
Gender
∆
∆
/ 5
;
∆
∆
5 6
user
«
«
 
.
«
«
 
	TaxNumber
«
«
 
=
«
«
 "
instructorProfileDto
«
«
 1
.
«
«
1 2
	TaxNumber
«
«
2 ;
;
«
«
; <
user
»
»
 
.
»
»
 

UpdateTime
»
»
 
=
»
»
 
DateTime
»
»
 &
.
»
»
& '
Now
»
»
' *
;
»
»
* +
var
À
À
 

instructor
À
À
 
=
À
À
 
await
À
À
 "
_unitOfWork
À
À
# .
.
À
À
. /"
InstructorRepository
À
À
/ C
.
À
À
C D
GetAsync
À
À
D L
(
À
À
L M
x
À
À
M N
=>
À
À
O Q
x
À
À
R S
.
À
À
S T
UserId
À
À
T Z
==
À
À
[ ]
userId
À
À
^ d
)
À
À
d e
;
À
À
e f
if
Ã
Ã
 
(
Ã
Ã
 

instructor
Ã
Ã
 
is
Ã
Ã
 
null
Ã
Ã
 "
)
Ã
Ã
" #
{
Õ
Õ
 

instructor
Œ
Œ
 
=
Œ
Œ
 
new
Œ
Œ
  

Instructor
Œ
Œ
! +
(
Œ
Œ
+ ,
)
Œ
Œ
, -
{
œ
œ
 
UserId
–
–
 
=
–
–
 
user
–
–
 !
.
–
–
! "
Id
–
–
" $
,
–
–
$ %
Introduction
—
—
  
=
—
—
! ""
instructorProfileDto
—
—
# 7
.
—
—
7 8
Introduction
—
—
8 D
,
—
—
D E
Degree
“
“
 
=
“
“
 "
instructorProfileDto
“
“
 1
.
“
“
1 2
Degree
“
“
2 8
,
“
“
8 9
Industry
”
”
 
=
”
”
 "
instructorProfileDto
”
”
 3
.
”
”
3 4
Industry
”
”
4 <
}
‘
‘
 
;
‘
‘
 
await
’
’
 
_unitOfWork
’
’
 !
.
’
’
! ""
InstructorRepository
’
’
" 6
.
’
’
6 7
AddAsync
’
’
7 ?
(
’
’
? @

instructor
’
’
@ J
)
’
’
J K
;
’
’
K L
}
÷
÷
 
else
◊
◊
 
{
ÿ
ÿ
 

instructor
Ÿ
Ÿ
 
.
Ÿ
Ÿ
 
Introduction
Ÿ
Ÿ
 '
=
Ÿ
Ÿ
( )"
instructorProfileDto
Ÿ
Ÿ
* >
.
Ÿ
Ÿ
> ?
Introduction
Ÿ
Ÿ
? K
;
Ÿ
Ÿ
K L

instructor
⁄
⁄
 
.
⁄
⁄
 
Industry
⁄
⁄
 #
=
⁄
⁄
$ %"
instructorProfileDto
⁄
⁄
& :
.
⁄
⁄
: ;
Industry
⁄
⁄
; C
;
⁄
⁄
C D
}
€
€
 
var
›
›
 
paymentCard
›
›
 
=
›
›
 
await
ﬁ
ﬁ
 
_unitOfWork
ﬁ
ﬁ
 !
.
ﬁ
ﬁ
! "#
PaymentCardRepository
ﬁ
ﬁ
" 7
.
ﬁ
ﬁ
7 8
GetAsync
ﬁ
ﬁ
8 @
(
ﬁ
ﬁ
@ A
x
ﬁ
ﬁ
A B
=>
ﬁ
ﬁ
C E
x
ﬂ
ﬂ
 
.
ﬂ
ﬂ
 

CardNumber
ﬂ
ﬂ
  
==
ﬂ
ﬂ
! #"
instructorProfileDto
ﬂ
ﬂ
$ 8
.
ﬂ
ﬂ
8 9

CardNumber
ﬂ
ﬂ
9 C
&&
ﬂ
ﬂ
D F
x
ﬂ
ﬂ
G H
.
ﬂ
ﬂ
H I
UserId
ﬂ
ﬂ
I O
==
ﬂ
ﬂ
P R
user
ﬂ
ﬂ
S W
.
ﬂ
ﬂ
W X
Id
ﬂ
ﬂ
X Z
)
ﬂ
ﬂ
Z [
;
ﬂ
ﬂ
[ \
if
‡
‡
 
(
‡
‡
 
paymentCard
‡
‡
 
is
‡
‡
 
null
‡
‡
 #
)
‡
‡
# $
{
·
·
 
paymentCard
‚
‚
 
=
‚
‚
 
new
‚
‚
 !
PaymentCard
‚
‚
" -
(
‚
‚
- .
)
‚
‚
. /
{
„
„
 
CardName
‰
‰
 
=
‰
‰
 "
instructorProfileDto
‰
‰
 3
.
‰
‰
3 4
CardName
‰
‰
4 <
,
‰
‰
< =

CardNumber
Â
Â
 
=
Â
Â
  "
instructorProfileDto
Â
Â
! 5
.
Â
Â
5 6

CardNumber
Â
Â
6 @
,
Â
Â
@ A
CardProvider
Ê
Ê
  
=
Ê
Ê
! ""
instructorProfileDto
Ê
Ê
# 7
.
Ê
Ê
7 8
CardProvider
Ê
Ê
8 D
,
Ê
Ê
D E
UserId
Á
Á
 
=
Á
Á
 
user
Á
Á
 !
.
Á
Á
! "
Id
Á
Á
" $
}
Ë
Ë
 
;
Ë
Ë
 
await
È
È
 
_unitOfWork
È
È
 !
.
È
È
! "#
PaymentCardRepository
È
È
" 7
.
È
È
7 8
AddAsync
È
È
8 @
(
È
È
@ A
paymentCard
È
È
A L
)
È
È
L M
;
È
È
M N
}
Í
Í
 
var
Ï
Ï
 
isRoleExist
Ï
Ï
 
=
Ï
Ï
 
await
Ï
Ï
 #
_roleManager
Ï
Ï
$ 0
.
Ï
Ï
0 1
RoleExistsAsync
Ï
Ï
1 @
(
Ï
Ï
@ A
StaticUserRoles
Ï
Ï
A P
.
Ï
Ï
P Q

Instructor
Ï
Ï
Q [
)
Ï
Ï
[ \
;
Ï
Ï
\ ]
if
Ô
Ô
 
(
Ô
Ô
 
isRoleExist
Ô
Ô
 
is
Ô
Ô
 
false
Ô
Ô
 $
)
Ô
Ô
$ %
{


 
await
Ò
Ò
 
_roleManager
Ò
Ò
 "
.
Ò
Ò
" #
CreateAsync
Ò
Ò
# .
(
Ò
Ò
. /
new
Ò
Ò
/ 2
IdentityRole
Ò
Ò
3 ?
(
Ò
Ò
? @
StaticUserRoles
Ò
Ò
@ O
.
Ò
Ò
O P

Instructor
Ò
Ò
P Z
)
Ò
Ò
Z [
)
Ò
Ò
[ \
;
Ò
Ò
\ ]
}
Ú
Ú
 
await
ı
ı
 
_userManager
ı
ı
 
.
ı
ı
 
AddToRoleAsync
ı
ı
 -
(
ı
ı
- .
user
ı
ı
. 2
,
ı
ı
2 3
StaticUserRoles
ı
ı
4 C
.
ı
ı
C D

Instructor
ı
ı
D N
)
ı
ı
N O
;
ı
ı
O P
await
˜
˜
 
_unitOfWork
˜
˜
 
.
˜
˜
 
	SaveAsync
˜
˜
 '
(
˜
˜
' (
)
˜
˜
( )
;
˜
˜
) *
return
˘
˘
 
new
˘
˘
 
ResponseDTO
˘
˘
 "
(
˘
˘
" #
)
˘
˘
# $
{
˙
˙
 
Message
˚
˚
 
=
˚
˚
 
$str
˚
˚
 ?
,
˚
˚
? @
	IsSuccess
¸
¸
 
=
¸
¸
 
true
¸
¸
  
,
¸
¸
  !

StatusCode
˝
˝
 
=
˝
˝
 
$num
˝
˝
  
,
˝
˝
  !
Result
˛
˛
 
=
˛
˛
 "
instructorProfileDto
˛
˛
 -
}
ˇ
ˇ
 
;
ˇ
ˇ
 
}
ÄÄ 	
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
(
ÉÉ" #
)
ÉÉ# $
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
e
ÖÖ 
.
ÖÖ 
Message
ÖÖ #
,
ÖÖ# $
	IsSuccess
ÜÜ 
=
ÜÜ 
false
ÜÜ !
,
ÜÜ! "

StatusCode
áá 
=
áá 
$num
áá  
,
áá  !
Result
àà 
=
àà 
null
àà 
}
ââ 
;
ââ 
}
ää 	
}
ãã 
public
çç 

async
çç 
Task
çç 
<
çç 
ResponseDTO
çç !
>
çç! "
GetUserInfo
çç# .
(
çç. /
ClaimsPrincipal
çç/ >
User
çç? C
)
ççC D
{
éé 
try
êê 
{
ëë 	
var
íí 
userId
íí 
=
íí 
User
íí 
.
íí 
Claims
íí $
.
íí$ %
FirstOrDefault
íí% 3
(
íí3 4
x
íí4 5
=>
íí6 8
x
íí9 :
.
íí: ;
Type
íí; ?
==
íí@ B

ClaimTypes
ííC M
.
ííM N
NameIdentifier
ííN \
)
íí\ ]
?
íí] ^
.
íí^ _
Value
íí_ d
;
ííd e
var
ìì 
user
ìì 
=
ìì 
await
ìì 
_userManager
ìì )
.
ìì) *
FindByIdAsync
ìì* 7
(
ìì7 8
userId
ìì8 >
)
ìì> ?
;
ìì? @
if
ññ 
(
ññ 
user
ññ 
is
ññ 
null
ññ 
)
ññ 
{
óó 
return
òò 
new
òò 
ResponseDTO
òò &
(
òò& '
)
òò' (
{
ôô 
Message
öö 
=
öö 
$str
öö 4
,
öö4 5
	IsSuccess
õõ 
=
õõ 
false
õõ  %
,
õõ% &

StatusCode
úú 
=
úú  
$num
úú! $
,
úú$ %
Result
ùù 
=
ùù 
null
ùù !
,
ùù! "
}
ûû 
;
ûû 
}
üü 
var
°° 
userInfo
°° 
=
°° 
_mapper
°° "
.
°°" #
Map
°°# &
<
°°& '
UserInfoDTO
°°' 2
>
°°2 3
(
°°3 4
user
°°4 8
)
°°8 9
;
°°9 :
var
¢¢ 
roles
¢¢ 
=
¢¢ 
await
¢¢ 
_userManager
¢¢ *
.
¢¢* +
GetRolesAsync
¢¢+ 8
(
¢¢8 9
user
¢¢9 =
)
¢¢= >
;
¢¢> ?
userInfo
££ 
.
££ 
Roles
££ 
=
££ 
roles
££ "
;
££" #
userInfo
§§ 
.
§§ 

isAccepted
§§ 
=
§§  !
true
§§" &
;
§§& '
if
¶¶ 
(
¶¶ 
roles
¶¶ 
.
¶¶ 
Contains
¶¶ 
(
¶¶ 
StaticUserRoles
¶¶ .
.
¶¶. /

Instructor
¶¶/ 9
)
¶¶9 :
)
¶¶: ;
{
ßß 
var
®® 

instructor
®® 
=
®®  
await
®®! &
_unitOfWork
®®' 2
.
®®2 3"
InstructorRepository
®®3 G
.
®®G H
GetAsync
®®H P
(
®®P Q
x
®®Q R
=>
®®S U
x
®®V W
.
®®W X
UserId
®®X ^
==
®®_ a
user
®®b f
.
®®f g
Id
®®g i
)
®®i j
;
®®j k
userInfo
©© 
.
©© 
isUploadDegree
©© '
=
©©( )

instructor
©©* 4
.
©©4 5
DegreeImageUrl
©©5 C
!=
©©D F
null
©©G K
?
©©L M
true
©©N R
:
©©S T
false
©©U Z
;
©©Z [
userInfo
™™ 
.
™™ 

isAccepted
™™ #
=
™™$ %

instructor
™™& 0
.
™™0 1

IsAccepted
™™1 ;
;
™™; <
}
´´ 
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ "
(
≠≠" #
)
≠≠# $
{
ÆÆ 
Message
ØØ 
=
ØØ 
$str
ØØ 6
,
ØØ6 7
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  
,
∞∞  !

StatusCode
±± 
=
±± 
$num
±±  
,
±±  !
Result
≤≤ 
=
≤≤ 
userInfo
≤≤ !
,
≤≤! "
}
≥≥ 
;
≥≥ 
}
¥¥ 	
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 	
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ "
(
∑∑" #
)
∑∑# $
{
∏∏ 
Message
ππ 
=
ππ 
$str
ππ 0
,
ππ0 1
	IsSuccess
∫∫ 
=
∫∫ 
false
∫∫ !
,
∫∫! "

StatusCode
ªª 
=
ªª 
$num
ªª  
,
ªª  !
Result
ºº 
=
ºº 
null
ºº 
,
ºº 
}
ΩΩ 
;
ΩΩ 
}
ææ 	
}
øø 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
MemoryStream
¡¡ "
>
¡¡" #
DisplayUserAvatar
¡¡$ 5
(
¡¡5 6
string
¡¡6 <
userId
¡¡= C
)
¡¡C D
{
¬¬ 
try
√√ 
{
ƒƒ 	
var
≈≈ 
user
≈≈ 
=
≈≈ 
await
≈≈ 
_userManager
≈≈ )
.
≈≈) *
FindByIdAsync
≈≈* 7
(
≈≈7 8
userId
≈≈8 >
)
≈≈> ?
;
≈≈? @
var
«« 
stream
«« 
=
«« 
await
«« 
_firebaseService
«« /
.
««/ 0
GetImage
««0 8
(
««8 9
user
««9 =
.
««= >
	AvatarUrl
««> G
)
««G H
;
««H I
return
…… 
stream
…… 
;
…… 
}
   	
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
e
ÀÀ 
)
ÀÀ 
{
ÃÃ 	
return
ÕÕ 
null
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
œœ 
public
—— 

async
—— 
Task
—— 
<
—— 
DegreeResponseDTO
—— '
>
——' (%
DisplayInstructorDegree
——) @
(
——@ A
string
——A G
userId
——H N
)
——N O
{
““ 
try
”” 
{
‘‘ 	
if
’’ 
(
’’ 
userId
’’ 
is
’’ 
null
’’ 
)
’’ 
{
÷÷ 
throw
◊◊ 
new
◊◊ 
	Exception
◊◊ #
(
◊◊# $
$str
◊◊$ ;
)
◊◊; <
;
◊◊< =
}
ÿÿ 
var
⁄⁄ 

instructor
⁄⁄ 
=
⁄⁄ 
await
⁄⁄ "
_unitOfWork
⁄⁄# .
.
⁄⁄. /"
InstructorRepository
⁄⁄/ C
.
⁄⁄C D
GetAsync
⁄⁄D L
(
⁄⁄L M
x
⁄⁄M N
=>
⁄⁄O Q
x
⁄⁄R S
.
⁄⁄S T
UserId
⁄⁄T Z
==
⁄⁄[ ]
userId
⁄⁄^ d
)
⁄⁄d e
;
⁄⁄e f
if
‹‹ 
(
‹‹ 

instructor
‹‹ 
is
‹‹ 
null
‹‹ "
)
‹‹" #
{
›› 
throw
ﬁﬁ 
new
ﬁﬁ 
	Exception
ﬁﬁ #
(
ﬁﬁ# $
$str
ﬁﬁ$ @
)
ﬁﬁ@ A
;
ﬁﬁA B
}
ﬂﬂ 
var
·· 

degreePath
·· 
=
·· 

instructor
·· '
?
··' (
.
··( )
DegreeImageUrl
··) 7
;
··7 8
if
‚‚ 
(
‚‚ 

degreePath
‚‚ 
.
‚‚ 
IsNullOrEmpty
‚‚ (
(
‚‚( )
)
‚‚) *
)
‚‚* +
{
„„ 
throw
‰‰ 
new
‰‰ 
	Exception
‰‰ #
(
‰‰# $
$str
‰‰$ H
)
‰‰H I
;
‰‰I J
}
ÂÂ 
var
ÁÁ 
stream
ÁÁ 
=
ÁÁ 
await
ÁÁ 
_firebaseService
ÁÁ /
.
ÁÁ/ 0
GetImage
ÁÁ0 8
(
ÁÁ8 9

instructor
ÁÁ9 C
.
ÁÁC D
DegreeImageUrl
ÁÁD R
)
ÁÁR S
;
ÁÁS T
if
ÈÈ 
(
ÈÈ 
stream
ÈÈ 
is
ÈÈ 
null
ÈÈ 
)
ÈÈ 
{
ÍÍ 
throw
ÎÎ 
new
ÎÎ 
	Exception
ÎÎ #
(
ÎÎ# $
$str
ÎÎ$ F
)
ÎÎF G
;
ÎÎG H
}
ÏÏ 
var
ÓÓ 
contentType
ÓÓ 
=
ÓÓ 
$str
ÓÓ 7
;
ÓÓ7 8
if
 
(
 

degreePath
 
.
 
EndsWith
 #
(
# $
$str
$ *
)
* +
)
+ ,
{
ÒÒ 
contentType
ÚÚ 
=
ÚÚ "
StaticFileExtensions
ÚÚ 2
.
ÚÚ2 3
Pdf
ÚÚ3 6
;
ÚÚ6 7
}
ÛÛ 
if
ıı 
(
ıı 

degreePath
ıı 
.
ıı 
EndsWith
ıı #
(
ıı# $
$str
ıı$ *
)
ıı* +
)
ıı+ ,
{
ˆˆ 
contentType
˜˜ 
=
˜˜ "
StaticFileExtensions
˜˜ 2
.
˜˜2 3
Png
˜˜3 6
;
˜˜6 7
}
¯¯ 
if
˙˙ 
(
˙˙ 

degreePath
˙˙ 
.
˙˙ 
EndsWith
˙˙ #
(
˙˙# $
$str
˙˙$ *
)
˙˙* +
||
˙˙, .

degreePath
˙˙/ 9
.
˙˙9 :
EndsWith
˙˙: B
(
˙˙B C
$str
˙˙C J
)
˙˙J K
)
˙˙K L
{
˚˚ 
contentType
¸¸ 
=
¸¸ "
StaticFileExtensions
¸¸ 2
.
¸¸2 3
Jpeg
¸¸3 7
;
¸¸7 8
}
˝˝ 
return
ˇˇ 
new
ˇˇ 
DegreeResponseDTO
ˇˇ (
(
ˇˇ( )
)
ˇˇ) *
{
ÄÄ 
Message
ÅÅ 
=
ÅÅ 
$str
ÅÅ 1
,
ÅÅ1 2
Stream
ÇÇ 
=
ÇÇ 
stream
ÇÇ 
,
ÇÇ  
ContentType
ÉÉ 
=
ÉÉ 
contentType
ÉÉ )
,
ÉÉ) *
FileName
ÑÑ 
=
ÑÑ 
Path
ÑÑ 
.
ÑÑ  
GetFileName
ÑÑ  +
(
ÑÑ+ ,

degreePath
ÑÑ, 6
)
ÑÑ6 7
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
catch
áá 
(
áá 
	Exception
áá 
e
áá 
)
áá 
{
àà 	
return
ââ 
new
ââ 
DegreeResponseDTO
ââ (
(
ââ( )
)
ââ) *
{
ää 
ContentType
ãã 
=
ãã 
null
ãã "
,
ãã" #
Message
åå 
=
åå 
e
åå 
.
åå 
Message
åå #
,
åå# $
Stream
çç 
=
çç 
null
çç 
}
éé 
;
éé 
}
èè 	
}
êê 
public
óó 

async
óó 
Task
óó 
<
óó 
ResponseDTO
óó !
>
óó! "
SignInByGoogle
óó# 1
(
óó1 2
SignInByGoogleDTO
óó2 C
signInByGoogleDto
óóD U
)
óóU V
{
òò 
try
ôô 
{
öö 	
FirebaseToken
úú 
googleTokenS
úú &
=
úú' (
await
ùù 
FirebaseAuth
ùù "
.
ùù" #
DefaultInstance
ùù# 2
.
ùù2 3 
VerifyIdTokenAsync
ùù3 E
(
ùùE F
signInByGoogleDto
ùùF W
.
ùùW X
Token
ùùX ]
)
ùù] ^
;
ùù^ _
string
ûû 
userId
ûû 
=
ûû 
googleTokenS
ûû (
.
ûû( )
Uid
ûû) ,
;
ûû, -
string
üü 
email
üü 
=
üü 
googleTokenS
üü '
.
üü' (
Claims
üü( .
[
üü. /
$str
üü/ 6
]
üü6 7
.
üü7 8
ToString
üü8 @
(
üü@ A
)
üüA B
;
üüB C
string
†† 
name
†† 
=
†† 
googleTokenS
†† &
.
††& '
Claims
††' -
[
††- .
$str
††. 4
]
††4 5
.
††5 6
ToString
††6 >
(
††> ?
)
††? @
;
††@ A
string
°° 
	avatarUrl
°° 
=
°° 
googleTokenS
°° +
.
°°+ ,
Claims
°°, 2
[
°°2 3
$str
°°3 <
]
°°< =
.
°°= >
ToString
°°> F
(
°°F G
)
°°G H
;
°°H I
var
§§ 
user
§§ 
=
§§ 
await
§§ 
_userManager
§§ )
.
§§) *
FindByEmailAsync
§§* :
(
§§: ;
email
§§; @
)
§§@ A
;
§§A B
UserLoginInfo
•• 
?
•• 
userLoginInfo
•• (
=
••) *
null
••+ /
;
••/ 0
if
¶¶ 
(
¶¶ 
user
¶¶ 
is
¶¶ 
not
¶¶ 
null
¶¶  
)
¶¶  !
{
ßß 
userLoginInfo
®® 
=
®® 
_userManager
®®  ,
.
®®, -
GetLoginsAsync
®®- ;
(
®®; <
user
®®< @
)
®®@ A
.
®®A B

GetAwaiter
®®B L
(
®®L M
)
®®M N
.
®®N O
	GetResult
®®O X
(
®®X Y
)
®®Y Z
.
©© 
FirstOrDefault
©© #
(
©©# $
x
©©$ %
=>
©©& (
x
©©) *
.
©©* +
LoginProvider
©©+ 8
==
©©9 ;!
StaticLoginProvider
©©< O
.
©©O P
Google
©©P V
)
©©V W
;
©©W X
}
™™ 
if
¨¨ 
(
¨¨ 
user
¨¨ 
is
¨¨ 
not
¨¨ 
null
¨¨  
&&
¨¨! #
userLoginInfo
¨¨$ 1
is
¨¨2 4
null
¨¨5 9
)
¨¨9 :
{
≠≠ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ &
(
ÆÆ& '
)
ÆÆ' (
{
ØØ 
Result
∞∞ 
=
∞∞ 
new
∞∞  
SignResponseDTO
∞∞! 0
(
∞∞0 1
)
∞∞1 2
{
±± 
RefreshToken
≤≤ $
=
≤≤% &
null
≤≤' +
,
≤≤+ ,
AccessToken
≥≥ #
=
≥≥$ %
null
≥≥& *
,
≥≥* +
}
¥¥ 
,
¥¥ 
Message
µµ 
=
µµ 
$str
µµ B
,
µµB C
	IsSuccess
∂∂ 
=
∂∂ 
false
∂∂  %
,
∂∂% &

StatusCode
∑∑ 
=
∑∑  
$num
∑∑! $
}
∏∏ 
;
∏∏ 
}
ππ 
if
ªª 
(
ªª 
userLoginInfo
ªª 
is
ªª  
null
ªª! %
&&
ªª& (
user
ªª) -
is
ªª. 0
null
ªª1 5
)
ªª5 6
{
ºº 
user
ææ 
=
ææ 
new
ææ 
ApplicationUser
ææ *
{
øø 
Email
¿¿ 
=
¿¿ 
email
¿¿ !
,
¿¿! "
FullName
¡¡ 
=
¡¡ 
name
¡¡ #
,
¡¡# $
UserName
¬¬ 
=
¬¬ 
email
¬¬ $
,
¬¬$ %
	AvatarUrl
√√ 
=
√√ 
	avatarUrl
√√  )
,
√√) *
EmailConfirmed
ƒƒ "
=
ƒƒ# $
true
ƒƒ% )
,
ƒƒ) *

UpdateTime
≈≈ 
=
≈≈  
null
≈≈! %
}
∆∆ 
;
∆∆ 
await
»» 
_userManager
»» "
.
»»" #
CreateAsync
»»# .
(
»». /
user
»»/ 3
)
»»3 4
;
»»4 5
await
…… 
_userManager
…… "
.
……" #
AddLoginAsync
……# 0
(
……0 1
user
……1 5
,
……5 6
new
   
UserLoginInfo
   %
(
  % &!
StaticLoginProvider
  & 9
.
  9 :
Google
  : @
,
  @ A
userId
  B H
,
  H I
$str
  J R
)
  R S
)
  S T
;
  T U
}
ÀÀ 
var
ÕÕ 
accessToken
ÕÕ 
=
ÕÕ 
await
ÕÕ #
_tokenService
ÕÕ$ 1
.
ÕÕ1 2)
GenerateJwtAccessTokenAsync
ÕÕ2 M
(
ÕÕM N
user
ÕÕN R
)
ÕÕR S
;
ÕÕS T
var
ŒŒ 
refreshToken
ŒŒ 
=
ŒŒ 
await
ŒŒ $
_tokenService
ŒŒ% 2
.
ŒŒ2 3*
GenerateJwtRefreshTokenAsync
ŒŒ3 O
(
ŒŒO P
user
ŒŒP T
)
ŒŒT U
;
ŒŒU V
await
œœ 
_tokenService
œœ 
.
œœ  
StoreRefreshToken
œœ  1
(
œœ1 2
user
œœ2 6
.
œœ6 7
Id
œœ7 9
,
œœ9 :
refreshToken
œœ; G
)
œœG H
;
œœH I
return
—— 
new
—— 
ResponseDTO
—— "
(
——" #
)
——# $
{
““ 
Result
”” 
=
”” 
new
”” 
SignResponseDTO
”” ,
(
””, -
)
””- .
{
‘‘ 
AccessToken
’’ 
=
’’  !
accessToken
’’" -
,
’’- .
RefreshToken
÷÷  
=
÷÷! "
refreshToken
÷÷# /
,
÷÷/ 0
}
◊◊ 
,
◊◊ 
Message
ÿÿ 
=
ÿÿ 
$str
ÿÿ 0
,
ÿÿ0 1
	IsSuccess
ŸŸ 
=
ŸŸ 
true
ŸŸ  
,
ŸŸ  !

StatusCode
⁄⁄ 
=
⁄⁄ 
$num
⁄⁄  
}
€€ 
;
€€ 
}
‹‹ 	
catch
›› 
(
›› #
FirebaseAuthException
›› $
e
››% &
)
››& '
{
ﬁﬁ 	
return
ﬂﬂ 
new
ﬂﬂ 
ResponseDTO
ﬂﬂ "
(
ﬂﬂ" #
)
ﬂﬂ# $
{
‡‡ 
Result
·· 
=
·· 
new
·· 
SignResponseDTO
·· ,
(
··, -
)
··- .
{
‚‚ 
AccessToken
„„ 
=
„„  !
null
„„" &
,
„„& '
RefreshToken
‰‰  
=
‰‰! "
null
‰‰# '
,
‰‰' (
}
ÂÂ 
,
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
$str
ÊÊ 0
,
ÊÊ0 1
	IsSuccess
ÁÁ 
=
ÁÁ 
false
ÁÁ !
,
ÁÁ! "

StatusCode
ËË 
=
ËË 
$num
ËË  
}
ÈÈ 
;
ÈÈ 
}
ÍÍ 	
}
ÎÎ 
public
ÚÚ 

async
ÚÚ 
Task
ÚÚ 
<
ÚÚ 
ResponseDTO
ÚÚ !
>
ÚÚ! "
UpdateStudent
ÚÚ# 0
(
ÚÚ0 1%
UpdateStudentProfileDTO
ÚÚ1 H
updateStudentDTO
ÚÚI Y
,
ÚÚY Z
ClaimsPrincipal
ÚÚ[ j
User
ÚÚk o
)
ÚÚo p
{
ÛÛ 
try
ÙÙ 
{
ıı 	
var
ˆˆ 
userId
ˆˆ 
=
ˆˆ 
User
ˆˆ 
.
ˆˆ 
Claims
ˆˆ $
.
ˆˆ$ %
FirstOrDefault
ˆˆ% 3
(
ˆˆ3 4
x
ˆˆ4 5
=>
ˆˆ6 8
x
ˆˆ9 :
.
ˆˆ: ;
Type
ˆˆ; ?
==
ˆˆ@ B

ClaimTypes
ˆˆC M
.
ˆˆM N
NameIdentifier
ˆˆN \
)
ˆˆ\ ]
?
ˆˆ] ^
.
ˆˆ^ _
Value
ˆˆ_ d
;
ˆˆd e
if
¯¯ 
(
¯¯ 
userId
¯¯ 
is
¯¯ 
null
¯¯ 
)
¯¯ 
{
˘˘ 
return
˙˙ 
new
˙˙ 
ResponseDTO
˙˙ &
{
˚˚ 
Message
¸¸ 
=
¸¸ 
$str
¸¸ .
,
¸¸. /
Result
˝˝ 
=
˝˝ 
null
˝˝ !
,
˝˝! "
	IsSuccess
˛˛ 
=
˛˛ 
false
˛˛  %
,
˛˛% &

StatusCode
ˇˇ 
=
ˇˇ  
$num
ˇˇ! $
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ 
studentToUpdate
ÉÉ 
=
ÉÉ  !
await
ÉÉ" '
_unitOfWork
ÉÉ( 3
.
ÉÉ3 4
StudentRepository
ÉÉ4 E
.
ÉÉE F
GetByUserId
ÉÉF Q
(
ÉÉQ R
userId
ÉÉR X
)
ÉÉX Y
;
ÉÉY Z
if
ÖÖ 
(
ÖÖ 
studentToUpdate
ÖÖ 
==
ÖÖ  "
null
ÖÖ# '
)
ÖÖ' (
{
ÜÜ 
return
áá 
new
áá 
ResponseDTO
áá &
{
àà 
Message
ââ 
=
ââ 
$str
ââ 1
,
ââ1 2
Result
ää 
=
ää 
null
ää !
,
ää! "
	IsSuccess
ãã 
=
ãã 
false
ãã  %
,
ãã% &

StatusCode
åå 
=
åå  
$num
åå! $
}
çç 
;
çç 
}
éé 
studentToUpdate
ëë 
.
ëë 

University
ëë &
=
ëë' (
updateStudentDTO
ëë) 9
.
ëë9 :

University
ëë: D
;
ëëD E
studentToUpdate
îî 
.
îî 
ApplicationUser
îî +
.
îî+ ,
Address
îî, 3
=
îî4 5
updateStudentDTO
îî6 F
.
îîF G
Address
îîG N
;
îîN O
studentToUpdate
ïï 
.
ïï 
ApplicationUser
ïï +
.
ïï+ ,
	BirthDate
ïï, 5
=
ïï6 7
updateStudentDTO
ïï8 H
.
ïïH I
	BirthDate
ïïI R
;
ïïR S
studentToUpdate
ññ 
.
ññ 
ApplicationUser
ññ +
.
ññ+ ,
Gender
ññ, 2
=
ññ3 4
updateStudentDTO
ññ5 E
.
ññE F
Gender
ññF L
;
ññL M
studentToUpdate
óó 
.
óó 
ApplicationUser
óó +
.
óó+ ,
FullName
óó, 4
=
óó5 6
updateStudentDTO
óó7 G
.
óóG H
FullName
óóH P
;
óóP Q
studentToUpdate
òò 
.
òò 
ApplicationUser
òò +
.
òò+ ,
Country
òò, 3
=
òò4 5
updateStudentDTO
òò6 F
.
òòF G
Country
òòG N
;
òòN O
if
úú 
(
úú 
!
úú 
string
úú 
.
úú  
IsNullOrWhiteSpace
úú *
(
úú* +
updateStudentDTO
úú+ ;
.
úú; <

CardNumber
úú< F
)
úúF G
&&
úúH J
!
ùù 
string
ùù 
.
ùù  
IsNullOrWhiteSpace
ùù *
(
ùù* +
updateStudentDTO
ùù+ ;
.
ùù; <
CardName
ùù< D
)
ùùD E
&&
ùùF H
!
ûû 
string
ûû 
.
ûû  
IsNullOrWhiteSpace
ûû *
(
ûû* +
updateStudentDTO
ûû+ ;
.
ûû; <
CardProvider
ûû< H
)
ûûH I
)
ûûI J
{
üü 
var
°° 
existingCard
°°  
=
°°! "
await
°°# (
_unitOfWork
°°) 4
.
°°4 5#
PaymentCardRepository
°°5 J
.
°°J K
GetCardByUserId
°°K Z
(
°°Z [
studentToUpdate
°°[ j
.
°°j k
UserId
°°k q
)
°°q r
;
°°r s
if
¢¢ 
(
¢¢ 
existingCard
¢¢  
!=
¢¢! #
null
¢¢$ (
)
¢¢( )
{
££ 
_unitOfWork
§§ 
.
§§  #
PaymentCardRepository
§§  5
.
§§5 6
Delete
§§6 <
(
§§< =
existingCard
§§= I
)
§§I J
;
§§J K
await
•• 
_unitOfWork
•• %
.
••% &
	SaveAsync
••& /
(
••/ 0
)
••0 1
;
••1 2
}
¶¶ 
PaymentCard
©© 
newPaymentCard
©© *
=
©©+ ,
new
©©- 0
PaymentCard
©©1 <
(
©©< =
)
©©= >
{
™™ 
CardName
´´ 
=
´´ 
updateStudentDTO
´´ /
.
´´/ 0
CardName
´´0 8
,
´´8 9

CardNumber
¨¨ 
=
¨¨  
updateStudentDTO
¨¨! 1
.
¨¨1 2

CardNumber
¨¨2 <
,
¨¨< =
CardProvider
≠≠  
=
≠≠! "
updateStudentDTO
≠≠# 3
.
≠≠3 4
CardProvider
≠≠4 @
,
≠≠@ A
UserId
ÆÆ 
=
ÆÆ 
studentToUpdate
ÆÆ ,
.
ÆÆ, -
UserId
ÆÆ- 3
}
ØØ 
;
ØØ 
await
∞∞ 
_unitOfWork
∞∞ !
.
∞∞! "#
PaymentCardRepository
∞∞" 7
.
∞∞7 8
AddAsync
∞∞8 @
(
∞∞@ A
newPaymentCard
∞∞A O
)
∞∞O P
;
∞∞P Q
}
±± 
_unitOfWork
¥¥ 
.
¥¥ 
StudentRepository
¥¥ )
.
¥¥) *
Update
¥¥* 0
(
¥¥0 1
studentToUpdate
¥¥1 @
)
¥¥@ A
;
¥¥A B
await
µµ 
_unitOfWork
µµ 
.
µµ 
	SaveAsync
µµ '
(
µµ' (
)
µµ( )
;
µµ) *
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ "
{
∏∏ 
Message
ππ 
=
ππ 
$str
ππ 8
,
ππ8 9
Result
∫∫ 
=
∫∫ 
null
∫∫ 
,
∫∫ 
	IsSuccess
ªª 
=
ªª 
true
ªª  
,
ªª  !

StatusCode
ºº 
=
ºº 
$num
ºº  
}
ΩΩ 
;
ΩΩ 
}
ææ 	
catch
øø 
(
øø 
	Exception
øø 
e
øø 
)
øø 
{
¿¿ 	
return
¡¡ 
new
¡¡ 
ResponseDTO
¡¡ "
{
¬¬ 
Message
√√ 
=
√√ 
e
√√ 
.
√√ 
Message
√√ #
,
√√# $
Result
ƒƒ 
=
ƒƒ 
null
ƒƒ 
,
ƒƒ 
	IsSuccess
≈≈ 
=
≈≈ 
false
≈≈ !
,
≈≈! "

StatusCode
∆∆ 
=
∆∆ 
$num
∆∆  
}
«« 
;
«« 
}
»» 	
}
…… 
public
œœ 

async
œœ 
Task
œœ 
<
œœ 
ResponseDTO
œœ !
>
œœ! "
UpdateInstructor
œœ# 3
(
œœ3 4'
UpdateIntructorProfileDTO
œœ4 M 
updateIntructorDTO
œœN `
,
œœ` a
ClaimsPrincipal
œœb q
User
œœr v
)
œœv w
{
–– 
try
—— 
{
““ 	
var
”” 
userId
”” 
=
”” 
User
”” 
.
”” 
Claims
”” $
.
””$ %
FirstOrDefault
””% 3
(
””3 4
x
””4 5
=>
””6 8
x
””9 :
.
””: ;
Type
””; ?
==
””@ B

ClaimTypes
””C M
.
””M N
NameIdentifier
””N \
)
””\ ]
?
””] ^
.
””^ _
Value
””_ d
;
””d e
if
’’ 
(
’’ 
userId
’’ 
is
’’ 
null
’’ 
)
’’ 
{
÷÷ 
return
◊◊ 
new
◊◊ 
ResponseDTO
◊◊ &
{
ÿÿ 
Message
ŸŸ 
=
ŸŸ 
$str
ŸŸ .
,
ŸŸ. /
Result
⁄⁄ 
=
⁄⁄ 
null
⁄⁄ !
,
⁄⁄! "
	IsSuccess
€€ 
=
€€ 
false
€€  %
,
€€% &

StatusCode
‹‹ 
=
‹‹  
$num
‹‹! $
}
›› 
;
›› 
}
ﬁﬁ 
var
‡‡ 
intructorToUpdate
‡‡ !
=
‡‡" #
await
‡‡$ )
_unitOfWork
‡‡* 5
.
‡‡5 6"
InstructorRepository
‡‡6 J
.
‡‡J K
GetByUserId
‡‡K V
(
‡‡V W
userId
‡‡W ]
)
‡‡] ^
;
‡‡^ _
if
‚‚ 
(
‚‚ 
intructorToUpdate
‚‚ !
==
‚‚" $
null
‚‚% )
)
‚‚) *
{
„„ 
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ &
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
$str
ÊÊ 3
,
ÊÊ3 4
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ !
,
ÁÁ! "
	IsSuccess
ËË 
=
ËË 
false
ËË  %
,
ËË% &

StatusCode
ÈÈ 
=
ÈÈ  
$num
ÈÈ! $
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 
intructorToUpdate
ÓÓ 
.
ÓÓ 
Degree
ÓÓ $
=
ÓÓ% & 
updateIntructorDTO
ÓÓ' 9
.
ÓÓ9 :
Degree
ÓÓ: @
;
ÓÓ@ A
intructorToUpdate
ÔÔ 
.
ÔÔ 
Industry
ÔÔ &
=
ÔÔ' ( 
updateIntructorDTO
ÔÔ) ;
.
ÔÔ; <
Industry
ÔÔ< D
;
ÔÔD E
intructorToUpdate
 
.
 
Introduction
 *
=
+ , 
updateIntructorDTO
- ?
.
? @
Introduction
@ L
;
L M
intructorToUpdate
ÛÛ 
.
ÛÛ 
ApplicationUser
ÛÛ -
.
ÛÛ- .
Address
ÛÛ. 5
=
ÛÛ6 7 
updateIntructorDTO
ÛÛ8 J
.
ÛÛJ K
Address
ÛÛK R
;
ÛÛR S
intructorToUpdate
ÙÙ 
.
ÙÙ 
ApplicationUser
ÙÙ -
.
ÙÙ- .
	BirthDate
ÙÙ. 7
=
ÙÙ8 9 
updateIntructorDTO
ÙÙ: L
.
ÙÙL M
	BirthDate
ÙÙM V
;
ÙÙV W
intructorToUpdate
ıı 
.
ıı 
ApplicationUser
ıı -
.
ıı- .
Gender
ıı. 4
=
ıı5 6 
updateIntructorDTO
ıı7 I
.
ııI J
Gender
ııJ P
;
ııP Q
intructorToUpdate
ˆˆ 
.
ˆˆ 
ApplicationUser
ˆˆ -
.
ˆˆ- .
FullName
ˆˆ. 6
=
ˆˆ7 8 
updateIntructorDTO
ˆˆ9 K
.
ˆˆK L
FullName
ˆˆL T
;
ˆˆT U
intructorToUpdate
˜˜ 
.
˜˜ 
ApplicationUser
˜˜ -
.
˜˜- .
Country
˜˜. 5
=
˜˜6 7 
updateIntructorDTO
˜˜8 J
.
˜˜J K
Country
˜˜K R
;
˜˜R S
intructorToUpdate
¯¯ 
.
¯¯ 
ApplicationUser
¯¯ -
.
¯¯- .
	TaxNumber
¯¯. 7
=
¯¯8 9 
updateIntructorDTO
¯¯: L
.
¯¯L M
	TaxNumber
¯¯M V
;
¯¯V W
if
˚˚ 
(
˚˚ 
!
˚˚ 
string
˚˚ 
.
˚˚  
IsNullOrWhiteSpace
˚˚ *
(
˚˚* + 
updateIntructorDTO
˚˚+ =
.
˚˚= >

CardNumber
˚˚> H
)
˚˚H I
&&
˚˚J L
!
¸¸ 
string
¸¸ 
.
¸¸  
IsNullOrWhiteSpace
¸¸ *
(
¸¸* + 
updateIntructorDTO
¸¸+ =
.
¸¸= >
CardName
¸¸> F
)
¸¸F G
&&
¸¸H J
!
˝˝ 
string
˝˝ 
.
˝˝  
IsNullOrWhiteSpace
˝˝ *
(
˝˝* + 
updateIntructorDTO
˝˝+ =
.
˝˝= >
CardProvider
˝˝> J
)
˝˝J K
)
˝˝K L
{
˛˛ 
var
ÄÄ 
existingCard
ÄÄ  
=
ÄÄ! "
await
ÄÄ# (
_unitOfWork
ÄÄ) 4
.
ÄÄ4 5#
PaymentCardRepository
ÄÄ5 J
.
ÄÄJ K
GetCardByUserId
ÄÄK Z
(
ÄÄZ [
intructorToUpdate
ÄÄ[ l
.
ÄÄl m
UserId
ÄÄm s
)
ÄÄs t
;
ÄÄt u
if
ÅÅ 
(
ÅÅ 
existingCard
ÅÅ  
!=
ÅÅ! #
null
ÅÅ$ (
)
ÅÅ( )
{
ÇÇ 
_unitOfWork
ÉÉ 
.
ÉÉ  #
PaymentCardRepository
ÉÉ  5
.
ÉÉ5 6
Delete
ÉÉ6 <
(
ÉÉ< =
existingCard
ÉÉ= I
)
ÉÉI J
;
ÉÉJ K
await
ÑÑ 
_unitOfWork
ÑÑ %
.
ÑÑ% &
	SaveAsync
ÑÑ& /
(
ÑÑ/ 0
)
ÑÑ0 1
;
ÑÑ1 2
}
ÖÖ 
PaymentCard
àà 
newPaymentCard
àà *
=
àà+ ,
new
àà- 0
PaymentCard
àà1 <
(
àà< =
)
àà= >
{
ââ 
CardName
ää 
=
ää  
updateIntructorDTO
ää 1
.
ää1 2
CardName
ää2 :
,
ää: ;

CardNumber
ãã 
=
ãã   
updateIntructorDTO
ãã! 3
.
ãã3 4

CardNumber
ãã4 >
,
ãã> ?
CardProvider
åå  
=
åå! " 
updateIntructorDTO
åå# 5
.
åå5 6
CardProvider
åå6 B
,
ååB C
UserId
çç 
=
çç 
intructorToUpdate
çç .
.
çç. /
UserId
çç/ 5
}
éé 
;
éé 
await
èè 
_unitOfWork
èè !
.
èè! "#
PaymentCardRepository
èè" 7
.
èè7 8
AddAsync
èè8 @
(
èè@ A
newPaymentCard
èèA O
)
èèO P
;
èèP Q
}
êê 
_unitOfWork
ìì 
.
ìì "
InstructorRepository
ìì ,
.
ìì, -
Update
ìì- 3
(
ìì3 4
intructorToUpdate
ìì4 E
)
ììE F
;
ììF G
await
îî 
_unitOfWork
îî 
.
îî 
	SaveAsync
îî '
(
îî' (
)
îî( )
;
îî) *
return
ññ 
new
ññ 
ResponseDTO
ññ "
{
óó 
Message
òò 
=
òò 
$str
òò :
,
òò: ;
Result
ôô 
=
ôô 
null
ôô 
,
ôô 
	IsSuccess
öö 
=
öö 
true
öö  
,
öö  !

StatusCode
õõ 
=
õõ 
$num
õõ  
}
úú 
;
úú 
}
ùù 	
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 	
return
†† 
new
†† 
ResponseDTO
†† "
{
°° 
Message
¢¢ 
=
¢¢ 
e
¢¢ 
.
¢¢ 
Message
¢¢ #
,
¢¢# $
Result
££ 
=
££ 
null
££ 
,
££ 
	IsSuccess
§§ 
=
§§ 
false
§§ !
,
§§! "

StatusCode
•• 
=
•• 
$num
••  
}
¶¶ 
;
¶¶ 
}
ßß 	
}
®® 
}™™ ≠Á
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Mappings\AutoMapperProfile.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Mappings %
;% &
public 
class 
AutoMapperProfile 
:  
Profile! (
{		 
public

 

AutoMapperProfile

 
(

 
)

 
{ 
	CreateMap 
< 
UserInfoDTO 
, 
ApplicationUser .
>. /
(/ 0
)0 1
.1 2

ReverseMap2 <
(< =
)= >
;> ?
	CreateMap 
< 
Category 
, 
CategoryDTO '
>' (
(( )
)) *
.* +

ReverseMap+ 5
(5 6
)6 7
;7 8
	CreateMap 
< 
Category 
, 
CreateCategoryDTO -
>- .
(. /
)/ 0
.0 1

ReverseMap1 ;
(; <
)< =
;= >
	CreateMap 
< 
CreateCategoryDTO #
,# $
Category% -
>- .
(. /
)/ 0
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
Id$ &
,& '
opt( +
=> 
opt 
. 
MapFrom 
( 
src "
=># %
Guid& *
.* +
NewGuid+ 2
(2 3
)3 4
)4 5
)5 6
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
ParentId$ ,
,, -
opt. 1
=> 
opt 
. 
MapFrom 
( 
src "
=># %
src& )
.) *
ParentId* 2
!=3 5
null6 :
?; <
Guid= A
.A B
ParseB G
(G H
srcH K
.K L
ParentIdL T
)T U
:V W
(X Y
GuidY ]
?] ^
)^ _
null_ c
)c d
)d e
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
Category 
, 
UpdateCategoryDTO -
>- .
(. /
)/ 0
.0 1

ReverseMap1 ;
(; <
)< =
;= >
	CreateMap 
< 
Category 
, 
AdminCategoryDTO ,
>, -
(- .
). /
. 
	ForMember 
( 
dest 
=> 
dest #
.# $

ParentName$ .
,. /
opt0 3
=> 
opt 
. 
MapFrom 
( 
src "
=># %
src& )
.) *
ParentCategory* 8
.8 9
Name9 =
)= >
)> ?
.? @

ReverseMap@ J
(J K
)K L
;L M
	CreateMap 
< 
EmailTemplateDTO "
," #
EmailTemplateDTO$ 4
>4 5
(5 6
)6 7
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
TemplateName$ 0
,0 1
opt2 5
=>   
opt   
.   
MapFrom   
(   
src   "
=>  # %
src  & )
.  ) *
TemplateName  * 6
)  6 7
)  7 8
.!! 
	ForMember!! 
(!! 
dest!! 
=>!! 
dest!! #
.!!# $

SenderName!!$ .
,!!. /
opt!!0 3
=>"" 
opt"" 
."" 
MapFrom"" 
("" 
src"" "
=>""# %
src""& )
."") *

SenderName""* 4
)""4 5
)""5 6
.## 
	ForMember## 
(## 
dest## 
=>## 
dest## #
.### $
SenderEmail##$ /
,##/ 0
opt##1 4
=>$$ 
opt$$ 
.$$ 
MapFrom$$ 
($$ 
src$$ "
=>$$# %
src$$& )
.$$) *
SenderEmail$$* 5
)$$5 6
)$$6 7
.%% 
	ForMember%% 
(%% 
dest%% 
=>%% 
dest%% #
.%%# $
Category%%$ ,
,%%, -
opt%%. 1
=>&& 
opt&& 
.&& 
MapFrom&& 
(&& 
src&& "
=>&&# %
src&&& )
.&&) *
Category&&* 2
)&&2 3
)&&3 4
.'' 
	ForMember'' 
('' 
dest'' 
=>'' 
dest'' #
.''# $
SubjectLine''$ /
,''/ 0
opt''1 4
=>(( 
opt(( 
.(( 
MapFrom(( 
((( 
src(( "
=>((# %
src((& )
.(() *
SubjectLine((* 5
)((5 6
)((6 7
.)) 
	ForMember)) 
()) 
dest)) 
=>)) 
dest)) #
.))# $
PreHeaderText))$ 1
,))1 2
opt))3 6
=>** 
opt** 
.** 
MapFrom** 
(** 
src** "
=>**# %
src**& )
.**) *
PreHeaderText*** 7
)**7 8
)**8 9
.++ 
	ForMember++ 
(++ 
dest++ 
=>++ 
dest++ #
.++# $
PersonalizationTags++$ 7
,++7 8
opt++9 <
=>,, 
opt,, 
.,, 
MapFrom,, 
(,, 
src,, "
=>,,# %
src,,& )
.,,) *
PersonalizationTags,,* =
),,= >
),,> ?
.-- 
	ForMember-- 
(-- 
dest-- 
=>-- 
dest-- #
.--# $
BodyContent--$ /
,--/ 0
opt--1 4
=>.. 
opt.. 
... 
MapFrom.. 
(.. 
src.. "
=>..# %
src..& )
...) *
BodyContent..* 5
)..5 6
)..6 7
.// 
	ForMember// 
(// 
dest// 
=>// 
dest// #
.//# $
FooterContent//$ 1
,//1 2
opt//3 6
=>00 
opt00 
.00 
MapFrom00 
(00 
src00 "
=>00# %
src00& )
.00) *
FooterContent00* 7
)007 8
)008 9
.11 
	ForMember11 
(11 
dest11 
=>11 
dest11 #
.11# $
CallToAction11$ 0
,110 1
opt112 5
=>22 
opt22 
.22 
MapFrom22 
(22 
src22 "
=>22# %
src22& )
.22) *
CallToAction22* 6
)226 7
)227 8
.33 
	ForMember33 
(33 
dest33 
=>33 
dest33 #
.33# $
Language33$ ,
,33, -
opt33. 1
=>44 
opt44 
.44 
MapFrom44 
(44 
src44 "
=>44# %
src44& )
.44) *
Language44* 2
)442 3
)443 4
.55 
	ForMember55 
(55 
dest55 
=>55 
dest55 #
.55# $
RecipientType55$ 1
,551 2
opt553 6
=>66 
opt66 
.66 
MapFrom66 
(66 
src66 "
=>66# %
src66& )
.66) *
RecipientType66* 7
)667 8
)668 9
.77 

ReverseMap77 
(77 
)77 
;77 
	CreateMap99 
<99 

Instructor99 
,99 !
InstructorInfoLiteDTO99 3
>993 4
(994 5
)995 6
.:: 
	ForMember:: 
(:: 
dest:: 
=>:: 
dest:: #
.::# $
FullName::$ ,
,::, -
opt::. 1
=>;; 
opt;; 
.;; 
MapFrom;; 
(;; 
src;; "
=>;;# %
src;;& )
.;;) *
ApplicationUser;;* 9
.;;9 :
FullName;;: B
);;B C
);;C D
.<< 
	ForMember<< 
(<< 
dest<< 
=><< 
dest<< #
.<<# $
Email<<$ )
,<<) *
opt<<+ .
=>== 
opt== 
.== 
MapFrom== 
(== 
src== "
=>==# %
src==& )
.==) *
ApplicationUser==* 9
.==9 :
Email==: ?
)==? @
)==@ A
.>> 
	ForMember>> 
(>> 
dest>> 
=>>> 
dest>> #
.>># $
PhoneNumber>>$ /
,>>/ 0
opt>>1 4
=>?? 
opt?? 
.?? 
MapFrom?? 
(?? 
src?? "
=>??# %
src??& )
.??) *
ApplicationUser??* 9
.??9 :
PhoneNumber??: E
)??E F
)??F G
.@@ 
	ForMember@@ 
(@@ 
dest@@ 
=>@@ 
dest@@ #
.@@# $
Gender@@$ *
,@@* +
opt@@, /
=>AA 
optAA 
.AA 
MapFromAA 
(AA 
srcAA "
=>AA# %
srcAA& )
.AA) *
ApplicationUserAA* 9
.AA9 :
GenderAA: @
)AA@ A
)AAA B
.BB 
	ForMemberBB 
(BB 
destBB 
=>BB 
destBB #
.BB# $
	BirthDateBB$ -
,BB- .
optBB/ 2
=>CC 
optCC 
.CC 
MapFromCC 
(CC 
srcCC "
=>CC# %
srcCC& )
.CC) *
ApplicationUserCC* 9
.CC9 :
	BirthDateCC: C
)CCC D
)CCD E
.DD 
	ForMemberDD 
(DD 
destDD 
=>DD 
destDD #
.DD# $

IsAcceptedDD$ .
,DD. /
optDD0 3
=>EE 
optEE 
.EE 
MapFromEE 
(EE 
srcEE "
=>EE# %
srcEE& )
.EE) *

IsAcceptedEE* 4
)EE4 5
)EE5 6
.FF 

ReverseMapFF 
(FF 
)FF 
;FF 
	CreateMapHH 
<HH 

InstructorHH 
,HH 
InstructorInfoDTOHH /
>HH/ 0
(HH0 1
)HH1 2
.II 
	ForMemberII 
(II 
destII 
=>II 
destII #
.II# $
InstructorIdII$ 0
,II0 1
optII2 5
=>JJ 
optJJ 
.JJ 
MapFromJJ 
(JJ 
srcJJ "
=>JJ# %
srcJJ& )
.JJ) *
InstructorIdJJ* 6
)JJ6 7
)JJ7 8
.KK 
	ForMemberKK 
(KK 
destKK 
=>KK 
destKK #
.KK# $
UserIdKK$ *
,KK* +
optKK, /
=>LL 
optLL 
.LL 
MapFromLL 
(LL 
srcLL "
=>LL# %
srcLL& )
.LL) *
UserIdLL* 0
)LL0 1
)LL1 2
.MM 
	ForMemberMM 
(MM 
destMM 
=>MM 
destMM #
.MM# $
FullNameMM$ ,
,MM, -
optMM. 1
=>NN 
optNN 
.NN 
MapFromNN 
(NN 
srcNN "
=>NN# %
srcNN& )
.NN) *
ApplicationUserNN* 9
.NN9 :
FullNameNN: B
)NNB C
)NNC D
.OO 
	ForMemberOO 
(OO 
destOO 
=>OO 
destOO #
.OO# $
EmailOO$ )
,OO) *
optOO+ .
=>PP 
optPP 
.PP 
MapFromPP 
(PP 
srcPP "
=>PP# %
srcPP& )
.PP) *
ApplicationUserPP* 9
.PP9 :
EmailPP: ?
)PP? @
)PP@ A
.QQ 
	ForMemberQQ 
(QQ 
destQQ 
=>QQ 
destQQ #
.QQ# $
PhoneNumberQQ$ /
,QQ/ 0
optQQ1 4
=>RR 
optRR 
.RR 
MapFromRR 
(RR 
srcRR "
=>RR# %
srcRR& )
.RR) *
ApplicationUserRR* 9
.RR9 :
PhoneNumberRR: E
)RRE F
)RRF G
.SS 
	ForMemberSS 
(SS 
destSS 
=>SS 
destSS #
.SS# $
GenderSS$ *
,SS* +
optSS, /
=>TT 
optTT 
.TT 
MapFromTT 
(TT 
srcTT "
=>TT# %
srcTT& )
.TT) *
ApplicationUserTT* 9
.TT9 :
GenderTT: @
)TT@ A
)TTA B
.UU 
	ForMemberUU 
(UU 
destUU 
=>UU 
destUU #
.UU# $
	BirthDateUU$ -
,UU- .
optUU/ 2
=>VV 
optVV 
.VV 
MapFromVV 
(VV 
srcVV "
=>VV# %
srcVV& )
.VV) *
ApplicationUserVV* 9
.VV9 :
	BirthDateVV: C
)VVC D
)VVD E
.WW 
	ForMemberWW 
(WW 
destWW 
=>WW 
destWW #
.WW# $
CountryWW$ +
,WW+ ,
optWW- 0
=>XX 
optXX 
.XX 
MapFromXX 
(XX 
srcXX "
=>XX# %
srcXX& )
.XX) *
ApplicationUserXX* 9
.XX9 :
CountryXX: A
)XXA B
)XXB C
.YY 
	ForMemberYY 
(YY 
destYY 
=>YY 
destYY #
.YY# $
AddressYY$ +
,YY+ ,
optYY- 0
=>ZZ 
optZZ 
.ZZ 
MapFromZZ 
(ZZ 
srcZZ "
=>ZZ# %
srcZZ& )
.ZZ) *
ApplicationUserZZ* 9
.ZZ9 :
AddressZZ: A
)ZZA B
)ZZB C
.[[ 
	ForMember[[ 
([[ 
dest[[ 
=>[[ 
dest[[ #
.[[# $
Degree[[$ *
,[[* +
opt[[, /
=>\\ 
opt\\ 
.\\ 
MapFrom\\ 
(\\ 
src\\ "
=>\\# %
src\\& )
.\\) *
Degree\\* 0
)\\0 1
)\\1 2
.]] 
	ForMember]] 
(]] 
dest]] 
=>]] 
dest]] #
.]]# $
Industry]]$ ,
,]], -
opt]]. 1
=>^^ 
opt^^ 
.^^ 
MapFrom^^ 
(^^ 
src^^ "
=>^^# %
src^^& )
.^^) *
Industry^^* 2
)^^2 3
)^^3 4
.__ 
	ForMember__ 
(__ 
dest__ 
=>__ 
dest__ #
.__# $
	TaxNumber__$ -
,__- .
opt__/ 2
=>`` 
opt`` 
.`` 
MapFrom`` 
(`` 
src`` "
=>``# %
src``& )
.``) *
ApplicationUser``* 9
.``9 :
	TaxNumber``: C
)``C D
)``D E
.aa 
	ForMemberaa 
(aa 
destaa 
=>aa 
destaa #
.aa# $

IsAcceptedaa$ .
,aa. /
optaa0 3
=>bb 
optbb 
.bb 
MapFrombb 
(bb 
srcbb "
=>bb# %
srcbb& )
.bb) *

IsAcceptedbb* 4
)bb4 5
)bb5 6
.cc 

ReverseMapcc 
(cc 
)cc 
;cc 
	CreateMapee 
<ee 
InstructorCommentee #
,ee# $
GetAllCommentsDTOee% 6
>ee6 7
(ee7 8
)ee8 9
.ee9 :

ReverseMapee: D
(eeD E
)eeE F
;eeF G
	CreateMapff 
<ff 
InstructorCommentff #
,ff# $&
CreateInstructorCommentDTOff% ?
>ff? @
(ff@ A
)ffA B
.ffB C

ReverseMapffC M
(ffM N
)ffN O
;ffO P
	CreateMapgg 
<gg 
InstructorCommentgg #
,gg# $&
UpdateInstructorCommentDTOgg% ?
>gg? @
(gg@ A
)ggA B
.ggB C

ReverseMapggC M
(ggM N
)ggN O
;ggO P
	CreateMapjj 
<jj 
CourseVersionjj 
,jj  
GetCourseVersionDTOjj! 4
>jj4 5
(jj5 6
)jj6 7
.kk 
	ForMemberkk 
(kk 
destkk 
=>kk 
destkk #
.kk# $
CategoryNamekk$ 0
,kk0 1
optkk2 5
=>kk6 8
optkk9 <
.kk< =
MapFromkk= D
(kkD E
srckkE H
=>kkI K
srckkL O
.kkO P
CategorykkP X
.kkX Y
NamekkY ]
)kk] ^
)kk^ _
.ll 
	ForMemberll 
(ll 
destll 
=>ll 
destll #
.ll# $
	LevelNamell$ -
,ll- .
optll/ 2
=>ll3 5
optll6 9
.ll9 :
MapFromll: A
(llA B
srcllB E
=>llF H
srcllI L
.llL M
LevelllM R
.llR S
NamellS W
)llW X
)llX Y
;llY Z
	CreateMapnn 
<nn 
CourseVersionStatusnn %
,nn% &%
GetCourseVersionStatusDTOnn' @
>nn@ A
(nnA B
)nnB C
.nnC D

ReverseMapnnD N
(nnN O
)nnO P
;nnP Q
	CreateMappp 
<pp  
CourseVersionCommentpp &
,pp& '
GetCourseCommnetDTOpp( ;
>pp; <
(pp< =
)pp= >
.qq 
	ForMemberqq 
(qq 
destqq 
=>qq 
destqq #
.qq# $
CourseVersionIdqq$ 3
,qq3 4
optqq5 8
=>qq9 ;
optqq< ?
.qq? @
MapFromqq@ G
(qqG H
srcqqH K
=>qqL N
srcqqO R
.qqR S
CourseVersionIdqqS b
)qqb c
)qqc d
.rr 
	ForMemberrr 
(rr 
destrr 
=>rr 
destrr #
.rr# $
Commentrr$ +
,rr+ ,
optrr- 0
=>rr1 3
optrr4 7
.rr7 8
MapFromrr8 ?
(rr? @
srcrr@ C
=>rrD F
srcrrG J
.rrJ K
CommentrrK R
)rrR S
)rrS T
.ss 
	ForMemberss 
(ss 
destss 
=>ss 
destss #
.ss# $
CreateByss$ ,
,ss, -
optss. 1
=>ss2 4
optss5 8
.ss8 9
MapFromss9 @
(ss@ A
srcssA D
=>ssE G
srcssH K
.ssK L
	CreatedByssL U
)ssU V
)ssV W
.tt 
	ForMembertt 
(tt 
desttt 
=>tt 
desttt #
.tt# $

CreateTimett$ .
,tt. /
opttt0 3
=>tt4 6
opttt7 :
.tt: ;
MapFromtt; B
(ttB C
srcttC F
=>ttG I
srcttJ M
.ttM N
CreatedTimettN Y
)ttY Z
)ttZ [
.uu 
	ForMemberuu 
(uu 
destuu 
=>uu 
destuu #
.uu# $
UpdateByuu$ ,
,uu, -
optuu. 1
=>uu2 4
optuu5 8
.uu8 9
MapFromuu9 @
(uu@ A
srcuuA D
=>uuE G
srcuuH K
.uuK L
	UpdatedByuuL U
)uuU V
)uuV W
.vv 
	ForMembervv 
(vv 
destvv 
=>vv 
destvv #
.vv# $

UpdateTimevv$ .
,vv. /
optvv0 3
=>vv4 6
optvv7 :
.vv: ;
MapFromvv; B
(vvB C
srcvvC F
=>vvG I
srcvvJ M
.vvM N
UpdatedTimevvN Y
)vvY Z
)vvZ [
.ww 
	ForMemberww 
(ww 
destww 
=>ww 
destww #
.ww# $
Statusww$ *
,ww* +
optww, /
=>ww0 2
optww3 6
.ww6 7
MapFromww7 >
(ww> ?
srcww? B
=>wwC E
srcwwF I
.wwI J
StatuswwJ P
)wwP Q
)wwQ R
.xx 

ReverseMapxx 
(xx 
)xx 
;xx 
	CreateMap{{ 
<{{ 
Course{{ 
,{{ 
GetCourseInfoDTO{{ *
>{{* +
({{+ ,
){{, -
.{{- .

ReverseMap{{. 8
({{8 9
){{9 :
;{{: ;
	CreateMap|| 
<|| 
Level|| 
,|| 
GetLevelDTO|| $
>||$ %
(||% &
)||& '
.||' (

ReverseMap||( 2
(||2 3
)||3 4
;||4 5
	CreateMap~~ 
<~~ 
Student~~ 
,~~ 
StudentInfoDTO~~ )
>~~) *
(~~* +
)~~+ ,
.~~, -

ReverseMap~~- 7
(~~7 8
)~~8 9
;~~9 :
	CreateMap 
< 
Student 
, 
StudentFullInfoDTO -
>- .
(. /
)/ 0
.
ÄÄ 
	ForMember
ÄÄ 
(
ÄÄ 
dest
ÄÄ 
=>
ÄÄ 
dest
ÄÄ #
.
ÄÄ# $
	StudentId
ÄÄ$ -
,
ÄÄ- .
opt
ÄÄ/ 2
=>
ÄÄ3 5
opt
ÄÄ6 9
.
ÄÄ9 :
MapFrom
ÄÄ: A
(
ÄÄA B
src
ÄÄB E
=>
ÄÄF H
src
ÄÄI L
.
ÄÄL M
	StudentId
ÄÄM V
)
ÄÄV W
)
ÄÄW X
.
ÅÅ 
	ForMember
ÅÅ 
(
ÅÅ 
dest
ÅÅ 
=>
ÅÅ 
dest
ÅÅ #
.
ÅÅ# $
UserId
ÅÅ$ *
,
ÅÅ* +
opt
ÅÅ, /
=>
ÅÅ0 2
opt
ÅÅ3 6
.
ÅÅ6 7
MapFrom
ÅÅ7 >
(
ÅÅ> ?
src
ÅÅ? B
=>
ÅÅC E
src
ÅÅF I
.
ÅÅI J
UserId
ÅÅJ P
)
ÅÅP Q
)
ÅÅQ R
.
ÇÇ 
	ForMember
ÇÇ 
(
ÇÇ 
dest
ÇÇ 
=>
ÇÇ 
dest
ÇÇ #
.
ÇÇ# $
FullName
ÇÇ$ ,
,
ÇÇ, -
opt
ÇÇ. 1
=>
ÇÇ2 4
opt
ÇÇ5 8
.
ÇÇ8 9
MapFrom
ÇÇ9 @
(
ÇÇ@ A
src
ÇÇA D
=>
ÇÇE G
src
ÇÇH K
.
ÇÇK L
ApplicationUser
ÇÇL [
.
ÇÇ[ \
FullName
ÇÇ\ d
)
ÇÇd e
)
ÇÇe f
.
ÉÉ 
	ForMember
ÉÉ 
(
ÉÉ 
dest
ÉÉ 
=>
ÉÉ 
dest
ÉÉ #
.
ÉÉ# $
Email
ÉÉ$ )
,
ÉÉ) *
opt
ÉÉ+ .
=>
ÉÉ/ 1
opt
ÉÉ2 5
.
ÉÉ5 6
MapFrom
ÉÉ6 =
(
ÉÉ= >
src
ÉÉ> A
=>
ÉÉB D
src
ÉÉE H
.
ÉÉH I
ApplicationUser
ÉÉI X
.
ÉÉX Y
Email
ÉÉY ^
)
ÉÉ^ _
)
ÉÉ_ `
.
ÑÑ 
	ForMember
ÑÑ 
(
ÑÑ 
dest
ÑÑ 
=>
ÑÑ 
dest
ÑÑ #
.
ÑÑ# $
PhoneNumber
ÑÑ$ /
,
ÑÑ/ 0
opt
ÑÑ1 4
=>
ÑÑ5 7
opt
ÑÑ8 ;
.
ÑÑ; <
MapFrom
ÑÑ< C
(
ÑÑC D
src
ÑÑD G
=>
ÑÑH J
src
ÑÑK N
.
ÑÑN O
ApplicationUser
ÑÑO ^
.
ÑÑ^ _
PhoneNumber
ÑÑ_ j
)
ÑÑj k
)
ÑÑk l
.
ÖÖ 
	ForMember
ÖÖ 
(
ÖÖ 
dest
ÖÖ 
=>
ÖÖ 
dest
ÖÖ #
.
ÖÖ# $
Gender
ÖÖ$ *
,
ÖÖ* +
opt
ÖÖ, /
=>
ÖÖ0 2
opt
ÖÖ3 6
.
ÖÖ6 7
MapFrom
ÖÖ7 >
(
ÖÖ> ?
src
ÖÖ? B
=>
ÖÖC E
src
ÖÖF I
.
ÖÖI J
ApplicationUser
ÖÖJ Y
.
ÖÖY Z
Gender
ÖÖZ `
)
ÖÖ` a
)
ÖÖa b
.
ÜÜ 
	ForMember
ÜÜ 
(
ÜÜ 
dest
ÜÜ 
=>
ÜÜ 
dest
ÜÜ #
.
ÜÜ# $
	BirthDate
ÜÜ$ -
,
ÜÜ- .
opt
ÜÜ/ 2
=>
ÜÜ3 5
opt
ÜÜ6 9
.
ÜÜ9 :
MapFrom
ÜÜ: A
(
ÜÜA B
src
ÜÜB E
=>
ÜÜF H
src
ÜÜI L
.
ÜÜL M
ApplicationUser
ÜÜM \
.
ÜÜ\ ]
	BirthDate
ÜÜ] f
)
ÜÜf g
)
ÜÜg h
.
áá 
	ForMember
áá 
(
áá 
dest
áá 
=>
áá 
dest
áá #
.
áá# $
Country
áá$ +
,
áá+ ,
opt
áá- 0
=>
áá1 3
opt
áá4 7
.
áá7 8
MapFrom
áá8 ?
(
áá? @
src
áá@ C
=>
ááD F
src
ááG J
.
ááJ K
ApplicationUser
ááK Z
.
ááZ [
Country
áá[ b
)
ááb c
)
áác d
.
àà 
	ForMember
àà 
(
àà 
dest
àà 
=>
àà 
dest
àà #
.
àà# $
Address
àà$ +
,
àà+ ,
opt
àà- 0
=>
àà1 3
opt
àà4 7
.
àà7 8
MapFrom
àà8 ?
(
àà? @
src
àà@ C
=>
ààD F
src
ààG J
.
ààJ K
ApplicationUser
ààK Z
.
ààZ [
Address
àà[ b
)
ààb c
)
ààc d
.
ââ 
	ForMember
ââ 
(
ââ 
dest
ââ 
=>
ââ 
dest
ââ #
.
ââ# $
	AvatarUrl
ââ$ -
,
ââ- .
opt
ââ/ 2
=>
ââ3 5
opt
ââ6 9
.
ââ9 :
MapFrom
ââ: A
(
ââA B
src
ââB E
=>
ââF H
src
ââI L
.
ââL M
ApplicationUser
ââM \
.
ââ\ ]
	AvatarUrl
ââ] f
)
ââf g
)
ââg h
.
ää 
	ForMember
ää 
(
ää 
dest
ää 
=>
ää 
dest
ää #
.
ää# $

University
ää$ .
,
ää. /
opt
ää0 3
=>
ää4 6
opt
ää7 :
.
ää: ;
MapFrom
ää; B
(
ääB C
src
ääC F
=>
ääG I
src
ääJ M
.
ääM N

University
ääN X
)
ääX Y
)
ääY Z
.
ãã 

ReverseMap
ãã 
(
ãã 
)
ãã 
;
ãã 
	CreateMap
èè 
<
èè 
StudentComment
èè  
,
èè  !
GetAllCommentsDTO
èè" 3
>
èè3 4
(
èè4 5
)
èè5 6
.
èè6 7

ReverseMap
èè7 A
(
èèA B
)
èèB C
;
èèC D
	CreateMap
êê 
<
êê 
StudentComment
êê  
,
êê  !%
CreateStudentCommentDTO
êê" 9
>
êê9 :
(
êê: ;
)
êê; <
.
êê< =

ReverseMap
êê= G
(
êêG H
)
êêH I
;
êêI J
	CreateMap
ëë 
<
ëë 
StudentComment
ëë  
,
ëë  !%
UpdateStudentCommentDTO
ëë" 9
>
ëë9 :
(
ëë: ;
)
ëë; <
.
ëë< =

ReverseMap
ëë= G
(
ëëG H
)
ëëH I
;
ëëI J
	CreateMap
ìì 
<
ìì 

CartHeader
ìì 
,
ìì 
CartHeaderDTO
ìì +
>
ìì+ ,
(
ìì, -
)
ìì- .
.
ìì. /

ReverseMap
ìì/ 9
(
ìì9 :
)
ìì: ;
;
ìì; <
	CreateMap
îî 
<
îî 
CartDetails
îî 
,
îî 
CartDetailsDTO
îî -
>
îî- .
(
îî. /
)
îî/ 0
.
îî0 1

ReverseMap
îî1 ;
(
îî; <
)
îî< =
;
îî= >
	CreateMap
óó 
<
óó 
OrderHeader
óó 
,
óó 
GetOrderHeaderDTO
óó 0
>
óó0 1
(
óó1 2
)
óó2 3
.
óó3 4

ReverseMap
óó4 >
(
óó> ?
)
óó? @
;
óó@ A
	CreateMap
òò 
<
òò 
OrderDetails
òò 
,
òò  
GetOrderDetailsDTO
òò  2
>
òò2 3
(
òò3 4
)
òò4 5
.
òò5 6

ReverseMap
òò6 @
(
òò@ A
)
òòA B
;
òòB C
	CreateMap
öö 
<
öö 
Transaction
öö 
,
öö 
GetTransactionDTO
öö 0
>
öö0 1
(
öö1 2
)
öö2 3
.
öö3 4

ReverseMap
öö4 >
(
öö> ?
)
öö? @
;
öö@ A
	CreateMap
úú 
<
úú 
CourseBookmark
úú  
,
úú  !%
CreateCourseBookmarkDTO
úú" 9
>
úú9 :
(
úú: ;
)
úú; <
.
úú< =

ReverseMap
úú= G
(
úúG H
)
úúH I
;
úúI J
}
ùù 
}ûû ß

mD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ITransactionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ITransactionService $
{ 
Task 
< 	
ResponseDTO	 
> 
GetTransactions %
(		 
ClaimsPrincipal

 
User

 
,

 
string 
? 
userId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int 
pageSize 
= 
$num 
) 
; 
Task 
< 	
ResponseDTO	 
> 
CreateTransaction '
(' ( 
CreateTransactionDTO( < 
createTransactionDto= Q
)Q R
;R S
} §
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ITokenService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ITokenService 
{ 
Task 
< 	
string	 
> '
GenerateJwtAccessTokenAsync ,
(, -
ApplicationUser- <
user= A
)A B
;B C
Task		 
<		 	
string			 
>		 (
GenerateJwtRefreshTokenAsync		 -
(		- .
ApplicationUser		. =
user		> B
)		B C
;		C D
Task

 
<

 	
bool

	 
>

 
StoreRefreshToken

  
(

  !
string

! '
userId

( .
,

. /
string

0 6
refreshToken

7 C
)

C D
;

D E
Task 
< 	
ClaimsPrincipal	 
> !
GetPrincipalFromToken /
(/ 0
string0 6
token7 <
)< =
;= >
Task 
< 	
string	 
>  
RetrieveRefreshToken %
(% &
string& ,
userId- 3
)3 4
;4 5
Task 
< 	
bool	 
> 
DeleteRefreshToken !
(! "
string" (
userId) /
)/ 0
;0 1
} Î 
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IStudentsService.cs
	namespace		 	
Cursus		
 
.		 
LMS		 
.		 
Service		 
.		 
IService		 %
{

 
public 

	interface 
IStudentsService %
{ 
Task 
< 
ResponseDTO 
> 
GetAllStudent '
( 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 
ResponseDTO 
> 
GetById !
(! "
Guid" &
id' )
)) *
;* +
Task 
< 
ResponseDTO 
> 

UpdateById $
($ %
UpdateStudentDTO% 5
updateStudentDTO6 F
)F G
;G H
Task 
< 
ResponseDTO 
> 
ActivateStudent )
() *
ClaimsPrincipal* 9
User: >
,> ?
Guid@ D
	studentIdE N
)N O
;O P
Task 
< 
ResponseDTO 
> 
DeactivateStudent +
(+ ,
ClaimsPrincipal, ;
User< @
,@ A
GuidB F
	studentIdG P
)P Q
;Q R
Task 
< 
ResponseDTO 
> "
GetStudentTotalCourses 0
(0 1
Guid1 5
	studentId6 ?
)? @
;@ A
Task 
< 
ResponseDTO 
> #
GetAllCourseByStudentId 1
(1 2
Guid2 6
	studentId7 @
)@ A
;A B
Task 
< 
ResponseDTO 
> '
GetAllCourseStudentEnrolled 5
(5 6
Guid6 :
	studentId; D
)D E
;E F
Task 
< 
ResponseDTO 
>  
GetAllStudentComment .
(. /
Guid/ 3
	studentId4 =
,= >
int? B

pageNumberC M
,M N
intO R
pageSizeS [
)[ \
;\ ]
Task   
<   
ResponseDTO   
>    
CreateStudentComment   .
(  . /
ClaimsPrincipal  / >
User  ? C
,  C D#
CreateStudentCommentDTO  E \#
createStudentCommentDTO  ] t
)  t u
;  u v
Task!! 
<!! 
ResponseDTO!! 
>!!  
UpdateStudentComment!! .
(!!. /
ClaimsPrincipal!!/ >
User!!? C
,!!C D#
UpdateStudentCommentDTO!!E \#
updateStudentCommentDTO!!] t
)!!t u
;!!u v
Task"" 
<"" 
ResponseDTO"" 
>""  
DeleteStudentComment"" .
("". /
Guid""/ 3
	commentId""4 =
)""= >
;""> ?
Task## 
<## 
ResponseDTO## 
>## 
ExportStudents## (
(##( )
string##) /
userId##0 6
,##6 7
int##8 ;
month##< A
,##A B
int##C F
year##G K
)##K L
;##L M
Task$$ 
<$$  
ClosedXMLResponseDTO$$ !
>$$! "
DownloadStudents$$# 3
($$3 4
string$$4 :
fileName$$; C
)$$C D
;$$D E
Task%% 
<%% 
ResponseDTO%% 
>%% )
TotalPricesCoursesByStudentId%% 7
(%%7 8
Guid%%8 <
	studentId%%= F
)%%F G
;%%G H
}'' 
}(( é
uD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IStudentCourseStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface '
IStudentCourseStatusService ,
{ 
Task 
< 	
ResponseDTO	 
> #
GetStudentCoursesStatus -
(- .
Guid. 2
studentCourseId3 B
)B C
;C D
Task		 
<		 	
ResponseDTO			 
>		 "
GetStudentCourseStatus		 ,
(		, -
Guid		- 1!
studentCourseStatusId		2 G
)		G H
;		H I
Task

 
<

 	
ResponseDTO

	 
>

 %
CreateStudentCourseStatus

 /
(

/ 0(
CreateStudentCourseStatusDTO

0 L(
createStudentCourseStatusDto

M i
)

i j
;

j k
} §
oD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IStudentCourseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface !
IStudentCourseService &
{ 
Task 
< 	
ResponseDTO	 
> 
CreateStudentCourse )
() *
ClaimsPrincipal* 9
User: >
,> ?
EnrollCourseDTO@ O
enrollCourseDtoP _
)_ `
;` a
Task		 
<		 	
ResponseDTO			 
>		 
UpdateStudentCourse		 )
(		) *
ClaimsPrincipal		* 9
User		: >
,		> ?"
UpdateStudentCourseDTO		@ V"
updateStudentCourseDto		W m
)		m n
;		n o
}

 ú
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IStripeService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
	interface 
IStripeService 
{ 
Task 
< 	
ResponseDTO	 
>  
CreatePaymentSession *
( "
CreateStripeSessionDTO		 "
createStripeSessionDto		 5
)

 
;

 
Task 
< 	
ResponseDTO	 
> "
ValidatePaymentSession ,
( $
ValidateStripeSessionDTO  $
validateStripeSessionDto! 9
) 
; 
Task 
< 	
ResponseDTO	 
> "
CreateConnectedAccount ,
( +
CreateStripeConnectedAccountDTO '+
createStripeConnectedAccountDto( G
) 
; 
Task 
< 	
ResponseDTO	 
> 
AddCard 
( 
AddStripeCardDTO 
addStripeCardDto )
) 
; 
Task 
< 	
ResponseDTO	 
> 
CreateTransfer $
( #
CreateStripeTransferDTO #
createStripeTransferDto  7
) 
; 
Task   
<   	
ResponseDTO  	 
>   
CreatePayout   "
(!! !
CreateStripePayoutDTO"" !
createStripePayoutDto"" 3
)## 
;## 
}$$ Æ
wD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ISectionDetailsVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface )
ISectionDetailsVersionService .
{ 
Task		 
<		 	
ResponseDTO			 
>		 '
CloneSectionsDetailsVersion		 1
(

 
ClaimsPrincipal 
User 
, *
CloneSectionsDetailsVersionDTO &*
cloneSectionsDetailsVersionDto' E
) 
; 
Task 
< 	
ResponseDTO	 
> &
GetSectionsDetailsVersions 0
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseSectionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> $
GetSectionDetailsVersion .
( 
ClaimsPrincipal 
User 
, 
Guid "
	detailsId# ,
) 
; 
Task   
<   	
ResponseDTO  	 
>   '
CreateSectionDetailsVersion   1
(!! 
ClaimsPrincipal"" 
User"" 
,"" *
CreateSectionDetailsVersionDTO## &*
createSectionDetailsVersionDto##' E
)$$ 
;$$ 
Task&& 
<&& 	
ResponseDTO&&	 
>&& %
EditSectionDetailsVersion&& /
('' 
ClaimsPrincipal(( 
User(( 
,(( (
EditSectionDetailsVersionDTO)) $(
editSectionDetailsVersionDto))% A
)** 
;** 
Task,, 
<,, 	
ResponseDTO,,	 
>,, '
RemoveSectionDetailsVersion,, 1
(-- 
ClaimsPrincipal.. 
User.. 
,.. 
Guid// 
	detailsId// 
)00 
;00 
Task22 
<22 	
ResponseDTO22	 
>22 .
"UploadSectionDetailsVersionContent22 8
(33 
ClaimsPrincipal44 
User44 
,44 
Guid55 
	detailsId55 
,55 1
%UploadSectionDetailsVersionContentDTO66 -1
%uploadSectionDetailsVersionContentDto66. S
)77 
;77 
Task99 
<99 	
ContentResponseDTO99	 
>99 /
#DisplaySectionDetailsVersionContent99 @
(:: 
ClaimsPrincipal;; 
User;; 
,;; 
Guid<< #
sectionDetailsVersionId<< $
,<<$ %
string== 
type== 
)>> 
;>> 
}?? ´
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IRedisService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IRedisService 
{ 
Task 
< 	
bool	 
> 
StoreString 
( 
string !
key" %
,% &
string' -
value. 3
)3 4
;4 5
Task 
< 	
string	 
> 
RetrieveString 
(  
string  &
key' *
)* +
;+ ,
Task 
< 	
bool	 
> 
DeleteString 
( 
string "
key# &
)& '
;' (
} „
iD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IPaymentService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IPaymentService  
{ 
Task 
< 	
ResponseDTO	 
> (
CreateStripeConnectedAccount 2
(2 3+
CreateStripeConnectedAccountDTO3 R+
createStripeConnectedAccountDtoS r
)r s
;s t
Task		 
<		 	
ResponseDTO			 
>		  
CreateStripeTransfer		 *
(		* +#
CreateStripeTransferDTO		+ B#
createStripeTransferDto		C Z
)		Z [
;		[ \
Task

 
<

 	
ResponseDTO

	 
>

 
AddStripeCard

 #
(

# $
AddStripeCardDTO

$ 4
addStripeCardDto

5 E
)

E F
;

F G
Task 
< 	
ResponseDTO	 
> 
CreateStripePayout (
(( )
ClaimsPrincipal) 8
User9 =
,= >!
CreateStripePayoutDTO? T!
createStripePayoutDtoU j
)j k
;k l
Task 
< 	
ResponseDTO	 
> '
GetLeastInstructorsByPayout 1
(1 2
int2 5
topN6 :
,: ;
int; >
?> ?

filterYear@ J
,J K
intK N
?N O
filterMonthP [
,[ \
int\ _
?_ `
filterQuartera n
)n o
;o p
Task 
< 	
ResponseDTO	 
> %
GetTopInstructorsByPayout /
(/ 0
int0 3
topN4 8
,8 9
int: =
?= >

filterYear? I
,I J
intK N
?N O
filterMonthP [
,[ \
int] `
?` a
filterQuarterb o
)o p
;p q
} ä
mD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IOrderStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IOrderStatusService $
{ 
Task 
< 	
ResponseDTO	 
> 
GetOrdersStatus %
(% &
Guid& *
orderHeaderId+ 8
)8 9
;9 :
Task		 
<		 	
ResponseDTO			 
>		 
GetOrderStatus		 $
(		$ %
Guid		% )
orderStatusId		* 7
)		7 8
;		8 9
Task

 
<

 	
ResponseDTO

	 
>

 
CreateOrderStatus

 '
(

' (
ClaimsPrincipal

( 7
User

8 <
,

< = 
CreateOrderStatusDTO

> R 
createOrderStatusDto

S g
)

g h
;

h i
} í
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IOrderService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IOrderService 
{ 
Task 
< 	
ResponseDTO	 
> 
CreateOrder !
(		 
ClaimsPrincipal

 
User

 
) 
; 
Task 
< 	
ResponseDTO	 
> 
	GetOrders 
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
	studentId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int 
pageSize 
= 
$num 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetOrder 
( 
ClaimsPrincipal 
User 
, 
Guid 
orderHeaderId 
) 
; 
Task 
< 	
ResponseDTO	 
> 
PayWithStripe #
(   
ClaimsPrincipal!! 
User!! 
,!! 
PayWithStripeDTO"" 
payWithStripeDto"" )
)## 
;## 
Task%% 
<%% 	
ResponseDTO%%	 
>%% 
ValidateWithStripe%% (
(&& 
ClaimsPrincipal'' 
User'' 
,'' !
ValidateWithStripeDTO(( !
validateWithStripeDto(( 3
))) 
;)) 
Task++ 
<++ 	
ResponseDTO++	 
>++ 
ConfirmOrder++ "
(++" #
ClaimsPrincipal++# 2
User++3 7
,++7 8
Guid++9 =
orderHeaderId++> K
)++K L
;++L M
},, ˆ
nD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\INotificationService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface  
INotificationService %
{ 
} Â
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ILevelService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ILevelService 
{ 
Task 
< 	
ResponseDTO	 
> 
	GetLevels 
(		 
ClaimsPrincipal

 
User

 
,

 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int 
pageSize 
= 
$num 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetLevel 
( 
ClaimsPrincipal .
User/ 3
,3 4
Guid5 9
levelId: A
)A B
;B C
Task 
< 	
ResponseDTO	 
> 
CreateLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
CreateLevelDTO8 F
createLevelDtoG U
)U V
;V W
Task 
< 	
ResponseDTO	 
> 
UpdateLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
UpdateLevelDTO8 F
updateLevelDtoG U
)U V
;V W
Task 
< 	
ResponseDTO	 
> 
DeleteLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
Guid8 <
levelId= D
)D E
;E F
} Ú 
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IInstructorService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IInstructorService #
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetById 
( 
Guid "
id# %
)% &
;& '
Task 
< 	
ResponseDTO	 
> 

UpdateById  
(  !
UpdateInstructorDTO! 4
updateInstructorDto5 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> 
AcceptInstructor &
(& '
ClaimsPrincipal' 6
User7 ;
,; <
Guid= A
idB D
)D E
;E F
Task 
< 	
ResponseDTO	 
> 
RejectInstructor &
(& '
ClaimsPrincipal' 6
User7 ;
,; <
Guid= A
idB D
)D E
;E F
Task 
< 	
ResponseDTO	 
> %
GetInstructorTotalCourses /
(/ 0
Guid0 4
instructorId5 A
)A B
;B C
Task 
< 	
ResponseDTO	 
> $
GetInstructorTotalRating .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> $
GetInstructorEarnedMoney .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> $
GetInstructorPayoutMoney .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> #
GetAllInstructorComment -
(- .
Guid. 2
instructorId3 ?
,? @
intA D

pageNumberE O
,O P
intQ T
pageSizeU ]
)] ^
;^ _
Task 
< 	
ResponseDTO	 
> #
CreateInstructorComment -
(- .
ClaimsPrincipal. =
User> B
,B C&
CreateInstructorCommentDTOD ^#
createInstructorComment_ v
)v w
;w x
Task 
< 	
ResponseDTO	 
> #
UpdateInstructorComment -
(- .
ClaimsPrincipal. =
User> B
,B C&
UpdateInstructorCommentDTOD ^#
updateInstructorComment_ v
)v w
;w x
Task   
<   	
ResponseDTO  	 
>   #
DeleteInstructorComment   -
(  - .
Guid  . 2
	commentId  3 <
)  < =
;  = >
Task!! 
<!! 	
ResponseDTO!!	 
>!! 
ExportInstructors!! '
(!!' (
string!!( .
userId!!/ 5
,!!5 6
int!!7 :
month!!; @
,!!@ A
int!!B E
year!!F J
)!!J K
;!!K L
Task"" 
<"" 	 
ClosedXMLResponseDTO""	 
>"" 
DownloadInstructors"" 2
(""2 3
string""3 9
fileName"": B
)""B C
;""C D
}## ‘
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IFirebaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IFirebaseService !
{ 
Task		 
<		 	
ResponseDTO			 
>		 
UploadImage		 !
(		! "
	IFormFile		" +
file		, 0
,		0 1
string		2 8
folder		9 ?
)		? @
;		@ A
Task

 
<

 	
MemoryStream

	 
>

 
GetImage

 
(

  
string

  &
filePath

' /
)

/ 0
;

0 1
Task 
< 	
ResponseDTO	 
> 
UploadVideo !
(! "
	IFormFile" +
file, 0
,0 1
Guid2 6
?6 7
courseId8 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> 
UploadSlide !
(! "
	IFormFile" +
file, 0
,0 1
Guid2 6
?6 7
courseId8 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> 
	UploadDoc 
(  
	IFormFile  )
file* .
,. /
Guid0 4
?4 5
courseId6 >
)> ?
;? @
Task 
< 	
MemoryStream	 
> 

GetContent !
(! "
string" (
?( )
filePath* 2
)2 3
;3 4
} ê
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IEmailService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IEmailService 
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
bool	 
> 
SendEmailAsync 
( 
string $
toEmail% ,
,, -
string. 4
subject5 <
,< =
string> D
bodyE I
)I J
;J K
Task 
< 	
bool	 
> (
SendEmailInactiveCourseAsync +
(+ ,
string, 2
instructorEmail3 B
,B C
stringD J
studentEmailK W
,W X
stringY _
subject` g
,g h
stringi o
bodyp t
)t u
;u v
Task 
< 	
bool	 
> 
SendEmailResetAsync "
(" #
string# )
toEmail* 1
,1 2
string3 9
subject: A
,A B
ApplicationUserC R
userS W
,W X
stringY _
currentDate` k
,k l
string 
	resetLink 
, 
string 
operatingSystem 
, 
string  &
browser' .
,. /
string0 6
ip7 9
,9 :
string; A
regionB H
,H I
stringJ P
cityQ U
,U V
stringW ]
country^ e
)e f
;f g
Task 
< 	
bool	 
> +
SendEmailForAdminAboutNewCourse .
(. /
string/ 5
toMail6 <
)< =
;= >
Task 
< 	
bool	 
> 2
&SendEmailForStudentAboutCompleteCourse 5
(5 6
string6 <
toMail= C
)C D
;D E
Task 
< 	
bool	 
> 7
+SendApproveEmailForInstructorAboutNewCourse :
(: ;
string; A
toMailB H
)H I
;I J
Task 
< 	
bool	 
> 6
*SendRejectEmailForInstructorAboutNewCourse 9
(9 :
string: @
toMailA G
)G H
;H I
Task 
< 	
bool	 
> 
SendVerifyEmail 
( 
string %
toMail& ,
,, -
string. 4
confirmationLink5 E
)E F
;F G
Task 
< 	
bool	 
> #
SendEmailInactiveCourse &
(& '
string' -
instructorEmail. =
,= >
string? E
instructorNameF T
,T U
stringV \
courseTitle] h
,h i
Listj n
<n o
stringo u
>u v
studentEmails	w Ñ
)
Ñ Ö
;
Ö Ü
} Æ
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IEmailSender.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IEmailSender 
{ 
Task -
!SendSubmittedCourseEmailForAdmins	 *
(* +
)+ ,
;, -
Task 0
$SendRejectedCourseEmailForInstructor	 -
(- .
Guid. 2
courseVersionId3 B
)B C
;C D
Task 0
$SendAcceptedCourseEmailForInstructor	 -
(- .
Guid. 2
courseVersionId3 B
)B C
;C D
Task 1
%SendDeactivatedCourseEmailForStudents	 .
(. /
Guid/ 3
courseId4 <
)< =
;= >
}		 ·
uD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseVersionStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface '
ICourseVersionStatusService ,
{ 
Task		 
<		 	
ResponseDTO			 
>		 #
GetCourseVersionsStatus		 -
(

 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> "
GetCourseVersionStatus ,
( 
ClaimsPrincipal 
User 
, 
Guid !
courseVersionStatusId "
) 
; 
Task 
< 	
ResponseDTO	 
> %
CreateCourseVersionStatus /
( 
ClaimsPrincipal 
User 
, (
CreateCourseVersionStatusDTO $"
courseVersionStatusDto% ;
) 
; 
}   Ë-
oD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface !
ICourseVersionService &
{ 
Task 
< 	
ResponseDTO	 
> 
GetCourseVersions '
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int   
pageSize   
)!! 
;!! 
Task** 
<** 	
ResponseDTO**	 
>** 
GetCourseVersion** &
(++ 
ClaimsPrincipal,, 
User,, 
,,, 
Guid-- 
courseVersionId-- 
).. 
;.. 
Task66 
<66 	
ResponseDTO66	 
>66 "
CreateCourseAndVersion66 ,
(77 
ClaimsPrincipal88 
User88 
,88 (
CreateNewCourseAndVersionDTO99 $(
createNewCourseAndVersionDto99% A
):: 
;:: 
TaskCC 
<CC 	
ResponseDTOCC	 
>CC 
CloneCourseVersionCC (
(DD 
ClaimsPrincipalEE 
UserEE 
,EE !
CloneCourseVersionDTOFF !
cloneCourseVersionDtoFF 3
)GG 
;GG 
TaskII 
<II 	
ResponseDTOII	 
>II 
RemoveCourseVersionII )
(II) *
ClaimsPrincipalII* 9
UserII: >
,II> ?
GuidII@ D
courseVersionIdIIE T
)IIT U
;IIU V
TaskJJ 
<JJ 	
ResponseDTOJJ	 
>JJ 
EditCourseVersionJJ '
(JJ' (
ClaimsPrincipalJJ( 7
UserJJ8 <
,JJ< = 
EditCourseVersionDTOJJ> R 
editCourseVersionDtoJJS g
)JJg h
;JJh i
TaskKK 
<KK 	
ResponseDTOKK	 
>KK 
AcceptCourseVersionKK )
(KK) *
ClaimsPrincipalKK* 9
UserKK: >
,KK> ?
GuidKK@ D
courseVersionIdKKE T
)KKT U
;KKU V
TaskLL 
<LL 	
ResponseDTOLL	 
>LL 
RejectCourseVersionLL )
(LL) *
ClaimsPrincipalLL* 9
UserLL: >
,LL> ?
GuidLL@ D
courseVersionIdLLE T
)LLT U
;LLU V
TaskMM 
<MM 	
ResponseDTOMM	 
>MM 
SubmitCourseVersionMM )
(MM) *
ClaimsPrincipalMM* 9
UserMM: >
,MM> ?
GuidMM@ D
courseVersionIdMME T
)MMT U
;MMU V
TaskNN 
<NN 	
ResponseDTONN	 
>NN 
MergeCourseVersionNN (
(NN( )
ClaimsPrincipalNN) 8
UserNN9 =
,NN= >
GuidNN? C
courseVersionIdNND S
)NNS T
;NNT U
TaskPP 
<PP 	
ResponseDTOPP	 
>PP %
GetCourseVersionsCommentsPP /
(QQ 
ClaimsPrincipalRR 
UserRR 
,RR 
GuidSS 
?SS 
courseVersionIdSS 
,SS 
stringTT 
?TT 
filterOnTT 
,TT 
stringUU 
?UU 
filterQueryUU 
,UU 
stringVV 
?VV 
sortByVV 
,VV 
intWW 

pageNumberWW 
,WW 
intXX 
pageSizeXX 
)YY 
;YY 
Task[[ 
<[[ 	
ResponseDTO[[	 
>[[ #
GetCourseVersionComment[[ -
(\\ 
ClaimsPrincipal]] 
User]] 
,]] 
Guid^^ "
courseVersionCommentId^^ #
)__ 
;__ 
Taskaa 
<aa 	
ResponseDTOaa	 
>aa &
CreateCourseVersionCommentaa 0
(bb 
ClaimsPrincipalcc 
Usercc 
,cc *
CreateCourseVersionCommentsDTOdd &*
createCourseVersionCommentsDTOdd' E
)ee 
;ee 
Taskgg 
<gg 	
ResponseDTOgg	 
>gg $
EditCourseVersionCommentgg .
(hh 
ClaimsPrincipalii 
Userii 
,ii (
EditCourseVersionCommentsDTOjj $(
editCourseVersionCommentsDTOjj% A
)kk 
;kk 
Taskmm 
<mm 	
ResponseDTOmm	 
>mm &
RemoveCourseVersionCommentmm 0
(nn 
ClaimsPrincipaloo 
Useroo 
,oo 
Guidpp 
	commentIdpp 
)qq 
;qq 
Taskss 
<ss 	
ResponseDTOss	 
>ss ,
 UploadCourseVersionBackgroundImgss 6
(tt 
ClaimsPrincipaluu 
Useruu 
,uu 
Guidvv 
courseVersionIdvv 
,vv ,
 UploadCourseVersionBackgroundImgww (,
 uploadCourseVersionBackgroundImgww) I
)xx 
;xx 
Taskzz 
<zz 	
MemoryStreamzz	 
>zz -
!DisplayCourseVersionBackgroundImgzz 8
({{ 
ClaimsPrincipal|| 
User|| 
,|| 
Guid}} 
courseVersionId}} 
)~~ 
;~~ 
} ã'
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ICourseService 
{ 
Task 
< 	
ResponseDTO	 
> 
CreateFrameCourse '
(' (
ClaimsPrincipal( 7
User8 <
,< =
Guid> B
courseVersionIdC R
)R S
;S T
Task 
< 	
ResponseDTO	 
> 

GetCourses  
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
instructorId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
double 
? 
	fromPrice 
, 
double 
? 
toPrice 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
	GetCourse 
( 
ClaimsPrincipal   
User   
,   
Guid!! 
courseId!! 
)"" 
;"" 
Task$$ 
<$$ 	
ResponseDTO$$	 
>$$ 
GetCourseInfo$$ #
(%% 
ClaimsPrincipal&& 
User&& 
,&& 
Guid'' 
courseId'' 
)(( 
;(( 
Task** 
<** 	
ResponseDTO**	 
>** 
ActivateCourse** $
(++ 
ClaimsPrincipal,, 
User,, 
,,, 
Guid-- 
courseId-- 
).. 
;.. 
Task00 
<00 	
ResponseDTO00	 
>00 
DeactivateCourse00 &
(11 
ClaimsPrincipal22 
User22 
,22 
Guid33 
courseId33 
)44 
;44 
Task66 
<66 	
ResponseDTO66	 
>66 
EnrollCourse66 "
(77 
ClaimsPrincipal88 
User88 
,88 
EnrollCourseDTO99 
enrollCourseDto99 '
):: 
;:: 
Task<< 
<<< 	
ResponseDTO<<	 
><< "
GetTopPurchasedCourses<< ,
(== 
int>> 
?>> 
year>> 
,>> 
int?? 
??? 
month?? 
,?? 
int@@ 
?@@ 
quarter@@ 
,@@ 
intAA 
topAA 
,AA 
intBB 

pageNumberBB 
,BB 
intCC 
pageSizeCC 
,CC 
stringDD 
?DD 
byCategoryNameDD 
)EE 
;EE 
TaskGG 
<GG 	
ResponseDTOGG	 
>GG $
GetLeastPurchasedCoursesGG .
(HH 
intII 
?II 
yearII 
,II 
intJJ 
?JJ 
monthJJ 
,JJ 
intKK 
?KK 
quarterKK 
,KK 
intLL 
topLL 
,LL 
intMM 

pageNumberMM 
,MM 
intNN 
pageSizeNN 
,NN 
stringOO 
?OO 
byCategoryNameOO 
)PP 
;PP 
TaskRR 
<RR 	
ResponseDTORR	 
>RR 
SuggestCourseRR #
(RR# $
GuidRR$ (
	studentIdRR) 2
)RR2 3
;RR3 4
TaskSS 
<SS 	
ResponseDTOSS	 
>SS 
UpsertCourseTotalSS '
(SS' ( 
UpsertCourseTotalDTOSS( < 
upsertCourseTotalDtoSS= Q
)SSQ R
;SSR S
TaskTT 
<TT 	
ResponseDTOTT	 
>TT '
GetAllBookMarkedCoursesByIdTT 1
(TT1 2
GuidTT2 6
	studentIdTT7 @
,TT@ A
stringTTB H
	sortOrderTTI R
=TTS T
$strTTU [
)TT[ \
;TT\ ]
TaskUU 
<UU 	
ResponseDTOUU	 
>UU "
CreateBookMarkedCourseUU ,
(UU, -
ClaimsPrincipalUU- <
UserUU= A
,UUA B#
CreateCourseBookmarkDTOUUC Z#
createCourseBookmarkDtoUU[ r
)UUr s
;UUs t
TaskVV 
<VV 	
ResponseDTOVV	 
>VV "
DeleteBookMarkedCourseVV ,
(VV, -
GuidVV- 1
idVV2 4
)VV4 5
;VV5 6
}XX „
vD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseSectionVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface (
ICourseSectionVersionService -
{ 
Task 
< 	
ResponseDTO	 
> %
CloneCourseSectionVersion /
(		 
ClaimsPrincipal

 
User

 
,

 (
CloneCourseSectionVersionDTO $(
cloneCourseSectionVersionDto% A
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetCourseSections '
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetCourseSection &
( 
ClaimsPrincipal 
User 
, 
Guid 
courseVersionId 
) 
; 
Task 
< 	
ResponseDTO	 
> 
CreateCourseSection )
( 
ClaimsPrincipal   
User   
,   )
CreateCourseSectionVersionDTO!! %)
createCourseSectionVersionDTO!!& C
)"" 
;"" 
Task## 
<## 	
ResponseDTO##	 
>## 
EditCourseSection## '
($$ 
ClaimsPrincipal%% 
User%% 
,%% '
EditCourseSectionVersionDTO&& #'
editCourseSectionVersionDTO&&$ ?
)'' 
;'' 
Task(( 
<(( 	
ResponseDTO((	 
>(( 
RemoveCourseSection(( )
()) 
ClaimsPrincipal** 
User** 
,** 
Guid++ 
sectionVersionId++ 
),, 
;,, 
}-- ¨
nD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseReviewService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface  
ICourseReviewService %
{ 
Task		 
<		 	
ResponseDTO			 
>		 
CreateCourseReview		 (
(		( )!
CreateCourseReviewDTO		) >!
createCourseReviewDTO		? T
)		T U
;		U V
Task

 
<

 	
ResponseDTO

	 
>

 
UpdateCourseReview

 (
(

( )
ClaimsPrincipal

) 8
User

9 =
,

= >!
UpdateCourseReviewDTO

> S!
updateCourseReviewDTO

T i
)

i j
;

j k
Task 
< 	
ResponseDTO	 
> 
DeleteCourseReview (
(( )
Guid) -
id. 0
)0 1
;1 2
Task 
< 	
ResponseDTO	 
> 
MarkCourseReview &
(& '
Guid' +
id, .
). /
;/ 0
Task 
< 	
ResponseDTO	 
> 
GetCourseReviewById )
() *
Guid* .
id/ 1
)1 2
;2 3
Task 
< 	
ResponseDTO	 
> 
GetCourseReviews &
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
} ñ
nD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseReportService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 

	interface  
ICourseReportService )
{		 
Task

 
<

 
ResponseDTO

 
>

 
GetCourseReports

 *
(

* +
ClaimsPrincipal

+ :
User

; ?
,

? @
Guid

A E
?

E F
courseId

G O
,

O P
string

Q W
?

W X
filterOn

Y a
,

a b
string

c i
?

i j
filterQuery

k v
,

v w
string

x ~
?

~ 
sortBy


Ä Ü
,


Ü á
bool


à å
?


å ç
isAscending


é ô
,


ô ö
int


õ û

pageNumber


ü ©
,


© ™
int


´ Æ
pageSize


Ø ∑
)


∑ ∏
;


∏ π
Task 
< 
ResponseDTO 
> 
GetCourseReportById -
(- .
Guid. 2
id3 5
)5 6
;6 7
Task 
< 
ResponseDTO 
> 
CreateCourseReport ,
(, -!
CreateCourseReportDTO- B!
createCourseReportDTOC X
)X Y
;Y Z
Task 
< 
ResponseDTO 
> 
UpdateCourseReport ,
(, -
ClaimsPrincipal- <
User= A
,A B!
UpdateCourseReportDTOB W!
updateCourseReportDTOX m
)m n
;n o
Task 
< 
ResponseDTO 
> 
DeleteCourseReport ,
(, -
Guid- 1
id2 4
)4 5
;5 6
} ı
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IClosedXMLService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IClosedXMLService "
{ 
Task 
< 	
string	 
> !
ExportInstructorExcel &
(& '
List' +
<+ ,
InstructorInfoDTO, =
>= >
instructorInfoDtos? Q
)Q R
;R S
Task		 
<		 	
string			 
>		 
ExportStudentExcel		 #
(		# $
List		$ (
<		( )
StudentFullInfoDTO		) ;
>		; <
studentFullInfoDTOs		= P
)		P Q
;		Q R
} –
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICategoryService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ICategoryService !
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
Search 
( 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetSubCategory $
($ %
Guid% )
id* ,
), -
;- .
Task   
<   	
ResponseDTO  	 
>   
GetParentCategory   '
(  ' (
Guid  ( ,
id  - /
)  / 0
;  0 1
Task!! 
<!! 	
ResponseDTO!!	 
>!! 
Get!! 
(!! 
ClaimsPrincipal!! )
User!!* .
,!!. /
Guid!!0 4
id!!5 7
)!!7 8
;!!8 9
Task"" 
<"" 	
ResponseDTO""	 
>"" 
CreateCategory"" $
(""$ %
ClaimsPrincipal""% 4
User""5 9
,""9 :
CreateCategoryDTO""; L
createCategoryDto""M ^
)""^ _
;""_ `
Task## 
<## 	
ResponseDTO##	 
>## 
Update## 
(## 
ClaimsPrincipal## ,
User##- 1
,##1 2
UpdateCategoryDTO##3 D
updateCategoryDto##E V
)##V W
;##W X
Task$$ 
<$$ 	
ResponseDTO$$	 
>$$ 
Delete$$ 
($$ 
ClaimsPrincipal$$ ,
User$$- 1
,$$1 2
Guid$$3 7
id$$8 :
)$$: ;
;$$; <
}%% “	
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICartService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ICartService 
{ 
Task 
< 	
ResponseDTO	 
> 
GetCart 
( 
ClaimsPrincipal -
User. 2
)2 3
;3 4
Task		 
<		 	
ResponseDTO			 
>		 
	AddToCart		 
(		  
ClaimsPrincipal		  /
User		0 4
,		4 5
AddToCartDTO		6 B
addToCartDto		C O
)		O P
;		P Q
Task

 
<

 	
ResponseDTO

	 
>

 
RemoveFromCart

 $
(

$ %
ClaimsPrincipal

% 4
User

5 9
,

9 :
Guid

; ?
courseId

@ H
)

H I
;

I J
Task 
< 	
ResponseDTO	 
> 
Checkout 
( 
ClaimsPrincipal .
User/ 3
)3 4
;4 5
} ¯
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IBaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IBaseService 
{ 
Task 
< 	
ResponseDTO	 
? 
> 
	SendAsync  
(  !

RequestDTO! +

requestDto, 6
,6 7
string8 >
?> ?
apiKey@ F
)F G
;G H
} π
iD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IBalanceService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IBalanceService  
{ 
Task 
< 	
ResponseDTO	 
> 
UpsertBalance #
(# $
UpsertBalanceDTO$ 4
upsertBalanceDto5 E
)E F
;F G
} ‡,
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IAuthService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IAuthService 
{ 
Task		 
<		 	
ResponseDTO			 
>		 
SignUpStudent		 #
(		# $
RegisterStudentDTO		$ 6
registerStudentDTO		7 I
)		I J
;		J K
Task

 
<

 	
ResponseDTO

	 
>

 
SignUpInstructor

 &
(

& '
SignUpInstructorDTO

' :
signUpInstructorDto

; N
)

N O
;

O P
Task 
< 	
ResponseDTO	 
> "
UploadInstructorDegree ,
(, -
	IFormFile- 6
file7 ;
,; <
ClaimsPrincipal= L
userM Q
)Q R
;R S
Task 
< 	
ResponseDTO	 
> 
UploadUserAvatar &
(& '
	IFormFile' 0
file1 5
,5 6
ClaimsPrincipal7 F
userG K
)K L
;L M
Task 
< 	
DegreeResponseDTO	 
> 
GetInstructorDegree /
(/ 0
ClaimsPrincipal0 ?
user@ D
)D E
;E F
Task 
< 	
MemoryStream	 
> 
GetUserAvatar $
($ %
ClaimsPrincipal% 4
user5 9
)9 :
;: ;
Task 
< 	
ResponseDTO	 
> 
SignIn 
( 
SignDTO $
signDTO% ,
), -
;- .
Task 
< 	
ResponseDTO	 
> 
ForgotPassword $
($ %
ForgotPasswordDTO% 6
forgotPasswordDto7 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> 
Refresh 
( 
string $
token% *
)* +
;+ ,
Task 
< 	
ResponseDTO	 
> 
ResetPassword #
(# $
string$ *
resetPasswordDto+ ;
,; <
string= C
tokenD I
,I J
stringK Q
passwordR Z
)Z [
;[ \
Task 
< 	
ResponseDTO	 
> 
ChangePassword $
($ %
string% +
userId, 2
,2 3
string4 :
oldPassword; F
,F G
stringH N
newPasswordO Z
,Z [
string\ b
confirmNewPasswordc u
)u v
;v w
Task 
< 	
ResponseDTO	 
> 
SendVerifyEmail %
(% &
string& ,
email- 2
,2 3
string4 :
confirmationLink; K
)K L
;L M
Task 
< 	
ResponseDTO	 
> 
VerifyEmail !
(! "
string" (
userId) /
,/ 0
string1 7
token8 =
)= >
;> ?
Task 
< 	
ResponseDTO	 
> 
CheckEmailExist %
(% &
string& ,
email- 2
)2 3
;3 4
Task 
< 	
ResponseDTO	 
> !
CheckPhoneNumberExist +
(+ ,
string, 2
phoneNumber3 >
)> ?
;? @
Task 
< 	
ResponseDTO	 
> 
SignInByGoogle $
($ %
SignInByGoogleDTO% 6
signInByGoogleDto7 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> "
CompleteStudentProfile ,
(, -
ClaimsPrincipal- <
User= A
,A B%
CompleteStudentProfileDTOC \
studentProfileDto] n
)n o
;o p
Task 
< 	
ResponseDTO	 
> %
CompleteInstructorProfile /
(/ 0
ClaimsPrincipal0 ?
User@ D
,D E(
CompleteInstructorProfileDTOF b 
instructorProfileDtoc w
)w x
;x y
Task 
< 	
ResponseDTO	 
> 
GetUserInfo !
(! "
ClaimsPrincipal" 1
User2 6
)6 7
;7 8
Task 
< 	
MemoryStream	 
> 
DisplayUserAvatar (
(( )
string) /
userId0 6
)6 7
;7 8
Task 
< 	
DegreeResponseDTO	 
> #
DisplayInstructorDegree 3
(3 4
string4 :
userId; A
)A B
;B C
Task 
< 	
ResponseDTO	 
> 
UpdateStudent #
(# $#
UpdateStudentProfileDTO$ ;
updateStudentDto< L
,L M
ClaimsPrincipalN ]
User^ b
)b c
;c d
Task 
< 	
ResponseDTO	 
> 
UpdateInstructor &
(& '%
UpdateIntructorProfileDTO' @
updateIntructorDtoA S
,S T
ClaimsPrincipalU d
Usere i
)i j
;j k
}   ∏
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Hubs\NotificationHub.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Hubs !
;! "
[ 
	Authorize 

]
 
public 
class 
NotificationHub 
: 
Hub "
{ 
private		 
static		 
readonly		 

Dictionary		 &
<		& '
string		' -
,		- .
string		/ 5
>		5 6
_connections		7 C
=		D E
new		F I

Dictionary		J T
<		T U
string		U [
,		[ \
string		] c
>		c d
(		d e
)		e f
;		f g
public 

override 
Task 
OnConnectedAsync )
() *
)* +
{ 
string 
userId 
= 
Context 
.  
UserIdentifier  .
;. /
if 

( 
userId 
!= 
null 
) 
{ 	
_connections 
[ 
userId 
]  
=! "
Context# *
.* +
ConnectionId+ 7
;7 8
} 	
return 
base 
. 
OnConnectedAsync $
($ %
)% &
;& '
} 
public 

override 
Task 
OnDisconnectedAsync ,
(, -
	Exception- 6
	exception7 @
)@ A
{ 
string 
userId 
= 
Context 
.  
UserIdentifier  .
;. /
if 

( 
userId 
!= 
null 
) 
{ 	
_connections 
. 
Remove 
(  
userId  &
)& '
;' (
} 	
return 
base 
. 
OnDisconnectedAsync '
(' (
	exception( 1
)1 2
;2 3
} 
public 

Task 
SendMessageToUser !
(! "
string" (
userId) /
,/ 0
string1 7
message8 ?
)? @
{   
if!! 

(!! 
_connections!! 
.!! 
TryGetValue!! $
(!!$ %
userId!!% +
,!!+ ,
out!!- 0
var!!1 4
connectionId!!5 A
)!!A B
)!!B C
{"" 	
return## 
Clients## 
.## 
Client## !
(##! "
connectionId##" .
)##. /
.##/ 0
	SendAsync##0 9
(##9 :
$str##: J
,##J K
message##L S
)##S T
;##T U
}$$ 	
return%% 
Task%% 
.%% 
CompletedTask%% !
;%%! "
}&& 
}'' 