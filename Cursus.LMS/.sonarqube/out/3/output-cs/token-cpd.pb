≤Y
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\TokenService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
TokenService 
: 
ITokenService )
{ 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
IRedisService "
_redisService# 0
;0 1
public 

TokenService 
( 
UserManager #
<# $
ApplicationUser$ 3
>3 4
userManager5 @
,@ A
IConfigurationB P
configurationQ ^
,^ _
IRedisService 
redisService "
)" #
{ 
_userManager 
= 
userManager "
;" #
_configuration 
= 
configuration &
;& '
_redisService 
= 
redisService $
;$ %
} 
public 

async 
Task 
< 
string 
> '
GenerateJwtAccessTokenAsync 9
(9 :
ApplicationUser: I
userJ N
)N O
{ 
var 
	userRoles 
= 
await 
_userManager *
.* +
GetRolesAsync+ 8
(8 9
user9 =
)= >
;> ?
var 

authClaims 
= 
new 
List !
<! "
Claim" '
>' (
(( )
)) *
{   	
new!! 
Claim!! 
(!! 

ClaimTypes!!  
.!!  !
Name!!! %
,!!% &
user!!' +
.!!+ ,
UserName!!, 4
)!!4 5
,!!5 6
new"" 
Claim"" 
("" 

ClaimTypes""  
.""  !
NameIdentifier""! /
,""/ 0
user""1 5
.""5 6
Id""6 8
)""8 9
,""9 :
}## 	
;##	 

foreach%% 
(%% 
var%% 
role%% 
in%% 
	userRoles%% &
)%%& '
{&& 	

authClaims'' 
.'' 
Add'' 
('' 
new'' 
Claim'' $
(''$ %

ClaimTypes''% /
.''/ 0
Role''0 4
,''4 5
role''6 :
)'': ;
)''; <
;''< =
}(( 	
var++ 

authSecret++ 
=++ 
new++  
SymmetricSecurityKey++ 1
(++1 2
Encoding++2 :
.++: ;
UTF8++; ?
.++? @
GetBytes++@ H
(++H I
_configuration++I W
[++W X
$str++X d
]++d e
)++e f
)++f g
;++g h
var,, 
signingCredentials,, 
=,,  
new,,! $
SigningCredentials,,% 7
(,,7 8

authSecret,,8 B
,,,B C
SecurityAlgorithms,,D V
.,,V W

HmacSha256,,W a
),,a b
;,,b c
var.. 
tokenObject.. 
=.. 
new.. 
JwtSecurityToken.. .
(... /
issuer// 
:// 
_configuration// "
[//" #
$str//# 4
]//4 5
,//5 6
audience00 
:00 
_configuration00 $
[00$ %
$str00% 8
]008 9
,009 :
	notBefore11 
:11 
DateTime11 
.11  
Now11  #
,11# $
expires22 
:22 
DateTime22 
.22 
Now22 !
.22! "

AddMinutes22" ,
(22, -
$num22- /
)22/ 0
,220 1
claims33 
:33 

authClaims33 
,33 
signingCredentials44 
:44 
signingCredentials44  2
)55 	
;55	 

var77 
accessToken77 
=77 
new77 #
JwtSecurityTokenHandler77 5
(775 6
)776 7
.777 8

WriteToken778 B
(77B C
tokenObject77C N
)77N O
;77O P
return99 
accessToken99 
;99 
}:: 
public@@ 

async@@ 
Task@@ 
<@@ 
string@@ 
>@@ (
GenerateJwtRefreshTokenAsync@@ :
(@@: ;
ApplicationUser@@; J
user@@K O
)@@O P
{AA 
varBB 

authClaimsBB 
=BB 
newBB 
ListBB !
<BB! "
ClaimBB" '
>BB' (
(BB( )
)BB) *
{CC 	
newDD 
ClaimDD 
(DD 

ClaimTypesDD  
.DD  !
NameIdentifierDD! /
,DD/ 0
userDD1 5
.DD5 6
IdDD6 8
)DD8 9
,DD9 :
}EE 	
;EE	 

varHH 

authSecretHH 
=HH 
newHH  
SymmetricSecurityKeyHH 1
(HH1 2
EncodingHH2 :
.HH: ;
UTF8HH; ?
.HH? @
GetBytesHH@ H
(HHH I
_configurationHHI W
[HHW X
$strHHX d
]HHd e
)HHe f
)HHf g
;HHg h
varII 
signingCredentialsII 
=II  
newII! $
SigningCredentialsII% 7
(II7 8

authSecretII8 B
,IIB C
SecurityAlgorithmsIID V
.IIV W

HmacSha256IIW a
)IIa b
;IIb c
varKK 
tokenObjectKK 
=KK 
newKK 
JwtSecurityTokenKK .
(KK. /
issuerLL 
:LL 
_configurationLL "
[LL" #
$strLL# 4
]LL4 5
,LL5 6
audienceMM 
:MM 
_configurationMM $
[MM$ %
$strMM% 8
]MM8 9
,MM9 :
	notBeforeNN 
:NN 
DateTimeNN 
.NN  
NowNN  #
,NN# $
expiresOO 
:OO 
DateTimeOO 
.OO 
NowOO !
.OO! "
AddDaysOO" )
(OO) *
$numOO* +
)OO+ ,
,OO, -
claimsPP 
:PP 

authClaimsPP 
,PP 
signingCredentialsQQ 
:QQ 
signingCredentialsQQ  2
)RR 	
;RR	 

varTT 
refreshTokenTT 
=TT 
newTT #
JwtSecurityTokenHandlerTT 6
(TT6 7
)TT7 8
.TT8 9

WriteTokenTT9 C
(TTC D
tokenObjectTTD O
)TTO P
;TTP Q
returnVV 
refreshTokenVV 
;VV 
}WW 
publicYY 

asyncYY 
TaskYY 
<YY 
ClaimsPrincipalYY %
>YY% &!
GetPrincipalFromTokenYY' <
(YY< =
stringYY= C
tokenYYD I
)YYI J
{ZZ 
var[[ 
tokenHandler[[ 
=[[ 
new[[ #
JwtSecurityTokenHandler[[ 6
([[6 7
)[[7 8
;[[8 9
var\\ 
key\\ 
=\\ 
Encoding\\ 
.\\ 
UTF8\\ 
.\\  
GetBytes\\  (
(\\( )
_configuration\\) 7
[\\7 8
$str\\8 D
]\\D E
)\\E F
;\\F G
try^^ 
{__ 	
var`` 
	principal`` 
=`` 
tokenHandler`` (
.``( )
ValidateToken``) 6
(``6 7
token``7 <
,``< =
new``> A%
TokenValidationParameters``B [
{aa 
ValidateIssuerbb 
=bb  
truebb! %
,bb% &
ValidateAudiencecc  
=cc! "
truecc# '
,cc' (
ValidateLifetimedd  
=dd! "
truedd# '
,dd' ($
ValidateIssuerSigningKeyee (
=ee) *
trueee+ /
,ee/ 0
ValidIssuerff 
=ff 
_configurationff ,
[ff, -
$strff- >
]ff> ?
,ff? @
ValidAudiencegg 
=gg 
_configurationgg  .
[gg. /
$strgg/ B
]ggB C
,ggC D
IssuerSigningKeyhh  
=hh! "
newhh# & 
SymmetricSecurityKeyhh' ;
(hh; <
keyhh< ?
)hh? @
}ii 
,ii 
outii 
SecurityTokenii  
validatedTokenii! /
)ii/ 0
;ii0 1
returnjj 
	principaljj 
;jj 
}kk 	
catchll 
{mm 	
returnoo 
nulloo 
;oo 
}pp 	
}qq 
publicyy 

asyncyy 
Taskyy 
<yy 
boolyy 
>yy 
StoreRefreshTokenyy -
(yy- .
stringyy. 4
userIdyy5 ;
,yy; <
stringyy= C
refreshTokenyyD P
)yyP Q
{zz 
string{{ 
redisKey{{ 
={{ 
$"{{ 
$str{{ #
{{{# $
userId{{$ *
}{{* +
$str{{+ 8
"{{8 9
;{{9 :
var|| 
result|| 
=|| 
await|| 
_redisService|| (
.||( )
StoreString||) 4
(||4 5
redisKey||5 =
,||= >
refreshToken||? K
)||K L
;||L M
return}} 
result}} 
;}} 
}~~ 
public
ÖÖ 

async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
string
ÖÖ 
>
ÖÖ "
RetrieveRefreshToken
ÖÖ 2
(
ÖÖ2 3
string
ÖÖ3 9
userId
ÖÖ: @
)
ÖÖ@ A
{
ÜÜ 
string
áá 
redisKey
áá 
=
áá 
$"
áá 
$str
áá #
{
áá# $
userId
áá$ *
}
áá* +
$str
áá+ 8
"
áá8 9
;
áá9 :
var
àà 
result
àà 
=
àà 
await
àà 
_redisService
àà (
.
àà( )
RetrieveString
àà) 7
(
àà7 8
redisKey
àà8 @
)
àà@ A
;
ààA B
return
ââ 
result
ââ 
;
ââ 
}
ää 
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
bool
ëë 
>
ëë  
DeleteRefreshToken
ëë .
(
ëë. /
string
ëë/ 5
userId
ëë6 <
)
ëë< =
{
íí 
string
ìì 
redisKey
ìì 
=
ìì 
$"
ìì 
$str
ìì #
{
ìì# $
userId
ìì$ *
}
ìì* +
$str
ìì+ 8
"
ìì8 9
;
ìì9 :
var
îî 
result
îî 
=
îî 
await
îî 
_redisService
îî (
.
îî( )
DeleteString
îî) 5
(
îî5 6
redisKey
îî6 >
)
îî> ?
;
îî? @
return
ïï 
result
ïï 
;
ïï 
}
ññ 
}óó ‹÷
uD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\SectionDetailsVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class (
SectionDetailsVersionService )
:* +)
ISectionDetailsVersionService, I
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IFirebaseService %
_firebaseService& 6
;6 7
public 
(
SectionDetailsVersionService '
(' (
IUnitOfWork( 3

unitOfWork4 >
,> ?
IMapper@ G
mapperH N
,N O
IFirebaseServiceP `
firebaseServicea p
)p q
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
_firebaseService 
= 
firebaseService *
;* +
} 
public 

async 
Task 
< 
ResponseDTO !
>! "'
CloneSectionsDetailsVersion# >
( 
ClaimsPrincipal   
User   
,   *
CloneSectionsDetailsVersionDTO!! &*
cloneSectionsDetailsVersionDto!!' E
)"" 
{## 
try$$ 
{%% 	
var&& "
sectionDetailsVersions&& &
=&&' (
await'' 
_unitOfWork'' !
.''! "+
SectionDetailsVersionRepository''" A
.(( @
4GetSectionDetailsVersionsOfCourseSectionVersionAsync(( I
()) *
cloneSectionsDetailsVersionDto** 6
.**6 7%
OldCourseSectionVersionId**7 P
,**P Q
asNoTracking++ $
:++$ %
true++& *
),, 
;,, 
if.. 
(.. "
sectionDetailsVersions.. &
...& '
IsNullOrEmpty..' 4
(..4 5
)..5 6
)..6 7
{// 
return00 
new00 
ResponseDTO00 &
(00& '
)00' (
{11 
	IsSuccess22 
=22 
false22  %
,22% &

StatusCode33 
=33  
$num33! $
,33$ %
Result44 
=44 
null44 !
,44! "
Message55 
=55 
$str55 W
}66 
;66 
}77 
foreach99 
(99 
var99 !
sectionDetailsVersion99 .
in99/ 1"
sectionDetailsVersions992 H
)99H I
{:: !
sectionDetailsVersion;; %
.;;% &
Id;;& (
=;;) *
Guid;;+ /
.;;/ 0
NewGuid;;0 7
(;;7 8
);;8 9
;;;9 :!
sectionDetailsVersion<< %
.<<% &"
CourseSectionVersionId<<& <
=<<= >*
cloneSectionsDetailsVersionDto<<? ]
.<<] ^%
NewCourseSectionVersionId<<^ w
;<<w x
}== 
await?? 
_unitOfWork?? 
.?? +
SectionDetailsVersionRepository?? =
.??= >
AddRangeAsync??> K
(??K L"
sectionDetailsVersions??L b
)??b c
;??c d
await@@ 
_unitOfWork@@ 
.@@ 
	SaveAsync@@ '
(@@' (
)@@( )
;@@) *
returnBB 
newBB 
ResponseDTOBB "
(BB" #
)BB# $
{CC 
	IsSuccessDD 
=DD 
trueDD  
,DD  !

StatusCodeEE 
=EE 
$numEE  
,EE  !
MessageFF 
=FF 
$strFF O
,FFO P
ResultGG 
=GG 
nullGG 
}HH 
;HH 
}II 	
catchJJ 
(JJ 
	ExceptionJJ 
eJJ 
)JJ 
{KK 	
returnLL 
newLL 
ResponseDTOLL "
(LL" #
)LL# $
{MM 
	IsSuccessNN 
=NN 
falseNN !
,NN! "

StatusCodeOO 
=OO 
$numOO  
,OO  !
MessagePP 
=PP 
ePP 
.PP 
MessagePP #
,PP# $
ResultQQ 
=QQ 
nullQQ 
}RR 
;RR 
}SS 	
}TT 
publicVV 

asyncVV 
TaskVV 
<VV 
ResponseDTOVV !
>VV! "&
GetSectionsDetailsVersionsVV# =
(WW 
ClaimsPrincipalXX 
UserXX 
,XX 
GuidYY 
?YY 
courseSectionIdYY 
,YY 
stringZZ 
?ZZ 
filterOnZZ 
,ZZ 
string[[ 
?[[ 
filterQuery[[ 
,[[ 
string\\ 
?\\ 
sortBy\\ 
,\\ 
bool]] 
?]] 
isAscending]] 
,]] 
int^^ 

pageNumber^^ 
,^^ 
int__ 
pageSize__ 
)__ 
{`` 
tryaa 
{bb 	
IEnumerablecc 
<cc !
SectionDetailsVersioncc -
>cc- .
sectionscc/ 7
;cc7 8
sectionsff 
=ff 
awaitff 
_unitOfWorkff (
.ff( )+
SectionDetailsVersionRepositoryff) H
.ffH I
GetAllAsyncffI T
(ffT U
xffU V
=>ffW Y
xgg 
.gg "
CourseSectionVersionIdgg (
==gg) +
courseSectionIdgg, ;
)gg; <
;gg< =
ifjj 
(jj 
!jj 
sectionsjj 
.jj 
Anyjj 
(jj 
)jj 
)jj  
{kk 
returnll 
newll 
ResponseDTOll &
(ll& '
)ll' (
{mm 
Messagenn 
=nn 
$strnn 4
,nn4 5
	IsSuccessoo 
=oo 
trueoo  $
,oo$ %

StatusCodepp 
=pp  
$numpp! $
,pp$ %
Resultqq 
=qq 
sectionsqq %
}rr 
;rr 
}ss 
varuu 
listSectionuu 
=uu 
sectionsuu &
.uu& '
ToListuu' -
(uu- .
)uu. /
;uu/ 0
ifxx 
(xx 
!xx 
stringxx 
.xx 
IsNullOrEmptyxx %
(xx% &
filterOnxx& .
)xx. /
&&xx0 2
!xx3 4
stringxx4 :
.xx: ;
IsNullOrEmptyxx; H
(xxH I
filterQueryxxI T
)xxT U
)xxU V
{yy 
switchzz 
(zz 
filterOnzz  
.zz  !
Trimzz! %
(zz% &
)zz& '
.zz' (
ToLowerzz( /
(zz/ 0
)zz0 1
)zz1 2
{{{ 
case|| 
$str|| 
:||  
listSection}} #
=}}$ %
listSection}}& 1
.}}1 2
Where}}2 7
(}}7 8
x}}8 9
=>}}: <
x~~ 
.~~ 
Name~~ "
.~~" #
Contains~~# +
(~~+ ,
filterQuery~~, 7
,~~7 8
StringComparison~~9 I
.~~I J$
CurrentCultureIgnoreCase~~J b
)~~b c
)~~c d
.~~d e
ToList~~e k
(~~k l
)~~l m
;~~m n
break 
; 
default
ÄÄ 
:
ÄÄ 
break
ÅÅ 
;
ÅÅ 
}
ÇÇ 
}
ÉÉ 
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
string
ÜÜ 
.
ÜÜ 
IsNullOrEmpty
ÜÜ %
(
ÜÜ% &
sortBy
ÜÜ& ,
)
ÜÜ, -
)
ÜÜ- .
{
áá 
switch
àà 
(
àà 
sortBy
àà 
.
àà 
Trim
àà #
(
àà# $
)
àà$ %
.
àà% &
ToLower
àà& -
(
àà- .
)
àà. /
)
àà/ 0
{
ââ 
case
ää 
$str
ää 
:
ää  
listSection
ãã #
=
ãã$ %
listSection
ãã& 1
.
ãã1 2
OrderBy
ãã2 9
(
ãã9 :
x
ãã: ;
=>
ãã< >
x
ãã? @
.
ãã@ A
Name
ããA E
)
ããE F
.
ããF G
ToList
ããG M
(
ããM N
)
ããN O
;
ããO P
break
åå 
;
åå 
default
çç 
:
çç 
break
éé 
;
éé 
}
èè 
}
êê 
if
ìì 
(
ìì 

pageNumber
ìì 
>
ìì 
$num
ìì 
&&
ìì !
pageSize
ìì" *
>
ìì+ ,
$num
ìì- .
)
ìì. /
{
îî 
var
ïï 

skipResult
ïï 
=
ïï  
(
ïï! "

pageNumber
ïï" ,
-
ïï- .
$num
ïï/ 0
)
ïï0 1
*
ïï2 3
pageSize
ïï4 <
;
ïï< =
listSection
ññ 
=
ññ 
listSection
ññ )
.
ññ) *
Skip
ññ* .
(
ññ. /

skipResult
ññ/ 9
)
ññ9 :
.
ññ: ;
Take
ññ; ?
(
ññ? @
pageSize
ññ@ H
)
ññH I
.
ññI J
ToList
ññJ P
(
ññP Q
)
ññQ R
;
ññR S
}
óó 
var
öö 

sectionDto
öö 
=
öö 
listSection
öö (
.
öö( )
Select
öö) /
(
öö/ 0
section
öö0 7
=>
öö8 :
new
öö; >$
GetAllSectionDetailDTO
öö? U
{
õõ 
Id
úú 
=
úú 
section
úú 
.
úú 
Id
úú 
,
úú  !
courseSectionDetail
ùù #
=
ùù$ %
section
ùù& -
.
ùù- .$
CourseSectionVersionId
ùù. D
,
ùùD E
name
ûû 
=
ûû 
section
ûû 
.
ûû 
Name
ûû #
,
ûû# $
videoUrl
üü 
=
üü 
section
üü "
.
üü" #
VideoUrl
üü# +
,
üü+ ,
slideUrl
†† 
=
†† 
section
†† "
.
††" #
SlideUrl
††# +
,
††+ ,
docsUrl
°° 
=
°° 
section
°° !
.
°°! "
DocsUrl
°°" )
,
°°) *
type
¢¢ 
=
¢¢ 
section
¢¢ 
.
¢¢ 
Type
¢¢ #
,
¢¢# $
currentStatus
££ 
=
££ 
section
££  '
.
££' (
CurrentStatus
££( 5
,
££5 6
}
§§ 
)
§§ 
.
§§ 
ToList
§§ 
(
§§ 
)
§§ 
;
§§ 
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ "
(
¶¶" #
)
¶¶# $
{
ßß 
Message
®® 
=
®® 
$str
®® D
,
®®D E
	IsSuccess
©© 
=
©© 
true
©©  
,
©©  !

StatusCode
™™ 
=
™™ 
$num
™™  
,
™™  !
Result
´´ 
=
´´ 

sectionDto
´´ #
}
¨¨ 
;
¨¨ 
}
≠≠ 	
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
e
ÆÆ 
)
ÆÆ 
{
ØØ 	
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ "
(
∞∞" #
)
∞∞# $
{
±± 
Message
≤≤ 
=
≤≤ 
e
≤≤ 
.
≤≤ 
Message
≤≤ #
,
≤≤# $
Result
≥≥ 
=
≥≥ 
null
≥≥ 
,
≥≥ 
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥ !
,
¥¥! "

StatusCode
µµ 
=
µµ 
$num
µµ  
}
∂∂ 
;
∂∂ 
}
∑∑ 	
}
∏∏ 
public
∫∫ 

async
∫∫ 
Task
∫∫ 
<
∫∫ 
ResponseDTO
∫∫ !
>
∫∫! "&
GetSectionDetailsVersion
∫∫# ;
(
∫∫; <
ClaimsPrincipal
∫∫< K
User
∫∫L P
,
∫∫P Q
Guid
∫∫R V
	detailsId
∫∫W `
)
∫∫` a
{
ªª 
try
ºº 
{
ΩΩ 	
var
ææ 
detail
ææ 
=
ææ 
await
øø 
_unitOfWork
øø !
.
øø! "-
SectionDetailsVersionRepository
øø" A
.
øøA B*
GetSectionDetailsVersionById
øøB ^
(
øø^ _
	detailsId
øø_ h
)
øøh i
;
øøi j
if
¡¡ 
(
¡¡ 
detail
¡¡ 
is
¡¡ 
null
¡¡ 
)
¡¡ 
{
¬¬ 
return
√√ 
new
√√ 
ResponseDTO
√√ &
(
√√& '
)
√√' (
{
ƒƒ 
Result
≈≈ 
=
≈≈ 
$str
≈≈ 
,
≈≈  
Message
∆∆ 
=
∆∆ 
$str
∆∆ K
,
∆∆K L
	IsSuccess
«« 
=
«« 
true
««  $
,
««$ %

StatusCode
»» 
=
»»  
$num
»»! $
}
…… 
;
…… 
}
   
var
ÃÃ 
sectionDetail
ÃÃ 
=
ÃÃ 
new
ÃÃ  ##
SectionDetailsVersion
ÃÃ$ 9
{
ÕÕ 
Id
ŒŒ 
=
ŒŒ 
	detailsId
ŒŒ 
,
ŒŒ $
CourseSectionVersionId
œœ &
=
œœ' (
detail
œœ) /
.
œœ/ 0$
CourseSectionVersionId
œœ0 F
,
œœF G
Name
–– 
=
–– 
detail
–– 
.
–– 
Name
–– "
,
––" #
VideoUrl
—— 
=
—— 
detail
—— !
.
——! "
VideoUrl
——" *
,
——* +
SlideUrl
““ 
=
““ 
detail
““ !
.
““! "
SlideUrl
““" *
,
““* +
DocsUrl
”” 
=
”” 
detail
””  
.
””  !
DocsUrl
””! (
,
””( )
Type
‘‘ 
=
‘‘ 
detail
‘‘ 
.
‘‘ 
Type
‘‘ "
,
‘‘" #
CurrentStatus
’’ 
=
’’ 
detail
’’  &
.
’’& '
CurrentStatus
’’' 4
,
’’4 5
}
÷÷ 
;
÷÷ 
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
{
ŸŸ 
Result
⁄⁄ 
=
⁄⁄ 
sectionDetail
⁄⁄ &
,
⁄⁄& '
Message
€€ 
=
€€ 
$str
€€ B
,
€€B C
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  
,
‹‹  !

StatusCode
›› 
=
›› 
$num
››  
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 	
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
(
‚‚" #
)
‚‚# $
{
„„ 
Result
‰‰ 
=
‰‰ 
null
‰‰ 
,
‰‰ 
Message
ÂÂ 
=
ÂÂ 
e
ÂÂ 
.
ÂÂ 
Message
ÂÂ #
,
ÂÂ# $
	IsSuccess
ÊÊ 
=
ÊÊ 
true
ÊÊ  
,
ÊÊ  !

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
}
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
public
ÏÏ 

async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
ResponseDTO
ÏÏ !
>
ÏÏ! ")
CreateSectionDetailsVersion
ÏÏ# >
(
ÌÌ 
ClaimsPrincipal
ÓÓ 
User
ÓÓ 
,
ÓÓ ,
CreateSectionDetailsVersionDTO
ÔÔ &,
createSectionDetailsVersionDto
ÔÔ' E
)
 
{
ÒÒ 
try
ÚÚ 
{
ÛÛ 	
var
ÙÙ 
Id
ÙÙ 
=
ÙÙ 
await
ıı 
_unitOfWork
ıı !
.
ıı! ",
CourseSectionVersionRepository
ıı" @
.
ıı@ A
GetAsync
ııA I
(
ııI J
i
ııJ K
=>
ııL N
i
ˆˆ 
.
ˆˆ 
Id
ˆˆ 
==
ˆˆ ,
createSectionDetailsVersionDto
ˆˆ :
.
ˆˆ: ;$
courseSectionVersionId
ˆˆ; Q
)
ˆˆQ R
;
ˆˆR S
if
˜˜ 
(
˜˜ 
Id
˜˜ 
==
˜˜ 
null
˜˜ 
)
˜˜ 
{
¯¯ 
return
˘˘ 
new
˘˘ 
ResponseDTO
˘˘ &
(
˘˘& '
)
˘˘' (
{
˙˙ 
Message
˚˚ 
=
˚˚ 
$str
˚˚ >
,
˚˚> ?
Result
¸¸ 
=
¸¸ 
null
¸¸ !
,
¸¸! "
	IsSuccess
˝˝ 
=
˝˝ 
false
˝˝  %
,
˝˝% &

StatusCode
˛˛ 
=
˛˛  
$num
˛˛! $
}
ˇˇ 
;
ˇˇ 
}
ÄÄ 
var
ÇÇ 
sectionDetail
ÇÇ 
=
ÇÇ 
new
ÇÇ  ##
SectionDetailsVersion
ÇÇ$ 9
{
ÉÉ $
CourseSectionVersionId
ÑÑ &
=
ÑÑ' (,
createSectionDetailsVersionDto
ÑÑ) G
?
ÑÑG H
.
ÑÑH I$
courseSectionVersionId
ÑÑI _
,
ÑÑ_ `
Name
ÖÖ 
=
ÖÖ ,
createSectionDetailsVersionDto
ÖÖ 5
?
ÖÖ5 6
.
ÖÖ6 7
name
ÖÖ7 ;
,
ÖÖ; <
}
ÜÜ 
;
ÜÜ 
await
àà 
_unitOfWork
àà 
.
àà -
SectionDetailsVersionRepository
àà =
.
àà= >
AddAsync
àà> F
(
ààF G
sectionDetail
ààG T
)
ààT U
;
ààU V
await
ââ 
_unitOfWork
ââ 
.
ââ 
	SaveAsync
ââ '
(
ââ' (
)
ââ( )
;
ââ) *
return
ãã 
new
ãã 
ResponseDTO
ãã "
{
åå 
Message
çç 
=
çç 
$str
çç >
,
çç> ?
Result
éé 
=
éé 
null
éé 
,
éé 
	IsSuccess
èè 
=
èè 
true
èè  
,
èè  !

StatusCode
êê 
=
êê 
$num
êê  
}
ëë 
;
ëë 
}
íí 	
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 	
return
óó 
new
óó 
ResponseDTO
óó "
{
òò 
Message
ôô 
=
ôô 
e
ôô 
.
ôô 
Message
ôô #
,
ôô# $
Result
öö 
=
öö 
null
öö 
,
öö 
	IsSuccess
õõ 
=
õõ 
false
õõ !
,
õõ! "

StatusCode
úú 
=
úú 
$num
úú  
}
ùù 
;
ùù 
}
ûû 	
}
üü 
public
°° 

async
°° 
Task
°° 
<
°° 
ResponseDTO
°° !
>
°°! "'
EditSectionDetailsVersion
°°# <
(
¢¢ 
ClaimsPrincipal
££ 
User
££ 
,
££ *
EditSectionDetailsVersionDTO
§§ $*
editSectionDetailsVersionDto
§§% A
)
•• 
{
¶¶ 
try
ßß 
{
®® 	
var
©© 
id
©© 
=
©© 
await
©© 
_unitOfWork
©© &
.
©©& '-
SectionDetailsVersionRepository
©©' F
.
©©F G
GetAsync
©©G O
(
©©O P
i
©©P Q
=>
©©R T
i
™™ 
.
™™ 
Id
™™ 
==
™™ *
editSectionDetailsVersionDto
™™ 4
.
™™4 5
sectionDetailId
™™5 D
)
™™D E
;
™™E F
if
¨¨ 
(
¨¨ 
id
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨ 
{
≠≠ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ &
(
ÆÆ& '
)
ÆÆ' (
{
ØØ 
Message
∞∞ 
=
∞∞ 
$str
∞∞ >
,
∞∞> ?
Result
±± 
=
±± 
null
±± !
,
±±! "
	IsSuccess
≤≤ 
=
≤≤ 
false
≤≤  %
,
≤≤% &

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
}
¥¥ 
;
¥¥ 
}
µµ 
id
∑∑ 
.
∑∑ $
CourseSectionVersionId
∑∑ %
=
∑∑& '*
editSectionDetailsVersionDto
∑∑( D
.
∑∑D E
courseSectionId
∑∑E T
;
∑∑T U
id
∏∏ 
.
∏∏ 
Name
∏∏ 
=
∏∏ *
editSectionDetailsVersionDto
∏∏ 2
?
∏∏2 3
.
∏∏3 4
name
∏∏4 8
;
∏∏8 9
_unitOfWork
ªª 
.
ªª -
SectionDetailsVersionRepository
ªª 7
.
ªª7 8
Update
ªª8 >
(
ªª> ?
id
ªª? A
)
ªªA B
;
ªªB C
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
return
ææ 
new
ææ 
ResponseDTO
ææ "
{
øø 
Message
¿¿ 
=
¿¿ 
$str
¿¿ <
,
¿¿< =
Result
¡¡ 
=
¡¡ 
id
¡¡ 
,
¡¡ 
	IsSuccess
¬¬ 
=
¬¬ 
true
¬¬  
,
¬¬  !

StatusCode
√√ 
=
√√ 
$num
√√  
}
ƒƒ 
;
ƒƒ 
}
≈≈ 	
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
e
∆∆ 
)
∆∆ 
{
«« 	
return
»» 
new
»» 
ResponseDTO
»» "
{
…… 
Message
   
=
   
e
   
.
   
Message
   #
,
  # $
Result
ÀÀ 
=
ÀÀ 
null
ÀÀ 
,
ÀÀ 
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ !
,
ÃÃ! "

StatusCode
ÕÕ 
=
ÕÕ 
$num
ÕÕ  
}
ŒŒ 
;
ŒŒ 
}
œœ 	
}
–– 
public
““ 

async
““ 
Task
““ 
<
““ 
ResponseDTO
““ !
>
““! ")
RemoveSectionDetailsVersion
““# >
(
”” 
ClaimsPrincipal
‘‘ 
User
‘‘ 
,
‘‘ 
Guid
’’ 
	detailsId
’’ 
)
÷÷ 
{
◊◊ 
try
ÿÿ 
{
ŸŸ 	
var
⁄⁄ 
Id
⁄⁄ 
=
⁄⁄ 
await
⁄⁄ 
_unitOfWork
⁄⁄ &
.
⁄⁄& '-
SectionDetailsVersionRepository
⁄⁄' F
.
⁄⁄F G
GetAsync
⁄⁄G O
(
⁄⁄O P
i
⁄⁄P Q
=>
⁄⁄R T
i
⁄⁄U V
.
⁄⁄V W
Id
⁄⁄W Y
==
⁄⁄Z \
	detailsId
⁄⁄] f
)
⁄⁄f g
;
⁄⁄g h
if
€€ 
(
€€ 
Id
€€ 
==
€€ 
null
€€ 
)
€€ 
{
‹‹ 
return
›› 
new
›› 
ResponseDTO
›› &
(
››& '
)
››' (
{
ﬁﬁ 
Message
ﬂﬂ 
=
ﬂﬂ 
$str
ﬂﬂ >
,
ﬂﬂ> ?
Result
‡‡ 
=
‡‡ 
null
‡‡ !
,
‡‡! "
	IsSuccess
·· 
=
·· 
false
··  %
,
··% &

StatusCode
‚‚ 
=
‚‚  
$num
‚‚! $
}
„„ 
;
„„ 
}
‰‰ 
_unitOfWork
ÁÁ 
.
ÁÁ -
SectionDetailsVersionRepository
ÁÁ 7
.
ÁÁ7 8
Remove
ÁÁ8 >
(
ÁÁ> ?
Id
ÁÁ? A
)
ÁÁA B
;
ÁÁB C
await
ËË 
_unitOfWork
ËË 
.
ËË 
	SaveAsync
ËË '
(
ËË' (
)
ËË( )
;
ËË) *
return
ÍÍ 
new
ÍÍ 
ResponseDTO
ÍÍ "
(
ÍÍ" #
)
ÍÍ# $
{
ÎÎ 
Message
ÏÏ 
=
ÏÏ 
$str
ÏÏ E
,
ÏÏE F
Result
ÌÌ 
=
ÌÌ 
null
ÌÌ 
,
ÌÌ 
	IsSuccess
ÓÓ 
=
ÓÓ 
true
ÓÓ  
,
ÓÓ  !

StatusCode
ÔÔ 
=
ÔÔ 
$num
ÔÔ  
}
 
;
 
}
ÒÒ 	
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 	
return
ÙÙ 
new
ÙÙ 
ResponseDTO
ÙÙ "
{
ıı 
Message
ˆˆ 
=
ˆˆ 
e
ˆˆ 
.
ˆˆ 
Message
ˆˆ #
,
ˆˆ# $
Result
˜˜ 
=
˜˜ 
null
˜˜ 
,
˜˜ 
	IsSuccess
¯¯ 
=
¯¯ 
false
¯¯ !
,
¯¯! "

StatusCode
˘˘ 
=
˘˘ 
$num
˘˘  
}
˙˙ 
;
˙˙ 
}
˚˚ 	
}
¸¸ 
public
˛˛ 

async
˛˛ 
Task
˛˛ 
<
˛˛ 
ResponseDTO
˛˛ !
>
˛˛! "0
"UploadSectionDetailsVersionContent
˛˛# E
(
ˇˇ 
ClaimsPrincipal
ÄÄ 
User
ÄÄ 
,
ÄÄ 
Guid
ÅÅ 
	detailsId
ÅÅ 
,
ÅÅ 3
%UploadSectionDetailsVersionContentDTO
ÇÇ -3
%uploadSectionDetailsVersionContentDto
ÇÇ. S
)
ÉÉ 
{
ÑÑ 
try
ÖÖ 
{
ÜÜ 	
if
àà 
(
àà 3
%uploadSectionDetailsVersionContentDto
àà 5
.
àà5 6
File
àà6 :
==
àà; =
null
àà> B
)
ààB C
{
ââ 
return
ää 
new
ää 
ResponseDTO
ää &
(
ää& '
)
ää' (
{
ãã 
	IsSuccess
åå 
=
åå 
false
åå  %
,
åå% &

StatusCode
çç 
=
çç  
$num
çç! $
,
çç$ %
Message
éé 
=
éé 
$str
éé 1
}
èè 
;
èè 
}
êê 
var
íí 
fileExtension
íí 
=
íí 
Path
íí  $
.
íí$ %
GetExtension
íí% 1
(
íí1 23
%uploadSectionDetailsVersionContentDto
íí2 W
.
ííW X
File
ííX \
.
íí\ ]
FileName
íí] e
)
ííe f
.
ííf g
ToLower
ííg n
(
íín o
)
íío p
;
ííp q
string
ìì 
[
ìì 
]
ìì 
allowedExtensions
ìì &
=
ìì' (
{
ìì) *
$str
ìì+ 2
,
ìì2 3
$str
ìì4 :
,
ìì: ;
$str
ìì< B
,
ììB C
$str
ììD J
}
ììK L
;
ììL M
if
ïï 
(
ïï 
!
ïï 
allowedExtensions
ïï "
.
ïï" #
Contains
ïï# +
(
ïï+ ,
fileExtension
ïï, 9
)
ïï9 :
)
ïï: ;
{
ññ 
return
óó 
new
óó 
ResponseDTO
óó &
(
óó& '
)
óó' (
{
òò 
	IsSuccess
ôô 
=
ôô 
false
ôô  %
,
ôô% &

StatusCode
öö 
=
öö  
$num
öö! $
,
öö$ %
Message
õõ 
=
õõ 
$str
õõ a
}
úú 
;
úú 
}
ùù 
var
†† 
userId
†† 
=
†† 
User
†† 
.
†† 
Claims
†† $
.
††$ %
FirstOrDefault
††% 3
(
††3 4
x
††4 5
=>
††6 8
x
††9 :
.
††: ;
Type
††; ?
==
††@ B

ClaimTypes
††C M
.
††M N
NameIdentifier
††N \
)
††\ ]
?
††] ^
.
††^ _
Value
††_ d
;
††d e
if
°° 
(
°° 
string
°° 
.
°° 
IsNullOrEmpty
°° $
(
°°$ %
userId
°°% +
)
°°+ ,
)
°°, -
{
¢¢ 
return
££ 
new
££ 
ResponseDTO
££ &
(
££& '
)
££' (
{
§§ 
	IsSuccess
•• 
=
•• 
false
••  %
,
••% &

StatusCode
¶¶ 
=
¶¶  
$num
¶¶! $
,
¶¶$ %
Message
ßß 
=
ßß 
$str
ßß :
}
®® 
;
®® 
}
©© 
var
¨¨ 

instructor
¨¨ 
=
¨¨ 
await
¨¨ "
_unitOfWork
¨¨# .
.
¨¨. /"
InstructorRepository
¨¨/ C
.
¨¨C D
GetAsync
¨¨D L
(
¨¨L M
x
¨¨M N
=>
¨¨O Q
x
¨¨R S
.
¨¨S T
UserId
¨¨T Z
==
¨¨[ ]
userId
¨¨^ d
)
¨¨d e
;
¨¨e f
if
≠≠ 
(
≠≠ 

instructor
≠≠ 
==
≠≠ 
null
≠≠ "
)
≠≠" #
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
(
ØØ& '
)
ØØ' (
{
∞∞ 
	IsSuccess
±± 
=
±± 
false
±±  %
,
±±% &

StatusCode
≤≤ 
=
≤≤  
$num
≤≤! $
,
≤≤$ %
Message
≥≥ 
=
≥≥ 
$str
≥≥ :
}
¥¥ 
;
¥¥ 
}
µµ 
var
ππ 
courseDetail
ππ 
=
ππ 
await
ππ $
_unitOfWork
ππ% 0
.
ππ0 1-
SectionDetailsVersionRepository
ππ1 P
.
ππP Q
GetAsync
ππQ Y
(
ππY Z
x
ππZ [
=>
ππ\ ^
x
∫∫ 
.
∫∫ 
Id
∫∫ 
==
∫∫ 
	detailsId
∫∫ !
)
∫∫! "
;
∫∫" #
if
ªª 
(
ªª 
courseDetail
ªª 
==
ªª 
null
ªª  $
)
ªª$ %
{
ºº 
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ &
(
ΩΩ& '
)
ΩΩ' (
{
ææ 
	IsSuccess
øø 
=
øø 
false
øø  %
,
øø% &

StatusCode
¿¿ 
=
¿¿  
$num
¿¿! $
,
¿¿$ %
Message
¡¡ 
=
¡¡ 
$str
¡¡ I
}
¬¬ 
;
¬¬ 
}
√√ 
var
≈≈ 
courseSection
≈≈ 
=
≈≈ 
await
∆∆ 
_unitOfWork
∆∆ !
.
∆∆! ",
CourseSectionVersionRepository
∆∆" @
.
∆∆@ A
GetAsync
∆∆A I
(
∆∆I J
x
∆∆J K
=>
∆∆L N
x
«« 
.
«« 
Id
«« 
==
«« 
courseDetail
«« (
.
««( )$
CourseSectionVersionId
««) ?
)
««? @
;
««@ A
if
»» 
(
»» 
courseSection
»» 
==
»»  
null
»»! %
)
»»% &
{
…… 
return
   
new
   
ResponseDTO
   &
(
  & '
)
  ' (
{
ÀÀ 
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ  %
,
ÃÃ% &

StatusCode
ÕÕ 
=
ÕÕ  
$num
ÕÕ! $
,
ÕÕ$ %
Message
ŒŒ 
=
ŒŒ 
$str
ŒŒ A
}
œœ 
;
œœ 
}
–– 
var
““ 
courseVersion
““ 
=
““ 
await
”” 
_unitOfWork
”” !
.
””! "%
CourseVersionRepository
””" 9
.
””9 :
GetAsync
””: B
(
””B C
x
””C D
=>
””E G
x
””H I
.
””I J
Id
””J L
==
””M O
courseSection
””P ]
.
””] ^
CourseVersionId
””^ m
)
””m n
;
””n o
if
‘‘ 
(
‘‘ 
courseVersion
‘‘ 
==
‘‘  
null
‘‘! %
)
‘‘% &
{
’’ 
return
÷÷ 
new
÷÷ 
ResponseDTO
÷÷ &
(
÷÷& '
)
÷÷' (
{
◊◊ 
	IsSuccess
ÿÿ 
=
ÿÿ 
false
ÿÿ  %
,
ÿÿ% &

StatusCode
ŸŸ 
=
ŸŸ  
$num
ŸŸ! $
,
ŸŸ$ %
Message
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄ 9
}
€€ 
;
€€ 
}
‹‹ 
var
ﬂﬂ 
courseId
ﬂﬂ 
=
ﬂﬂ 
courseVersion
ﬂﬂ (
.
ﬂﬂ( )
CourseId
ﬂﬂ) 1
;
ﬂﬂ1 2
ResponseDTO
‚‚ 
responseDto
‚‚ #
;
‚‚# $
if
„„ 
(
„„ 
fileExtension
„„ 
==
„„  
$str
„„! '
||
„„( *
fileExtension
„„+ 8
==
„„9 ;
$str
„„< B
)
„„B C
{
‰‰ 
responseDto
ÂÂ 
=
ÂÂ 
await
ÂÂ #
_firebaseService
ÂÂ$ 4
.
ÂÂ4 5
UploadVideo
ÂÂ5 @
(
ÂÂ@ A3
%uploadSectionDetailsVersionContentDto
ÂÂA f
.
ÂÂf g
File
ÂÂg k
,
ÂÂk l
courseId
ÂÂm u
)
ÂÂu v
;
ÂÂv w
courseDetail
ÁÁ 
.
ÁÁ 
VideoUrl
ÁÁ %
=
ÁÁ& '
responseDto
ÁÁ( 3
.
ÁÁ3 4
Result
ÁÁ4 :
?
ÁÁ: ;
.
ÁÁ; <
ToString
ÁÁ< D
(
ÁÁD E
)
ÁÁE F
;
ÁÁF G
}
ËË 
else
ÈÈ 
if
ÈÈ 
(
ÈÈ 
fileExtension
ÈÈ "
==
ÈÈ# %
$str
ÈÈ& ,
)
ÈÈ, -
{
ÍÍ 
responseDto
ÎÎ 
=
ÎÎ 
await
ÎÎ #
_firebaseService
ÎÎ$ 4
.
ÎÎ4 5
UploadSlide
ÎÎ5 @
(
ÎÎ@ A3
%uploadSectionDetailsVersionContentDto
ÎÎA f
.
ÎÎf g
File
ÎÎg k
,
ÎÎk l
courseId
ÎÎm u
)
ÎÎu v
;
ÎÎv w
courseDetail
ÌÌ 
.
ÌÌ 
SlideUrl
ÌÌ %
=
ÌÌ& '
responseDto
ÌÌ( 3
.
ÌÌ3 4
Result
ÌÌ4 :
?
ÌÌ: ;
.
ÌÌ; <
ToString
ÌÌ< D
(
ÌÌD E
)
ÌÌE F
;
ÌÌF G
}
ÓÓ 
else
ÔÔ 
{
 
responseDto
ÒÒ 
=
ÒÒ 
await
ÒÒ #
_firebaseService
ÒÒ$ 4
.
ÒÒ4 5
	UploadDoc
ÒÒ5 >
(
ÒÒ> ?3
%uploadSectionDetailsVersionContentDto
ÒÒ? d
.
ÒÒd e
File
ÒÒe i
,
ÒÒi j
courseId
ÒÒk s
)
ÒÒs t
;
ÒÒt u
courseDetail
ÛÛ 
.
ÛÛ 
DocsUrl
ÛÛ $
=
ÛÛ% &
responseDto
ÛÛ' 2
.
ÛÛ2 3
Result
ÛÛ3 9
?
ÛÛ9 :
.
ÛÛ: ;
ToString
ÛÛ; C
(
ÛÛC D
)
ÛÛD E
;
ÛÛE F
}
ÙÙ 
if
ˆˆ 
(
ˆˆ 
!
ˆˆ 
responseDto
ˆˆ 
.
ˆˆ 
	IsSuccess
ˆˆ &
)
ˆˆ& '
{
˜˜ 
return
¯¯ 
new
¯¯ 
ResponseDTO
¯¯ &
(
¯¯& '
)
¯¯' (
{
˘˘ 
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
,
˚˚$ %
Message
¸¸ 
=
¸¸ 
$str
¸¸ 3
}
˝˝ 
;
˝˝ 
}
˛˛ 
courseDetail
ÅÅ 
.
ÅÅ #
UpdateTypeDescription
ÅÅ .
(
ÅÅ. /
)
ÅÅ/ 0
;
ÅÅ0 1
_unitOfWork
ÉÉ 
.
ÉÉ -
SectionDetailsVersionRepository
ÉÉ 7
.
ÉÉ7 8
Update
ÉÉ8 >
(
ÉÉ> ?
courseDetail
ÉÉ? K
)
ÉÉK L
;
ÉÉL M
await
ÑÑ 
_unitOfWork
ÑÑ 
.
ÑÑ 
	SaveAsync
ÑÑ '
(
ÑÑ' (
)
ÑÑ( )
;
ÑÑ) *
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ "
(
ÜÜ" #
)
ÜÜ# $
{
áá 
	IsSuccess
àà 
=
àà 
true
àà  
,
àà  !

StatusCode
ââ 
=
ââ 
$num
ââ  
,
ââ  !
Result
ää 
=
ää 
responseDto
ää $
.
ää$ %
Result
ää% +
,
ää+ ,
Message
ãã 
=
ãã 
$str
ãã 4
}
åå 
;
åå 
}
çç 	
catch
éé 
(
éé 
	Exception
éé 
e
éé 
)
éé 
{
èè 	
return
êê 
new
êê 
ResponseDTO
êê "
(
êê" #
)
êê# $
{
ëë 
	IsSuccess
íí 
=
íí 
false
íí !
,
íí! "

StatusCode
ìì 
=
ìì 
$num
ìì  
,
ìì  !
Result
îî 
=
îî 
null
îî 
,
îî 
Message
ïï 
=
ïï 
e
ïï 
.
ïï 
Message
ïï #
}
ññ 
;
ññ 
}
óó 	
}
òò 
public
öö 

async
öö 
Task
öö 
<
öö  
ContentResponseDTO
öö (
>
öö( )1
#DisplaySectionDetailsVersionContent
öö* M
(
õõ 
ClaimsPrincipal
úú 
User
úú 
,
úú 
Guid
ùù %
sectionDetailsVersionId
ùù $
,
ùù$ %
string
ûû 
type
ûû 
)
üü 
{
†† 
try
°° 
{
¢¢ 	
if
££ 
(
££ %
sectionDetailsVersionId
££ '
.
££' (
ToString
££( 0
(
££0 1
)
££1 2
.
££2 3
IsNullOrEmpty
££3 @
(
££@ A
)
££A B
)
££B C
{
§§ 
throw
•• 
new
•• 
	Exception
•• #
(
••# $
$str
••$ D
)
••D E
;
••E F
}
¶¶ 
if
®® 
(
®® 
type
®® 
.
®® 
IsNullOrEmpty
®® "
(
®®" #
)
®®# $
)
®®$ %
{
©© 
throw
™™ 
new
™™ 
	Exception
™™ #
(
™™# $
$str
™™$ ;
)
™™; <
;
™™< =
}
´´ 
var
≠≠ "
sectionDetailVersion
≠≠ $
=
≠≠% &
await
≠≠' ,
_unitOfWork
≠≠- 8
.
≠≠8 9-
SectionDetailsVersionRepository
≠≠9 X
.
ÆÆ 
GetAsync
ÆÆ 
(
ÆÆ 
x
ÆÆ 
=>
ÆÆ 
x
ÆÆ  
.
ÆÆ  !
Id
ÆÆ! #
==
ÆÆ$ &%
sectionDetailsVersionId
ÆÆ' >
)
ÆÆ> ?
;
ÆÆ? @
if
∞∞ 
(
∞∞ "
sectionDetailVersion
∞∞ $
is
∞∞% '
null
∞∞( ,
)
∞∞, -
{
±± 
throw
≤≤ 
new
≤≤ 
	Exception
≤≤ #
(
≤≤# $
$str
≤≤$ D
)
≤≤D E
;
≤≤E F
}
≥≥ 
var
µµ 
stream
µµ 
=
µµ 
new
µµ 
MemoryStream
µµ )
(
µµ) *
)
µµ* +
;
µµ+ ,
var
∂∂ 
contentType
∂∂ 
=
∂∂ 
$str
∂∂ 7
;
∂∂7 8
string
∑∑ 
?
∑∑ 
filePath
∑∑ 
=
∑∑ 
null
∑∑ #
;
∑∑# $
switch
ππ 
(
ππ 
type
ππ 
.
ππ 
ToLower
ππ  
(
ππ  !
)
ππ! "
)
ππ" #
{
∫∫ 
case
ªª 
$str
ªª 
:
ªª 
{
ºº 
filePath
ΩΩ 
=
ΩΩ "
sectionDetailVersion
ΩΩ 3
.
ΩΩ3 4
VideoUrl
ΩΩ4 <
;
ΩΩ< =
if
øø 
(
øø 
filePath
øø  
==
øø! #
null
øø$ (
)
øø( )
{
¿¿ 
throw
¡¡ 
new
¡¡ !
	Exception
¡¡" +
(
¡¡+ ,
$str
¡¡, C
)
¡¡C D
;
¡¡D E
}
¬¬ 
stream
ƒƒ 
=
ƒƒ 
await
ƒƒ "
_firebaseService
ƒƒ# 3
.
ƒƒ3 4

GetContent
ƒƒ4 >
(
ƒƒ> ?
filePath
ƒƒ? G
)
ƒƒG H
;
ƒƒH I
if
∆∆ 
(
∆∆ 
filePath
∆∆  
.
∆∆  !
EndsWith
∆∆! )
(
∆∆) *
$str
∆∆* 0
)
∆∆0 1
)
∆∆1 2
{
«« 
contentType
»» #
=
»»$ %"
StaticFileExtensions
»»& :
.
»»: ;
Mp4
»»; >
;
»»> ?
}
…… 
if
ÀÀ 
(
ÀÀ 
filePath
ÀÀ  
.
ÀÀ  !
EndsWith
ÀÀ! )
(
ÀÀ) *
$str
ÀÀ* 0
)
ÀÀ0 1
)
ÀÀ1 2
{
ÃÃ 
contentType
ÕÕ #
=
ÕÕ$ %"
StaticFileExtensions
ÕÕ& :
.
ÕÕ: ;
Mov
ÕÕ; >
;
ÕÕ> ?
}
ŒŒ 
break
–– 
;
–– 
}
—— 
case
““ 
$str
““ 
:
““ 
{
”” 
filePath
‘‘ 
=
‘‘ "
sectionDetailVersion
‘‘ 3
.
‘‘3 4
SlideUrl
‘‘4 <
;
‘‘< =
if
÷÷ 
(
÷÷ 
filePath
÷÷  
==
÷÷! #
null
÷÷$ (
)
÷÷( )
{
◊◊ 
throw
ÿÿ 
new
ÿÿ !
	Exception
ÿÿ" +
(
ÿÿ+ ,
$str
ÿÿ, C
)
ÿÿC D
;
ÿÿD E
}
ŸŸ 
stream
€€ 
=
€€ 
await
€€ "
_firebaseService
€€# 3
.
€€3 4

GetContent
€€4 >
(
€€> ?
filePath
€€? G
)
€€G H
;
€€H I
contentType
‹‹ 
=
‹‹  !"
StaticFileExtensions
‹‹" 6
.
‹‹6 7
Pdf
‹‹7 :
;
‹‹: ;
break
›› 
;
›› 
}
ﬁﬁ 
case
ﬂﬂ 
$str
ﬂﬂ 
:
ﬂﬂ 
{
‡‡ 
filePath
·· 
=
·· "
sectionDetailVersion
·· 3
.
··3 4
DocsUrl
··4 ;
;
··; <
if
„„ 
(
„„ 
filePath
„„  
==
„„! #
null
„„$ (
)
„„( )
{
‰‰ 
throw
ÂÂ 
new
ÂÂ !
	Exception
ÂÂ" +
(
ÂÂ+ ,
$str
ÂÂ, C
)
ÂÂC D
;
ÂÂD E
}
ÊÊ 
stream
ËË 
=
ËË 
await
ËË "
_firebaseService
ËË# 3
.
ËË3 4

GetContent
ËË4 >
(
ËË> ?
filePath
ËË? G
)
ËËG H
;
ËËH I
contentType
ÈÈ 
=
ÈÈ  !"
StaticFileExtensions
ÈÈ" 6
.
ÈÈ6 7
Doc
ÈÈ7 :
;
ÈÈ: ;
break
ÎÎ 
;
ÎÎ 
}
ÏÏ 
}
ÌÌ 
if
ÔÔ 
(
ÔÔ 
stream
ÔÔ 
is
ÔÔ 
null
ÔÔ 
)
ÔÔ 
{
 
throw
ÒÒ 
new
ÒÒ 
	Exception
ÒÒ #
(
ÒÒ# $
$str
ÒÒ$ F
)
ÒÒF G
;
ÒÒG H
}
ÚÚ 
return
ıı 
new
ıı  
ContentResponseDTO
ıı )
(
ıı) *
)
ıı* +
{
ˆˆ 
Message
˜˜ 
=
˜˜ 
$str
˜˜ 1
,
˜˜1 2
Stream
¯¯ 
=
¯¯ 
stream
¯¯ 
,
¯¯  
ContentType
˘˘ 
=
˘˘ 
contentType
˘˘ )
,
˘˘) *
FileName
˙˙ 
=
˙˙ 
Path
˙˙ 
.
˙˙  
GetFileName
˙˙  +
(
˙˙+ ,
filePath
˙˙, 4
)
˙˙4 5
}
˚˚ 
;
˚˚ 
}
¸¸ 	
catch
˝˝ 
(
˝˝ 
	Exception
˝˝ 
e
˝˝ 
)
˝˝ 
{
˛˛ 	
return
ˇˇ 
new
ˇˇ  
ContentResponseDTO
ˇˇ )
(
ˇˇ) *
)
ˇˇ* +
{
ÄÄ 
ContentType
ÅÅ 
=
ÅÅ 
null
ÅÅ "
,
ÅÅ" #
Message
ÇÇ 
=
ÇÇ 
e
ÇÇ 
.
ÇÇ 
Message
ÇÇ #
,
ÇÇ# $
Stream
ÉÉ 
=
ÉÉ 
null
ÉÉ 
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá ´
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\RedisService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
RedisService 
: 
IRedisService )
{ 
private 
readonly "
IConnectionMultiplexer +
_redis, 2
;2 3
public

 

RedisService

 
(

 "
IConnectionMultiplexer

 .
redis

/ 4
)

4 5
{ 
_redis 
= 
redis 
; 
} 
public 

async 
Task 
< 
bool 
> 
StoreString '
(' (
string( .
key/ 2
,2 3
string4 :
value; @
)@ A
{ 
var 
cache 
= 
_redis 
. 
GetDatabase &
(& '
)' (
;( )
var 
result 
= 
await 
cache  
.  !
StringSetAsync! /
(/ 0
key0 3
,3 4
value5 :
): ;
;; <
return 
result 
; 
} 
public!! 

async!! 
Task!! 
<!! 
string!! 
>!! 
RetrieveString!! ,
(!!, -
string!!- 3
key!!4 7
)!!7 8
{"" 
var## 
cache## 
=## 
_redis## 
.## 
GetDatabase## &
(##& '
)##' (
;##( )
var$$ 
result$$ 
=$$ 
await$$ 
cache$$  
.$$  !
StringGetAsync$$! /
($$/ 0
key$$0 3
)$$3 4
;$$4 5
return%% 
result%% 
;%% 
}&& 
public-- 

async-- 
Task-- 
<-- 
bool-- 
>-- 
DeleteString-- (
(--( )
string--) /
key--0 3
)--3 4
{.. 
var// 
cache// 
=// 
_redis// 
.// 
GetDatabase// &
(//& '
)//' (
;//( )
var00 
result00 
=00 
await00 
cache00  
.00  !
KeyDeleteAsync00! /
(00/ 0
key000 3
)003 4
;004 5
return11 
result11 
;11 
}22 
}33 ü
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\NotificationService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
NotificationService  
:! " 
INotificationService# 7
{ 
} ª∞
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\LevelService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
LevelService 
: 
ILevelService )
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
IMapper 
_mapper 
; 
public 

LevelService 
( 
IUnitOfWork #

unitOfWork$ .
,. /
IMapper0 7
mapper8 >
)> ?
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
	GetLevels# ,
( 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int   
pageSize   
=   
$num   
)!! 
{"" 
try## 
{$$ 	
var&& 
userRole&& 
=&& 
User&& 
.&&  
Claims&&  &
.&&& '
FirstOrDefault&&' 5
(&&5 6
x&&6 7
=>&&8 :
x&&; <
.&&< =
Type&&= A
==&&B D

ClaimTypes&&E O
.&&O P
Role&&P T
)&&T U
?&&U V
.&&V W
Value&&W \
;&&\ ]
IEnumerable(( 
<(( 
Level(( 
>(( 
levels(( %
;((% &
if** 
(** 
userRole** 
==** 
StaticUserRoles** +
.**+ ,
Admin**, 1
)**1 2
{++ 
levels-- 
=-- 
await-- 
_unitOfWork-- *
.--* +
LevelRepository--+ :
.--: ;
GetAllAsync--; F
(--F G
)--G H
;--H I
}.. 
else// 
{00 
levels22 
=22 
await22 
_unitOfWork22 *
.22* +
LevelRepository22+ :
.22: ;
GetAllAsync22; F
(22F G
x22G H
=>22I K
x22L M
.22M N
Status22N T
<=22U W
$num22X Y
)22Y Z
;22Z [
}33 
if66 
(66 
!66 
levels66 
.66 
Any66 
(66 
)66 
)66 
{77 
return88 
new88 
ResponseDTO88 &
(88& '
)88' (
{99 
Message:: 
=:: 
$str:: 3
,::3 4
	IsSuccess;; 
=;; 
true;;  $
,;;$ %

StatusCode<< 
=<<  
$num<<! $
,<<$ %
Result== 
=== 
null== !
}>> 
;>> 
}?? 
varAA 

listLevelsAA 
=AA 
levelsAA #
.AA# $
ToListAA$ *
(AA* +
)AA+ ,
;AA, -
ifDD 
(DD 
!DD 
stringDD 
.DD 
IsNullOrEmptyDD %
(DD% &
filterOnDD& .
)DD. /
&&DD0 2
!DD3 4
stringDD4 :
.DD: ;
IsNullOrEmptyDD; H
(DDH I
filterQueryDDI T
)DDT U
)DDU V
{EE 
switchFF 
(FF 
filterOnFF  
.FF  !
TrimFF! %
(FF% &
)FF& '
.FF' (
ToLowerFF( /
(FF/ 0
)FF0 1
)FF1 2
{GG 
caseHH 
$strHH 
:HH  

listLevelsII "
=II# $

listLevelsII% /
.II/ 0
WhereII0 5
(II5 6
xII6 7
=>II8 :
xJJ 
.JJ 
NameJJ "
.JJ" #
ContainsJJ# +
(JJ+ ,
filterQueryJJ, 7
,JJ7 8
StringComparisonJJ9 I
.JJI J$
CurrentCultureIgnoreCaseJJJ b
)JJb c
)JJc d
.JJd e
ToListJJe k
(JJk l
)JJl m
;JJm n
breakKK 
;KK 
defaultLL 
:LL 
breakMM 
;MM 
}NN 
}OO 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrEmptyRR %
(RR% &
sortByRR& ,
)RR, -
)RR- .
{SS 
switchTT 
(TT 
sortByTT 
.TT 
TrimTT #
(TT# $
)TT$ %
.TT% &
ToLowerTT& -
(TT- .
)TT. /
)TT/ 0
{UU 
caseVV 
$strVV 
:VV  

listLevelsWW "
=WW# $

listLevelsWW% /
.WW/ 0
OrderByWW0 7
(WW7 8
xWW8 9
=>WW: <
xWW= >
.WW> ?
NameWW? C
)WWC D
.WWD E
ToListWWE K
(WWK L
)WWL M
;WWM N
breakXX 
;XX 
defaultYY 
:YY 
breakZZ 
;ZZ 
}[[ 
}\\ 
else]] 
{^^ 

listLevels`` 
=`` 

listLevels`` '
.``' (
OrderByDescending``( 9
(``9 :
x``: ;
=>``< >
x``? @
.``@ A

CreateTime``A K
)``K L
.``L M
ToList``M S
(``S T
)``T U
;``U V
}aa 
ifdd 
(dd 

pageNumberdd 
>dd 
$numdd 
&&dd !
pageSizedd" *
>dd+ ,
$numdd- .
)dd. /
{ee 
varff 

skipResultff 
=ff  
(ff! "

pageNumberff" ,
-ff- .
$numff/ 0
)ff0 1
*ff2 3
pageSizeff4 <
;ff< =

listLevelsgg 
=gg 

listLevelsgg '
.gg' (
Skipgg( ,
(gg, -

skipResultgg- 7
)gg7 8
.gg8 9
Takegg9 =
(gg= >
pageSizegg> F
)ggF G
.ggG H
ToListggH N
(ggN O
)ggO P
;ggP Q
}hh 
varkk 
	levelsDtokk 
=kk 

listLevelskk &
.kk& '
Selectkk' -
(kk- .
levelkk. 3
=>kk4 6
newkk7 :
GetLevelDTOkk; F
(kkF G
)kkG H
{ll 
Idmm 
=mm 
levelmm 
.mm 
Idmm 
,mm 
Namenn 
=nn 
levelnn 
.nn 
Namenn !
,nn! "

CreateTimeoo 
=oo 
leveloo "
.oo" #

CreateTimeoo# -
,oo- .
CreateBypp 
=pp 
levelpp  
.pp  !
CreateBypp! )
,pp) *

UpdateTimeqq 
=qq 
levelqq "
.qq" #

UpdateTimeqq# -
,qq- .
UpdateByrr 
=rr 
levelrr  
.rr  !
UpdateByrr! )
,rr) *
Statusss 
=ss 
levelss 
.ss 
Statusss %
}tt 
)tt 
.tt 
ToListtt 
(tt 
)tt 
;tt 
returnvv 
newvv 
ResponseDTOvv "
(vv" #
)vv# $
{ww 
Messagexx 
=xx 
$strxx 3
,xx3 4
	IsSuccessyy 
=yy 
trueyy  
,yy  !

StatusCodezz 
=zz 
$numzz  
,zz  !
Result{{ 
={{ 
	levelsDto{{ "
}|| 
;|| 
}}} 	
catch~~ 
(~~ 
	Exception~~ 
e~~ 
)~~ 
{ 	
return
ÄÄ 
new
ÄÄ 
ResponseDTO
ÄÄ "
(
ÄÄ" #
)
ÄÄ# $
{
ÅÅ 
Message
ÇÇ 
=
ÇÇ 
e
ÇÇ 
.
ÇÇ 
Message
ÇÇ #
,
ÇÇ# $
Result
ÉÉ 
=
ÉÉ 
null
ÉÉ 
,
ÉÉ 
	IsSuccess
ÑÑ 
=
ÑÑ 
false
ÑÑ !
,
ÑÑ! "

StatusCode
ÖÖ 
=
ÖÖ 
$num
ÖÖ  
}
ÜÜ 
;
ÜÜ 
}
áá 	
}
àà 
public
ää 

async
ää 
Task
ää 
<
ää 
ResponseDTO
ää !
>
ää! "
GetLevel
ää# +
(
ää+ ,
ClaimsPrincipal
ää, ;
User
ää< @
,
ää@ A
Guid
ääB F
levelId
ääG N
)
ääN O
{
ãã 
try
åå 
{
çç 	
var
éé 
LevelID
éé 
=
éé 
await
èè 
_unitOfWork
èè !
.
èè! "
LevelRepository
èè" 1
.
èè1 2
GetLevelById
èè2 >
(
èè> ?
levelId
èè? F
)
èèF G
;
èèG H
if
ëë 
(
ëë 
LevelID
ëë 
is
ëë 
null
ëë 
)
ëë  
{
íí 
return
ìì 
new
ìì 
ResponseDTO
ìì &
(
ìì& '
)
ìì' (
{
îî 
Result
ïï 
=
ïï 
$str
ïï 
,
ïï  
Message
ññ 
=
ññ 
$str
ññ 3
,
ññ3 4
	IsSuccess
óó 
=
óó 
true
óó  $
,
óó$ %

StatusCode
òò 
=
òò  
$num
òò! $
}
ôô 
;
ôô 
}
öö 
GetLevelDTO
úú 
levelDto
úú  
;
úú  !
try
ùù 
{
ûû 
levelDto
üü 
=
üü 
_mapper
üü "
.
üü" #
Map
üü# &
<
üü& '
GetLevelDTO
üü' 2
>
üü2 3
(
üü3 4
LevelID
üü4 ;
)
üü; <
;
üü< =
}
†† 
catch
°° 
(
°° (
AutoMapperMappingException
°° -
e
°°. /
)
°°/ 0
{
¢¢ 
return
•• 
new
•• 
ResponseDTO
•• &
(
••& '
)
••' (
{
¶¶ 
Result
ßß 
=
ßß 
null
ßß !
,
ßß! "
Message
®® 
=
®® 
$str
®® B
,
®®B C
	IsSuccess
©© 
=
©© 
false
©©  %
,
©©% &

StatusCode
™™ 
=
™™  
$num
™™! $
}
´´ 
;
´´ 
}
¨¨ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ "
(
ÆÆ" #
)
ÆÆ# $
{
ØØ 
Result
∞∞ 
=
∞∞ 
levelDto
∞∞ !
,
∞∞! "
Message
±± 
=
±± 
$str
±± 2
,
±±2 3
	IsSuccess
≤≤ 
=
≤≤ 
true
≤≤  
,
≤≤  !

StatusCode
≥≥ 
=
≥≥ 
$num
≥≥  
}
¥¥ 
;
¥¥ 
}
µµ 	
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 	
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
(
∏∏" #
)
∏∏# $
{
ππ 
Result
∫∫ 
=
∫∫ 
null
∫∫ 
,
∫∫ 
Message
ªª 
=
ªª 
e
ªª 
.
ªª 
Message
ªª #
,
ªª# $
	IsSuccess
ºº 
=
ºº 
true
ºº  
,
ºº  !

StatusCode
ΩΩ 
=
ΩΩ 
$num
ΩΩ  
}
ææ 
;
ææ 
}
øø 	
}
¿¿ 
public
¬¬ 

async
¬¬ 
Task
¬¬ 
<
¬¬ 
ResponseDTO
¬¬ !
>
¬¬! "
CreateLevel
¬¬# .
(
¬¬. /
ClaimsPrincipal
¬¬/ >
User
¬¬? C
,
¬¬C D
CreateLevelDTO
¬¬E S
createLevelDto
¬¬T b
)
¬¬b c
{
√√ 
try
ƒƒ 
{
≈≈ 	
var
∆∆ 
userId
∆∆ 
=
∆∆ 
User
∆∆ 
.
∆∆ 
Claims
∆∆ $
.
∆∆$ %
FirstOrDefault
∆∆% 3
(
∆∆3 4
x
∆∆4 5
=>
∆∆6 8
x
∆∆9 :
.
∆∆: ;
Type
∆∆; ?
==
∆∆@ B

ClaimTypes
∆∆C M
.
∆∆M N
NameIdentifier
∆∆N \
)
∆∆\ ]
?
∆∆] ^
.
∆∆^ _
Value
∆∆_ d
;
∆∆d e
var
«« 
admin
«« 
=
«« 
await
«« 
_unitOfWork
«« )
.
««) *#
UserManagerRepository
««* ?
.
««? @
FindByIdAsync
««@ M
(
««M N
userId
««N T
)
««T U
;
««U V
Level
   
levels
   
=
   
new
   
Level
   $
(
  $ %
)
  % &
{
ÀÀ 
Name
ÃÃ 
=
ÃÃ 
createLevelDto
ÃÃ %
.
ÃÃ% &
Name
ÃÃ& *
,
ÃÃ* +
CreateBy
ÕÕ 
=
ÕÕ 
admin
ÕÕ  
.
ÕÕ  !
Email
ÕÕ! &
,
ÕÕ& '

CreateTime
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ %
.
ŒŒ% &
Now
ŒŒ& )
,
ŒŒ) *

UpdateTime
œœ 
=
œœ 
null
œœ !
,
œœ! "
UpdateBy
–– 
=
–– 
$str
–– 
,
–– 
Status
—— 
=
—— 
$num
—— 
}
““ 
;
““ 
await
’’ 
_unitOfWork
’’ 
.
’’ 
LevelRepository
’’ -
.
’’- .
AddAsync
’’. 6
(
’’6 7
levels
’’7 =
)
’’= >
;
’’> ?
await
÷÷ 
_unitOfWork
÷÷ 
.
÷÷ 
	SaveAsync
÷÷ '
(
÷÷' (
)
÷÷( )
;
÷÷) *
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
{
ŸŸ 
Message
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄ 6
,
⁄⁄6 7
Result
€€ 
=
€€ 
levels
€€ 
,
€€  
	IsSuccess
‹‹ 
=
‹‹ 
true
‹‹  
,
‹‹  !

StatusCode
›› 
=
›› 
$num
››  
,
››  !
}
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 	
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
{
„„ 
Message
‰‰ 
=
‰‰ 
e
‰‰ 
.
‰‰ 
Message
‰‰ #
,
‰‰# $
Result
ÂÂ 
=
ÂÂ 
null
ÂÂ 
,
ÂÂ 
	IsSuccess
ÊÊ 
=
ÊÊ 
false
ÊÊ !
,
ÊÊ! "

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
}
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
public
ÏÏ 

async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
ResponseDTO
ÏÏ !
>
ÏÏ! "
UpdateLevel
ÏÏ# .
(
ÏÏ. /
ClaimsPrincipal
ÏÏ/ >
User
ÏÏ? C
,
ÏÏC D
UpdateLevelDTO
ÏÏE S
updateLevelDto
ÏÏT b
)
ÏÏb c
{
ÌÌ 
try
ÓÓ 
{
ÔÔ 	
var
ÒÒ 
levelID
ÒÒ 
=
ÒÒ 
await
ÒÒ 
_unitOfWork
ÒÒ  +
.
ÒÒ+ ,
LevelRepository
ÒÒ, ;
.
ÒÒ; <
GetAsync
ÒÒ< D
(
ÒÒD E
c
ÒÒE F
=>
ÒÒG I
c
ÒÒJ K
.
ÒÒK L
Id
ÒÒL N
==
ÒÒO Q
updateLevelDto
ÒÒR `
.
ÒÒ` a
LevelId
ÒÒa h
)
ÒÒh i
;
ÒÒi j
if
ÙÙ 
(
ÙÙ 
levelID
ÙÙ 
==
ÙÙ 
null
ÙÙ 
)
ÙÙ  
{
ıı 
return
ˆˆ 
new
ˆˆ 
ResponseDTO
ˆˆ &
{
˜˜ 
Message
¯¯ 
=
¯¯ 
$str
¯¯ /
,
¯¯/ 0
Result
˘˘ 
=
˘˘ 
null
˘˘ !
,
˘˘! "
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
}
¸¸ 
;
¸¸ 
}
˝˝ 
levelID
ÄÄ 
.
ÄÄ 
Name
ÄÄ 
=
ÄÄ 
updateLevelDto
ÄÄ )
.
ÄÄ) *
Name
ÄÄ* .
;
ÄÄ. /
levelID
ÅÅ 
.
ÅÅ 

UpdateTime
ÅÅ 
=
ÅÅ  
DateTime
ÅÅ! )
.
ÅÅ) *
Now
ÅÅ* -
;
ÅÅ- .
levelID
ÇÇ 
.
ÇÇ 
UpdateBy
ÇÇ 
=
ÇÇ 
User
ÇÇ #
.
ÇÇ# $
Identity
ÇÇ$ ,
.
ÇÇ, -
Name
ÇÇ- 1
;
ÇÇ1 2
levelID
ÉÉ 
.
ÉÉ 
Status
ÉÉ 
=
ÉÉ 
$num
ÉÉ 
;
ÉÉ 
_unitOfWork
áá 
.
áá 
LevelRepository
áá '
.
áá' (
Update
áá( .
(
áá. /
levelID
áá/ 6
)
áá6 7
;
áá7 8
var
ää 
save
ää 
=
ää 
await
ää 
_unitOfWork
ää (
.
ää( )
	SaveAsync
ää) 2
(
ää2 3
)
ää3 4
;
ää4 5
if
ãã 
(
ãã 
save
ãã 
<=
ãã 
$num
ãã 
)
ãã 
{
åå 
return
çç 
new
çç 
ResponseDTO
çç &
{
éé 
Message
èè 
=
èè 
$str
èè 6
,
èè6 7
Result
êê 
=
êê 
null
êê !
,
êê! "
	IsSuccess
ëë 
=
ëë 
false
ëë  %
,
ëë% &

StatusCode
íí 
=
íí  
$num
íí! $
}
ìì 
;
ìì 
}
îî 
return
ññ 
new
ññ 
ResponseDTO
ññ "
{
óó 
Message
òò 
=
òò 
$str
òò 6
,
òò6 7
Result
ôô 
=
ôô 
levelID
ôô  
,
ôô  !
	IsSuccess
öö 
=
öö 
true
öö  
,
öö  !

StatusCode
õõ 
=
õõ 
$num
õõ  
}
úú 
;
úú 
}
ùù 	
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 	
return
†† 
new
†† 
ResponseDTO
†† "
{
°° 
Message
¢¢ 
=
¢¢ 
e
¢¢ 
.
¢¢ 
Message
¢¢ #
,
¢¢# $
Result
££ 
=
££ 
null
££ 
,
££ 
	IsSuccess
§§ 
=
§§ 
false
§§ !
,
§§! "

StatusCode
•• 
=
•• 
$num
••  
}
¶¶ 
;
¶¶ 
}
ßß 	
}
®® 
public
´´ 

async
´´ 
Task
´´ 
<
´´ 
ResponseDTO
´´ !
>
´´! "
DeleteLevel
´´# .
(
´´. /
ClaimsPrincipal
´´/ >
User
´´? C
,
´´C D
Guid
´´E I
levelId
´´J Q
)
´´Q R
{
¨¨ 
try
≠≠ 
{
ÆÆ 	
var
∞∞ 
levelID
∞∞ 
=
∞∞ 
await
∞∞ 
_unitOfWork
∞∞  +
.
∞∞+ ,
LevelRepository
∞∞, ;
.
∞∞; <
GetAsync
∞∞< D
(
∞∞D E
c
∞∞E F
=>
∞∞G I
c
∞∞J K
.
∞∞K L
Id
∞∞L N
==
∞∞O Q
levelId
∞∞R Y
)
∞∞Y Z
;
∞∞Z [
if
≤≤ 
(
≤≤ 
levelID
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤  
{
≥≥ 
return
¥¥ 
new
¥¥ 
ResponseDTO
¥¥ &
{
µµ 
Message
∂∂ 
=
∂∂ 
$str
∂∂ 9
,
∂∂9 :
Result
∑∑ 
=
∑∑ 
null
∑∑ !
,
∑∑! "
	IsSuccess
∏∏ 
=
∏∏ 
false
∏∏  %
,
∏∏% &

StatusCode
ππ 
=
ππ  
$num
ππ! $
}
∫∫ 
;
∫∫ 
}
ªª 
levelID
ΩΩ 
.
ΩΩ 
Status
ΩΩ 
=
ΩΩ 
$num
ΩΩ 
;
ΩΩ 
levelID
ææ 
.
ææ 
UpdateBy
ææ 
=
ææ 
User
ææ #
.
ææ# $
Identity
ææ$ ,
.
ææ, -
Name
ææ- 1
;
ææ1 2
levelID
øø 
.
øø 

UpdateTime
øø 
=
øø  
DateTime
øø! )
.
øø) *
Now
øø* -
;
øø- .
_unitOfWork
¡¡ 
.
¡¡ 
LevelRepository
¡¡ '
.
¡¡' (
Update
¡¡( .
(
¡¡. /
levelID
¡¡/ 6
)
¡¡6 7
;
¡¡7 8
await
¬¬ 
_unitOfWork
¬¬ 
.
¬¬ 
	SaveAsync
¬¬ '
(
¬¬' (
)
¬¬( )
;
¬¬) *
return
ƒƒ 
new
ƒƒ 
ResponseDTO
ƒƒ "
{
≈≈ 
Message
∆∆ 
=
∆∆ 
$str
∆∆ 6
,
∆∆6 7
Result
«« 
=
«« 
levelID
««  
,
««  !
	IsSuccess
»» 
=
»» 
true
»»  
,
»»  !

StatusCode
…… 
=
…… 
$num
……  
}
   
;
   
}
ÀÀ 	
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 	
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ "
{
œœ 
Message
–– 
=
–– 
e
–– 
.
–– 
Message
–– #
,
––# $
Result
—— 
=
—— 
null
—— 
,
—— 
	IsSuccess
““ 
=
““ 
false
““ !
,
““! "

StatusCode
”” 
=
”” 
$num
””  
}
‘‘ 
;
‘‘ 
}
’’ 	
}
÷÷ 
}◊◊ ‘ﬁ
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\InstructorService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
InstructorService 
:  
IInstructorService! 3
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IClosedXMLService &
_closedXmlService' 8
;8 9
private 
readonly 
IWebHostEnvironment (
_env) -
;- .
private 
readonly 
IConfiguration #
_config$ +
;+ ,
private 
readonly 
IHubContext  
<  !
NotificationHub! 0
>0 1
_notificationHub2 B
;B C
public 

InstructorService 
( 
IUnitOfWork (

unitOfWork) 3
,3 4
IMapper5 <
mapper= C
,C D
IClosedXMLServiceE V
closedXmlServiceW g
,g h
IWebHostEnvironment 
env 
,  
IConfiguration! /
config0 6
,6 7
IHubContext8 C
<C D
NotificationHubD S
>S T
notificationHubU d
)d e
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
_closedXmlService 
= 
closedXmlService ,
;, -
_env 
= 
env 
; 
_config   
=   
config   
;   
_notificationHub!! 
=!! 
notificationHub!! *
;!!* +
}"" 
public%% 

async%% 
Task%% 
<%% 
ResponseDTO%% !
>%%! "
GetAll%%# )
(&& 
ClaimsPrincipal'' 
User'' 
,'' 
string(( 
?(( 
filterOn(( 
,(( 
string)) 
?)) 
filterQuery)) 
,)) 
string** 
?** 
sortBy** 
,** 
bool++ 
?++ 
isAscending++ 
,++ 
int,, 

pageNumber,, 
,,, 
int-- 
pageSize-- 
).. 
{// 
try22 
{33 	
List44 
<44 

Instructor44 
>44 
instructors44 (
=44) *
new44+ .
List44/ 3
<443 4

Instructor444 >
>44> ?
(44? @
)44@ A
;44A B
if77 
(77 
!77 
string77 
.77 
IsNullOrEmpty77 %
(77% &
filterOn77& .
)77. /
&&770 2
!773 4
string774 :
.77: ;
IsNullOrEmpty77; H
(77H I
filterQuery77I T
)77T U
)77U V
{88 
switch99 
(99 
filterOn99  
.99  !
Trim99! %
(99% &
)99& '
.99' (
ToLower99( /
(99/ 0
)990 1
)991 2
{:: 
case;; 
$str;; 
:;;  
{<< 
instructors== #
===$ %
_unitOfWork==& 1
.==1 2 
InstructorRepository==2 F
.==F G
GetAllAsync==G R
(==R S
includeProperties==S d
:==d e
$str==f w
)==w x
.>> 

GetAwaiter>> '
(>>' (
)>>( )
.>>) *
	GetResult>>* 3
(>>3 4
)>>4 5
.>>5 6
Where>>6 ;
(>>; <
x>>< =
=>>>> @
x??  !
.??! "
ApplicationUser??" 1
.??1 2
FullName??2 :
.??: ;
Contains??; C
(??C D
filterQuery??D O
,??O P
StringComparison@@$ 4
.@@4 5$
CurrentCultureIgnoreCase@@5 M
)@@M N
)@@N O
.@@O P
ToList@@P V
(@@V W
)@@W X
;@@X Y
breakAA 
;AA 
}BB 
caseCC 
$strCC  
:CC  !
{DD 
instructorsEE #
=EE$ %
_unitOfWorkEE& 1
.EE1 2 
InstructorRepositoryEE2 F
.EEF G
GetAllAsyncEEG R
(EER S
includePropertiesEES d
:EEd e
$strEEf w
)EEw x
.FF 

GetAwaiterFF '
(FF' (
)FF( )
.FF) *
	GetResultFF* 3
(FF3 4
)FF4 5
.FF5 6
WhereFF6 ;
(FF; <
xFF< =
=>FF> @
xGG  !
.GG! "
ApplicationUserGG" 1
.GG1 2
EmailGG2 7
.GG7 8
ContainsGG8 @
(GG@ A
filterQueryGGA L
,GGL M
StringComparisonHH$ 4
.HH4 5$
CurrentCultureIgnoreCaseHH5 M
)HHM N
)HHN O
.HHO P
ToListHHP V
(HHV W
)HHW X
;HHX Y
breakII 
;II 
}JJ 
defaultKK 
:KK 
{LL 
instructorsMM #
=MM$ %
_unitOfWorkMM& 1
.MM1 2 
InstructorRepositoryMM2 F
.MMF G
GetAllAsyncMMG R
(MMR S
includePropertiesMMS d
:MMd e
$strMMf w
)MMw x
.NN 

GetAwaiterNN '
(NN' (
)NN( )
.NN) *
	GetResultNN* 3
(NN3 4
)NN4 5
.NN5 6
ToListNN6 <
(NN< =
)NN= >
;NN> ?
breakOO 
;OO 
}PP 
}QQ 
}RR 
elseSS 
{TT 
instructorsUU 
=UU 
_unitOfWorkUU )
.UU) * 
InstructorRepositoryUU* >
.UU> ?
GetAllAsyncUU? J
(UUJ K
includePropertiesUUK \
:UU\ ]
$strUU^ o
)UUo p
.VV 

GetAwaiterVV 
(VV  
)VV  !
.VV! "
	GetResultVV" +
(VV+ ,
)VV, -
.VV- .
ToListVV. 4
(VV4 5
)VV5 6
;VV6 7
}WW 
ifZZ 
(ZZ 
!ZZ 
stringZZ 
.ZZ 
IsNullOrEmptyZZ %
(ZZ% &
sortByZZ& ,
)ZZ, -
)ZZ- .
{[[ 
switch\\ 
(\\ 
sortBy\\ 
.\\ 
Trim\\ #
(\\# $
)\\$ %
.\\% &
ToLower\\& -
(\\- .
)\\. /
)\\/ 0
{]] 
case^^ 
$str^^ 
:^^  
{__ 
instructors`` #
=``$ %
isAscending``& 1
==``2 4
true``5 9
?aa 
[aa 
..aa !
instructorsaa" -
.aa- .
OrderByaa. 5
(aa5 6
xaa6 7
=>aa8 :
xaa; <
.aa< =
ApplicationUseraa= L
.aaL M
FullNameaaM U
)aaU V
]aaV W
:bb 
[bb 
..bb !
instructorsbb" -
.bb- .
OrderByDescendingbb. ?
(bb? @
xbb@ A
=>bbB D
xbbE F
.bbF G
ApplicationUserbbG V
.bbV W
FullNamebbW _
)bb_ `
]bb` a
;bba b
breakcc 
;cc 
}dd 
caseee 
$stree  
:ee  !
{ff 
instructorsgg #
=gg$ %
isAscendinggg& 1
==gg2 4
truegg5 9
?hh 
[hh 
..hh !
instructorshh" -
.hh- .
OrderByhh. 5
(hh5 6
xhh6 7
=>hh8 :
xhh; <
.hh< =
ApplicationUserhh= L
.hhL M
EmailhhM R
)hhR S
]hhS T
:ii 
[ii 
..ii !
instructorsii" -
.ii- .
OrderByDescendingii. ?
(ii? @
xii@ A
=>iiB D
xiiE F
.iiF G
ApplicationUseriiG V
.iiV W
EmailiiW \
)ii\ ]
]ii] ^
;ii^ _
breakjj 
;jj 
}kk 
defaultll 
:ll 
{mm 
breaknn 
;nn 
}oo 
}pp 
}qq 
iftt 
(tt 

pageNumbertt 
>tt 
$numtt 
&&tt !
pageSizett" *
>tt+ ,
$numtt- .
)tt. /
{uu 
varvv 

skipResultvv 
=vv  
(vv! "

pageNumbervv" ,
-vv- .
$numvv/ 0
)vv0 1
*vv2 3
pageSizevv4 <
;vv< =
instructorsww 
=ww 
instructorsww )
.ww) *
Skipww* .
(ww. /

skipResultww/ 9
)ww9 :
.ww: ;
Takeww; ?
(ww? @
pageSizeww@ H
)wwH I
.wwI J
ToListwwJ P
(wwP Q
)wwQ R
;wwR S
}xx 
if|| 
(|| 
instructors|| 
.|| 
IsNullOrEmpty|| )
(||) *
)||* +
)||+ ,
{}} 
return~~ 
new~~ 
ResponseDTO~~ &
(~~& '
)~~' (
{ 
Message
ÄÄ 
=
ÄÄ 
$str
ÄÄ 8
,
ÄÄ8 9
Result
ÅÅ 
=
ÅÅ 
null
ÅÅ !
,
ÅÅ! "
	IsSuccess
ÇÇ 
=
ÇÇ 
false
ÇÇ  %
,
ÇÇ% &

StatusCode
ÉÉ 
=
ÉÉ  
$num
ÉÉ! $
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 
var
áá #
instructorInfoLiteDto
áá %
=
áá& '
_mapper
áá( /
.
áá/ 0
Map
áá0 3
<
áá3 4
List
áá4 8
<
áá8 9#
InstructorInfoLiteDTO
áá9 N
>
ááN O
>
ááO P
(
ááP Q
instructors
ááQ \
)
áá\ ]
;
áá] ^
return
ââ 
new
ââ 
ResponseDTO
ââ "
(
ââ" #
)
ââ# $
{
ää 
Message
ãã 
=
ãã 
$str
ãã 9
,
ãã9 :
Result
åå 
=
åå #
instructorInfoLiteDto
åå .
,
åå. /
	IsSuccess
çç 
=
çç 
true
çç  
,
çç  !

StatusCode
éé 
=
éé 
$num
éé  
}
èè 
;
èè 
}
êê 	
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 	
return
ìì 
new
ìì 
ResponseDTO
ìì "
(
ìì" #
)
ìì# $
{
îî 
Message
ïï 
=
ïï 
e
ïï 
.
ïï 
Message
ïï #
,
ïï# $
Result
ññ 
=
ññ 
null
ññ 
,
ññ 
	IsSuccess
óó 
=
óó 
false
óó !
,
óó! "

StatusCode
òò 
=
òò 
$num
òò  
}
ôô 
;
ôô 
}
öö 	
}
õõ 
public
ùù 

async
ùù 
Task
ùù 
<
ùù 
ResponseDTO
ùù !
>
ùù! "
GetById
ùù# *
(
ùù* +
Guid
ùù+ /
id
ùù0 2
)
ùù2 3
{
ûû 
try
üü 
{
†† 	
var
°° 

instructor
°° 
=
°° 
await
°° "
_unitOfWork
°°# .
.
°°. /"
InstructorRepository
°°/ C
.
°°C D
GetById
°°D K
(
°°K L
id
°°L N
)
°°N O
;
°°O P
if
¢¢ 
(
¢¢ 

instructor
¢¢ 
is
¢¢ 
null
¢¢ "
)
¢¢" #
{
££ 
return
§§ 
new
§§ 
ResponseDTO
§§ &
(
§§& '
)
§§' (
{
•• 
Message
¶¶ 
=
¶¶ 
$str
¶¶ 8
,
¶¶8 9
	IsSuccess
ßß 
=
ßß 
false
ßß  %
,
ßß% &

StatusCode
®® 
=
®®  
$num
®®! $
,
®®$ %
Result
©© 
=
©© 
null
©© !
}
™™ 
;
™™ 
}
´´ 
var
≠≠ 
paymentCard
≠≠ 
=
≠≠ 
await
≠≠ #
_unitOfWork
≠≠$ /
.
≠≠/ 0#
PaymentCardRepository
≠≠0 E
.
≠≠E F
GetCardByUserId
≠≠F U
(
≠≠U V

instructor
≠≠V `
.
≠≠` a
UserId
≠≠a g
)
≠≠g h
;
≠≠h i
InstructorInfoDTO
ØØ 
instructorInfoDto
ØØ /
=
ØØ0 1
new
ØØ2 5
InstructorInfoDTO
ØØ6 G
(
ØØG H
)
ØØH I
{
∞∞ 
InstructorId
±± 
=
±± 

instructor
±± )
.
±±) *
InstructorId
±±* 6
,
±±6 7
UserId
≤≤ 
=
≤≤ 

instructor
≤≤ #
.
≤≤# $
UserId
≤≤$ *
,
≤≤* +
	AvatarUrl
≥≥ 
=
≥≥ 

instructor
≥≥ &
.
≥≥& '
ApplicationUser
≥≥' 6
.
≥≥6 7
	AvatarUrl
≥≥7 @
,
≥≥@ A
FullName
¥¥ 
=
¥¥ 

instructor
¥¥ %
.
¥¥% &
ApplicationUser
¥¥& 5
.
¥¥5 6
FullName
¥¥6 >
,
¥¥> ?
Email
µµ 
=
µµ 

instructor
µµ "
.
µµ" #
ApplicationUser
µµ# 2
.
µµ2 3
Email
µµ3 8
,
µµ8 9
Address
∂∂ 
=
∂∂ 

instructor
∂∂ $
.
∂∂$ %
ApplicationUser
∂∂% 4
.
∂∂4 5
Address
∂∂5 <
,
∂∂< =
PhoneNumber
∑∑ 
=
∑∑ 

instructor
∑∑ (
.
∑∑( )
ApplicationUser
∑∑) 8
.
∑∑8 9
PhoneNumber
∑∑9 D
,
∑∑D E
Gender
∏∏ 
=
∏∏ 

instructor
∏∏ #
.
∏∏# $
ApplicationUser
∏∏$ 3
.
∏∏3 4
Gender
∏∏4 :
,
∏∏: ;
	BirthDate
ππ 
=
ππ 

instructor
ππ &
.
ππ& '
ApplicationUser
ππ' 6
.
ππ6 7
	BirthDate
ππ7 @
,
ππ@ A
Country
∫∫ 
=
∫∫ 

instructor
∫∫ $
.
∫∫$ %
ApplicationUser
∫∫% 4
.
∫∫4 5
Country
∫∫5 <
,
∫∫< =
Degree
ªª 
=
ªª 

instructor
ªª #
.
ªª# $
Degree
ªª$ *
,
ªª* +
Industry
ºº 
=
ºº 

instructor
ºº %
.
ºº% &
Industry
ºº& .
,
ºº. /
Introduction
ΩΩ 
=
ΩΩ 

instructor
ΩΩ )
.
ΩΩ) *
Introduction
ΩΩ* 6
,
ΩΩ6 7
	TaxNumber
ææ 
=
ææ 

instructor
ææ &
.
ææ& '
ApplicationUser
ææ' 6
.
ææ6 7
	TaxNumber
ææ7 @
,
ææ@ A

CardNumber
øø 
=
øø 
paymentCard
øø (
?
øø( )
.
øø) *

CardNumber
øø* 4
,
øø4 5
CardName
¿¿ 
=
¿¿ 
paymentCard
¿¿ &
?
¿¿& '
.
¿¿' (
CardName
¿¿( 0
,
¿¿0 1
CardProvider
¡¡ 
=
¡¡ 
paymentCard
¡¡ *
?
¡¡* +
.
¡¡+ ,
CardProvider
¡¡, 8
,
¡¡8 9

IsAccepted
¬¬ 
=
¬¬ 

instructor
¬¬ '
.
¬¬' (

IsAccepted
¬¬( 2
}
√√ 
;
√√ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ "
(
≈≈" #
)
≈≈# $
{
∆∆ 
Message
«« 
=
«« 
$str
«« 8
,
««8 9
	IsSuccess
»» 
=
»» 
false
»» !
,
»»! "

StatusCode
…… 
=
…… 
$num
……  
,
……  !
Result
   
=
   
instructorInfoDto
   *
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 	
return
œœ 
new
œœ 
ResponseDTO
œœ "
(
œœ" #
)
œœ# $
{
–– 
Message
—— 
=
—— 
e
—— 
.
—— 
Message
—— #
,
——# $
	IsSuccess
““ 
=
““ 
false
““ !
,
““! "

StatusCode
”” 
=
”” 
$num
””  
,
””  !
Result
‘‘ 
=
‘‘ 
null
‘‘ 
}
’’ 
;
’’ 
}
÷÷ 	
}
◊◊ 
public
ﬂﬂ 

async
ﬂﬂ 
Task
ﬂﬂ 
<
ﬂﬂ 
ResponseDTO
ﬂﬂ !
>
ﬂﬂ! "

UpdateById
ﬂﬂ# -
(
ﬂﬂ- .!
UpdateInstructorDTO
ﬂﬂ. A!
updateInstructorDto
ﬂﬂB U
)
ﬂﬂU V
{
‡‡ 
try
·· 
{
‚‚ 	
var
„„  
instructorToUpdate
„„ "
=
„„# $
await
‰‰ 
_unitOfWork
‰‰ !
.
‰‰! ""
InstructorRepository
‰‰" 6
.
‰‰6 7
GetById
‰‰7 >
(
‰‰> ?!
updateInstructorDto
‰‰? R
.
‰‰R S
InstructorId
‰‰S _
)
‰‰_ `
;
‰‰` a
if
ÊÊ 
(
ÊÊ  
instructorToUpdate
ÊÊ "
==
ÊÊ# %
null
ÊÊ& *
)
ÊÊ* +
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË &
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
$str
ÍÍ 4
,
ÍÍ4 5
Result
ÎÎ 
=
ÎÎ 
null
ÎÎ !
,
ÎÎ! "
	IsSuccess
ÏÏ 
=
ÏÏ 
false
ÏÏ  %
,
ÏÏ% &

StatusCode
ÌÌ 
=
ÌÌ  
$num
ÌÌ! $
}
ÓÓ 
;
ÓÓ 
}
ÔÔ  
instructorToUpdate
ÒÒ 
.
ÒÒ 
Degree
ÒÒ %
=
ÒÒ& '!
updateInstructorDto
ÒÒ( ;
.
ÒÒ; <
Degree
ÒÒ< B
;
ÒÒB C 
instructorToUpdate
ÚÚ 
.
ÚÚ 
Industry
ÚÚ '
=
ÚÚ( )!
updateInstructorDto
ÚÚ* =
.
ÚÚ= >
Industry
ÚÚ> F
;
ÚÚF G 
instructorToUpdate
ÛÛ 
.
ÛÛ 
Introduction
ÛÛ +
=
ÛÛ, -!
updateInstructorDto
ÛÛ. A
.
ÛÛA B
Introduction
ÛÛB N
;
ÛÛN O 
instructorToUpdate
ıı 
.
ıı 
ApplicationUser
ıı .
.
ıı. /
Address
ıı/ 6
=
ıı7 8!
updateInstructorDto
ıı9 L
?
ııL M
.
ııM N
Address
ııN U
;
ııU V 
instructorToUpdate
ˆˆ 
.
ˆˆ 
ApplicationUser
ˆˆ .
.
ˆˆ. /
	BirthDate
ˆˆ/ 8
=
ˆˆ9 :!
updateInstructorDto
ˆˆ; N
?
ˆˆN O
.
ˆˆO P
	BirthDate
ˆˆP Y
;
ˆˆY Z 
instructorToUpdate
˜˜ 
.
˜˜ 
ApplicationUser
˜˜ .
.
˜˜. /
PhoneNumber
˜˜/ :
=
˜˜; <!
updateInstructorDto
˜˜= P
?
˜˜P Q
.
˜˜Q R
PhoneNumber
˜˜R ]
;
˜˜] ^ 
instructorToUpdate
¯¯ 
.
¯¯ 
ApplicationUser
¯¯ .
.
¯¯. /
Gender
¯¯/ 5
=
¯¯6 7!
updateInstructorDto
¯¯8 K
?
¯¯K L
.
¯¯L M
Gender
¯¯M S
;
¯¯S T 
instructorToUpdate
˘˘ 
.
˘˘ 
ApplicationUser
˘˘ .
.
˘˘. /
FullName
˘˘/ 7
=
˘˘8 9!
updateInstructorDto
˘˘: M
?
˘˘M N
.
˘˘N O
FullName
˘˘O W
;
˘˘W X 
instructorToUpdate
˙˙ 
.
˙˙ 
ApplicationUser
˙˙ .
.
˙˙. /
Country
˙˙/ 6
=
˙˙7 8!
updateInstructorDto
˙˙9 L
?
˙˙L M
.
˙˙M N
Country
˙˙N U
;
˙˙U V 
instructorToUpdate
˚˚ 
.
˚˚ 
ApplicationUser
˚˚ .
.
˚˚. /
Email
˚˚/ 4
=
˚˚5 6!
updateInstructorDto
˚˚7 J
?
˚˚J K
.
˚˚K L
Email
˚˚L Q
;
˚˚Q R 
instructorToUpdate
¸¸ 
.
¸¸ 
ApplicationUser
¸¸ .
.
¸¸. /
	TaxNumber
¸¸/ 8
=
¸¸9 :!
updateInstructorDto
¸¸; N
?
¸¸N O
.
¸¸O P
	TaxNumber
¸¸P Y
;
¸¸Y Z
_unitOfWork
ˇˇ 
.
ˇˇ "
InstructorRepository
ˇˇ ,
.
ˇˇ, -
Update
ˇˇ- 3
(
ˇˇ3 4 
instructorToUpdate
ˇˇ4 F
)
ˇˇF G
;
ˇˇG H
await
ÄÄ 
_unitOfWork
ÄÄ 
.
ÄÄ 
	SaveAsync
ÄÄ '
(
ÄÄ' (
)
ÄÄ( )
;
ÄÄ) *
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ "
{
ÉÉ 
Message
ÑÑ 
=
ÑÑ 
$str
ÑÑ ;
,
ÑÑ; <
Result
ÖÖ 
=
ÖÖ 
null
ÖÖ 
,
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 	
return
åå 
new
åå 
ResponseDTO
åå "
{
çç 
Message
éé 
=
éé 
e
éé 
.
éé 
Message
éé #
,
éé# $
Result
èè 
=
èè 
null
èè 
,
èè 
	IsSuccess
êê 
=
êê 
false
êê !
,
êê! "

StatusCode
ëë 
=
ëë 
$num
ëë  
}
íí 
;
íí 
}
ìì 	
}
îî 
public
ññ 

async
ññ 
Task
ññ 
<
ññ 
ResponseDTO
ññ !
>
ññ! "
AcceptInstructor
ññ# 3
(
ññ3 4
ClaimsPrincipal
ññ4 C
User
ññD H
,
ññH I
Guid
ññJ N
instructorId
ññO [
)
ññ[ \
{
óó 
try
òò 
{
ôô 	
var
öö 
userId
öö 
=
öö 
User
öö 
.
öö 
Claims
öö $
.
öö$ %
FirstOrDefault
öö% 3
(
öö3 4
x
öö4 5
=>
öö6 8
x
öö9 :
.
öö: ;
Type
öö; ?
==
öö@ B

ClaimTypes
ööC M
.
ööM N
NameIdentifier
ööN \
)
öö\ ]
?
öö] ^
.
öö^ _
Value
öö_ d
;
ööd e
var
õõ 

instructor
õõ 
=
õõ 
await
õõ "
_unitOfWork
õõ# .
.
õõ. /"
InstructorRepository
õõ/ C
.
õõC D
GetById
õõD K
(
õõK L
instructorId
õõL X
)
õõX Y
;
õõY Z
if
úú 
(
úú 

instructor
úú 
is
úú 
null
úú "
)
úú" #
{
ùù 
return
ûû 
new
ûû 
ResponseDTO
ûû &
(
ûû& '
)
ûû' (
{
üü 
Message
†† 
=
†† 
$str
†† 8
,
††8 9
	IsSuccess
°° 
=
°° 
false
°°  %
,
°°% &

StatusCode
¢¢ 
=
¢¢  
$num
¢¢! $
,
¢¢$ %
Result
££ 
=
££ 
null
££ !
}
§§ 
;
§§ 
}
•• 

instructor
ßß 
.
ßß 

IsAccepted
ßß !
=
ßß" #
true
ßß$ (
;
ßß( )

instructor
®® 
.
®® 

AcceptedBy
®® !
=
®®" #
userId
®®$ *
;
®®* +

instructor
©© 
.
©© 
AcceptedTime
©© #
=
©©$ %
DateTime
©©& .
.
©©. /
UtcNow
©©/ 5
;
©©5 6
await
™™ 
_unitOfWork
™™ 
.
™™ 
	SaveAsync
™™ '
(
™™' (
)
™™( )
;
™™) *
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ :
,
ÆÆ: ;
Result
ØØ 
=
ØØ 
null
ØØ 
,
ØØ 
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  
,
∞∞  !

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
Message
∏∏ 
=
∏∏ 
e
∏∏ 
.
∏∏ 
Message
∏∏ #
,
∏∏# $
	IsSuccess
ππ 
=
ππ 
true
ππ  
,
ππ  !

StatusCode
∫∫ 
=
∫∫ 
$num
∫∫  
,
∫∫  !
Result
ªª 
=
ªª 
null
ªª 
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
¿¿ 

async
¿¿ 
Task
¿¿ 
<
¿¿ 
ResponseDTO
¿¿ !
>
¿¿! "
RejectInstructor
¿¿# 3
(
¿¿3 4
ClaimsPrincipal
¿¿4 C
User
¿¿D H
,
¿¿H I
Guid
¿¿J N
instructorId
¿¿O [
)
¿¿[ \
{
¡¡ 
try
¬¬ 
{
√√ 	
var
ƒƒ 
userId
ƒƒ 
=
ƒƒ 
User
ƒƒ 
.
ƒƒ 
Claims
ƒƒ $
.
ƒƒ$ %
FirstOrDefault
ƒƒ% 3
(
ƒƒ3 4
x
ƒƒ4 5
=>
ƒƒ6 8
x
ƒƒ9 :
.
ƒƒ: ;
Type
ƒƒ; ?
==
ƒƒ@ B

ClaimTypes
ƒƒC M
.
ƒƒM N
NameIdentifier
ƒƒN \
)
ƒƒ\ ]
?
ƒƒ] ^
.
ƒƒ^ _
Value
ƒƒ_ d
;
ƒƒd e
var
∆∆ 

instructor
∆∆ 
=
∆∆ 
await
∆∆ "
_unitOfWork
∆∆# .
.
∆∆. /"
InstructorRepository
∆∆/ C
.
∆∆C D
GetById
∆∆D K
(
∆∆K L
instructorId
∆∆L X
)
∆∆X Y
;
∆∆Y Z
if
«« 
(
«« 

instructor
«« 
is
«« 
null
«« "
)
««" #
{
»» 
return
…… 
new
…… 
ResponseDTO
…… &
(
……& '
)
……' (
{
   
Message
ÀÀ 
=
ÀÀ 
$str
ÀÀ 8
,
ÀÀ8 9
	IsSuccess
ÃÃ 
=
ÃÃ 
false
ÃÃ  %
,
ÃÃ% &

StatusCode
ÕÕ 
=
ÕÕ  
$num
ÕÕ! $
,
ÕÕ$ %
Result
ŒŒ 
=
ŒŒ 
null
ŒŒ !
}
œœ 
;
œœ 
}
–– 

instructor
““ 
.
““ 

IsAccepted
““ !
=
““" #
false
““$ )
;
““) *

instructor
”” 
.
”” 

RejectedBy
”” !
=
””" #
userId
””$ *
;
””* +

instructor
‘‘ 
.
‘‘ 
RejectedTime
‘‘ #
=
‘‘$ %
DateTime
‘‘& .
.
‘‘. /
UtcNow
‘‘/ 5
;
‘‘5 6
await
’’ 
_unitOfWork
’’ 
.
’’ 
	SaveAsync
’’ '
(
’’' (
)
’’( )
;
’’) *
return
◊◊ 
new
◊◊ 
ResponseDTO
◊◊ "
(
◊◊" #
)
◊◊# $
{
ÿÿ 
Message
ŸŸ 
=
ŸŸ 
$str
ŸŸ :
,
ŸŸ: ;
Result
⁄⁄ 
=
⁄⁄ 
null
⁄⁄ 
,
⁄⁄ 
	IsSuccess
€€ 
=
€€ 
true
€€  
,
€€  !

StatusCode
‹‹ 
=
‹‹ 
$num
‹‹  
}
›› 
;
›› 
}
ﬁﬁ 	
catch
ﬂﬂ 
(
ﬂﬂ 
	Exception
ﬂﬂ 
e
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 	
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Message
„„ 
=
„„ 
e
„„ 
.
„„ 
Message
„„ #
,
„„# $
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Result
ÊÊ 
=
ÊÊ 
null
ÊÊ 
}
ÁÁ 
;
ÁÁ 
}
ËË 	
}
ÈÈ 
public
ÎÎ 

async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
ResponseDTO
ÎÎ !
>
ÎÎ! "'
GetInstructorTotalCourses
ÎÎ# <
(
ÎÎ< =
Guid
ÎÎ= A
instructorId
ÎÎB N
)
ÎÎN O
{
ÏÏ 
try
ÌÌ 
{
ÓÓ 	
var
ÔÔ 
id
ÔÔ 
=
ÔÔ 
await
ÔÔ 
_unitOfWork
ÔÔ &
.
ÔÔ& '"
InstructorRepository
ÔÔ' ;
.
ÔÔ; <
GetAsync
ÔÔ< D
(
ÔÔD E
i
ÔÔE F
=>
ÔÔG I
i
ÔÔJ K
.
ÔÔK L
InstructorId
ÔÔL X
==
ÔÔY [
instructorId
ÔÔ\ h
)
ÔÔh i
;
ÔÔi j
if
ÒÒ 
(
ÒÒ 
id
ÒÒ 
==
ÒÒ 
null
ÒÒ 
)
ÒÒ 
{
ÚÚ 
return
ÛÛ 
new
ÛÛ 
ResponseDTO
ÛÛ &
(
ÛÛ& '
)
ÛÛ' (
{
ÙÙ 
Message
ıı 
=
ıı 
$str
ıı 4
,
ıı4 5
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ !
,
ˆˆ! "
	IsSuccess
˜˜ 
=
˜˜ 
false
˜˜  %
,
˜˜% &

StatusCode
¯¯ 
=
¯¯  
$num
¯¯! $
}
˘˘ 
;
˘˘ 
}
˙˙ 
var
¸¸ 
courses
¸¸ 
=
¸¸ 
await
¸¸ 
_unitOfWork
¸¸  +
.
¸¸+ ,
CourseRepository
¸¸, <
.
¸¸< =
GetAllAsync
¸¸= H
(
¸¸H I
c
¸¸I J
=>
¸¸K M
c
¸¸N O
.
¸¸O P
InstructorId
¸¸P \
==
¸¸] _
id
¸¸` b
.
¸¸b c
InstructorId
¸¸c o
)
¸¸o p
;
¸¸p q
var
˛˛ 
totalCourses
˛˛ 
=
˛˛ 
courses
˛˛ &
.
˛˛& '
Count
˛˛' ,
(
˛˛, -
)
˛˛- .
;
˛˛. /
var
ˇˇ 
pending
ˇˇ 
=
ˇˇ 
courses
ˇˇ !
.
ˇˇ! "
Count
ˇˇ" '
(
ˇˇ' (
x
ˇˇ( )
=>
ˇˇ* ,
x
ˇˇ- .
.
ˇˇ. /
Status
ˇˇ/ 5
==
ˇˇ6 8
$num
ˇˇ9 :
)
ˇˇ: ;
;
ˇˇ; <
var
ÄÄ 
	activated
ÄÄ 
=
ÄÄ 
courses
ÄÄ #
.
ÄÄ# $
Count
ÄÄ$ )
(
ÄÄ) *
x
ÄÄ* +
=>
ÄÄ, .
x
ÄÄ/ 0
.
ÄÄ0 1
Status
ÄÄ1 7
==
ÄÄ8 :
$num
ÄÄ; <
)
ÄÄ< =
;
ÄÄ= >
var
ÅÅ 
rejected
ÅÅ 
=
ÅÅ 
courses
ÅÅ "
.
ÅÅ" #
Count
ÅÅ# (
(
ÅÅ( )
x
ÅÅ) *
=>
ÅÅ+ -
x
ÅÅ. /
.
ÅÅ/ 0
Status
ÅÅ0 6
==
ÅÅ7 9
$num
ÅÅ: ;
)
ÅÅ; <
;
ÅÅ< =
var
ÇÇ 
deleted
ÇÇ 
=
ÇÇ 
courses
ÇÇ !
.
ÇÇ! "
Count
ÇÇ" '
(
ÇÇ' (
x
ÇÇ( )
=>
ÇÇ* ,
x
ÇÇ- .
.
ÇÇ. /
Status
ÇÇ/ 5
==
ÇÇ6 8
$num
ÇÇ9 :
)
ÇÇ: ;
;
ÇÇ; <
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ 2
,
ÜÜ2 3
	IsSuccess
áá 
=
áá 
true
áá  
,
áá  !

StatusCode
àà 
=
àà 
$num
àà  
,
àà  !
Result
ââ 
=
ââ 
new
ââ "
InstructorTotalCount
ââ 1
(
ââ1 2
)
ââ2 3
{
ää 
Total
ãã 
=
ãã 
totalCourses
ãã (
,
ãã( )
	Activated
åå 
=
åå 
	activated
åå  )
,
åå) *
Deleted
çç 
=
çç 
deleted
çç %
,
çç% &
Pending
éé 
=
éé 
pending
éé %
,
éé% &
Rejected
èè 
=
èè 
rejected
èè '
}
êê 
}
ëë 
;
ëë 
}
íí 	
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 	
return
ïï 
new
ïï 
ResponseDTO
ïï "
{
ññ 
Message
óó 
=
óó 
e
óó 
.
óó 
Message
óó #
,
óó# $
Result
òò 
=
òò 
null
òò 
,
òò 
	IsSuccess
ôô 
=
ôô 
false
ôô !
,
ôô! "

StatusCode
öö 
=
öö 
$num
öö  
}
õõ 
;
õõ 
}
úú 	
}
ùù 
public
üü 

async
üü 
Task
üü 
<
üü 
ResponseDTO
üü !
>
üü! "&
GetInstructorTotalRating
üü# ;
(
üü; <
Guid
üü< @
instructorId
üüA M
)
üüM N
{
†† 
try
°° 
{
¢¢ 	
var
§§ 
instructorRatings
§§ !
=
§§" #
await
•• 
_unitOfWork
•• !
.
••! "(
InstructorRatingRepository
••" <
.
••< =
GetAllAsync
••= H
(
••H I
x
••I J
=>
••K M
x
••N O
.
••O P
InstructorId
••P \
==
••] _
instructorId
••` l
)
••l m
;
••m n
if
ßß 
(
ßß 
instructorRatings
ßß !
==
ßß" $
null
ßß% )
||
ßß* ,
!
ßß- .
instructorRatings
ßß. ?
.
ßß? @
Any
ßß@ C
(
ßßC D
)
ßßD E
)
ßßE F
{
®® 
return
©© 
new
©© 
ResponseDTO
©© &
{
™™ 
Message
´´ 
=
´´ 
$str
´´ E
,
´´E F
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨  %
,
¨¨% &

StatusCode
≠≠ 
=
≠≠  
$num
≠≠! $
}
ÆÆ 
;
ÆÆ 
}
ØØ 
var
≤≤ 
one
≤≤ 
=
≤≤ 
instructorRatings
≤≤ '
.
≤≤' (
Count
≤≤( -
(
≤≤- .
x
≤≤. /
=>
≤≤0 2
x
≤≤3 4
.
≤≤4 5
Rate
≤≤5 9
==
≤≤: <
$num
≤≤= >
)
≤≤> ?
;
≤≤? @
var
≥≥ 
two
≥≥ 
=
≥≥ 
instructorRatings
≥≥ '
.
≥≥' (
Count
≥≥( -
(
≥≥- .
x
≥≥. /
=>
≥≥0 2
x
≥≥3 4
.
≥≥4 5
Rate
≥≥5 9
==
≥≥: <
$num
≥≥= >
)
≥≥> ?
;
≥≥? @
var
¥¥ 
three
¥¥ 
=
¥¥ 
instructorRatings
¥¥ )
.
¥¥) *
Count
¥¥* /
(
¥¥/ 0
x
¥¥0 1
=>
¥¥2 4
x
¥¥5 6
.
¥¥6 7
Rate
¥¥7 ;
==
¥¥< >
$num
¥¥? @
)
¥¥@ A
;
¥¥A B
var
µµ 
four
µµ 
=
µµ 
instructorRatings
µµ (
.
µµ( )
Count
µµ) .
(
µµ. /
x
µµ/ 0
=>
µµ1 3
x
µµ4 5
.
µµ5 6
Rate
µµ6 :
==
µµ; =
$num
µµ> ?
)
µµ? @
;
µµ@ A
var
∂∂ 
five
∂∂ 
=
∂∂ 
instructorRatings
∂∂ (
.
∂∂( )
Count
∂∂) .
(
∂∂. /
x
∂∂/ 0
=>
∂∂1 3
x
∂∂4 5
.
∂∂5 6
Rate
∂∂6 :
==
∂∂; =
$num
∂∂> ?
)
∂∂? @
;
∂∂@ A
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
{
ππ 
Message
∫∫ 
=
∫∫ 
$str
∫∫ 8
,
∫∫8 9
	IsSuccess
ªª 
=
ªª 
true
ªª  
,
ªª  !

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
Result
ΩΩ 
=
ΩΩ 
new
ΩΩ  
InstructorAvgCount
ΩΩ /
(
ΩΩ/ 0
)
ΩΩ0 1
{
ææ 
One
øø 
=
øø 
one
øø 
,
øø 
Two
¿¿ 
=
¿¿ 
two
¿¿ 
,
¿¿ 
Three
¡¡ 
=
¡¡ 
three
¡¡ !
,
¡¡! "
Four
¬¬ 
=
¬¬ 
four
¬¬ 
,
¬¬  
Five
√√ 
=
√√ 
five
√√ 
}
ƒƒ 
}
≈≈ 
;
≈≈ 
}
∆∆ 	
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 	
return
…… 
new
…… 
ResponseDTO
…… "
{
   
Message
ÀÀ 
=
ÀÀ 
e
ÀÀ 
.
ÀÀ 
Message
ÀÀ #
,
ÀÀ# $
Result
ÃÃ 
=
ÃÃ 
null
ÃÃ 
,
ÃÃ 
	IsSuccess
ÕÕ 
=
ÕÕ 
false
ÕÕ !
,
ÕÕ! "

StatusCode
ŒŒ 
=
ŒŒ 
$num
ŒŒ  
}
œœ 
;
œœ 
}
–– 	
}
—— 
public
‘‘ 

Task
‘‘ 
<
‘‘ 
ResponseDTO
‘‘ 
>
‘‘ &
GetInstructorEarnedMoney
‘‘ 5
(
‘‘5 6
Guid
‘‘6 :
instructorId
‘‘; G
)
‘‘G H
{
’’ 
throw
÷÷ 
new
÷÷ %
NotImplementedException
÷÷ )
(
÷÷) *
)
÷÷* +
;
÷÷+ ,
}
◊◊ 
public
ŸŸ 

Task
ŸŸ 
<
ŸŸ 
ResponseDTO
ŸŸ 
>
ŸŸ &
GetInstructorPayoutMoney
ŸŸ 5
(
ŸŸ5 6
Guid
ŸŸ6 :
instructorId
ŸŸ; G
)
ŸŸG H
{
⁄⁄ 
throw
€€ 
new
€€ %
NotImplementedException
€€ )
(
€€) *
)
€€* +
;
€€+ ,
}
‹‹ 
public
‡‡ 

async
‡‡ 
Task
‡‡ 
<
‡‡ 
ResponseDTO
‡‡ !
>
‡‡! "%
GetAllInstructorComment
‡‡# :
(
·· 
Guid
‚‚ 
instructorId
‚‚ 
,
‚‚ 
int
„„ 

pageNumber
„„ 
,
„„ 
int
‰‰ 
pageSize
‰‰ 
)
ÂÂ 
{
ÊÊ 
try
ÁÁ 
{
ËË 	
var
ÈÈ 
comments
ÈÈ 
=
ÈÈ 
_unitOfWork
ÈÈ &
.
ÈÈ& ')
InstructorCommentRepository
ÈÈ' B
.
ÈÈB C
GetAllAsync
ÈÈC N
(
ÈÈN O
x
ÍÍ 
=>
ÍÍ 
x
ÍÍ 
.
ÍÍ 
InstructorId
ÍÍ #
==
ÍÍ$ &
instructorId
ÍÍ' 3
&&
ÍÍ4 6
x
ÎÎ 
.
ÎÎ 
Status
ÎÎ 
!=
ÎÎ  
$num
ÎÎ! "
)
ÏÏ 
.
ÏÏ 

GetAwaiter
ÏÏ 
(
ÏÏ 
)
ÏÏ 
.
ÏÏ 
	GetResult
ÏÏ $
(
ÏÏ$ %
)
ÏÏ% &
.
ÏÏ& '
ToList
ÏÏ' -
(
ÏÏ- .
)
ÏÏ. /
;
ÏÏ/ 0
if
ÌÌ 
(
ÌÌ 
comments
ÌÌ 
is
ÌÌ 
null
ÌÌ  
)
ÌÌ  !
{
ÓÓ 
return
ÔÔ 
new
ÔÔ 
ResponseDTO
ÔÔ &
(
ÔÔ& '
)
ÔÔ' (
{
 
Message
ÒÒ 
=
ÒÒ 
$str
ÒÒ 4
,
ÒÒ4 5
	IsSuccess
ÚÚ 
=
ÚÚ 
true
ÚÚ  $
,
ÚÚ$ %

StatusCode
ÛÛ 
=
ÛÛ  
$num
ÛÛ! $
,
ÛÛ$ %
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ !
}
ıı 
;
ıı 
}
ˆˆ 
comments
¯¯ 
=
¯¯ 
comments
¯¯ 
.
¯¯  
OrderByDescending
¯¯  1
(
¯¯1 2
x
¯¯2 3
=>
¯¯4 6
x
¯¯7 8
.
¯¯8 9

CreateTime
¯¯9 C
)
¯¯C D
.
¯¯D E
ToList
¯¯E K
(
¯¯K L
)
¯¯L M
;
¯¯M N
if
˚˚ 
(
˚˚ 

pageNumber
˚˚ 
>
˚˚ 
$num
˚˚ 
&&
˚˚ !
pageSize
˚˚" *
>
˚˚+ ,
$num
˚˚- .
)
˚˚. /
{
¸¸ 
var
˝˝ 

skipResult
˝˝ 
=
˝˝  
(
˝˝! "

pageNumber
˝˝" ,
-
˝˝- .
$num
˝˝/ 0
)
˝˝0 1
*
˝˝2 3
pageSize
˝˝4 <
;
˝˝< =
comments
˛˛ 
=
˛˛ 
comments
˛˛ #
.
˛˛# $
Skip
˛˛$ (
(
˛˛( )

skipResult
˛˛) 3
)
˛˛3 4
.
˛˛4 5
Take
˛˛5 9
(
˛˛9 :
pageSize
˛˛: B
)
˛˛B C
.
˛˛C D
ToList
˛˛D J
(
˛˛J K
)
˛˛K L
;
˛˛L M
}
ˇˇ 
var
ÅÅ 
commentsDto
ÅÅ 
=
ÅÅ 
_mapper
ÅÅ %
.
ÅÅ% &
Map
ÅÅ& )
<
ÅÅ) *
List
ÅÅ* .
<
ÅÅ. /
GetAllCommentsDTO
ÅÅ/ @
>
ÅÅ@ A
>
ÅÅA B
(
ÅÅB C
comments
ÅÅC K
)
ÅÅK L
;
ÅÅL M
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
(
ÉÉ" #
)
ÉÉ# $
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
$str
ÖÖ ?
,
ÖÖ? @
	IsSuccess
ÜÜ 
=
ÜÜ 
true
ÜÜ  
,
ÜÜ  !

StatusCode
áá 
=
áá 
$num
áá  
,
áá  !
Result
àà 
=
àà 
commentsDto
àà $
}
ââ 
;
ââ 
}
ää 	
catch
ãã 
(
ãã 
	Exception
ãã 
e
ãã 
)
ãã 
{
åå 	
return
çç 
new
çç 
ResponseDTO
çç "
(
çç" #
)
çç# $
{
éé 
Message
èè 
=
èè 
e
èè 
.
èè 
Message
èè #
,
èè# $
Result
êê 
=
êê 
null
êê 
,
êê 
	IsSuccess
ëë 
=
ëë 
false
ëë !
,
ëë! "

StatusCode
íí 
=
íí 
$num
íí  
}
ìì 
;
ìì 
}
îî 	
}
ïï 
public
óó 

async
óó 
Task
óó 
<
óó 
ResponseDTO
óó !
>
óó! "%
CreateInstructorComment
óó# :
(
óó: ;
ClaimsPrincipal
óó; J
User
óóK O
,
óóO P(
CreateInstructorCommentDTO
òò "%
createInstructorComment
òò# :
)
òò: ;
{
ôô 
try
öö 
{
õõ 	
var
ùù 
instructorId
ùù 
=
ùù 
await
ûû 
_unitOfWork
ûû !
.
ûû! ""
InstructorRepository
ûû" 6
.
ûû6 7
GetAsync
ûû7 ?
(
ûû? @
i
ûû@ A
=>
ûûB D
i
üü 
.
üü 
InstructorId
üü "
==
üü# %%
createInstructorComment
üü& =
.
üü= >
instructorId
üü> J
)
üüJ K
;
üüK L
if
†† 
(
†† 
instructorId
†† 
==
†† 
null
††  $
)
††$ %
{
°° 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ &
(
¢¢& '
)
¢¢' (
{
££ 
Message
§§ 
=
§§ 
$str
§§ 4
,
§§4 5
Result
•• 
=
•• 
null
•• !
,
••! "
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
}
®® 
;
®® 
}
©© 
var
´´ 
userId
´´ 
=
´´ 
User
´´ 
.
´´ 
Claims
´´ $
.
´´$ %
FirstOrDefault
´´% 3
(
´´3 4
x
´´4 5
=>
´´6 8
x
´´9 :
.
´´: ;
Type
´´; ?
==
´´@ B

ClaimTypes
´´C M
.
´´M N
NameIdentifier
´´N \
)
´´\ ]
?
´´] ^
.
´´^ _
Value
´´_ d
;
´´d e
var
¨¨ 
admin
¨¨ 
=
¨¨ 
await
¨¨ 
_unitOfWork
¨¨ )
.
¨¨) *#
UserManagerRepository
¨¨* ?
.
¨¨? @
FindByIdAsync
¨¨@ M
(
¨¨M N
userId
¨¨N T
)
¨¨T U
;
¨¨U V
InstructorComment
ØØ 
comment
ØØ %
=
ØØ& '
new
ØØ( +
InstructorComment
ØØ, =
(
ØØ= >
)
ØØ> ?
{
∞∞ 
Comment
±± 
=
±± %
createInstructorComment
±± 1
.
±±1 2
Comment
±±2 9
,
±±9 :
InstructorId
≤≤ 
=
≤≤ %
createInstructorComment
≤≤ 6
.
≤≤6 7
instructorId
≤≤7 C
,
≤≤C D

UpdateTime
≥≥ 
=
≥≥ 
DateTime
≥≥ %
.
≥≥% &
Now
≥≥& )
,
≥≥) *

CreateTime
¥¥ 
=
¥¥ 
DateTime
¥¥ %
.
¥¥% &
Now
¥¥& )
,
¥¥) *
CreateBy
µµ 
=
µµ 
admin
µµ  
.
µµ  !
Email
µµ! &
,
µµ& '
UpdateBy
∂∂ 
=
∂∂ 
$str
∂∂ 
,
∂∂ 
Status
∑∑ 
=
∑∑ 
$num
∑∑ 
}
∏∏ 
;
∏∏ 
await
ªª 
_unitOfWork
ªª 
.
ªª )
InstructorCommentRepository
ªª 9
.
ªª9 :
AddAsync
ªª: B
(
ªªB C
comment
ªªC J
)
ªªJ K
;
ªªK L
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ "
(
ΩΩ" #
)
ΩΩ# $
{
ææ 
Message
øø 
=
øø 
$str
øø 8
,
øø8 9
Result
¿¿ 
=
¿¿ 
comment
¿¿  
,
¿¿  !
	IsSuccess
¡¡ 
=
¡¡ 
true
¡¡  
,
¡¡  !

StatusCode
¬¬ 
=
¬¬ 
$num
¬¬  
,
¬¬  !
}
√√ 
;
√√ 
}
ƒƒ 	
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
e
≈≈ 
)
≈≈ 
{
∆∆ 	
return
«« 
new
«« 
ResponseDTO
«« "
{
»» 
Message
…… 
=
…… 
e
…… 
.
…… 
Message
…… #
,
……# $
Result
   
=
   
null
   
,
   
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ !
,
ÀÀ! "

StatusCode
ÃÃ 
=
ÃÃ 
$num
ÃÃ  
}
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
œœ 
public
—— 

async
—— 
Task
—— 
<
—— 
ResponseDTO
—— !
>
——! "%
UpdateInstructorComment
——# :
(
——: ;
ClaimsPrincipal
——; J
User
——K O
,
——O P(
UpdateInstructorCommentDTO
““ "(
updateInstructorCommentDTO
““# =
)
““= >
{
”” 
try
‘‘ 
{
’’ 	
var
÷÷ 
instructorId
÷÷ 
=
÷÷ 
await
◊◊ 
_unitOfWork
◊◊ !
.
◊◊! ")
InstructorCommentRepository
◊◊" =
.
◊◊= >
GetAsync
◊◊> F
(
◊◊F G
i
◊◊G H
=>
◊◊I K
i
◊◊L M
.
◊◊M N
Id
◊◊N P
==
◊◊Q S(
updateInstructorCommentDTO
◊◊T n
.
◊◊n o
Id
◊◊o q
)
◊◊q r
;
◊◊r s
if
ÿÿ 
(
ÿÿ 
instructorId
ÿÿ 
==
ÿÿ 
null
ÿÿ  $
)
ÿÿ$ %
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ &
(
⁄⁄& '
)
⁄⁄' (
{
€€ 
Message
‹‹ 
=
‹‹ 
$str
‹‹ 4
,
‹‹4 5
Result
›› 
=
›› 
null
›› !
,
››! "
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
false
ﬁﬁ  %
,
ﬁﬁ% &

StatusCode
ﬂﬂ 
=
ﬂﬂ  
$num
ﬂﬂ! $
}
‡‡ 
;
‡‡ 
}
·· 
var
„„ 
userId
„„ 
=
„„ 
User
„„ 
.
„„ 
Claims
„„ $
.
„„$ %
FirstOrDefault
„„% 3
(
„„3 4
x
„„4 5
=>
„„6 8
x
„„9 :
.
„„: ;
Type
„„; ?
==
„„@ B

ClaimTypes
„„C M
.
„„M N
NameIdentifier
„„N \
)
„„\ ]
?
„„] ^
.
„„^ _
Value
„„_ d
;
„„d e
var
‰‰ 
admin
‰‰ 
=
‰‰ 
await
‰‰ 
_unitOfWork
‰‰ )
.
‰‰) *#
UserManagerRepository
‰‰* ?
.
‰‰? @
FindByIdAsync
‰‰@ M
(
‰‰M N
userId
‰‰N T
)
‰‰T U
;
‰‰U V
instructorId
ÁÁ 
.
ÁÁ 

UpdateTime
ÁÁ #
=
ÁÁ$ %
DateTime
ÁÁ& .
.
ÁÁ. /
Now
ÁÁ/ 2
;
ÁÁ2 3
instructorId
ËË 
.
ËË 
UpdateBy
ËË !
=
ËË" #
admin
ËË$ )
.
ËË) *
Email
ËË* /
;
ËË/ 0
instructorId
ÈÈ 
.
ÈÈ 
Comment
ÈÈ  
=
ÈÈ! "(
updateInstructorCommentDTO
ÈÈ# =
.
ÈÈ= >
comment
ÈÈ> E
;
ÈÈE F
instructorId
ÍÍ 
.
ÍÍ 
Status
ÍÍ 
=
ÍÍ  !
$num
ÍÍ" #
;
ÍÍ# $
_unitOfWork
ÏÏ 
.
ÏÏ )
InstructorCommentRepository
ÏÏ 3
.
ÏÏ3 4
Update
ÏÏ4 :
(
ÏÏ: ;
instructorId
ÏÏ; G
)
ÏÏG H
;
ÏÏH I
await
ÔÔ 
_unitOfWork
ÔÔ 
.
ÔÔ 
	SaveAsync
ÔÔ '
(
ÔÔ' (
)
ÔÔ( )
;
ÔÔ) *
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ "
(
ÒÒ" #
)
ÒÒ# $
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ 
$str
ÛÛ 8
,
ÛÛ8 9
Result
ÙÙ 
=
ÙÙ 
null
ÙÙ 
,
ÙÙ 
	IsSuccess
ıı 
=
ıı 
true
ıı  
,
ıı  !

StatusCode
ˆˆ 
=
ˆˆ 
$num
ˆˆ  
,
ˆˆ  !
}
˜˜ 
;
˜˜ 
}
¯¯ 	
catch
˘˘ 
(
˘˘ 
	Exception
˘˘ 
e
˘˘ 
)
˘˘ 
{
˙˙ 	
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ "
{
¸¸ 
Message
˝˝ 
=
˝˝ 
e
˝˝ 
.
˝˝ 
Message
˝˝ #
,
˝˝# $
Result
˛˛ 
=
˛˛ 
null
˛˛ 
,
˛˛ 
	IsSuccess
ˇˇ 
=
ˇˇ 
false
ˇˇ !
,
ˇˇ! "

StatusCode
ÄÄ 
=
ÄÄ 
$num
ÄÄ  
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
public
ÖÖ 

async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
ResponseDTO
ÖÖ !
>
ÖÖ! "%
DeleteInstructorComment
ÖÖ# :
(
ÖÖ: ;
Guid
ÖÖ; ?
	commentId
ÖÖ@ I
)
ÖÖI J
{
ÜÜ 
try
áá 
{
àà 	
var
ââ 
comment
ââ 
=
ââ 
await
ää 
_unitOfWork
ää !
.
ää! ")
InstructorCommentRepository
ää" =
.
ää= >
GetAsync
ää> F
(
ääF G
x
ääG H
=>
ääI K
x
ääL M
.
ääM N
Id
ääN P
==
ääQ S
	commentId
ääT ]
)
ää] ^
;
ää^ _
if
ãã 
(
ãã 
comment
ãã 
==
ãã 
null
ãã 
)
ãã  
{
åå 
return
çç 
new
çç 
ResponseDTO
çç &
(
çç& '
)
çç' (
{
éé 
Message
èè 
=
èè 
$str
èè 5
,
èè5 6
	IsSuccess
êê 
=
êê 
false
êê  %
,
êê% &

StatusCode
ëë 
=
ëë  
$num
ëë! $
,
ëë$ %
Result
íí 
=
íí 
null
íí !
,
íí! "
}
ìì 
;
ìì 
}
îî 
comment
óó 
.
óó 
Status
óó 
=
óó 
$num
óó 
;
óó 
_unitOfWork
ôô 
.
ôô )
InstructorCommentRepository
ôô 3
.
ôô3 4
Update
ôô4 :
(
ôô: ;
comment
ôô; B
)
ôôB C
;
ôôC D
await
öö 
_unitOfWork
öö 
.
öö 
	SaveAsync
öö '
(
öö' (
)
öö( )
;
öö) *
return
úú 
new
úú 
ResponseDTO
úú "
(
úú" #
)
úú# $
{
ùù 
Message
ûû 
=
ûû 
$str
ûû 8
,
ûû8 9
	IsSuccess
üü 
=
üü 
true
üü  
,
üü  !

StatusCode
†† 
=
†† 
$num
††  
,
††  !
Result
°° 
=
°° 
comment
°°  
.
°°  !
Id
°°! #
,
°°# $
}
¢¢ 
;
¢¢ 
}
££ 	
catch
§§ 
(
§§ 
	Exception
§§ 
e
§§ 
)
§§ 
{
•• 	
return
¶¶ 
new
¶¶ 
ResponseDTO
¶¶ "
{
ßß 
Message
®® 
=
®® 
e
®® 
.
®® 
Message
®® #
,
®®# $
Result
©© 
=
©© 
null
©© 
,
©© 
	IsSuccess
™™ 
=
™™ 
false
™™ !
,
™™! "

StatusCode
´´ 
=
´´ 
$num
´´  
}
¨¨ 
;
¨¨ 
}
≠≠ 	
}
ÆÆ 
public
∞∞ 

async
∞∞ 
Task
∞∞ 
<
∞∞ 
ResponseDTO
∞∞ !
>
∞∞! "
ExportInstructors
∞∞# 4
(
∞∞4 5
string
∞∞5 ;
userId
∞∞< B
,
∞∞B C
int
∞∞D G
month
∞∞H M
,
∞∞M N
int
∞∞O R
year
∞∞S W
)
∞∞W X
{
±± 
var
≤≤ 
instructors
≤≤ 
=
≤≤ 
_unitOfWork
≤≤ %
.
≤≤% &"
InstructorRepository
≤≤& :
.
≤≤: ;
GetAllAsync
≤≤; F
(
≤≤F G
includeProperties
≤≤G X
:
≤≤X Y
$str
≤≤Z k
)
≤≤k l
.
≥≥ 

GetAwaiter
≥≥ 
(
≥≥ 
)
≥≥ 
.
≥≥ 
	GetResult
≥≥ #
(
≥≥# $
)
≥≥$ %
.
≥≥% &
ToList
≥≥& ,
(
≥≥, -
)
≥≥- .
;
≥≥. /
instructors
µµ 
=
µµ 
instructors
µµ !
.
µµ! "
Where
µµ" '
(
µµ' (
x
µµ( )
=>
µµ* ,
x
∂∂ 
.
∂∂ 
ApplicationUser
∂∂ !
.
∂∂! "

CreateTime
∂∂" ,
.
∂∂, -
Value
∂∂- 2
.
∂∂2 3
Month
∂∂3 8
==
∂∂9 ;
month
∂∂< A
&&
∂∂B D
x
∂∂E F
.
∂∂F G
ApplicationUser
∂∂G V
.
∂∂V W

CreateTime
∂∂W a
.
∂∂a b
Value
∂∂b g
.
∂∂g h
Year
∂∂h l
==
∂∂m o
year
∂∂p t
)
∂∂t u
.
∑∑ 
ToList
∑∑ 
(
∑∑ 
)
∑∑ 
;
∑∑ 
var
ππ  
instructorInfoDtos
ππ 
=
ππ  
_mapper
ππ! (
.
ππ( )
Map
ππ) ,
<
ππ, -
List
ππ- 1
<
ππ1 2
InstructorInfoDTO
ππ2 C
>
ππC D
>
ππD E
(
ππE F
instructors
ππF Q
)
ππQ R
;
ππR S
var
∫∫ 
fileName
∫∫ 
=
∫∫ 
await
∫∫ 
_closedXmlService
∫∫ .
.
∫∫. /#
ExportInstructorExcel
∫∫/ D
(
∫∫D E 
instructorInfoDtos
∫∫E W
)
∫∫W X
;
∫∫X Y
await
ΩΩ 
_notificationHub
ΩΩ 
.
ΩΩ 
Clients
ΩΩ &
.
ΩΩ& '
User
ΩΩ' +
(
ΩΩ+ ,
userId
ΩΩ, 2
)
ΩΩ2 3
.
ΩΩ3 4
	SendAsync
ΩΩ4 =
(
ΩΩ= >
$str
ΩΩ> P
,
ΩΩP Q
fileName
ΩΩR Z
)
ΩΩZ [
;
ΩΩ[ \
return
øø 
new
øø 
ResponseDTO
øø 
(
øø 
)
øø  
{
¿¿ 	
Message
¡¡ 
=
¡¡ 
$str
¡¡ "
,
¡¡" #
	IsSuccess
¬¬ 
=
¬¬ 
true
¬¬ 
,
¬¬ 

StatusCode
√√ 
=
√√ 
$num
√√ 
,
√√ 
Result
ƒƒ 
=
ƒƒ 
null
ƒƒ 
}
≈≈ 	
;
≈≈	 

}
∆∆ 
public
»» 

async
»» 
Task
»» 
<
»» "
ClosedXMLResponseDTO
»» *
>
»»* +!
DownloadInstructors
»», ?
(
»»? @
string
»»@ F
fileName
»»G O
)
»»O P
{
…… 
try
   
{
ÀÀ 	
string
ÃÃ 
filePath
ÃÃ 
=
ÃÃ 
Path
ÃÃ "
.
ÃÃ" #
Combine
ÃÃ# *
(
ÃÃ* +
_env
ÃÃ+ /
.
ÃÃ/ 0
ContentRootPath
ÃÃ0 ?
,
ÃÃ? @
_config
ÃÃA H
[
ÃÃH I
$str
ÃÃI k
]
ÃÃk l
,
ÃÃl m
fileName
ÃÃn v
)
ÃÃv w
;
ÃÃw x
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
File
ŒŒ 
.
ŒŒ 
Exists
ŒŒ 
(
ŒŒ 
filePath
ŒŒ %
)
ŒŒ% &
)
ŒŒ& '
{
œœ 
return
–– 
new
–– "
ClosedXMLResponseDTO
–– /
(
––/ 0
)
––0 1
{
—— 
Message
““ 
=
““ 
$str
““ 2
,
““2 3
	IsSuccess
”” 
=
”” 
false
””  %
,
””% &

StatusCode
‘‘ 
=
‘‘  
$num
‘‘! $
,
‘‘$ %
Stream
’’ 
=
’’ 
null
’’ !
,
’’! "
ContentType
÷÷ 
=
÷÷  !
null
÷÷" &
,
÷÷& '
FileName
◊◊ 
=
◊◊ 
null
◊◊ #
,
◊◊# $
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
var
‹‹ 
memory
‹‹ 
=
‹‹ 
new
‹‹ 
MemoryStream
‹‹ )
(
‹‹) *
)
‹‹* +
;
‹‹+ ,
using
›› 
(
›› 
var
›› 
stream
›› 
=
›› 
new
››  #

FileStream
››$ .
(
››. /
filePath
››/ 7
,
››7 8
FileMode
››9 A
.
››A B
Open
››B F
)
››F G
)
››G H
{
ﬁﬁ 
stream
ﬂﬂ 
.
ﬂﬂ 
CopyTo
ﬂﬂ 
(
ﬂﬂ 
memory
ﬂﬂ $
)
ﬂﬂ$ %
;
ﬂﬂ% &
}
‡‡ 
memory
‚‚ 
.
‚‚ 
Position
‚‚ 
=
‚‚ 
$num
‚‚ 
;
‚‚  
var
„„ 
contentType
„„ 
=
„„ 
$str
„„ a
;
„„a b
System
ÊÊ 
.
ÊÊ 
IO
ÊÊ 
.
ÊÊ 
File
ÊÊ 
.
ÊÊ 
Delete
ÊÊ !
(
ÊÊ! "
filePath
ÊÊ" *
)
ÊÊ* +
;
ÊÊ+ ,
return
ËË 
new
ËË "
ClosedXMLResponseDTO
ËË +
(
ËË+ ,
)
ËË, -
{
ÈÈ 
Stream
ÍÍ 
=
ÍÍ 
memory
ÍÍ 
,
ÍÍ  
ContentType
ÎÎ 
=
ÎÎ 
contentType
ÎÎ )
,
ÎÎ) *
FileName
ÏÏ 
=
ÏÏ 
fileName
ÏÏ #
,
ÏÏ# $

StatusCode
ÌÌ 
=
ÌÌ 
$num
ÌÌ  
,
ÌÌ  !
	IsSuccess
ÓÓ 
=
ÓÓ 
true
ÓÓ  
,
ÓÓ  !
Message
ÔÔ 
=
ÔÔ 
$str
ÔÔ 6
}
 
;
 
}
ÒÒ 	
catch
ÚÚ 
(
ÚÚ 
	Exception
ÚÚ 
e
ÚÚ 
)
ÚÚ 
{
ÛÛ 	
Console
ÙÙ 
.
ÙÙ 
	WriteLine
ÙÙ 
(
ÙÙ 
e
ÙÙ 
)
ÙÙ  
;
ÙÙ  !
throw
ıı 
;
ıı 
}
ˆˆ 	
}
˜˜ 
}¯¯ ‹k
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\FirebaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
FirebaseService 
: 
IFirebaseService /
{		 
private

 
readonly

 
StorageClient

 "
_storageClient

# 1
;

1 2
private 
readonly 
string 
_bucketName '
=( )
$str* J
;J K
public 

FirebaseService 
( 
StorageClient (
storageClient) 6
)6 7
{ 
_storageClient 
= 
storageClient &
;& '
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
UploadImage# .
(. /
	IFormFile/ 8
file9 =
,= >
string? E
folderF L
)L M
{ 
if 

( 
file 
is 
null 
|| 
file  
.  !
Length! '
==( *
$num+ ,
), -
{ 	
return 
new 
ResponseDTO "
(" #
)# $
{ 
	IsSuccess 
= 
false !
,! "

StatusCode 
= 
$num  
,  !
Message   
=   
$str   *
}!! 
;!! 
}"" 	
var$$ 
fileName$$ 
=$$ 
$"$$ 
{$$ 
Guid$$ 
.$$ 
NewGuid$$ &
($$& '
)$$' (
}$$( )
$str$$) *
{$$* +
file$$+ /
.$$/ 0
FileName$$0 8
}$$8 9
"$$9 :
;$$: ;
var&& 
filePath&& 
=&& 
$"&& 
{&& 
folder&&  
}&&  !
$str&&! "
{&&" #
fileName&&# +
}&&+ ,
"&&, -
;&&- .
string(( 
url(( 
;(( 
await** 
using** 
(** 
var** 
stream** 
=**  !
file**" &
.**& '
OpenReadStream**' 5
(**5 6
)**6 7
)**7 8
{++ 	
var,, 
result,, 
=,, 
await,, 
_storageClient,, -
.,,- .
UploadObjectAsync,,. ?
(,,? @
_bucketName,,@ K
,,,K L
filePath,,M U
,,,U V
null,,W [
,,,[ \
stream,,] c
),,c d
;,,d e
}-- 	
return// 
new// 
ResponseDTO// 
(// 
)//  
{00 	
	IsSuccess11 
=11 
true11 
,11 

StatusCode22 
=22 
$num22 
,22 
Result33 
=33 
filePath33 
,33 
Message44 
=44 
$str44 2
}55 	
;55	 

}66 
public>> 

async>> 
Task>> 
<>> 
ResponseDTO>> !
>>>! "
UploadVideo>># .
(>>. /
	IFormFile>>/ 8
file>>9 =
,>>= >
Guid>>? C
?>>C D
courseId>>E M
)>>M N
{?? 
if@@ 

(@@ 
file@@ 
is@@ 
null@@ 
||@@ 
file@@  
.@@  !
Length@@! '
==@@( *
$num@@+ ,
)@@, -
{AA 	
returnBB 
newBB 
ResponseDTOBB "
(BB" #
)BB# $
{CC 
	IsSuccessDD 
=DD 
falseDD !
,DD! "

StatusCodeEE 
=EE 
$numEE  
,EE  !
MessageFF 
=FF 
$strFF *
}GG 
;GG 
}HH 	
varJJ 
fileNameJJ 
=JJ 
$"JJ 
{JJ 
GuidJJ 
.JJ 
NewGuidJJ &
(JJ& '
)JJ' (
}JJ( )
$strJJ) *
{JJ* +
fileJJ+ /
.JJ/ 0
FileNameJJ0 8
}JJ8 9
"JJ9 :
;JJ: ;
varLL 
filePathLL 
=LL 
$"LL 
{LL 
$strLL "
}LL" #
$strLL# $
{LL$ %
courseIdLL% -
}LL- .
$strLL. /
{LL/ 0
$strLL0 8
}LL8 9
$strLL9 :
{LL: ;
fileNameLL; C
}LLC D
"LLD E
;LLE F
stringNN 
urlNN 
;NN 
awaitPP 
usingPP 
(PP 
varPP 
streamPP 
=PP  !
filePP" &
.PP& '
OpenReadStreamPP' 5
(PP5 6
)PP6 7
)PP7 8
{QQ 	
varRR 
resultRR 
=RR 
awaitRR 
_storageClientRR -
.RR- .
UploadObjectAsyncRR. ?
(RR? @
_bucketNameRR@ K
,RRK L
filePathRRM U
,RRU V
nullRRW [
,RR[ \
streamRR] c
)RRc d
;RRd e
}SS 	
returnUU 
newUU 
ResponseDTOUU 
(UU 
)UU  
{VV 	
	IsSuccessWW 
=WW 
trueWW 
,WW 

StatusCodeXX 
=XX 
$numXX 
,XX 
ResultYY 
=YY 
filePathYY 
,YY 
MessageZZ 
=ZZ 
$strZZ 2
}[[ 	
;[[	 

}\\ 
publicdd 

asyncdd 
Taskdd 
<dd 
ResponseDTOdd !
>dd! "
UploadSlidedd# .
(dd. /
	IFormFiledd/ 8
filedd9 =
,dd= >
Guiddd? C
?ddC D
courseIdddE M
)ddM N
{ee 
ifff 

(ff 
fileff 
isff 
nullff 
||ff 
fileff  
.ff  !
Lengthff! '
==ff( *
$numff+ ,
)ff, -
{gg 	
returnhh 
newhh 
ResponseDTOhh "
(hh" #
)hh# $
{ii 
	IsSuccessjj 
=jj 
falsejj !
,jj! "

StatusCodekk 
=kk 
$numkk  
,kk  !
Messagell 
=ll 
$strll *
}mm 
;mm 
}nn 	
varpp 
fileNamepp 
=pp 
$"pp 
{pp 
Guidpp 
.pp 
NewGuidpp &
(pp& '
)pp' (
}pp( )
$strpp) *
{pp* +
filepp+ /
.pp/ 0
FileNamepp0 8
}pp8 9
"pp9 :
;pp: ;
varrr 
filePathrr 
=rr 
$"rr 
{rr 
$strrr "
}rr" #
$strrr# $
{rr$ %
courseIdrr% -
}rr- .
$strrr. /
{rr/ 0
$strrr0 8
}rr8 9
$strrr9 :
{rr: ;
fileNamerr; C
}rrC D
"rrD E
;rrE F
stringtt 
urltt 
;tt 
awaitvv 
usingvv 
(vv 
varvv 
streamvv 
=vv  !
filevv" &
.vv& '
OpenReadStreamvv' 5
(vv5 6
)vv6 7
)vv7 8
{ww 	
varxx 
resultxx 
=xx 
awaitxx 
_storageClientxx -
.xx- .
UploadObjectAsyncxx. ?
(xx? @
_bucketNamexx@ K
,xxK L
filePathxxM U
,xxU V
nullxxW [
,xx[ \
streamxx] c
)xxc d
;xxd e
}yy 	
return{{ 
new{{ 
ResponseDTO{{ 
({{ 
){{  
{|| 	
	IsSuccess}} 
=}} 
true}} 
,}} 

StatusCode~~ 
=~~ 
$num~~ 
,~~ 
Result 
= 
filePath 
, 
Message
ÄÄ 
=
ÄÄ 
$str
ÄÄ 2
}
ÅÅ 	
;
ÅÅ	 

}
ÇÇ 
public
ää 

async
ää 
Task
ää 
<
ää 
ResponseDTO
ää !
>
ää! "
	UploadDoc
ää# ,
(
ää, -
	IFormFile
ää- 6
file
ää7 ;
,
ää; <
Guid
ää= A
?
ääA B
courseId
ääC K
)
ääK L
{
ãã 
if
åå 

(
åå 
file
åå 
is
åå 
null
åå 
||
åå 
file
åå  
.
åå  !
Length
åå! '
==
åå( *
$num
åå+ ,
)
åå, -
{
çç 	
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
	IsSuccess
êê 
=
êê 
false
êê !
,
êê! "

StatusCode
ëë 
=
ëë 
$num
ëë  
,
ëë  !
Message
íí 
=
íí 
$str
íí *
}
ìì 
;
ìì 
}
îî 	
var
ññ 
fileName
ññ 
=
ññ 
$"
ññ 
{
ññ 
Guid
ññ 
.
ññ 
NewGuid
ññ &
(
ññ& '
)
ññ' (
}
ññ( )
$str
ññ) *
{
ññ* +
file
ññ+ /
.
ññ/ 0
FileName
ññ0 8
}
ññ8 9
"
ññ9 :
;
ññ: ;
var
òò 
filePath
òò 
=
òò 
$"
òò 
{
òò 
$str
òò "
}
òò" #
$str
òò# $
{
òò$ %
courseId
òò% -
}
òò- .
$str
òò. /
{
òò/ 0
$str
òò0 6
}
òò6 7
$str
òò7 8
{
òò8 9
fileName
òò9 A
}
òòA B
"
òòB C
;
òòC D
string
öö 
url
öö 
;
öö 
await
úú 
using
úú 
(
úú 
var
úú 
stream
úú 
=
úú  !
file
úú" &
.
úú& '
OpenReadStream
úú' 5
(
úú5 6
)
úú6 7
)
úú7 8
{
ùù 	
var
ûû 
result
ûû 
=
ûû 
await
ûû 
_storageClient
ûû -
.
ûû- .
UploadObjectAsync
ûû. ?
(
ûû? @
_bucketName
ûû@ K
,
ûûK L
filePath
ûûM U
,
ûûU V
null
ûûW [
,
ûû[ \
stream
ûû] c
)
ûûc d
;
ûûd e
}
üü 	
return
°° 
new
°° 
ResponseDTO
°° 
(
°° 
)
°°  
{
¢¢ 	
	IsSuccess
££ 
=
££ 
true
££ 
,
££ 

StatusCode
§§ 
=
§§ 
$num
§§ 
,
§§ 
Result
•• 
=
•• 
filePath
•• 
,
•• 
Message
¶¶ 
=
¶¶ 
$str
¶¶ 0
}
ßß 	
;
ßß	 

}
®® 
public
™™ 

async
™™ 
Task
™™ 
<
™™ 
MemoryStream
™™ "
>
™™" #

GetContent
™™$ .
(
™™. /
string
™™/ 5
?
™™5 6
filePath
™™7 ?
)
™™? @
{
´´ 
try
¨¨ 
{
≠≠ 	
MemoryStream
ÆÆ 
memoryStream
ÆÆ %
=
ÆÆ& '
new
ÆÆ( +
MemoryStream
ÆÆ, 8
(
ÆÆ8 9
)
ÆÆ9 :
;
ÆÆ: ;
await
∞∞ 
_storageClient
∞∞  
.
∞∞  !!
DownloadObjectAsync
∞∞! 4
(
∞∞4 5
_bucketName
∞∞5 @
,
∞∞@ A
filePath
∞∞B J
,
∞∞J K
memoryStream
∞∞L X
)
∞∞X Y
;
∞∞Y Z
memoryStream
≤≤ 
.
≤≤ 
Seek
≤≤ 
(
≤≤ 
$num
≤≤ 
,
≤≤  

SeekOrigin
≤≤! +
.
≤≤+ ,
Begin
≤≤, 1
)
≤≤1 2
;
≤≤2 3
return
¥¥ 
memoryStream
¥¥ 
;
¥¥  
}
µµ 	
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
e
∂∂ 
)
∂∂ 
{
∑∑ 	
return
∏∏ 
null
∏∏ 
;
∏∏ 
}
ππ 	
}
∫∫ 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
MemoryStream
¡¡ "
>
¡¡" #
GetImage
¡¡$ ,
(
¡¡, -
string
¡¡- 3
filePath
¡¡4 <
)
¡¡< =
{
¬¬ 
try
√√ 
{
ƒƒ 	
MemoryStream
≈≈ 
memoryStream
≈≈ %
=
≈≈& '
new
≈≈( +
MemoryStream
≈≈, 8
(
≈≈8 9
)
≈≈9 :
;
≈≈: ;
await
«« 
_storageClient
««  
.
««  !!
DownloadObjectAsync
««! 4
(
««4 5
_bucketName
««5 @
,
««@ A
filePath
««B J
,
««J K
memoryStream
««L X
)
««X Y
;
««Y Z
memoryStream
…… 
.
…… 
Seek
…… 
(
…… 
$num
…… 
,
……  

SeekOrigin
……! +
.
……+ ,
Begin
……, 1
)
……1 2
;
……2 3
return
ÀÀ 
memoryStream
ÀÀ 
;
ÀÀ  
}
ÃÃ 	
catch
ÕÕ 
(
ÕÕ 
	Exception
ÕÕ 
e
ÕÕ 
)
ÕÕ 
{
ŒŒ 	
return
œœ 
null
œœ 
;
œœ 
}
–– 	
}
—— 
}““ â4
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailTemplate.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Models #
{ 
public 

class 
EmailTemplate 
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
string 
TemplateName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

SenderName  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
SenderEmail !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Category 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
SubjectLine !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
PreHeaderText #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
PersonalizationTags )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 
BodyContent !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
FooterContent #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
CallToAction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Language 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
RecipientType #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
CreateBy 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

CreateTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
UpdateBy 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

UpdateTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Status 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 

BuildEmail  
(  !
string! '
recipientName( 5
,5 6
string7 =
confirmationLink> N
=O P
$strQ S
,S T
stringU [
token\ a
=b c
$strd f
)f g
{ 	
string 
	emailBody 
= 
BodyContent *
;* +
if!! 
(!! 
!!! 
string!! 
.!! 
IsNullOrEmpty!! %
(!!% &
confirmationLink!!& 6
)!!6 7
)!!7 8
{"" 
	emailBody## 
=## 
	emailBody## %
.##% &
Replace##& -
(##- .
$str##. B
,##B C
confirmationLink##D T
)##T U
;##U V
}$$ 
if&& 
(&& 
!&& 
string&& 
.&& 
IsNullOrEmpty&& %
(&&% &
token&&& +
)&&+ ,
)&&, -
{'' 
	emailBody(( 
=(( 
	emailBody(( %
.((% &
Replace((& -
(((- .
$str((. 7
,((7 8
token((9 >
)((> ?
;((? @
})) 
	emailBody++ 
=++ 
	emailBody++ !
.++! "
Replace++" )
(++) *
$str++* ;
,++; <
recipientName++= J
)++J K
;++K L
string-- 
	fullEmail-- 
=-- 
$@"-- "
$str-0" 
{00 
TemplateName00 !
}00! "
$str01" 
{11 
PreHeaderText11 !
}11! "
$str12" 
{22 
	emailBody22 
}22 
$str23 
{33 
FooterContent33 !
}33! "
$str34" 
{44 
CallToAction44 )
}44) *
$str46* 
"66 
;66 
return88 
	fullEmail88 
;88 
}99 	
}:: 
public<< 

class<< #
EmailTemplateRepository<< (
{== 
private>> 
readonly>> 
string>> 
_connectionString>>  1
;>>1 2
public@@ #
EmailTemplateRepository@@ &
(@@& '
string@@' -
connectionString@@. >
)@@> ?
{AA 	
_connectionStringBB 
=BB 
connectionStringBB  0
;BB0 1
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
EmailTemplateEE '
>EE' ('
GetEmailTemplateByNameAsyncEE) D
(EED E
stringEEE K
templateNameEEL X
)EEX Y
{FF 	
usingGG 
(GG 
varGG 

connectionGG !
=GG" #
newGG$ '
SqlConnectionGG( 5
(GG5 6
_connectionStringGG6 G
)GGG H
)GGH I
{HH 
varII 
queryII 
=II 
$strIK A
;KKA B
returnLL 
awaitLL 

connectionLL '
.LL' (%
QuerySingleOrDefaultAsyncLL( A
<LLA B
EmailTemplateLLB O
>LLO P
(LLP Q
queryLLQ V
,LLV W
newMM 
{MM 
TemplateNameMM &
=MM' (
templateNameMM) 5
}MM6 7
)MM7 8
;MM8 9
}NN 
}OO 	
}PP 
}QQ Œì
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
EmailService 
: 
IEmailService )
{ 
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

EmailService 
( 
IConfiguration &
configuration' 4
,4 5
IUnitOfWork6 A

unitOfWorkB L
,L M
IMapperN U
mapperV \
,\ ]
UserManager^ i
<i j
ApplicationUserj y
>y z
userManager	{ Ü
)
Ü á
{ 
_userManager 
= 
userManager "
;" #
_configuration 
= 
configuration &
;& '
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetAll# )
() *
ClaimsPrincipal 
User 
, 
string   
?   
filterOn   
,   
string!! 
?!! 
filterQuery!! 
,!! 
string"" 
?"" 
sortBy"" 
,"" 
bool## 
?## 
isAscending## 
,## 
int$$ 

pageNumber$$ 
,$$ 
int%% 
pageSize%% 
)%% 
{&& 
try)) 
{** 	
List++ 
<++ 
EmailTemplate++ 
>++ 
emailTemplates++  .
=++/ 0
new++1 4
List++5 9
<++9 :
EmailTemplate++: G
>++G H
(++H I
)++I J
;++J K
if.. 
(.. 
!.. 
string.. 
... 
IsNullOrEmpty.. %
(..% &
filterOn..& .
)... /
&&..0 2
!..3 4
string..4 :
...: ;
IsNullOrEmpty..; H
(..H I
filterQuery..I T
)..T U
)..U V
{// 
switch00 
(00 
filterOn00  
.00  !
Trim00! %
(00% &
)00& '
.00' (
ToLower00( /
(00/ 0
)000 1
)001 2
{11 
case22 
$str22 '
:22' (
{33 
emailTemplates44 &
=44' (
_unitOfWork44) 4
.444 5#
EmailTemplateRepository445 L
.44L M
GetAllAsync44M X
(44X Y
)44Y Z
.55 

GetAwaiter55 '
(55' (
)55( )
.55) *
	GetResult55* 3
(553 4
)554 5
.555 6
Where556 ;
(55; <
x55< =
=>55> @
x55A B
.55B C
TemplateName55C O
.55O P
Contains55P X
(55X Y
filterQuery55Y d
,55d e
StringComparison55f v
.55v w%
CurrentCultureIgnoreCase	55w è
)
55è ê
)
55ê ë
.
55ë í
ToList
55í ò
(
55ò ô
)
55ô ö
;
55ö õ
break66 
;66 
}77 
default99 
:99 
{:: 
emailTemplates;; &
=;;' (
_unitOfWork;;) 4
.;;4 5#
EmailTemplateRepository;;5 L
.;;L M
GetAllAsync;;M X
(;;X Y
);;Y Z
.<< 

GetAwaiter<< '
(<<' (
)<<( )
.<<) *
	GetResult<<* 3
(<<3 4
)<<4 5
.<<5 6
ToList<<6 <
(<<< =
)<<= >
;<<> ?
break== 
;== 
}>> 
}?? 
}@@ 
elseAA 
{BB 
emailTemplatesCC 
=CC  
_unitOfWorkCC! ,
.CC, -#
EmailTemplateRepositoryCC- D
.CCD E
GetAllAsyncCCE P
(CCP Q
)CCQ R
.DD 

GetAwaiterDD 
(DD  
)DD  !
.DD! "
	GetResultDD" +
(DD+ ,
)DD, -
.DD- .
ToListDD. 4
(DD4 5
)DD5 6
;DD6 7
}EE 
ifHH 
(HH 
!HH 
stringHH 
.HH 
IsNullOrEmptyHH %
(HH% &
sortByHH& ,
)HH, -
)HH- .
{II 
switchJJ 
(JJ 
sortByJJ 
.JJ 
TrimJJ #
(JJ# $
)JJ$ %
.JJ% &
ToLowerJJ& -
(JJ- .
)JJ. /
)JJ/ 0
{KK 
caseLL 
$strLL '
:LL' (
{MM 
emailTemplatesNN &
=NN' (
isAscendingNN) 4
==NN5 7
trueNN8 <
?OO 
[OO 
..OO !
emailTemplatesOO" 0
.OO0 1
OrderByOO1 8
(OO8 9
xOO9 :
=>OO; =
xOO> ?
.OO? @
TemplateNameOO@ L
)OOL M
]OOM N
:PP 
[PP 
..PP !
emailTemplatesPP" 0
.PP0 1
OrderByDescendingPP1 B
(PPB C
xPPC D
=>PPE G
xPPH I
.PPI J
TemplateNamePPJ V
)PPV W
]PPW X
;PPX Y
breakQQ 
;QQ 
}RR 
caseSS 
$strSS %
:SS% &
{TT 
emailTemplatesUU &
=UU' (
isAscendingUU) 4
==UU5 7
trueUU8 <
?VV 
[VV 
..VV !
emailTemplatesVV" 0
.VV0 1
OrderByVV1 8
(VV8 9
xVV9 :
=>VV; =
xVV> ?
.VV? @

SenderNameVV@ J
)VVJ K
]VVK L
:WW 
[WW 
..WW !
emailTemplatesWW" 0
.WW0 1
OrderByDescendingWW1 B
(WWB C
xWWC D
=>WWE G
xWWH I
.WWI J

SenderNameWWJ T
)WWT U
]WWU V
;WWV W
breakXX 
;XX 
}YY 
caseZZ 
$strZZ &
:ZZ& '
{[[ 
emailTemplates\\ &
=\\' (
isAscending\\) 4
==\\5 7
true\\8 <
?]] 
[]] 
..]] !
emailTemplates]]" 0
.]]0 1
OrderBy]]1 8
(]]8 9
x]]9 :
=>]]; =
x]]> ?
.]]? @
SenderEmail]]@ K
)]]K L
]]]L M
:^^ 
[^^ 
..^^ !
emailTemplates^^" 0
.^^0 1
OrderByDescending^^1 B
(^^B C
x^^C D
=>^^E G
x^^H I
.^^I J
SenderEmail^^J U
)^^U V
]^^V W
;^^W X
break__ 
;__ 
}`` 
caseaa 
$straa #
:aa# $
{bb 
emailTemplatescc &
=cc' (
isAscendingcc) 4
==cc5 7
truecc8 <
?dd 
[dd 
..dd !
emailTemplatesdd" 0
.dd0 1
OrderBydd1 8
(dd8 9
xdd9 :
=>dd; =
xdd> ?
.dd? @
Categorydd@ H
)ddH I
]ddI J
:ee 
[ee 
..ee !
emailTemplatesee" 0
.ee0 1
OrderByDescendingee1 B
(eeB C
xeeC D
=>eeE G
xeeH I
.eeI J
CategoryeeJ R
)eeR S
]eeS T
;eeT U
breakff 
;ff 
}gg 
defaulthh 
:hh 
{ii 
breakjj 
;jj 
}kk 
}ll 
}mm 
ifpp 
(pp 

pageNumberpp 
>pp 
$numpp 
&&pp !
pageSizepp" *
>pp+ ,
$numpp- .
)pp. /
{qq 
varrr 

skipResultrr 
=rr  
(rr! "

pageNumberrr" ,
-rr- .
$numrr/ 0
)rr0 1
*rr2 3
pageSizerr4 <
;rr< =
emailTemplatesss 
=ss  
emailTemplatesss! /
.ss/ 0
Skipss0 4
(ss4 5

skipResultss5 ?
)ss? @
.ss@ A
TakessA E
(ssE F
pageSizessF N
)ssN O
.ssO P
ToListssP V
(ssV W
)ssW X
;ssX Y
}tt 
ifxx 
(xx 
emailTemplatesxx 
.xx 
IsNullOrEmptyxx ,
(xx, -
)xx- .
)xx. /
{yy 
returnzz 
newzz 
ResponseDTOzz &
(zz& '
)zz' (
{{{ 
Message|| 
=|| 
$str|| ;
,||; <
Result}} 
=}} 
null}} !
,}}! "
	IsSuccess~~ 
=~~ 
false~~  %
,~~% &

StatusCode 
=  
$num! $
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ #
instructorInfoLiteDto
ÉÉ %
=
ÉÉ& '
_mapper
ÉÉ( /
.
ÉÉ/ 0
Map
ÉÉ0 3
<
ÉÉ3 4
List
ÉÉ4 8
<
ÉÉ8 9
EmailTemplate
ÉÉ9 F
>
ÉÉF G
>
ÉÉG H
(
ÉÉH I
emailTemplates
ÉÉI W
)
ÉÉW X
;
ÉÉX Y
return
ÖÖ 
new
ÖÖ 
ResponseDTO
ÖÖ "
(
ÖÖ" #
)
ÖÖ# $
{
ÜÜ 
Message
áá 
=
áá 
$str
áá ?
,
áá? @
Result
àà 
=
àà #
instructorInfoLiteDto
àà .
,
àà. /
	IsSuccess
ââ 
=
ââ 
true
ââ  
,
ââ  !

StatusCode
ää 
=
ää 
$num
ää  
}
ãã 
;
ãã 
}
åå 	
catch
çç 
(
çç 
	Exception
çç 
e
çç 
)
çç 
{
éé 	
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Message
ëë 
=
ëë 
e
ëë 
.
ëë 
Message
ëë #
,
ëë# $
Result
íí 
=
íí 
null
íí 
,
íí 
	IsSuccess
ìì 
=
ìì 
false
ìì !
,
ìì! "

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
}
óó 
private
†† 
async
†† 
Task
†† 
<
†† 
bool
†† 
>
†† #
SendEmailFromTemplate
†† 2
(
††2 3
string
††3 9
toMail
††: @
,
††@ A
string
††B H
templateName
††I U
,
††U V
string
††W ]
replacementValue
††^ n
)
††n o
{
°° 
var
££ 
template
££ 
=
££ 
await
££ 
_unitOfWork
££ (
.
££( )%
EmailTemplateRepository
££) @
.
££@ A
GetAsync
££A I
(
££I J
t
££J K
=>
££L N
t
££O P
.
££P Q
TemplateName
££Q ]
==
££^ `
templateName
££a m
)
££m n
;
££n o
if
•• 

(
•• 
template
•• 
==
•• 
null
•• 
)
•• 
{
¶¶ 	
throw
®® 
new
®® 
	Exception
®® 
(
®®  
$str
®®  :
)
®®: ;
;
®®; <
}
©© 	
string
¨¨ 
subject
¨¨ 
=
¨¨ 
template
¨¨ !
.
¨¨! "
SubjectLine
¨¨" -
;
¨¨- .
string
≠≠ 
body
≠≠ 
=
≠≠ 
$@"
≠≠ 
$str
≠∞ 
{
∞∞ 
template
∞∞ 
.
∞∞ 
SubjectLine
∞∞ )
}
∞∞) *
$str
∞±* 
{
±± 
template
±± 
.
±± 
PreHeaderText
±± +
}
±±+ ,
$str
±≤, 
{
≤≤ 
template
≤≤ 
.
≤≤ 
BodyContent
≤≤ (
}
≤≤( )
$str
≤≥) 
{
≥≥ 
replacementValue
≥≥ -
}
≥≥- .
$str≥≥. å
{≥≥å ç
template≥≥ç ï
.≥≥ï ñ
CallToAction≥≥ñ ¢
.≥≥¢ £
Replace≥≥£ ™
(≥≥™ ´
$str≥≥´ ¥
,≥≥¥ µ 
replacementValue≥≥∂ ∆
)≥≥∆ «
}≥≥« »
$str≥¥» 
{
¥¥ 
template
¥¥ 
.
¥¥ 
FooterContent
¥¥ '
}
¥¥' (
$str
¥∂( 
"
∂∂ 
;
∂∂ 
return
∏∏ 
await
∏∏ 
SendEmailAsync
∏∏ #
(
∏∏# $
toMail
∏∏$ *
,
∏∏* +
subject
∏∏, 3
,
∏∏3 4
body
∏∏5 9
)
∏∏9 :
;
∏∏: ;
}
ππ 
private
ªª 
async
ªª 
Task
ªª 
<
ªª 
bool
ªª 
>
ªª -
SendEmailInactiveCourseTemplate
ªª <
(
ªª< =
string
ªª= C
studentEmail
ªªD P
,
ªªP Q
string
ªªR X
templateName
ªªY e
,
ªªe f
string
ªªg m
instructorEmail
ªªn }
,
ªª} ~
stringªª Ö
instructorNameªªÜ î
,ªªî ï
stringªªñ ú
courseTitleªªù ®
)ªª® ©
{
ºº 
var
ΩΩ 
template
ΩΩ 
=
ΩΩ 
await
ΩΩ 
_unitOfWork
ΩΩ (
.
ΩΩ( )%
EmailTemplateRepository
ΩΩ) @
.
ΩΩ@ A
GetAsync
ΩΩA I
(
ΩΩI J
t
ΩΩJ K
=>
ΩΩL N
t
ΩΩO P
.
ΩΩP Q
TemplateName
ΩΩQ ]
==
ΩΩ^ `
templateName
ΩΩa m
)
ΩΩm n
;
ΩΩn o
if
øø 

(
øø 
template
øø 
==
øø 
null
øø 
)
øø 
{
¿¿ 	
throw
¡¡ 
new
¡¡ 
	Exception
¡¡ 
(
¡¡  
$str
¡¡  :
)
¡¡: ;
;
¡¡; <
}
¬¬ 	
string
ƒƒ 
subject
ƒƒ 
=
ƒƒ 
template
ƒƒ !
.
ƒƒ! "
SubjectLine
ƒƒ" -
;
ƒƒ- .
string
≈≈ 
body
≈≈ 
=
≈≈ 
$@"
≈≈ 
$str
≈» 
{
»» 
template
»» 
.
»» 
SubjectLine
»» )
}
»») *
$str
»…* 
{
…… 
template
…… 
.
…… 
PreHeaderText
…… +
}
……+ ,
$str
… , 
{
   
template
   
.
   
BodyContent
   (
.
  ( )
Replace
  ) 0
(
  0 1
$str
  1 @
,
  @ A
courseTitle
  B M
)
  M N
.
  N O
Replace
  O V
(
  V W
$str
  W g
,
  g h
instructorName
  i w
)
  w x
}
  x y
$str
 Ày 
{
ÀÀ 
template
ÀÀ 
.
ÀÀ 
FooterContent
ÀÀ '
}
ÀÀ' (
$str
ÀÕ( 
"
ÕÕ 
;
ÕÕ 
return
œœ 
await
œœ *
SendEmailInactiveCourseAsync
œœ 1
(
œœ1 2
instructorEmail
œœ2 A
,
œœA B
studentEmail
œœC O
,
œœO P
subject
œœQ X
,
œœX Y
body
œœZ ^
)
œœ^ _
;
œœ_ `
}
–– 
public
““ 

async
““ 
Task
““ 
<
““ 
bool
““ 
>
““ 
SendEmailAsync
““ *
(
““* +
string
““+ 1
toEmail
““2 9
,
““9 :
string
““; A
subject
““B I
,
““I J
string
““K Q
body
““R V
)
““V W
{
”” 
try
’’ 
{
÷÷ 	
var
◊◊ 
	fromEmail
◊◊ 
=
◊◊ 
_configuration
◊◊ *
[
◊◊* +
$str
◊◊+ D
]
◊◊D E
;
◊◊E F
var
ÿÿ 
fromPassword
ÿÿ 
=
ÿÿ 
_configuration
ÿÿ -
[
ÿÿ- .
$str
ÿÿ. J
]
ÿÿJ K
;
ÿÿK L
var
ŸŸ 
smtpHost
ŸŸ 
=
ŸŸ 
_configuration
ŸŸ )
[
ŸŸ) *
$str
ŸŸ* B
]
ŸŸB C
;
ŸŸC D
var
⁄⁄ 
smtpPort
⁄⁄ 
=
⁄⁄ 
int
⁄⁄ 
.
⁄⁄ 
Parse
⁄⁄ $
(
⁄⁄$ %
_configuration
⁄⁄% 3
[
⁄⁄3 4
$str
⁄⁄4 L
]
⁄⁄L M
)
⁄⁄M N
;
⁄⁄N O
var
›› 
message
›› 
=
›› 
new
›› 
MailMessage
›› )
(
››) *
	fromEmail
››* 3
,
››3 4
toEmail
››5 <
,
››< =
subject
››> E
,
››E F
body
››G K
)
››K L
;
››L M
message
ﬁﬁ 
.
ﬁﬁ 

IsBodyHtml
ﬁﬁ 
=
ﬁﬁ  
true
ﬁﬁ! %
;
ﬁﬁ% &
using
·· 
var
·· 

smtpClient
··  
=
··! "
new
··# &

SmtpClient
··' 1
(
··1 2
smtpHost
··2 :
,
··: ;
smtpPort
··< D
)
··D E
{
‚‚ 
Credentials
„„ 
=
„„ 
new
„„ !
NetworkCredential
„„" 3
(
„„3 4
	fromEmail
„„4 =
,
„„= >
fromPassword
„„? K
)
„„K L
,
„„L M
	EnableSsl
‰‰ 
=
‰‰ 
true
‰‰  
}
ÂÂ 
;
ÂÂ 
await
ÊÊ 

smtpClient
ÊÊ 
.
ÊÊ 
SendMailAsync
ÊÊ *
(
ÊÊ* +
message
ÊÊ+ 2
)
ÊÊ2 3
;
ÊÊ3 4
return
ÁÁ 
true
ÁÁ 
;
ÁÁ 
}
ËË 	
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
return
ÎÎ 
false
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
}
ÌÌ 
public
ÒÒ 

async
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
bool
ÒÒ 
>
ÒÒ *
SendEmailInactiveCourseAsync
ÒÒ 8
(
ÒÒ8 9
string
ÒÒ9 ?
instructorEmail
ÒÒ@ O
,
ÒÒO P
string
ÒÒQ W
studentEmail
ÒÒX d
,
ÒÒd e
string
ÒÒf l
subject
ÒÒm t
,
ÒÒt u
string
ÒÒv |
bodyÒÒ} Å
)ÒÒÅ Ç
{
ÚÚ 
try
ÛÛ 
{
ÙÙ 	
var
ıı 
fromPassword
ıı 
=
ıı 
_configuration
ıı -
[
ıı- .
$str
ıı. J
]
ııJ K
;
ııK L
var
ˆˆ 
smtpHost
ˆˆ 
=
ˆˆ 
_configuration
ˆˆ )
[
ˆˆ) *
$str
ˆˆ* B
]
ˆˆB C
;
ˆˆC D
var
˜˜ 
smtpPort
˜˜ 
=
˜˜ 
int
˜˜ 
.
˜˜ 
Parse
˜˜ $
(
˜˜$ %
_configuration
˜˜% 3
[
˜˜3 4
$str
˜˜4 L
]
˜˜L M
)
˜˜M N
;
˜˜N O
var
˘˘ 
message
˘˘ 
=
˘˘ 
new
˘˘ 
MailMessage
˘˘ )
(
˘˘) *
instructorEmail
˘˘* 9
,
˘˘9 :
studentEmail
˘˘; G
,
˘˘G H
subject
˘˘I P
,
˘˘P Q
body
˘˘R V
)
˘˘V W
;
˘˘W X
message
˙˙ 
.
˙˙ 

IsBodyHtml
˙˙ 
=
˙˙  
true
˙˙! %
;
˙˙% &
using
¸¸ 
var
¸¸ 

smtpClient
¸¸  
=
¸¸! "
new
¸¸# &

SmtpClient
¸¸' 1
(
¸¸1 2
smtpHost
¸¸2 :
,
¸¸: ;
smtpPort
¸¸< D
)
¸¸D E
{
˝˝ 
Credentials
˛˛ 
=
˛˛ 
new
˛˛ !
NetworkCredential
˛˛" 3
(
˛˛3 4
instructorEmail
˛˛4 C
,
˛˛C D
fromPassword
˛˛E Q
)
˛˛Q R
,
˛˛R S
	EnableSsl
ˇˇ 
=
ˇˇ 
true
ˇˇ  
}
ÄÄ 
;
ÄÄ 
await
ÅÅ 

smtpClient
ÅÅ 
.
ÅÅ 
SendMailAsync
ÅÅ *
(
ÅÅ* +
message
ÅÅ+ 2
)
ÅÅ2 3
;
ÅÅ3 4
return
ÇÇ 
true
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
return
ÜÜ 
false
ÜÜ 
;
ÜÜ 
}
áá 	
}
àà 
public
ää 

async
ää 
Task
ää 
<
ää 
bool
ää 
>
ää !
SendEmailResetAsync
ää /
(
ää/ 0
string
ää0 6
toEmail
ää7 >
,
ää> ?
string
ää@ F
subject
ääG N
,
ääN O
ApplicationUser
ääP _
user
ää` d
,
ääd e
string
ãã 
currentDate
ãã 
,
ãã 
string
ãã "
	resetLink
ãã# ,
,
ãã, -
string
åå 
operatingSystem
åå 
,
åå 
string
åå  &
browser
åå' .
,
åå. /
string
åå0 6
ip
åå7 9
,
åå9 :
string
åå; A
region
ååB H
,
ååH I
string
ååJ P
city
ååQ U
,
ååU V
string
ååW ]
country
åå^ e
)
ååe f
{
çç 
try
èè 
{
êê 	
var
ëë 
	fromEmail
ëë 
=
ëë 
_configuration
ëë *
[
ëë* +
$str
ëë+ D
]
ëëD E
;
ëëE F
var
íí 
fromPassword
íí 
=
íí 
_configuration
íí -
[
íí- .
$str
íí. J
]
ííJ K
;
ííK L
var
ìì 
smtpHost
ìì 
=
ìì 
_configuration
ìì )
[
ìì) *
$str
ìì* B
]
ììB C
;
ììC D
var
îî 
smtpPort
îî 
=
îî 
int
îî 
.
îî 
Parse
îî $
(
îî$ %
_configuration
îî% 3
[
îî3 4
$str
îî4 L
]
îîL M
)
îîM N
;
îîN O
var
ññ 
body
ññ 
=
ññ 
$@"
ññ 
$str
ñö ;
{
öö; <
currentDate
öö< G
}
ööG H
$str
ö¨H D
{
¨¨D E
user
¨¨E I
.
¨¨I J
FullName
¨¨J R
}
¨¨R S
$str¨¨S √
{¨¨√ ƒ
user¨¨ƒ »
.¨¨» …
UserName¨¨… —
}¨¨— “
$str¨Ø“ 
{
ØØ 
	resetLink
ØØ $
}
ØØ$ %
$strØ¥% ò
{¥¥ò ô
operatingSystem¥¥ô ®
}¥¥® ©
$str¥¥© Ó
{¥¥Ó Ô
browser¥¥Ô ˆ
}¥¥ˆ ˜
$str¥¥˜ ¬
{¥¥¬ √
ip¥¥√ ≈
}¥¥≈ ∆
$str¥¥∆ ä
{¥¥ä ã
region¥¥ã ë
}¥¥ë í
$str¥¥í À
{¥¥À Ã
city¥¥Ã –
}¥¥– —
$str¥¥— ä
{¥¥ä ã
country¥¥ã í
}¥¥í ì
$str¥‰ì 
"
‰‰ 
;
‰‰ 
var
ÁÁ 
message
ÁÁ 
=
ÁÁ 
new
ÁÁ 
MailMessage
ÁÁ )
(
ÁÁ) *
	fromEmail
ÁÁ* 3
,
ÁÁ3 4
toEmail
ÁÁ5 <
,
ÁÁ< =
subject
ÁÁ> E
,
ÁÁE F
body
ÁÁG K
)
ÁÁK L
;
ÁÁL M
message
ËË 
.
ËË 

IsBodyHtml
ËË 
=
ËË  
true
ËË! %
;
ËË% &
using
ÎÎ 
var
ÎÎ 

smtpClient
ÎÎ  
=
ÎÎ! "
new
ÎÎ# &

SmtpClient
ÎÎ' 1
(
ÎÎ1 2
smtpHost
ÎÎ2 :
,
ÎÎ: ;
smtpPort
ÎÎ< D
)
ÎÎD E
{
ÏÏ 
Credentials
ÌÌ 
=
ÌÌ 
new
ÌÌ !
NetworkCredential
ÌÌ" 3
(
ÌÌ3 4
	fromEmail
ÌÌ4 =
,
ÌÌ= >
fromPassword
ÌÌ? K
)
ÌÌK L
,
ÌÌL M
	EnableSsl
ÓÓ 
=
ÓÓ 
true
ÓÓ  
}
ÔÔ 
;
ÔÔ 
await
 

smtpClient
 
.
 
SendMailAsync
 *
(
* +
message
+ 2
)
2 3
;
3 4
return
ÒÒ 
true
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 	
return
ıı 
false
ıı 
;
ıı 
}
ˆˆ 	
}
˜˜ 
public
ˇˇ 

async
ˇˇ 
Task
ˇˇ 
<
ˇˇ 
bool
ˇˇ 
>
ˇˇ 
SendVerifyEmail
ˇˇ +
(
ˇˇ+ ,
string
ˇˇ, 2
toMail
ˇˇ3 9
,
ˇˇ9 :
string
ˇˇ; A
confirmationLink
ˇˇB R
)
ˇˇR S
{
ÄÄ 
return
ÅÅ 
await
ÅÅ #
SendEmailFromTemplate
ÅÅ *
(
ÅÅ* +
toMail
ÅÅ+ 1
,
ÅÅ1 2
$str
ÅÅ3 D
,
ÅÅD E
confirmationLink
ÅÅF V
)
ÅÅV W
;
ÅÅW X
}
ÇÇ 
public
ää 

async
ää 
Task
ää 
<
ää 
bool
ää 
>
ää ,
SendEmailForInstructorApproval
ää :
(
ää: ;
string
ää; A
toMail
ääB H
,
ääH I
string
ääJ P
token
ääQ V
)
ääV W
{
ãã 
return
åå 
await
åå #
SendEmailFromTemplate
åå *
(
åå* +
toMail
åå+ 1
,
åå1 2
$str
åå3 L
,
ååL M
token
ååN S
)
ååS T
;
ååT U
}
çç 
public
êê 

async
êê 
Task
êê 
<
êê 
bool
êê 
>
êê %
SendEmailInactiveCourse
êê 3
(
êê3 4
string
êê4 :
instructorEmail
êê; J
,
êêJ K
string
êêL R
instructorName
êêS a
,
êêa b
string
êêc i
courseTitle
êêj u
,
êêu v
List
êêw {
<
êê{ |
stringêê| Ç
>êêÇ É
studentEmailsêêÑ ë
)êêë í
{
ëë 
try
íí 
{
ìì 	
foreach
îî 
(
îî 
var
îî 
studentEmail
îî %
in
îî& (
studentEmails
îî) 6
)
îî6 7
{
ïï 
await
ññ -
SendEmailInactiveCourseTemplate
ññ 5
(
ññ5 6
studentEmail
ññ6 B
,
ññB C
$str
ññD Y
,
ññY Z
instructorEmail
ññ[ j
,
ññj k
instructorName
ññl z
,
ññz {
courseTitleññ| á
)ññá à
;ññà â
}
óó 
return
òò 
true
òò 
;
òò 
}
ôô 	
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 	
return
úú 
false
úú 
;
úú 
}
ùù 	
}
ûû 
public
ßß 

async
ßß 
Task
ßß 
<
ßß 
bool
ßß 
>
ßß -
SendEmailForAdminAboutNewCourse
ßß ;
(
ßß; <
string
ßß< B
toMail
ßßC I
)
ßßI J
{
®® 
var
™™ 
template
™™ 
=
™™ 
await
™™ 
_unitOfWork
™™ (
.
™™( )%
EmailTemplateRepository
™™) @
.
™™@ A
GetAsync
™™A I
(
™™I J
t
™™J K
=>
™™L N
t
™™O P
.
™™P Q
TemplateName
™™Q ]
==
™™^ `
$str™™a Ö
)™™Ö Ü
;™™Ü á
var
´´ 
courseStatus
´´ 
=
´´ 
await
´´  
_unitOfWork
´´! ,
.
´´, -%
CourseVersionRepository
´´- D
.
´´D E
GetAsync
´´E M
(
´´M N
z
´´N O
=>
´´P R
z
´´S T
.
´´T U
CurrentStatus
´´U b
==
´´c e
$num
´´f g
)
´´g h
;
´´h i
if
¨¨ 

(
¨¨ 
template
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨ 
{
≠≠ 	
throw
ØØ 
new
ØØ 
	Exception
ØØ 
(
ØØ  
$str
ØØ  :
)
ØØ: ;
;
ØØ; <
}
∞∞ 	
string
≥≥ 
subject
≥≥ 
=
≥≥ 
template
≥≥ !
.
≥≥! "
SubjectLine
≥≥" -
;
≥≥- .
string
¥¥ 
body
¥¥ 
=
¥¥ 
$@"
¥¥ 
$str
¥∑ 
{
∑∑ 
template
∑∑ 
.
∑∑ 
SubjectLine
∑∑ )
}
∑∑) *
$str
∑∏* 
{
∏∏ 
template
∏∏ 
.
∏∏ 
PreHeaderText
∏∏ +
}
∏∏+ ,
$str
∏π, 
{
ππ 
template
ππ 
.
ππ 
BodyContent
ππ (
}
ππ( )
$str
π∫) *
{
∫∫* +
courseStatus
∫∫+ 7
.
∫∫7 8
CurrentStatus
∫∫8 E
}
∫∫E F
$str
∫ªF 
{
ªª 
template
ªª 
.
ªª 
FooterContent
ªª '
}
ªª' (
$str
ªΩ( 
"
ΩΩ 
;
ΩΩ 
return
øø 
await
øø 
SendEmailAsync
øø #
(
øø# $
toMail
øø$ *
,
øø* +
subject
øø, 3
,
øø3 4
body
øø5 9
)
øø9 :
;
øø: ;
}
¿¿ 
public
…… 

async
…… 
Task
…… 
<
…… 
bool
…… 
>
…… 9
+SendApproveEmailForInstructorAboutNewCourse
…… G
(
……G H
string
……H N
toMail
……O U
)
……U V
{
   
var
ÃÃ 
template
ÃÃ 
=
ÃÃ 
await
ÃÃ 
_unitOfWork
ÃÃ (
.
ÃÃ( )%
EmailTemplateRepository
ÃÃ) @
.
ÃÃ@ A
GetAsync
ÃÃA I
(
ÃÃI J
t
ÃÃJ K
=>
ÃÃL N
t
ÃÃO P
.
ÃÃP Q
TemplateName
ÃÃQ ]
==
ÃÃ^ `
$str
ÃÃa z
)
ÃÃz {
;
ÃÃ{ |
var
ÕÕ 
courseStatus
ÕÕ 
=
ÕÕ 
await
ÕÕ  
_unitOfWork
ÕÕ! ,
.
ÕÕ, -%
CourseVersionRepository
ÕÕ- D
.
ÕÕD E
GetAsync
ÕÕE M
(
ÕÕM N
z
ÕÕN O
=>
ÕÕP R
z
ÕÕS T
.
ÕÕT U
CurrentStatus
ÕÕU b
==
ÕÕc e
$num
ÕÕf g
)
ÕÕg h
;
ÕÕh i
if
ŒŒ 

(
ŒŒ 
template
ŒŒ 
==
ŒŒ 
null
ŒŒ 
)
ŒŒ 
{
œœ 	
throw
—— 
new
—— 
	Exception
—— 
(
——  
$str
——  :
)
——: ;
;
——; <
}
““ 	
string
’’ 
subject
’’ 
=
’’ 
template
’’ !
.
’’! "
SubjectLine
’’" -
;
’’- .
string
÷÷ 
body
÷÷ 
=
÷÷ 
$@"
÷÷ 
$str
÷Ÿ 
{
ŸŸ 
template
ŸŸ 
.
ŸŸ 
SubjectLine
ŸŸ )
}
ŸŸ) *
$str
Ÿ⁄* 
{
⁄⁄ 
template
⁄⁄ 
.
⁄⁄ 
PreHeaderText
⁄⁄ +
}
⁄⁄+ ,
$str
⁄€, 
{
€€ 
template
€€ 
.
€€ 
BodyContent
€€ (
}
€€( )
$str
€‹) *
{
‹‹* +
courseStatus
‹‹+ 7
.
‹‹7 8
CurrentStatus
‹‹8 E
}
‹‹E F
$str
‹›F 
{
›› 
template
›› 
.
›› 
FooterContent
›› '
}
››' (
$str
›ﬂ( 
"
ﬂﬂ 
;
ﬂﬂ 
return
·· 
await
·· 
SendEmailAsync
·· #
(
··# $
toMail
··$ *
,
··* +
subject
··, 3
,
··3 4
body
··5 9
)
··9 :
;
··: ;
}
‚‚ 
public
ÎÎ 

async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
bool
ÎÎ 
>
ÎÎ 8
*SendRejectEmailForInstructorAboutNewCourse
ÎÎ F
(
ÎÎF G
string
ÎÎG M
toMail
ÎÎN T
)
ÎÎT U
{
ÏÏ 
var
ÓÓ 
template
ÓÓ 
=
ÓÓ 
await
ÓÓ 
_unitOfWork
ÓÓ (
.
ÓÓ( )%
EmailTemplateRepository
ÓÓ) @
.
ÓÓ@ A
GetAsync
ÓÓA I
(
ÓÓI J
t
ÓÓJ K
=>
ÓÓL N
t
ÓÓO P
.
ÓÓP Q
TemplateName
ÓÓQ ]
==
ÓÓ^ `
$str
ÓÓa y
)
ÓÓy z
;
ÓÓz {
var
ÔÔ 
courseStatus
ÔÔ 
=
ÔÔ 
await
ÔÔ  
_unitOfWork
ÔÔ! ,
.
ÔÔ, -%
CourseVersionRepository
ÔÔ- D
.
ÔÔD E
GetAsync
ÔÔE M
(
ÔÔM N
z
ÔÔN O
=>
ÔÔP R
z
ÔÔS T
.
ÔÔT U
CurrentStatus
ÔÔU b
==
ÔÔc e
$num
ÔÔf g
)
ÔÔg h
;
ÔÔh i
if
 

(
 
template
 
==
 
null
 
)
 
{
ÒÒ 	
throw
ÛÛ 
new
ÛÛ 
	Exception
ÛÛ 
(
ÛÛ  
$str
ÛÛ  :
)
ÛÛ: ;
;
ÛÛ; <
}
ÙÙ 	
string
˜˜ 
subject
˜˜ 
=
˜˜ 
template
˜˜ !
.
˜˜! "
SubjectLine
˜˜" -
;
˜˜- .
string
¯¯ 
body
¯¯ 
=
¯¯ 
$@"
¯¯ 
$str
¯˚ 
{
˚˚ 
template
˚˚ 
.
˚˚ 
SubjectLine
˚˚ )
}
˚˚) *
$str
˚¸* 
{
¸¸ 
template
¸¸ 
.
¸¸ 
PreHeaderText
¸¸ +
}
¸¸+ ,
$str
¸˝, 
{
˝˝ 
template
˝˝ 
.
˝˝ 
BodyContent
˝˝ (
}
˝˝( )
$str
˝˛) 
{
˛˛ 
courseStatus
˛˛  
.
˛˛  !
CurrentStatus
˛˛! .
}
˛˛. /
$str
˛ˇ/ 
{
ˇˇ 
template
ˇˇ 
.
ˇˇ 
FooterContent
ˇˇ '
}
ˇˇ' (
$str
ˇÅ( 
"
ÅÅ 
;
ÅÅ 
return
ÉÉ 
await
ÉÉ 
SendEmailAsync
ÉÉ #
(
ÉÉ# $
toMail
ÉÉ$ *
,
ÉÉ* +
subject
ÉÉ, 3
,
ÉÉ3 4
body
ÉÉ5 9
)
ÉÉ9 :
;
ÉÉ: ;
}
ÑÑ 
}ÖÖ ßI
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\EmailSender.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
EmailSender 
: 
IEmailSender '
{		 
private

 
readonly

 
IEmailService

 "
_emailService

# 0
;

0 1
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
public 

EmailSender 
( 
IEmailService $
emailService% 1
,1 2
IUnitOfWork3 >

unitOfWork? I
)I J
{ 
_emailService 
= 
emailService $
;$ %
_unitOfWork 
= 

unitOfWork  
;  !
} 
public 

async 
Task -
!SendSubmittedCourseEmailForAdmins 7
(7 8
)8 9
{ 
var 
admins 
= 
await 
_unitOfWork &
.& '!
UserManagerRepository' <
.< =
GetUsersInRoleAsync= P
(P Q
StaticUserRolesQ `
.` a
Admina f
)f g
;g h
foreach 
( 
var 
admin 
in 
admins $
)$ %
{ 	
if 
( 
admin 
. 
Email 
!= 
null #
)# $
{ 
await 
_emailService #
.# $+
SendEmailForAdminAboutNewCourse$ C
(C D
adminD I
.I J
EmailJ O
)O P
;P Q
} 
} 	
} 
public 

async 
Task 0
$SendRejectedCourseEmailForInstructor :
(: ;
Guid; ?
courseVersionId@ O
)O P
{   
try!! 
{"" 	
var## 
courseVersion## 
=## 
await##  %
_unitOfWork##& 1
.##1 2#
CourseVersionRepository##2 I
.##I J
GetAsync##J R
(##R S
x##S T
=>##U W
x##X Y
.##Y Z
Id##Z \
==##] _
courseVersionId##` o
)##o p
;##p q
var$$ 

instructor$$ 
=$$ 
await%% 
_unitOfWork%% !
.%%! " 
InstructorRepository%%" 6
.%%6 7
GetAsync%%7 ?
(&& 
filter'' 
:'' 
x'' 
=>''  
x''! "
.''" #
InstructorId''# /
==''0 2
courseVersion''3 @
.''@ A
InstructorId''A M
,''M N
includeProperties(( %
:((% &
$str((' 8
))) 
;)) 
await** 
_emailService** 
.**  6
*SendRejectEmailForInstructorAboutNewCourse**  J
(**J K

instructor**K U
.**U V
ApplicationUser**V e
.**e f
Email**f k
)**k l
;**l m
}++ 	
catch,, 
(,, 
	Exception,, 
e,, 
),, 
{-- 	
}// 	
}00 
public22 

async22 
Task22 0
$SendAcceptedCourseEmailForInstructor22 :
(22: ;
Guid22; ?
courseVersionId22@ O
)22O P
{33 
try44 
{55 	
var66 
courseVersion66 
=66 
await66  %
_unitOfWork66& 1
.661 2#
CourseVersionRepository662 I
.66I J
GetAsync66J R
(66R S
x66S T
=>66U W
x66X Y
.66Y Z
Id66Z \
==66] _
courseVersionId66` o
)66o p
;66p q
var77 

instructor77 
=77 
await88 
_unitOfWork88 !
.88! " 
InstructorRepository88" 6
.886 7
GetAsync887 ?
(99 
filter:: 
::: 
x:: 
=>::  
x::! "
.::" #
InstructorId::# /
==::0 2
courseVersion::3 @
.::@ A
InstructorId::A M
,::M N
includeProperties;; %
:;;% &
$str;;' 8
)<< 
;<< 
await== 
_emailService== 
.==  7
+SendApproveEmailForInstructorAboutNewCourse==  K
(==K L

instructor==L V
.==V W
ApplicationUser==W f
.==f g
Email==g l
)==l m
;==m n
}>> 	
catch?? 
(?? 
	Exception?? 
e?? 
)?? 
{@@ 	
}BB 	
}CC 
publicEE 

asyncEE 
TaskEE 1
%SendDeactivatedCourseEmailForStudentsEE ;
(EE; <
GuidEE< @
courseIdEEA I
)EEI J
{FF 
tryGG 
{HH 	
varII 
studentCoursesII 
=II  
awaitII! &
_unitOfWorkII' 2
.II2 3#
StudentCourseRepositoryII3 J
.IIJ K
GetAllAsyncIIK V
(IIV W
xIIW X
=>IIY [
xII\ ]
.II] ^
CourseIdII^ f
==IIg i
courseIdIIj r
)IIr s
;IIs t
varKK 
courseKK 
=KK 
awaitKK 
_unitOfWorkKK *
.KK* +
CourseRepositoryKK+ ;
.KK; <
GetAsyncKK< D
(KKD E
xKKE F
=>KKG I
xKKJ K
.KKK L
IdKKL N
==KKO Q
courseIdKKR Z
)KKZ [
;KK[ \
varMM 
courseVersionsMM 
=MM  
awaitNN 
_unitOfWorkNN !
.NN! "#
CourseVersionRepositoryNN" 9
.NN9 :
GetAsyncNN: B
(NNB C
xNNC D
=>NNE G
xNNH I
.NNI J
IdNNJ L
==NNM O
courseNNP V
.NNV W
CourseVersionIdNNW f
)NNf g
;NNg h
varPP 

instructorPP 
=PP 
awaitPP "
_unitOfWorkPP# .
.PP. / 
InstructorRepositoryPP/ C
.PPC D
GetAsyncPPD L
(PPL M
filterQQ 
:QQ 
xQQ 
=>QQ 
courseQQ #
!=QQ$ &
nullQQ' +
&&QQ, .
xQQ/ 0
.QQ0 1
InstructorIdQQ1 =
==QQ> @
courseQQA G
.QQG H
InstructorIdQQH T
,QQT U
includePropertiesRR !
:RR! "
$strRR# 4
)SS 
;SS 
varUU 
studentEmailsUU 
=UU 
newUU  #
ListUU$ (
<UU( )
stringUU) /
>UU/ 0
(UU0 1
)UU1 2
;UU2 3
foreachWW 
(WW 
varWW 
studentCourseWW &
inWW' )
studentCoursesWW* 8
)WW8 9
{XX 
varYY 
studentYY 
=YY 
awaitYY #
_unitOfWorkYY$ /
.YY/ 0
StudentRepositoryYY0 A
.YYA B
GetAsyncYYB J
(ZZ 
filter[[ 
:[[ 
x[[ 
=>[[  
x[[! "
.[[" #
	StudentId[[# ,
==[[- /
studentCourse[[0 =
.[[= >
	StudentId[[> G
,[[G H
includeProperties\\ %
:\\% &
$str\\' 8
)]] 
;]] 
if^^ 
(^^ 
student^^ 
?^^ 
.^^ 
ApplicationUser^^ ,
.^^, -
Email^^- 2
!=^^3 5
null^^6 :
)^^: ;
{__ 
studentEmails`` !
.``! "
Add``" %
(``% &
student``& -
.``- .
ApplicationUser``. =
.``= >
Email``> C
)``C D
;``D E
}aa 
}bb 
ifdd 
(dd 

instructordd 
?dd 
.dd 
ApplicationUserdd +
isdd, .
{dd/ 0
Emaildd1 6
:dd6 7
notdd8 ;
nulldd< @
,dd@ A
FullNameddB J
:ddJ K
notddL O
nullddP T
}ddU V
)ddV W
{ee 
ifff 
(ff 
courseVersionsff "
?ff" #
.ff# $
Titleff$ )
!=ff* ,
nullff- 1
)ff1 2
{gg 
awaithh 
_emailServicehh '
.hh' (#
SendEmailInactiveCoursehh( ?
(hh? @

instructorhh@ J
.hhJ K
ApplicationUserhhK Z
.hhZ [
Emailhh[ `
,hh` a

instructorii "
.ii" #
ApplicationUserii# 2
.ii2 3
FullNameii3 ;
,ii; <
courseVersionsii= K
.iiK L
TitleiiL Q
,iiQ R
studentEmailsiiS `
)ii` a
;iia b
}jj 
}kk 
}ll 	
catchmm 
(mm 
	Exceptionmm 
emm 
)mm 
{nn 	
}pp 	
}qq 
}rr œ4
sD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseVersionStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public

 
class

 &
CourseVersionStatusService

 '
:

( )'
ICourseVersionStatusService

* E
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 
&
CourseVersionStatusService %
(% &
IUnitOfWork& 1

unitOfWork2 <
,< =
IMapper> E
mapperF L
)L M
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

Task 
< 
ResponseDTO 
> #
GetCourseVersionsStatus 4
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
{ 
throw   
new   #
NotImplementedException   )
(  ) *
)  * +
;  + ,
}!! 
public## 

async## 
Task## 
<## 
ResponseDTO## !
>##! ""
GetCourseVersionStatus### 9
($$ 
ClaimsPrincipal%% 
User%% 
,%% 
Guid&& !
courseVersionStatusId&& "
)'' 
{(( 
try)) 
{** 	
var++ 
courseVersion++ 
=++ 
await,, 
_unitOfWork,, !
.,,! ")
CourseVersionStatusRepository,," ?
.,,? @+
GetCourseVersionStatusByIdAsync,,@ _
(,,_ `!
courseVersionStatusId,,` u
),,u v
;,,v w
if.. 
(.. 
courseVersion.. 
is..  
null..! %
)..% &
{// 
return00 
new00 
ResponseDTO00 &
(00& '
)00' (
{11 
Message22 
=22 
$str22 C
,22C D
Result33 
=33 
null33 !
,33! "
	IsSuccess44 
=44 
false44  %
,44% &

StatusCode55 
=55  
$num55! $
,55$ %
}66 
;66 
}77 
var99 %
getCourseVersionStatusDto99 )
=99* +
_mapper99, 3
.993 4
Map994 7
<997 8%
GetCourseVersionStatusDTO998 Q
>99Q R
(99R S
courseVersion99S `
)99` a
;99a b
return;; 
new;; 
ResponseDTO;; "
(;;" #
);;# $
{<< 
Message== 
=== 
$str== B
,==B C
Result>> 
=>> %
getCourseVersionStatusDto>> 2
,>>2 3
	IsSuccess?? 
=?? 
true??  
,??  !

StatusCode@@ 
=@@ 
$num@@  
}AA 
;AA 
}BB 	
catchCC 
(CC 
	ExceptionCC 
eCC 
)CC 
{DD 	
returnEE 
newEE 
ResponseDTOEE "
(EE" #
)EE# $
{FF 
MessageGG 
=GG 
eGG 
.GG 
MessageGG #
,GG# $
	IsSuccessHH 
=HH 
falseHH !
,HH! "

StatusCodeII 
=II 
$numII  
,II  !
ResultJJ 
=JJ 
nullJJ 
}KK 
;KK 
}LL 	
}MM 
publicOO 

asyncOO 
TaskOO 
<OO 
ResponseDTOOO !
>OO! "%
CreateCourseVersionStatusOO# <
(PP 
ClaimsPrincipalQQ 
UserQQ 
,QQ (
CreateCourseVersionStatusDTORR $(
createCourseVersionStatusDtoRR% A
)SS 
{TT 
tryUU 
{VV 	
varWW 
courseVersionStatusWW #
=WW$ %
newWW& )
CourseVersionStatusWW* =
(WW= >
)WW> ?
{XX 
IdYY 
=YY 
newYY 
GuidYY 
(YY 
)YY 
,YY  

CreateTimeZZ 
=ZZ 
DateTimeZZ %
.ZZ% &
UtcNowZZ& ,
,ZZ, -
Status[[ 
=[[ (
createCourseVersionStatusDto[[ 5
.[[5 6
Status[[6 <
,[[< =
CourseVersionId\\ 
=\\  !(
createCourseVersionStatusDto\\" >
.\\> ?
CourseVersionId\\? N
}]] 
;]] 
await__ 
_unitOfWork__ 
.__ )
CourseVersionStatusRepository__ ;
.__; <
AddAsync__< D
(__D E
courseVersionStatus__E X
)__X Y
;__Y Z
await`` 
_unitOfWork`` 
.`` 
	SaveAsync`` '
(``' (
)``( )
;``) *
returnbb 
newbb 
ResponseDTObb "
(bb" #
)bb# $
{cc 
Messagedd 
=dd 
$strdd E
,ddE F
Resultee 
=ee 
courseVersionStatusee ,
.ee, -
Idee- /
,ee/ 0
	IsSuccessff 
=ff 
trueff  
,ff  !

StatusCodegg 
=gg 
$numgg  
}hh 
;hh 
}ii 	
catchjj 
(jj 
	Exceptionjj 
ejj 
)jj 
{kk 	
returnll 
newll 
ResponseDTOll "
(ll" #
)ll# $
{mm 
Messagenn 
=nn 
enn 
.nn 
Messagenn #
,nn# $
Resultoo 
=oo 
nulloo 
,oo 
	IsSuccesspp 
=pp 
truepp  
,pp  !

StatusCodeqq 
=qq 
$numqq  
}rr 
;rr 
}ss 	
}tt 
}uu Ç…
mD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class  
CourseVersionService !
:" #!
ICourseVersionService$ 9
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
ICourseService #
_courseService$ 2
;2 3
private 
readonly (
ICourseSectionVersionService 1(
_courseSectionVersionService2 N
;N O
private 
readonly '
ICourseVersionStatusService 0'
_courseVersionStatusService1 L
;L M
private 
readonly 
IFirebaseService %
_firebaseService& 6
;6 7
private 
IMapper 
_mapper 
; 
public 
 
CourseVersionService 
( 
IUnitOfWork 

unitOfWork 
, 
ICourseService 
courseService $
,$ %
IMapper 
mapper 
, '
ICourseVersionStatusService #&
courseVersionStatusService$ >
,> ?(
ICourseSectionVersionService $'
courseSectionVersionService% @
,@ A
IFirebaseServiceB R
firebaseServiceS b
)b c
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_courseService 
= 
courseService &
;& '
_mapper   
=   
mapper   
;   '
_courseVersionStatusService!! #
=!!$ %&
courseVersionStatusService!!& @
;!!@ A(
_courseSectionVersionService"" $
=""% &'
courseSectionVersionService""' B
;""B C
_firebaseService## 
=## 
firebaseService## *
;##* +
}$$ 
public&& 

async&& 
Task&& 
<&& 
ResponseDTO&& !
>&&! "
GetCourseVersions&&# 4
('' 
ClaimsPrincipal(( 
User(( 
,(( 
Guid)) 
?)) 
courseId)) 
,)) 
string** 
?** 
filterOn** 
,** 
string++ 
?++ 
filterQuery++ 
,++ 
string,, 
?,, 
sortBy,, 
,,, 
bool-- 
?-- 
isAscending-- 
,-- 
int.. 

pageNumber.. 
,.. 
int// 
pageSize// 
)00 
{11 
try22 
{33 	
if44 
(44 
string44 
.44 
IsNullOrEmpty44 $
(44$ %
courseId44% -
.44- .
ToString44. 6
(446 7
)447 8
)448 9
)449 :
{55 
return66 
new66 
ResponseDTO66 &
(66& '
)66' (
{77 
Message88 
=88 
$str88 4
,884 5
	IsSuccess99 
=99 
false99  %
,99% &

StatusCode:: 
=::  
$num::! $
,::$ %
Result;; 
=;; 
null;; !
}<< 
;<< 
}== 
var?? 
courseVersions?? 
=??  
_unitOfWork??! ,
.??, -#
CourseVersionRepository??- D
.@@ 
GetAllAsync@@ 
(@@ 
filterAA 
:AA 
xAA 
=>AA  
xAA! "
.AA" #
CourseIdAA# +
==AA, .
courseIdAA/ 7
,AA7 8
includePropertiesBB %
:BB% &
$strBB' 7
)CC 
.DD 

GetAwaiterDD 
(DD 
)DD 
.DD 
	GetResultDD '
(DD' (
)DD( )
.DD) *
ToListDD* 0
(DD0 1
)DD1 2
;DD2 3
ifFF 
(FF 
courseVersionsFF 
.FF 
IsNullOrEmptyFF ,
(FF, -
)FF- .
)FF. /
{GG 
returnHH 
newHH 
ResponseDTOHH &
(HH& '
)HH' (
{II 
MessageJJ 
=JJ 
$strJJ <
,JJ< =
ResultKK 
=KK 
courseVersionsKK +
,KK+ ,
	IsSuccessLL 
=LL 
falseLL  %
,LL% &

StatusCodeMM 
=MM  
$numMM! $
}NN 
;NN 
}OO 
ifRR 
(RR 
!RR 
stringRR 
.RR 
IsNullOrEmptyRR %
(RR% &
filterOnRR& .
)RR. /
&&RR0 2
!RR3 4
stringRR4 :
.RR: ;
IsNullOrEmptyRR; H
(RRH I
filterQueryRRI T
)RRT U
)RRU V
{SS 
switchTT 
(TT 
filterOnTT  
.TT  !
TrimTT! %
(TT% &
)TT& '
.TT' (
ToLowerTT( /
(TT/ 0
)TT0 1
)TT1 2
{UU 
caseVV 
$strVV  
:VV  !
{WW 
courseVersionsXX &
=XX' (
courseVersionsXX) 7
.XX7 8
WhereXX8 =
(XX= >
xXX> ?
=>XX@ B
xYY 
.YY 
TitleYY #
.YY# $
ContainsYY$ ,
(YY, -
filterQueryYY- 8
,YY8 9
StringComparisonYY: J
.YYJ K$
CurrentCultureIgnoreCaseYYK c
)YYc d
)YYd e
.YYe f
ToListYYf l
(YYl m
)YYm n
;YYn o
breakZZ 
;ZZ 
}[[ 
case\\ 
$str\\ 
:\\  
{]] 
courseVersions^^ &
=^^' (
courseVersions^^) 7
.^^7 8
Where^^8 =
(^^= >
x^^> ?
=>^^@ B
x__ 
.__ 
Code__ "
.__" #
Contains__# +
(__+ ,
filterQuery__, 7
,__7 8
StringComparison__9 I
.__I J$
CurrentCultureIgnoreCase__J b
)__b c
)__c d
.__d e
ToList__e k
(__k l
)__l m
;__m n
break`` 
;`` 
}aa 
casebb 
$strbb &
:bb& '
{cc 
courseVersionsdd &
=dd' (
courseVersionsdd) 7
.dd7 8
Wheredd8 =
(dd= >
xdd> ?
=>dd@ B
xee 
.ee 
Descriptionee )
.ee) *
Containsee* 2
(ee2 3
filterQueryee3 >
,ee> ?
StringComparisonee@ P
.eeP Q$
CurrentCultureIgnoreCaseeeQ i
)eei j
)eej k
.eek l
ToListeel r
(eer s
)ees t
;eet u
breakff 
;ff 
}gg 
casehh 
$strhh !
:hh! "
{ii 
courseVersionsjj &
=jj' (
courseVersionsjj) 7
.jj7 8
Wherejj8 =
(jj= >
xjj> ?
=>jj@ B
xkk 
.kk 
CurrentStatuskk +
==kk, .
intkk/ 2
.kk2 3
Parsekk3 8
(kk8 9
filterQuerykk9 D
.kkD E
TrimkkE I
(kkI J
)kkJ K
)kkK L
)kkL M
.kkM N
ToListkkN T
(kkT U
)kkU V
;kkV W
breakll 
;ll 
}mm 
}nn 
}oo 
ifrr 
(rr 
!rr 
stringrr 
.rr 
IsNullOrEmptyrr %
(rr% &
sortByrr& ,
)rr, -
)rr- .
{ss 
switchtt 
(tt 
sortBytt 
.tt 
Trimtt #
(tt# $
)tt$ %
.tt% &
ToLowertt& -
(tt- .
)tt. /
)tt/ 0
{uu 
casevv 
$strvv  
:vv  !
{ww 
courseVersionsxx &
=xx' (
isAscendingxx) 4
==xx5 7
truexx8 <
?yy 
[yy 
..yy !
courseVersionsyy" 0
.yy0 1
OrderByyy1 8
(yy8 9
xyy9 :
=>yy; =
xyy> ?
.yy? @
Titleyy@ E
)yyE F
]yyF G
:zz 
[zz 
..zz !
courseVersionszz" 0
.zz0 1
OrderByDescendingzz1 B
(zzB C
xzzC D
=>zzE G
xzzH I
.zzI J
TitlezzJ O
)zzO P
]zzP Q
;zzQ R
break{{ 
;{{ 
}|| 
case}} 
$str}} 
:}}  
{~~ 
courseVersions &
=' (
isAscending) 4
==5 7
true8 <
?
ÄÄ 
[
ÄÄ 
..
ÄÄ !
courseVersions
ÄÄ" 0
.
ÄÄ0 1
OrderBy
ÄÄ1 8
(
ÄÄ8 9
x
ÄÄ9 :
=>
ÄÄ; =
x
ÄÄ> ?
.
ÄÄ? @
Code
ÄÄ@ D
)
ÄÄD E
]
ÄÄE F
:
ÅÅ 
[
ÅÅ 
..
ÅÅ !
courseVersions
ÅÅ" 0
.
ÅÅ0 1
OrderByDescending
ÅÅ1 B
(
ÅÅB C
x
ÅÅC D
=>
ÅÅE G
x
ÅÅH I
.
ÅÅI J
Code
ÅÅJ N
)
ÅÅN O
]
ÅÅO P
;
ÅÅP Q
break
ÇÇ 
;
ÇÇ 
}
ÉÉ 
case
ÑÑ 
$str
ÑÑ &
:
ÑÑ& '
{
ÖÖ 
courseVersions
ÜÜ &
=
ÜÜ' (
isAscending
ÜÜ) 4
==
ÜÜ5 7
true
ÜÜ8 <
?
áá 
[
áá 
..
áá !
courseVersions
áá" 0
.
áá0 1
OrderBy
áá1 8
(
áá8 9
x
áá9 :
=>
áá; =
x
áá> ?
.
áá? @
Description
áá@ K
)
ááK L
]
ááL M
:
àà 
[
àà 
..
àà !
courseVersions
àà" 0
.
àà0 1
OrderByDescending
àà1 B
(
ààB C
x
ààC D
=>
ààE G
x
ààH I
.
ààI J
Description
ààJ U
)
ààU V
]
ààV W
;
ààW X
break
ââ 
;
ââ 
}
ää 
case
ãã 
$str
ãã  
:
ãã  !
{
åå 
courseVersions
çç &
=
çç' (
isAscending
çç) 4
==
çç5 7
true
çç8 <
?
éé 
[
éé 
..
éé !
courseVersions
éé" 0
.
éé0 1
OrderBy
éé1 8
(
éé8 9
x
éé9 :
=>
éé; =
x
éé> ?
.
éé? @
Price
éé@ E
)
ééE F
]
ééF G
:
èè 
[
èè 
..
èè !
courseVersions
èè" 0
.
èè0 1
OrderByDescending
èè1 B
(
èèB C
x
èèC D
=>
èèE G
x
èèH I
.
èèI J
Price
èèJ O
)
èèO P
]
èèP Q
;
èèQ R
break
êê 
;
êê 
}
ëë 
default
íí 
:
íí 
{
ìì 
break
îî 
;
îî 
}
ïï 
}
ññ 
}
óó 
if
öö 
(
öö 

pageNumber
öö 
>
öö 
$num
öö 
&&
öö !
pageSize
öö" *
>
öö+ ,
$num
öö- .
)
öö. /
{
õõ 
var
úú 

skipResult
úú 
=
úú  
(
úú! "

pageNumber
úú" ,
-
úú- .
$num
úú/ 0
)
úú0 1
*
úú2 3
pageSize
úú4 <
;
úú< =
courseVersions
ùù 
=
ùù  
courseVersions
ùù! /
.
ùù/ 0
Skip
ùù0 4
(
ùù4 5

skipResult
ùù5 ?
)
ùù? @
.
ùù@ A
Take
ùùA E
(
ùùE F
pageSize
ùùF N
)
ùùN O
.
ùùO P
ToList
ùùP V
(
ùùV W
)
ùùW X
;
ùùX Y
}
ûû 
if
†† 
(
†† 
courseVersions
†† 
.
†† 
IsNullOrEmpty
†† ,
(
††, -
)
††- .
)
††. /
{
°° 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ &
(
¢¢& '
)
¢¢' (
{
££ 
Message
§§ 
=
§§ 
$str
§§ ;
,
§§; <
Result
•• 
=
•• 
courseVersions
•• +
,
••+ ,
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
}
®® 
;
®® 
}
©© 
var
´´ 
courseVersionDto
´´  
=
´´! "
_mapper
´´# *
.
´´* +
Map
´´+ .
<
´´. /
List
´´/ 3
<
´´3 4!
GetCourseVersionDTO
´´4 G
>
´´G H
>
´´H I
(
´´I J
courseVersions
´´J X
)
´´X Y
;
´´Y Z
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ "
(
≠≠" #
)
≠≠# $
{
ÆÆ 
Result
ØØ 
=
ØØ 
courseVersionDto
ØØ )
,
ØØ) *
Message
∞∞ 
=
∞∞ 
$str
∞∞ <
,
∞∞< =
	IsSuccess
±± 
=
±± 
true
±±  
,
±±  !

StatusCode
≤≤ 
=
≤≤ 
$num
≤≤  
}
≥≥ 
;
≥≥ 
}
¥¥ 	
catch
µµ 
(
µµ 
	Exception
µµ 
e
µµ 
)
µµ 
{
∂∂ 	
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ "
(
∑∑" #
)
∑∑# $
{
∏∏ 
Result
ππ 
=
ππ 
null
ππ 
,
ππ 
Message
∫∫ 
=
∫∫ 
e
∫∫ 
.
∫∫ 
Message
∫∫ #
,
∫∫# $
	IsSuccess
ªª 
=
ªª 
false
ªª !
,
ªª! "

StatusCode
ºº 
=
ºº 
$num
ºº  
}
ΩΩ 
;
ΩΩ 
}
ææ 	
}
øø 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
ResponseDTO
¡¡ !
>
¡¡! "
GetCourseVersion
¡¡# 3
(
¬¬ 
ClaimsPrincipal
√√ 
User
√√ 
,
√√ 
Guid
ƒƒ 
courseVersionId
ƒƒ 
)
≈≈ 
{
∆∆ 
try
«« 
{
»» 	
var
…… 
courseVersion
…… 
=
…… 
await
   
_unitOfWork
   !
.
  ! "%
CourseVersionRepository
  " 9
.
  9 :
GetAsync
  : B
(
ÀÀ 
filter
ÃÃ 
:
ÃÃ 
x
ÃÃ 
=>
ÃÃ  
x
ÃÃ! "
.
ÃÃ" #
Id
ÃÃ# %
==
ÃÃ& (
courseVersionId
ÃÃ) 8
,
ÃÃ8 9
includeProperties
ÕÕ %
:
ÕÕ% &
$str
ÕÕ' 7
)
ŒŒ 
;
ŒŒ 
if
–– 
(
–– 
courseVersion
–– 
is
––  
null
––! %
)
––% &
{
—— 
return
““ 
new
““ 
ResponseDTO
““ &
(
““& '
)
““' (
{
”” 
Result
‘‘ 
=
‘‘ 
$str
‘‘ 
,
‘‘  
Message
’’ 
=
’’ 
$str
’’ <
,
’’< =
	IsSuccess
÷÷ 
=
÷÷ 
true
÷÷  $
,
÷÷$ %

StatusCode
◊◊ 
=
◊◊  
$num
◊◊! $
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 
var
€€ 
courseVersionDto
€€  
=
€€! "
_mapper
€€# *
.
€€* +
Map
€€+ .
<
€€. /!
GetCourseVersionDTO
€€/ B
>
€€B C
(
€€C D
courseVersion
€€D Q
)
€€Q R
;
€€R S
return
›› 
new
›› 
ResponseDTO
›› "
(
››" #
)
››# $
{
ﬁﬁ 
Result
ﬂﬂ 
=
ﬂﬂ 
courseVersionDto
ﬂﬂ )
,
ﬂﬂ) *
Message
‡‡ 
=
‡‡ 
$str
‡‡ ;
,
‡‡; <
	IsSuccess
·· 
=
·· 
true
··  
,
··  !

StatusCode
‚‚ 
=
‚‚ 
$num
‚‚  
}
„„ 
;
„„ 
}
‰‰ 	
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
e
ÂÂ 
)
ÂÂ 
{
ÊÊ 	
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ "
(
ÁÁ" #
)
ÁÁ# $
{
ËË 
Result
ÈÈ 
=
ÈÈ 
null
ÈÈ 
,
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
e
ÍÍ 
.
ÍÍ 
Message
ÍÍ #
,
ÍÍ# $
	IsSuccess
ÎÎ 
=
ÎÎ 
false
ÎÎ !
,
ÎÎ! "

StatusCode
ÏÏ 
=
ÏÏ 
$num
ÏÏ  
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 	
}
ÔÔ 
public
ÒÒ 

async
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
ResponseDTO
ÒÒ !
>
ÒÒ! "$
CreateCourseAndVersion
ÒÒ# 9
(
ÚÚ 
ClaimsPrincipal
ÛÛ 
User
ÛÛ 
,
ÛÛ *
CreateNewCourseAndVersionDTO
ÙÙ $*
createNewCourseAndVersionDto
ÙÙ% A
)
ıı 
{
ˆˆ 
try
˜˜ 
{
¯¯ 	
var
˘˘ 
courseVersionId
˘˘ 
=
˘˘  !
Guid
˘˘" &
.
˘˘& '
NewGuid
˘˘' .
(
˘˘. /
)
˘˘/ 0
;
˘˘0 1
var
˙˙ 
response
˙˙ 
=
˙˙ 
await
˙˙  
_courseService
˙˙! /
.
˙˙/ 0
CreateFrameCourse
˙˙0 A
(
˙˙A B
User
˙˙B F
,
˙˙F G
courseVersionId
˙˙H W
)
˙˙W X
;
˙˙X Y
if
˚˚ 
(
˚˚ 
response
˚˚ 
.
˚˚ 
	IsSuccess
˚˚ "
==
˚˚# %
false
˚˚& +
)
˚˚+ ,
{
¸¸ 
return
˝˝ 
response
˝˝ 
;
˝˝  
}
˛˛ 
var
ÄÄ 
course
ÄÄ 
=
ÄÄ 
(
ÄÄ 
Course
ÄÄ  
)
ÄÄ  !
response
ÄÄ! )
.
ÄÄ) *
Result
ÄÄ* 0
!
ÄÄ0 1
;
ÄÄ1 2
var
ÇÇ 
courseVersion
ÇÇ 
=
ÇÇ 
new
ÇÇ  #
CourseVersion
ÇÇ$ 1
(
ÇÇ1 2
)
ÇÇ2 3
{
ÉÉ 
Id
ÑÑ 
=
ÑÑ 
courseVersionId
ÑÑ $
,
ÑÑ$ %
CourseId
ÖÖ 
=
ÖÖ 
course
ÖÖ !
.
ÖÖ! "
Id
ÖÖ" $
,
ÖÖ$ %
Title
ÜÜ 
=
ÜÜ *
createNewCourseAndVersionDto
ÜÜ 4
.
ÜÜ4 5
Title
ÜÜ5 :
,
ÜÜ: ;
Code
áá 
=
áá *
createNewCourseAndVersionDto
áá 3
.
áá3 4
Code
áá4 8
,
áá8 9
Description
àà 
=
àà *
createNewCourseAndVersionDto
àà :
.
àà: ;
Description
àà; F
,
ààF G
LearningTime
ââ 
=
ââ *
createNewCourseAndVersionDto
ââ ;
.
ââ; <
LearningTime
ââ< H
,
ââH I
Price
ää 
=
ää *
createNewCourseAndVersionDto
ää 4
.
ää4 5
Price
ää5 :
,
ää: ;
OldPrice
ãã 
=
ãã 
$num
ãã 
,
ãã 
CourseImgUrl
åå 
=
åå *
createNewCourseAndVersionDto
åå ;
.
åå; <
CourseImgUrl
åå< H
,
ååH I
InstructorId
çç 
=
çç 
course
çç %
.
çç% &
InstructorId
çç& 2
,
çç2 3

CategoryId
éé 
=
éé *
createNewCourseAndVersionDto
éé 9
.
éé9 :

CategoryId
éé: D
,
ééD E
LevelId
èè 
=
èè *
createNewCourseAndVersionDto
èè 6
.
èè6 7
LevelId
èè7 >
,
èè> ?
CurrentStatus
êê 
=
êê 
$num
êê  !
,
êê! "
Version
ëë 
=
ëë 
$num
ëë 
,
ëë 
CreatedTime
íí 
=
íí 
DateTime
íí &
.
íí& '
UtcNow
íí' -
,
íí- .
}
ìì 
;
ìì 
await
ïï 
_unitOfWork
ïï 
.
ïï %
CourseVersionRepository
ïï 5
.
ïï5 6
AddAsync
ïï6 >
(
ïï> ?
courseVersion
ïï? L
)
ïïL M
;
ïïM N
await
ññ 
_unitOfWork
ññ 
.
ññ 
	SaveAsync
ññ '
(
ññ' (
)
ññ( )
;
ññ) *
var
ôô 
responseDto
ôô 
=
ôô 
await
ôô #)
_courseVersionStatusService
ôô$ ?
.
ôô? @'
CreateCourseVersionStatus
ôô@ Y
(
öö 
User
õõ 
,
õõ 
new
úú *
CreateCourseVersionStatusDTO
úú 0
(
úú0 1
)
úú1 2
{
ùù 
CourseVersionId
ûû #
=
ûû$ %
courseVersion
ûû& 3
.
ûû3 4
Id
ûû4 6
,
ûû6 7
Status
üü 
=
üü '
StaticCourseVersionStatus
üü 6
.
üü6 7
New
üü7 :
}
†† 
)
°° 
;
°° 
if
££ 
(
££ 
responseDto
££ 
.
££ 
	IsSuccess
££ %
is
££& (
false
££) .
)
££. /
{
§§ 
return
•• 
responseDto
•• "
;
••" #
}
¶¶ 
return
®® 
new
®® 
ResponseDTO
®® "
(
®®" #
)
®®# $
{
©© 
Result
™™ 
=
™™ 
courseVersion
™™ &
.
™™& '
Id
™™' )
,
™™) *
Message
´´ 
=
´´ 
$str
´´ M
,
´´M N
	IsSuccess
¨¨ 
=
¨¨ 
true
¨¨  
,
¨¨  !

StatusCode
≠≠ 
=
≠≠ 
$num
≠≠  
}
ÆÆ 
;
ÆÆ 
}
ØØ 	
catch
∞∞ 
(
∞∞ 
	Exception
∞∞ 
e
∞∞ 
)
∞∞ 
{
±± 	
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Result
¥¥ 
=
¥¥ 
null
¥¥ 
,
¥¥ 
	IsSuccess
µµ 
=
µµ 
false
µµ !
,
µµ! "
Message
∂∂ 
=
∂∂ 
e
∂∂ 
.
∂∂ 
Message
∂∂ #
,
∂∂# $

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
}
∏∏ 
;
∏∏ 
}
ππ 	
}
∫∫ 
public
ºº 

async
ºº 
Task
ºº 
<
ºº 
ResponseDTO
ºº !
>
ºº! " 
CloneCourseVersion
ºº# 5
(
ΩΩ 
ClaimsPrincipal
ææ 
User
ææ 
,
ææ #
CloneCourseVersionDTO
øø #
cloneCourseVersionDto
øø 3
)
¿¿ 
{
¡¡ 
try
¬¬ 
{
√√ 	
var
≈≈ 
courseVersion
≈≈ 
=
≈≈ 
await
∆∆ 
_unitOfWork
∆∆ !
.
∆∆! "%
CourseVersionRepository
∆∆" 9
.
∆∆9 :#
GetCourseVersionAsync
∆∆: O
(
«« #
cloneCourseVersionDto
»» )
.
»») *
CourseVersionId
»»* 9
,
»»9 :
asNoTracking
……  
:
……  !
true
……" &
)
   
;
   
if
ÃÃ 
(
ÃÃ 
courseVersion
ÃÃ 
is
ÃÃ  
null
ÃÃ! %
)
ÃÃ% &
{
ÕÕ 
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ &
(
ŒŒ& '
)
ŒŒ' (
{
œœ 
Result
–– 
=
–– 
null
–– !
,
––! "
	IsSuccess
—— 
=
—— 
false
——  %
,
——% &
Message
““ 
=
““ 
$str
““ =
,
““= >

StatusCode
”” 
=
””  
$num
””! $
,
””$ %
}
‘‘ 
;
‘‘ 
}
’’ 
var
ÿÿ *
cloneCourseSectionVersionDto
ÿÿ ,
=
ÿÿ- .
new
ÿÿ/ 2*
CloneCourseSectionVersionDTO
ÿÿ3 O
(
ÿÿO P
)
ÿÿP Q
{
ŸŸ  
NewCourseVersionId
⁄⁄ "
=
⁄⁄# $
Guid
⁄⁄% )
.
⁄⁄) *
NewGuid
⁄⁄* 1
(
⁄⁄1 2
)
⁄⁄2 3
,
⁄⁄3 4 
OldCourseVersionId
€€ "
=
€€# $
courseVersion
€€% 2
.
€€2 3
Id
€€3 5
}
‹‹ 
;
‹‹ 
courseVersion
ﬁﬁ 
.
ﬁﬁ 
Id
ﬁﬁ 
=
ﬁﬁ *
cloneCourseSectionVersionDto
ﬁﬁ ;
.
ﬁﬁ; < 
NewCourseVersionId
ﬁﬁ< N
;
ﬁﬁN O
courseVersion
ﬂﬂ 
.
ﬂﬂ 
CurrentStatus
ﬂﬂ '
=
ﬂﬂ( )'
StaticCourseVersionStatus
ﬂﬂ* C
.
ﬂﬂC D
New
ﬂﬂD G
;
ﬂﬂG H
courseVersion
‡‡ 
.
‡‡ 
Version
‡‡ !
=
‡‡" #
await
·· 
_unitOfWork
·· !
.
··! "%
CourseVersionRepository
··" 9
.
··9 :)
GetTotalCourseVersionsAsync
··: U
(
··U V
courseVersion
··V c
.
··c d
CourseId
··d l
)
··l m
+
··n o
$num
··p q
;
··q r
await
„„ 
_unitOfWork
„„ 
.
„„ %
CourseVersionRepository
„„ 5
.
„„5 6
AddAsync
„„6 >
(
„„> ?
courseVersion
„„? L
)
„„L M
;
„„M N
await
‰‰ 
_unitOfWork
‰‰ 
.
‰‰ 
	SaveAsync
‰‰ '
(
‰‰' (
)
‰‰( )
;
‰‰) *
var
ÁÁ 
responseDto
ÁÁ 
=
ÁÁ 
await
ËË *
_courseSectionVersionService
ËË 2
.
ËË2 3'
CloneCourseSectionVersion
ËË3 L
(
ÈÈ 
User
ÍÍ 
,
ÍÍ *
cloneCourseSectionVersionDto
ÎÎ 0
)
ÏÏ 
;
ÏÏ 
if
ÌÌ 
(
ÌÌ 
responseDto
ÌÌ 
.
ÌÌ 

StatusCode
ÌÌ &
==
ÌÌ' )
$num
ÌÌ* -
)
ÌÌ- .
{
ÓÓ 
return
ÔÔ 
responseDto
ÔÔ "
;
ÔÔ" #
}
 
responseDto
ÛÛ 
=
ÛÛ 
await
ÛÛ )
_courseVersionStatusService
ÛÛ  ;
.
ÛÛ; <'
CreateCourseVersionStatus
ÛÛ< U
(
ÙÙ 
User
ıı 
,
ıı 
new
ˆˆ *
CreateCourseVersionStatusDTO
ˆˆ 0
(
ˆˆ0 1
)
ˆˆ1 2
{
˜˜ 
CourseVersionId
¯¯ #
=
¯¯$ %
courseVersion
¯¯& 3
.
¯¯3 4
Id
¯¯4 6
,
¯¯6 7
Status
˘˘ 
=
˘˘ '
StaticCourseVersionStatus
˘˘ 6
.
˘˘6 7
New
˘˘7 :
}
˙˙ 
)
˚˚ 
;
˚˚ 
if
˝˝ 
(
˝˝ 
responseDto
˝˝ 
.
˝˝ 
	IsSuccess
˝˝ %
is
˝˝& (
false
˝˝) .
)
˝˝. /
{
˛˛ 
return
ˇˇ 
responseDto
ˇˇ "
;
ˇˇ" #
}
ÄÄ 
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ "
(
ÇÇ" #
)
ÇÇ# $
{
ÉÉ 
Result
ÑÑ 
=
ÑÑ 
null
ÑÑ 
,
ÑÑ 
	IsSuccess
ÖÖ 
=
ÖÖ 
true
ÖÖ  
,
ÖÖ  !
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ A
,
ÜÜA B

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
catch
ää 
(
ää 
	Exception
ää 
e
ää 
)
ää 
{
ãã 	
return
åå 
new
åå 
ResponseDTO
åå "
(
åå" #
)
åå# $
{
çç 
Result
éé 
=
éé 
null
éé 
,
éé 
	IsSuccess
èè 
=
èè 
false
èè !
,
èè! "
Message
êê 
=
êê 
e
êê 
.
êê 
Message
êê #
,
êê# $

StatusCode
ëë 
=
ëë 
$num
ëë  
}
íí 
;
íí 
}
ìì 	
}
îî 
public
ññ 

async
ññ 
Task
ññ 
<
ññ 
ResponseDTO
ññ !
>
ññ! "
EditCourseVersion
ññ# 4
(
ññ4 5
ClaimsPrincipal
ññ5 D
User
ññE I
,
ññI J"
EditCourseVersionDTO
ññK _"
editCourseVersionDto
ññ` t
)
ññt u
{
óó 
try
òò 
{
ôô 	
var
öö 
courseVersion
öö 
=
öö 
await
õõ 
_unitOfWork
õõ !
.
õõ! "%
CourseVersionRepository
õõ" 9
.
õõ9 :
GetAsync
õõ: B
(
õõB C
x
õõC D
=>
õõE G
x
õõH I
.
õõI J
Id
õõJ L
==
õõM O"
editCourseVersionDto
õõP d
.
õõd e
Id
õõe g
)
õõg h
;
õõh i
if
ùù 
(
ùù 
courseVersion
ùù 
is
ùù  
null
ùù! %
)
ùù% &
{
ûû 
return
üü 
new
üü 
ResponseDTO
üü &
(
üü& '
)
üü' (
{
†† 
Message
°° 
=
°° 
$str
°° <
,
°°< =

StatusCode
¢¢ 
=
¢¢  
$num
¢¢! $
,
¢¢$ %
	IsSuccess
££ 
=
££ 
false
££  %
,
££% &
Result
§§ 
=
§§ 
null
§§ !
}
•• 
;
•• 
}
¶¶ 
switch
®® 
(
®® 
courseVersion
®® !
.
®®! "
CurrentStatus
®®" /
)
®®/ 0
{
©© 
case
™™ '
StaticCourseVersionStatus
™™ .
.
™™. /
New
™™/ 2
:
™™2 3
{
´´ 
break
¨¨ 
;
¨¨ 
}
≠≠ 
case
ÆÆ '
StaticCourseVersionStatus
ÆÆ .
.
ÆÆ. /
	Submitted
ÆÆ/ 8
:
ÆÆ8 9
{
ØØ 
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ *
(
∞∞* +
)
∞∞+ ,
{
±± 
Message
≤≤ 
=
≤≤  !
$str
≤≤" E
,
≤≤E F
	IsSuccess
≥≥ !
=
≥≥" #
false
≥≥$ )
,
≥≥) *

StatusCode
¥¥ "
=
¥¥# $
$num
¥¥% (
,
¥¥( )
Result
µµ 
=
µµ  
null
µµ! %
}
∂∂ 
;
∂∂ 
}
∑∑ 
case
∏∏ '
StaticCourseVersionStatus
∏∏ .
.
∏∏. /
Accepted
∏∏/ 7
:
∏∏7 8
{
ππ 
break
∫∫ 
;
∫∫ 
}
ªª 
case
ºº '
StaticCourseVersionStatus
ºº .
.
ºº. /
Rejected
ºº/ 7
:
ºº7 8
{
ΩΩ 
break
ææ 
;
ææ 
}
øø 
case
¿¿ '
StaticCourseVersionStatus
¿¿ .
.
¿¿. /
Merged
¿¿/ 5
:
¿¿5 6
{
¡¡ 
return
¬¬ 
new
¬¬ 
ResponseDTO
¬¬ *
(
¬¬* +
)
¬¬+ ,
{
√√ 
Message
ƒƒ 
=
ƒƒ  !
$str
ƒƒ" B
,
ƒƒB C
	IsSuccess
≈≈ !
=
≈≈" #
false
≈≈$ )
,
≈≈) *

StatusCode
∆∆ "
=
∆∆# $
$num
∆∆% (
,
∆∆( )
Result
«« 
=
««  
null
««! %
}
»» 
;
»» 
}
…… 
case
   '
StaticCourseVersionStatus
   .
.
  . /
Removed
  / 6
:
  6 7
{
ÀÀ 
return
ÃÃ 
new
ÃÃ 
ResponseDTO
ÃÃ *
(
ÃÃ* +
)
ÃÃ+ ,
{
ÕÕ 
Message
ŒŒ 
=
ŒŒ  !
$str
ŒŒ" C
,
ŒŒC D
	IsSuccess
œœ !
=
œœ" #
false
œœ$ )
,
œœ) *

StatusCode
–– "
=
––# $
$num
––% (
,
––( )
Result
—— 
=
——  
null
——! %
}
““ 
;
““ 
}
”” 
}
‘‘ 
courseVersion
÷÷ 
.
÷÷ 

CategoryId
÷÷ $
=
÷÷% &"
editCourseVersionDto
÷÷' ;
.
÷÷; <

CategoryId
÷÷< F
;
÷÷F G
courseVersion
◊◊ 
.
◊◊ 
LevelId
◊◊ !
=
◊◊" #"
editCourseVersionDto
◊◊$ 8
.
◊◊8 9
LevelId
◊◊9 @
;
◊◊@ A
courseVersion
ÿÿ 
.
ÿÿ 
Title
ÿÿ 
=
ÿÿ  !"
editCourseVersionDto
ÿÿ" 6
.
ÿÿ6 7
Title
ÿÿ7 <
;
ÿÿ< =
courseVersion
ŸŸ 
.
ŸŸ 
Code
ŸŸ 
=
ŸŸ  "
editCourseVersionDto
ŸŸ! 5
.
ŸŸ5 6
Code
ŸŸ6 :
;
ŸŸ: ;
courseVersion
⁄⁄ 
.
⁄⁄ 
Description
⁄⁄ %
=
⁄⁄& '"
editCourseVersionDto
⁄⁄( <
.
⁄⁄< =
Description
⁄⁄= H
;
⁄⁄H I
courseVersion
€€ 
.
€€ 
LearningTime
€€ &
=
€€' ("
editCourseVersionDto
€€) =
.
€€= >
LearningTime
€€> J
;
€€J K
courseVersion
‹‹ 
.
‹‹ 
Price
‹‹ 
=
‹‹  !"
editCourseVersionDto
‹‹" 6
.
‹‹6 7
Price
‹‹7 <
;
‹‹< =
courseVersion
›› 
.
›› 
CourseImgUrl
›› &
=
››' ("
editCourseVersionDto
››) =
.
››= >
CourseImgUrl
››> J
;
››J K
_unitOfWork
ﬂﬂ 
.
ﬂﬂ %
CourseVersionRepository
ﬂﬂ /
.
ﬂﬂ/ 0
Update
ﬂﬂ0 6
(
ﬂﬂ6 7
courseVersion
ﬂﬂ7 D
)
ﬂﬂD E
;
ﬂﬂE F
await
‡‡ 
_unitOfWork
‡‡ 
.
‡‡ 
	SaveAsync
‡‡ '
(
‡‡' (
)
‡‡( )
;
‡‡) *
return
‚‚ 
new
‚‚ 
ResponseDTO
‚‚ "
(
‚‚" #
)
‚‚# $
{
„„ 
Message
‰‰ 
=
‰‰ 
$str
‰‰ >
,
‰‰> ?
	IsSuccess
ÂÂ 
=
ÂÂ 
true
ÂÂ  
,
ÂÂ  !

StatusCode
ÊÊ 
=
ÊÊ 
$num
ÊÊ  
,
ÊÊ  !
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ 
}
ËË 
;
ËË 
}
ÈÈ 	
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
e
ÍÍ 
)
ÍÍ 
{
ÎÎ 	
return
ÏÏ 
new
ÏÏ 
ResponseDTO
ÏÏ "
(
ÏÏ" #
)
ÏÏ# $
{
ÌÌ 
Result
ÓÓ 
=
ÓÓ 
null
ÓÓ 
,
ÓÓ 
	IsSuccess
ÔÔ 
=
ÔÔ 
false
ÔÔ !
,
ÔÔ! "
Message
 
=
 
e
 
.
 
Message
 #
,
# $

StatusCode
ÒÒ 
=
ÒÒ 
$num
ÒÒ  
}
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
}
ÙÙ 
public
ˆˆ 

async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
ResponseDTO
ˆˆ !
>
ˆˆ! "!
RemoveCourseVersion
ˆˆ# 6
(
˜˜ 
ClaimsPrincipal
¯¯ 
User
¯¯ 
,
¯¯ 
Guid
˘˘ 
courseVersionId
˘˘ 
)
˙˙ 
{
˚˚ 
try
¸¸ 
{
˝˝ 	
var
˛˛ 
courseVersion
˛˛ 
=
˛˛ 
await
˛˛  %
_unitOfWork
˛˛& 1
.
˛˛1 2%
CourseVersionRepository
˛˛2 I
.
˛˛I J
GetAsync
˛˛J R
(
˛˛R S
x
˛˛S T
=>
˛˛U W
x
˛˛X Y
.
˛˛Y Z
Id
˛˛Z \
==
˛˛] _
courseVersionId
˛˛` o
)
˛˛o p
;
˛˛p q
if
ÄÄ 
(
ÄÄ 
courseVersion
ÄÄ 
is
ÄÄ  
null
ÄÄ! %
)
ÄÄ% &
{
ÅÅ 
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ &
(
ÇÇ& '
)
ÇÇ' (
{
ÉÉ 
Result
ÑÑ 
=
ÑÑ 
null
ÑÑ !
,
ÑÑ! "
	IsSuccess
ÖÖ 
=
ÖÖ 
false
ÖÖ  %
,
ÖÖ% &
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ <
,
ÜÜ< =

StatusCode
áá 
=
áá  
$num
áá! $
}
àà 
;
àà 
}
ââ 
switch
ãã 
(
ãã 
courseVersion
ãã !
.
ãã! "
CurrentStatus
ãã" /
)
ãã/ 0
{
åå 
case
çç '
StaticCourseVersionStatus
çç .
.
çç. /
	Submitted
çç/ 8
:
çç8 9
{
éé 
return
èè 
new
èè 
ResponseDTO
èè *
(
èè* +
)
èè+ ,
{
êê 
Message
ëë 
=
ëë  !
$str
ëë" F
,
ëëF G

StatusCode
íí "
=
íí# $
$num
íí% (
,
íí( )
	IsSuccess
ìì !
=
ìì" #
false
ìì$ )
,
ìì) *
Result
îî 
=
îî  
null
îî! %
}
ïï 
;
ïï 
}
ññ 
case
óó '
StaticCourseVersionStatus
óó .
.
óó. /
Merged
óó/ 5
:
óó5 6
{
òò 
return
ôô 
new
ôô 
ResponseDTO
ôô *
(
ôô* +
)
ôô+ ,
{
öö 
Message
õõ 
=
õõ  !
$str
õõ" C
,
õõC D

StatusCode
úú "
=
úú# $
$num
úú% (
,
úú( )
	IsSuccess
ùù !
=
ùù" #
false
ùù$ )
,
ùù) *
Result
ûû 
=
ûû  
null
ûû! %
}
üü 
;
üü 
}
†† 
case
°° '
StaticCourseVersionStatus
°° .
.
°°. /
Removed
°°/ 6
:
°°6 7
{
¢¢ 
return
££ 
new
££ 
ResponseDTO
££ *
(
££* +
)
££+ ,
{
§§ 
Message
•• 
=
••  !
$str
••" D
,
••D E

StatusCode
¶¶ "
=
¶¶# $
$num
¶¶% (
,
¶¶( )
	IsSuccess
ßß !
=
ßß" #
false
ßß$ )
,
ßß) *
Result
®® 
=
®®  
null
®®! %
}
©© 
;
©© 
}
™™ 
default
´´ 
:
´´ 
{
¨¨ 
courseVersion
≠≠ !
.
≠≠! "
CurrentStatus
≠≠" /
=
≠≠0 1'
StaticCourseVersionStatus
≠≠2 K
.
≠≠K L
Removed
≠≠L S
;
≠≠S T
break
ÆÆ 
;
ÆÆ 
}
ØØ 
}
∞∞ 
_unitOfWork
≤≤ 
.
≤≤ %
CourseVersionRepository
≤≤ /
.
≤≤/ 0
Update
≤≤0 6
(
≤≤6 7
courseVersion
≤≤7 D
)
≤≤D E
;
≤≤E F
var
¥¥ 
responseDto
¥¥ 
=
¥¥ 
await
¥¥ #)
_courseVersionStatusService
¥¥$ ?
.
¥¥? @'
CreateCourseVersionStatus
¥¥@ Y
(
µµ 
User
∂∂ 
,
∂∂ 
new
∑∑ *
CreateCourseVersionStatusDTO
∑∑ 0
(
∑∑0 1
)
∑∑1 2
{
∏∏ 
CourseVersionId
ππ #
=
ππ$ %
courseVersion
ππ& 3
.
ππ3 4
Id
ππ4 6
,
ππ6 7
Status
∫∫ 
=
∫∫ '
StaticCourseVersionStatus
∫∫ 6
.
∫∫6 7
Removed
∫∫7 >
}
ªª 
)
ºº 
;
ºº 
if
ææ 
(
ææ 
responseDto
ææ 
.
ææ 

StatusCode
ææ &
==
ææ' )
$num
ææ* -
)
ææ- .
{
øø 
return
¿¿ 
responseDto
¿¿ "
;
¿¿" #
}
¡¡ 
return
√√ 
new
√√ 
ResponseDTO
√√ "
(
√√" #
)
√√# $
{
ƒƒ 
Result
≈≈ 
=
≈≈ 
null
≈≈ 
,
≈≈ 
	IsSuccess
∆∆ 
=
∆∆ 
true
∆∆  
,
∆∆  !
Message
«« 
=
«« 
$str
«« >
,
««> ?

StatusCode
»» 
=
»» 
$num
»»  
}
…… 
;
…… 
}
   	
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
e
ÀÀ 
)
ÀÀ 
{
ÃÃ 	
return
ÕÕ 
new
ÕÕ 
ResponseDTO
ÕÕ "
(
ÕÕ" #
)
ÕÕ# $
{
ŒŒ 
Result
œœ 
=
œœ 
null
œœ 
,
œœ 
	IsSuccess
–– 
=
–– 
false
–– !
,
––! "
Message
—— 
=
—— 
e
—— 
.
—— 
Message
—— #
,
——# $

StatusCode
““ 
=
““ 
$num
““  
}
”” 
;
”” 
}
‘‘ 	
}
’’ 
public
◊◊ 

async
◊◊ 
Task
◊◊ 
<
◊◊ 
ResponseDTO
◊◊ !
>
◊◊! "!
AcceptCourseVersion
◊◊# 6
(
ÿÿ 
ClaimsPrincipal
ŸŸ 
User
ŸŸ 
,
ŸŸ 
Guid
⁄⁄ 
courseVersionId
⁄⁄ 
)
€€ 
{
‹‹ 
try
›› 
{
ﬁﬁ 	
var
ﬂﬂ 
courseVersion
ﬂﬂ 
=
ﬂﬂ 
await
ﬂﬂ  %
_unitOfWork
ﬂﬂ& 1
.
ﬂﬂ1 2%
CourseVersionRepository
ﬂﬂ2 I
.
ﬂﬂI J
GetAsync
ﬂﬂJ R
(
ﬂﬂR S
x
ﬂﬂS T
=>
ﬂﬂU W
x
ﬂﬂX Y
.
ﬂﬂY Z
Id
ﬂﬂZ \
==
ﬂﬂ] _
courseVersionId
ﬂﬂ` o
)
ﬂﬂo p
;
ﬂﬂp q
if
·· 
(
·· 
courseVersion
·· 
is
··  
null
··! %
)
··% &
{
‚‚ 
return
„„ 
new
„„ 
ResponseDTO
„„ &
(
„„& '
)
„„' (
{
‰‰ 
Result
ÂÂ 
=
ÂÂ 
null
ÂÂ !
,
ÂÂ! "
	IsSuccess
ÊÊ 
=
ÊÊ 
false
ÊÊ  %
,
ÊÊ% &
Message
ÁÁ 
=
ÁÁ 
$str
ÁÁ <
,
ÁÁ< =

StatusCode
ËË 
=
ËË  
$num
ËË! $
}
ÈÈ 
;
ÈÈ 
}
ÍÍ 
switch
ÏÏ 
(
ÏÏ 
courseVersion
ÏÏ !
.
ÏÏ! "
CurrentStatus
ÏÏ" /
)
ÏÏ/ 0
{
ÌÌ 
case
ÓÓ '
StaticCourseVersionStatus
ÓÓ .
.
ÓÓ. /
New
ÓÓ/ 2
:
ÓÓ2 3
{
ÔÔ 
return
 
new
 
ResponseDTO
 *
(
* +
)
+ ,
{
ÒÒ 
Message
ÚÚ 
=
ÚÚ  !
$str
ÚÚ" G
,
ÚÚG H

StatusCode
ÛÛ "
=
ÛÛ# $
$num
ÛÛ% (
,
ÛÛ( )
	IsSuccess
ÙÙ !
=
ÙÙ" #
false
ÙÙ$ )
,
ÙÙ) *
Result
ıı 
=
ıı  
null
ıı! %
}
ˆˆ 
;
ˆˆ 
}
˜˜ 
case
¯¯ '
StaticCourseVersionStatus
¯¯ .
.
¯¯. /
Accepted
¯¯/ 7
:
¯¯7 8
{
˘˘ 
return
˙˙ 
new
˙˙ 
ResponseDTO
˙˙ *
(
˙˙* +
)
˙˙+ ,
{
˚˚ 
Message
¸¸ 
=
¸¸  !
$str
¸¸" E
,
¸¸E F

StatusCode
˝˝ "
=
˝˝# $
$num
˝˝% (
,
˝˝( )
	IsSuccess
˛˛ !
=
˛˛" #
false
˛˛$ )
,
˛˛) *
Result
ˇˇ 
=
ˇˇ  
null
ˇˇ! %
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 
case
ÇÇ '
StaticCourseVersionStatus
ÇÇ .
.
ÇÇ. /
Merged
ÇÇ/ 5
:
ÇÇ5 6
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ *
(
ÑÑ* +
)
ÑÑ+ ,
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ  !
$str
ÜÜ" C
,
ÜÜC D

StatusCode
áá "
=
áá# $
$num
áá% (
,
áá( )
	IsSuccess
àà !
=
àà" #
false
àà$ )
,
àà) *
Result
ââ 
=
ââ  
null
ââ! %
}
ää 
;
ää 
}
ãã 
case
åå '
StaticCourseVersionStatus
åå .
.
åå. /
Removed
åå/ 6
:
åå6 7
{
çç 
return
éé 
new
éé 
ResponseDTO
éé *
(
éé* +
)
éé+ ,
{
èè 
Message
êê 
=
êê  !
$str
êê" D
,
êêD E

StatusCode
ëë "
=
ëë# $
$num
ëë% (
,
ëë( )
	IsSuccess
íí !
=
íí" #
false
íí$ )
,
íí) *
Result
ìì 
=
ìì  
null
ìì! %
}
îî 
;
îî 
}
ïï 
default
ññ 
:
ññ 
{
óó 
courseVersion
òò !
.
òò! "
CurrentStatus
òò" /
=
òò0 1'
StaticCourseVersionStatus
òò2 K
.
òòK L
Accepted
òòL T
;
òòT U
break
ôô 
;
ôô 
}
öö 
}
õõ 
_unitOfWork
ùù 
.
ùù %
CourseVersionRepository
ùù /
.
ùù/ 0
Update
ùù0 6
(
ùù6 7
courseVersion
ùù7 D
)
ùùD E
;
ùùE F
var
üü 
responseDto
üü 
=
üü 
await
üü #)
_courseVersionStatusService
üü$ ?
.
üü? @'
CreateCourseVersionStatus
üü@ Y
(
†† 
User
°° 
,
°° 
new
¢¢ *
CreateCourseVersionStatusDTO
¢¢ 0
(
¢¢0 1
)
¢¢1 2
{
££ 
CourseVersionId
§§ #
=
§§$ %
courseVersion
§§& 3
.
§§3 4
Id
§§4 6
,
§§6 7
Status
•• 
=
•• '
StaticCourseVersionStatus
•• 6
.
••6 7
Accepted
••7 ?
}
¶¶ 
)
ßß 
;
ßß 
if
©© 
(
©© 
responseDto
©© 
.
©© 

StatusCode
©© &
==
©©' )
$num
©©* -
)
©©- .
{
™™ 
return
´´ 
responseDto
´´ "
;
´´" #
}
¨¨ 
BackgroundJob
ÆÆ 
.
ÆÆ 
Enqueue
ÆÆ !
<
ÆÆ! "
IEmailSender
ÆÆ" .
>
ÆÆ. /
(
ÆÆ/ 0
job
ÆÆ0 3
=>
ÆÆ4 6
job
ÆÆ7 :
.
ÆÆ: ;2
$SendAcceptedCourseEmailForInstructor
ÆÆ; _
(
ÆÆ_ `
courseVersionId
ÆÆ` o
)
ÆÆo p
)
ÆÆp q
;
ÆÆq r
return
∞∞ 
new
∞∞ 
ResponseDTO
∞∞ "
(
∞∞" #
)
∞∞# $
{
±± 
Result
≤≤ 
=
≤≤ 
null
≤≤ 
,
≤≤ 
	IsSuccess
≥≥ 
=
≥≥ 
true
≥≥  
,
≥≥  !
Message
¥¥ 
=
¥¥ 
$str
¥¥ >
,
¥¥> ?

StatusCode
µµ 
=
µµ 
$num
µµ  
}
∂∂ 
;
∂∂ 
}
∑∑ 	
catch
∏∏ 
(
∏∏ 
	Exception
∏∏ 
e
∏∏ 
)
∏∏ 
{
ππ 	
return
∫∫ 
new
∫∫ 
ResponseDTO
∫∫ "
(
∫∫" #
)
∫∫# $
{
ªª 
Result
ºº 
=
ºº 
null
ºº 
,
ºº 
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ !
,
ΩΩ! "
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $

StatusCode
øø 
=
øø 
$num
øø  
}
¿¿ 
;
¿¿ 
}
¡¡ 	
}
¬¬ 
public
ƒƒ 

async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
ResponseDTO
ƒƒ !
>
ƒƒ! "!
RejectCourseVersion
ƒƒ# 6
(
≈≈ 
ClaimsPrincipal
∆∆ 
User
∆∆ 
,
∆∆ 
Guid
«« 
courseVersionId
«« 
)
»» 
{
…… 
try
   
{
ÀÀ 	
var
ÃÃ 
courseVersion
ÃÃ 
=
ÃÃ 
await
ÃÃ  %
_unitOfWork
ÃÃ& 1
.
ÃÃ1 2%
CourseVersionRepository
ÃÃ2 I
.
ÃÃI J
GetAsync
ÃÃJ R
(
ÃÃR S
x
ÃÃS T
=>
ÃÃU W
x
ÃÃX Y
.
ÃÃY Z
Id
ÃÃZ \
==
ÃÃ] _
courseVersionId
ÃÃ` o
)
ÃÃo p
;
ÃÃp q
if
ŒŒ 
(
ŒŒ 
courseVersion
ŒŒ 
is
ŒŒ  
null
ŒŒ! %
)
ŒŒ% &
{
œœ 
return
–– 
new
–– 
ResponseDTO
–– &
(
––& '
)
––' (
{
—— 
Result
““ 
=
““ 
null
““ !
,
““! "
	IsSuccess
”” 
=
”” 
false
””  %
,
””% &
Message
‘‘ 
=
‘‘ 
$str
‘‘ <
,
‘‘< =

StatusCode
’’ 
=
’’  
$num
’’! $
}
÷÷ 
;
÷÷ 
}
◊◊ 
switch
ŸŸ 
(
ŸŸ 
courseVersion
ŸŸ !
.
ŸŸ! "
CurrentStatus
ŸŸ" /
)
ŸŸ/ 0
{
⁄⁄ 
case
€€ '
StaticCourseVersionStatus
€€ .
.
€€. /
New
€€/ 2
:
€€2 3
{
‹‹ 
return
›› 
new
›› 
ResponseDTO
›› *
(
››* +
)
››+ ,
{
ﬁﬁ 
Message
ﬂﬂ 
=
ﬂﬂ  !
$str
ﬂﬂ" G
,
ﬂﬂG H

StatusCode
‡‡ "
=
‡‡# $
$num
‡‡% (
,
‡‡( )
	IsSuccess
·· !
=
··" #
false
··$ )
,
··) *
Result
‚‚ 
=
‚‚  
null
‚‚! %
}
„„ 
;
„„ 
}
‰‰ 
case
ÂÂ '
StaticCourseVersionStatus
ÂÂ .
.
ÂÂ. /
Accepted
ÂÂ/ 7
:
ÂÂ7 8
{
ÊÊ 
return
ÁÁ 
new
ÁÁ 
ResponseDTO
ÁÁ *
(
ÁÁ* +
)
ÁÁ+ ,
{
ËË 
Message
ÈÈ 
=
ÈÈ  !
$str
ÈÈ" E
,
ÈÈE F

StatusCode
ÍÍ "
=
ÍÍ# $
$num
ÍÍ% (
,
ÍÍ( )
	IsSuccess
ÎÎ !
=
ÎÎ" #
false
ÎÎ$ )
,
ÎÎ) *
Result
ÏÏ 
=
ÏÏ  
null
ÏÏ! %
}
ÌÌ 
;
ÌÌ 
}
ÓÓ 
case
ÔÔ '
StaticCourseVersionStatus
ÔÔ .
.
ÔÔ. /
Merged
ÔÔ/ 5
:
ÔÔ5 6
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ *
(
ÒÒ* +
)
ÒÒ+ ,
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ  !
$str
ÛÛ" C
,
ÛÛC D

StatusCode
ÙÙ "
=
ÙÙ# $
$num
ÙÙ% (
,
ÙÙ( )
	IsSuccess
ıı !
=
ıı" #
false
ıı$ )
,
ıı) *
Result
ˆˆ 
=
ˆˆ  
null
ˆˆ! %
}
˜˜ 
;
˜˜ 
}
¯¯ 
case
˘˘ '
StaticCourseVersionStatus
˘˘ .
.
˘˘. /
Removed
˘˘/ 6
:
˘˘6 7
{
˙˙ 
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ *
(
˚˚* +
)
˚˚+ ,
{
¸¸ 
Message
˝˝ 
=
˝˝  !
$str
˝˝" D
,
˝˝D E

StatusCode
˛˛ "
=
˛˛# $
$num
˛˛% (
,
˛˛( )
	IsSuccess
ˇˇ !
=
ˇˇ" #
false
ˇˇ$ )
,
ˇˇ) *
Result
ÄÄ 
=
ÄÄ  
null
ÄÄ! %
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 
default
ÉÉ 
:
ÉÉ 
{
ÑÑ 
courseVersion
ÖÖ !
.
ÖÖ! "
CurrentStatus
ÖÖ" /
=
ÖÖ0 1'
StaticCourseVersionStatus
ÖÖ2 K
.
ÖÖK L
Rejected
ÖÖL T
;
ÖÖT U
break
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 
_unitOfWork
ää 
.
ää %
CourseVersionRepository
ää /
.
ää/ 0
Update
ää0 6
(
ää6 7
courseVersion
ää7 D
)
ääD E
;
ääE F
var
åå 
responseDto
åå 
=
åå 
await
åå #)
_courseVersionStatusService
åå$ ?
.
åå? @'
CreateCourseVersionStatus
åå@ Y
(
çç 
User
éé 
,
éé 
new
èè *
CreateCourseVersionStatusDTO
èè 0
(
èè0 1
)
èè1 2
{
êê 
CourseVersionId
ëë #
=
ëë$ %
courseVersion
ëë& 3
.
ëë3 4
Id
ëë4 6
,
ëë6 7
Status
íí 
=
íí '
StaticCourseVersionStatus
íí 6
.
íí6 7
Rejected
íí7 ?
}
ìì 
)
îî 
;
îî 
if
ññ 
(
ññ 
responseDto
ññ 
.
ññ 

StatusCode
ññ &
==
ññ' )
$num
ññ* -
)
ññ- .
{
óó 
return
òò 
responseDto
òò "
;
òò" #
}
ôô 
BackgroundJob
õõ 
.
õõ 
Enqueue
õõ !
<
õõ! "
IEmailSender
õõ" .
>
õõ. /
(
õõ/ 0
job
õõ0 3
=>
õõ4 6
job
õõ7 :
.
õõ: ;2
$SendRejectedCourseEmailForInstructor
õõ; _
(
õõ_ `
courseVersionId
õõ` o
)
õõo p
)
õõp q
;
õõq r
return
ùù 
new
ùù 
ResponseDTO
ùù "
(
ùù" #
)
ùù# $
{
ûû 
Result
üü 
=
üü 
null
üü 
,
üü 
	IsSuccess
†† 
=
†† 
true
††  
,
††  !
Message
°° 
=
°° 
$str
°° >
,
°°> ?

StatusCode
¢¢ 
=
¢¢ 
$num
¢¢  
}
££ 
;
££ 
}
§§ 	
catch
•• 
(
•• 
	Exception
•• 
e
•• 
)
•• 
{
¶¶ 	
return
ßß 
new
ßß 
ResponseDTO
ßß "
(
ßß" #
)
ßß# $
{
®® 
Result
©© 
=
©© 
null
©© 
,
©© 
	IsSuccess
™™ 
=
™™ 
false
™™ !
,
™™! "
Message
´´ 
=
´´ 
e
´´ 
.
´´ 
Message
´´ #
,
´´# $

StatusCode
¨¨ 
=
¨¨ 
$num
¨¨  
}
≠≠ 
;
≠≠ 
}
ÆÆ 	
}
ØØ 
public
±± 

async
±± 
Task
±± 
<
±± 
ResponseDTO
±± !
>
±±! "!
SubmitCourseVersion
±±# 6
(
≤≤ 
ClaimsPrincipal
≥≥ 
User
≥≥ 
,
≥≥ 
Guid
¥¥ 
courseVersionId
¥¥ 
)
µµ 
{
∂∂ 
try
∑∑ 
{
∏∏ 	
var
ππ 
courseVersion
ππ 
=
ππ 
await
ππ  %
_unitOfWork
ππ& 1
.
ππ1 2%
CourseVersionRepository
ππ2 I
.
ππI J
GetAsync
ππJ R
(
ππR S
x
ππS T
=>
ππU W
x
ππX Y
.
ππY Z
Id
ππZ \
==
ππ] _
courseVersionId
ππ` o
)
ππo p
;
ππp q
if
ªª 
(
ªª 
courseVersion
ªª 
is
ªª  
null
ªª! %
)
ªª% &
{
ºº 
return
ΩΩ 
new
ΩΩ 
ResponseDTO
ΩΩ &
(
ΩΩ& '
)
ΩΩ' (
{
ææ 
Result
øø 
=
øø 
null
øø !
,
øø! "
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿  %
,
¿¿% &
Message
¡¡ 
=
¡¡ 
$str
¡¡ <
,
¡¡< =

StatusCode
¬¬ 
=
¬¬  
$num
¬¬! $
}
√√ 
;
√√ 
}
ƒƒ 
switch
∆∆ 
(
∆∆ 
courseVersion
∆∆ !
.
∆∆! "
CurrentStatus
∆∆" /
)
∆∆/ 0
{
«« 
case
»» '
StaticCourseVersionStatus
»» .
.
»». /
	Submitted
»»/ 8
:
»»8 9
{
…… 
return
   
new
   
ResponseDTO
   *
(
  * +
)
  + ,
{
ÀÀ 
Message
ÃÃ 
=
ÃÃ  !
$str
ÃÃ" F
,
ÃÃF G

StatusCode
ÕÕ "
=
ÕÕ# $
$num
ÕÕ% (
,
ÕÕ( )
	IsSuccess
ŒŒ !
=
ŒŒ" #
false
ŒŒ$ )
,
ŒŒ) *
Result
œœ 
=
œœ  
null
œœ! %
}
–– 
;
–– 
}
—— 
case
““ '
StaticCourseVersionStatus
““ .
.
““. /
Accepted
““/ 7
:
““7 8
{
”” 
return
‘‘ 
new
‘‘ 
ResponseDTO
‘‘ *
(
‘‘* +
)
‘‘+ ,
{
’’ 
Message
÷÷ 
=
÷÷  !
$str
÷÷" E
,
÷÷E F

StatusCode
◊◊ "
=
◊◊# $
$num
◊◊% (
,
◊◊( )
	IsSuccess
ÿÿ !
=
ÿÿ" #
false
ÿÿ$ )
,
ÿÿ) *
Result
ŸŸ 
=
ŸŸ  
null
ŸŸ! %
}
⁄⁄ 
;
⁄⁄ 
}
€€ 
case
‹‹ '
StaticCourseVersionStatus
‹‹ .
.
‹‹. /
Merged
‹‹/ 5
:
‹‹5 6
{
›› 
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ *
(
ﬁﬁ* +
)
ﬁﬁ+ ,
{
ﬂﬂ 
Message
‡‡ 
=
‡‡  !
$str
‡‡" C
,
‡‡C D

StatusCode
·· "
=
··# $
$num
··% (
,
··( )
	IsSuccess
‚‚ !
=
‚‚" #
false
‚‚$ )
,
‚‚) *
Result
„„ 
=
„„  
null
„„! %
}
‰‰ 
;
‰‰ 
}
ÂÂ 
case
ÊÊ '
StaticCourseVersionStatus
ÊÊ .
.
ÊÊ. /
Removed
ÊÊ/ 6
:
ÊÊ6 7
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË *
(
ËË* +
)
ËË+ ,
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ  !
$str
ÍÍ" D
,
ÍÍD E

StatusCode
ÎÎ "
=
ÎÎ# $
$num
ÎÎ% (
,
ÎÎ( )
	IsSuccess
ÏÏ !
=
ÏÏ" #
false
ÏÏ$ )
,
ÏÏ) *
Result
ÌÌ 
=
ÌÌ  
null
ÌÌ! %
}
ÓÓ 
;
ÓÓ 
}
ÔÔ 
default
 
:
 
{
ÒÒ 
courseVersion
ÚÚ !
.
ÚÚ! "
CurrentStatus
ÚÚ" /
=
ÚÚ0 1'
StaticCourseVersionStatus
ÚÚ2 K
.
ÚÚK L
	Submitted
ÚÚL U
;
ÚÚU V
break
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 
_unitOfWork
˜˜ 
.
˜˜ %
CourseVersionRepository
˜˜ /
.
˜˜/ 0
Update
˜˜0 6
(
˜˜6 7
courseVersion
˜˜7 D
)
˜˜D E
;
˜˜E F
var
˘˘ 
responseDto
˘˘ 
=
˘˘ 
await
˘˘ #)
_courseVersionStatusService
˘˘$ ?
.
˘˘? @'
CreateCourseVersionStatus
˘˘@ Y
(
˙˙ 
User
˚˚ 
,
˚˚ 
new
¸¸ *
CreateCourseVersionStatusDTO
¸¸ 0
(
¸¸0 1
)
¸¸1 2
{
˝˝ 
CourseVersionId
˛˛ #
=
˛˛$ %
courseVersion
˛˛& 3
.
˛˛3 4
Id
˛˛4 6
,
˛˛6 7
Status
ˇˇ 
=
ˇˇ '
StaticCourseVersionStatus
ˇˇ 6
.
ˇˇ6 7
	Submitted
ˇˇ7 @
}
ÄÄ 
)
ÅÅ 
;
ÅÅ 
if
ÉÉ 
(
ÉÉ 
responseDto
ÉÉ 
.
ÉÉ 

StatusCode
ÉÉ &
==
ÉÉ' )
$num
ÉÉ* -
)
ÉÉ- .
{
ÑÑ 
return
ÖÖ 
responseDto
ÖÖ "
;
ÖÖ" #
}
ÜÜ 
BackgroundJob
àà 
.
àà 
Enqueue
àà !
<
àà! "
IEmailSender
àà" .
>
àà. /
(
àà/ 0
job
àà0 3
=>
àà4 6
job
àà7 :
.
àà: ;/
!SendSubmittedCourseEmailForAdmins
àà; \
(
àà\ ]
)
àà] ^
)
àà^ _
;
àà_ `
return
ää 
new
ää 
ResponseDTO
ää "
(
ää" #
)
ää# $
{
ãã 
Result
åå 
=
åå 
null
åå 
,
åå 
	IsSuccess
çç 
=
çç 
true
çç  
,
çç  !
Message
éé 
=
éé 
$str
éé >
,
éé> ?

StatusCode
èè 
=
èè 
$num
èè  
}
êê 
;
êê 
}
ëë 	
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 	
return
îî 
new
îî 
ResponseDTO
îî "
(
îî" #
)
îî# $
{
ïï 
Result
ññ 
=
ññ 
null
ññ 
,
ññ 
	IsSuccess
óó 
=
óó 
false
óó !
,
óó! "
Message
òò 
=
òò 
e
òò 
.
òò 
Message
òò #
,
òò# $

StatusCode
ôô 
=
ôô 
$num
ôô  
}
öö 
;
öö 
}
õõ 	
}
úú 
public
ûû 

async
ûû 
Task
ûû 
<
ûû 
ResponseDTO
ûû !
>
ûû! " 
MergeCourseVersion
ûû# 5
(
üü 
ClaimsPrincipal
†† 
User
†† 
,
†† 
Guid
°° 
courseVersionId
°° 
)
¢¢ 
{
££ 
try
§§ 
{
•• 	
var
¶¶ 
courseVersion
¶¶ 
=
¶¶ 
await
¶¶  %
_unitOfWork
¶¶& 1
.
¶¶1 2%
CourseVersionRepository
¶¶2 I
.
¶¶I J
GetAsync
¶¶J R
(
¶¶R S
x
¶¶S T
=>
¶¶U W
x
¶¶X Y
.
¶¶Y Z
Id
¶¶Z \
==
¶¶] _
courseVersionId
¶¶` o
)
¶¶o p
;
¶¶p q
if
ßß 
(
ßß 
courseVersion
ßß 
is
ßß  
null
ßß! %
)
ßß% &
{
®® 
return
©© 
new
©© 
ResponseDTO
©© &
(
©©& '
)
©©' (
{
™™ 
Result
´´ 
=
´´ 
null
´´ !
,
´´! "
	IsSuccess
¨¨ 
=
¨¨ 
false
¨¨  %
,
¨¨% &
Message
≠≠ 
=
≠≠ 
$str
≠≠ <
,
≠≠< =

StatusCode
ÆÆ 
=
ÆÆ  
$num
ÆÆ! $
}
ØØ 
;
ØØ 
}
∞∞ 
switch
≤≤ 
(
≤≤ 
courseVersion
≤≤ !
.
≤≤! "
CurrentStatus
≤≤" /
)
≤≤/ 0
{
≥≥ 
case
¥¥ '
StaticCourseVersionStatus
¥¥ .
.
¥¥. /
New
¥¥/ 2
:
¥¥2 3
{
µµ 
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ *
(
∂∂* +
)
∂∂+ ,
{
∑∑ 
Message
∏∏ 
=
∏∏  !
$str
∏∏" G
,
∏∏G H

StatusCode
ππ "
=
ππ# $
$num
ππ% (
,
ππ( )
	IsSuccess
∫∫ !
=
∫∫" #
false
∫∫$ )
,
∫∫) *
Result
ªª 
=
ªª  
null
ªª! %
}
ºº 
;
ºº 
}
ΩΩ 
case
ææ '
StaticCourseVersionStatus
ææ .
.
ææ. /
Rejected
ææ/ 7
:
ææ7 8
{
øø 
return
¿¿ 
new
¿¿ 
ResponseDTO
¿¿ *
(
¿¿* +
)
¿¿+ ,
{
¡¡ 
Message
¬¬ 
=
¬¬  !
$str
¬¬" E
,
¬¬E F

StatusCode
√√ "
=
√√# $
$num
√√% (
,
√√( )
	IsSuccess
ƒƒ !
=
ƒƒ" #
false
ƒƒ$ )
,
ƒƒ) *
Result
≈≈ 
=
≈≈  
null
≈≈! %
}
∆∆ 
;
∆∆ 
}
«« 
case
»» '
StaticCourseVersionStatus
»» .
.
»». /
	Submitted
»»/ 8
:
»»8 9
{
…… 
return
   
new
   
ResponseDTO
   *
(
  * +
)
  + ,
{
ÀÀ 
Message
ÃÃ 
=
ÃÃ  !
$str
ÃÃ" F
,
ÃÃF G

StatusCode
ÕÕ "
=
ÕÕ# $
$num
ÕÕ% (
,
ÕÕ( )
	IsSuccess
ŒŒ !
=
ŒŒ" #
false
ŒŒ$ )
,
ŒŒ) *
Result
œœ 
=
œœ  
null
œœ! %
}
–– 
;
–– 
}
—— 
case
““ '
StaticCourseVersionStatus
““ .
.
““. /
Merged
““/ 5
:
““5 6
{
”” 
return
‘‘ 
new
‘‘ 
ResponseDTO
‘‘ *
(
‘‘* +
)
‘‘+ ,
{
’’ 
Message
÷÷ 
=
÷÷  !
$str
÷÷" C
,
÷÷C D

StatusCode
◊◊ "
=
◊◊# $
$num
◊◊% (
,
◊◊( )
	IsSuccess
ÿÿ !
=
ÿÿ" #
false
ÿÿ$ )
,
ÿÿ) *
Result
ŸŸ 
=
ŸŸ  
null
ŸŸ! %
}
⁄⁄ 
;
⁄⁄ 
}
€€ 
case
‹‹ '
StaticCourseVersionStatus
‹‹ .
.
‹‹. /
Removed
‹‹/ 6
:
‹‹6 7
{
›› 
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ *
(
ﬁﬁ* +
)
ﬁﬁ+ ,
{
ﬂﬂ 
Message
‡‡ 
=
‡‡  !
$str
‡‡" D
,
‡‡D E

StatusCode
·· "
=
··# $
$num
··% (
,
··( )
	IsSuccess
‚‚ !
=
‚‚" #
false
‚‚$ )
,
‚‚) *
Result
„„ 
=
„„  
null
„„! %
}
‰‰ 
;
‰‰ 
}
ÂÂ 
default
ÊÊ 
:
ÊÊ 
{
ÁÁ 
courseVersion
ËË !
.
ËË! "
CurrentStatus
ËË" /
=
ËË0 1'
StaticCourseVersionStatus
ËË2 K
.
ËËK L
Merged
ËËL R
;
ËËR S
break
ÈÈ 
;
ÈÈ 
}
ÍÍ 
}
ÎÎ 
var
ÌÌ 
course
ÌÌ 
=
ÌÌ 
await
ÌÌ 
_unitOfWork
ÌÌ *
.
ÌÌ* +
CourseRepository
ÌÌ+ ;
.
ÌÌ; <
GetAsync
ÌÌ< D
(
ÌÌD E
x
ÌÌE F
=>
ÌÌG I
x
ÌÌJ K
.
ÌÌK L
Id
ÌÌL N
==
ÌÌO Q
courseVersion
ÌÌR _
.
ÌÌ_ `
CourseId
ÌÌ` h
)
ÌÌh i
;
ÌÌi j
if
ÔÔ 
(
ÔÔ 
course
ÔÔ 
is
ÔÔ 
null
ÔÔ 
)
ÔÔ 
{
 
return
ÒÒ 
new
ÒÒ 
ResponseDTO
ÒÒ &
(
ÒÒ& '
)
ÒÒ' (
{
ÚÚ 
Message
ÛÛ 
=
ÛÛ 
$str
ÛÛ 4
,
ÛÛ4 5

StatusCode
ÙÙ 
=
ÙÙ  
$num
ÙÙ! $
,
ÙÙ$ %
	IsSuccess
ıı 
=
ıı 
false
ıı  %
,
ıı% &
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ !
}
˜˜ 
;
˜˜ 
}
¯¯ 
course
˙˙ 
.
˙˙ 
CourseVersionId
˙˙ "
=
˙˙# $
courseVersion
˙˙% 2
.
˙˙2 3
Id
˙˙3 5
;
˙˙5 6
_unitOfWork
¸¸ 
.
¸¸ %
CourseVersionRepository
¸¸ /
.
¸¸/ 0
Update
¸¸0 6
(
¸¸6 7
courseVersion
¸¸7 D
)
¸¸D E
;
¸¸E F
_unitOfWork
˝˝ 
.
˝˝ 
CourseRepository
˝˝ (
.
˝˝( )
Update
˝˝) /
(
˝˝/ 0
course
˝˝0 6
)
˝˝6 7
;
˝˝7 8
await
˛˛ 
_unitOfWork
˛˛ 
.
˛˛ 
	SaveAsync
˛˛ '
(
˛˛' (
)
˛˛( )
;
˛˛) *
var
ÄÄ 
responseDto
ÄÄ 
=
ÄÄ 
await
ÄÄ #)
_courseVersionStatusService
ÄÄ$ ?
.
ÄÄ? @'
CreateCourseVersionStatus
ÄÄ@ Y
(
ÅÅ 
User
ÇÇ 
,
ÇÇ 
new
ÉÉ *
CreateCourseVersionStatusDTO
ÉÉ 0
(
ÉÉ0 1
)
ÉÉ1 2
{
ÑÑ 
CourseVersionId
ÖÖ #
=
ÖÖ$ %
courseVersion
ÖÖ& 3
.
ÖÖ3 4
Id
ÖÖ4 6
,
ÖÖ6 7
Status
ÜÜ 
=
ÜÜ '
StaticCourseVersionStatus
ÜÜ 6
.
ÜÜ6 7
Merged
ÜÜ7 =
,
ÜÜ= >
}
áá 
)
àà 
;
àà 
if
ää 
(
ää 
responseDto
ää 
.
ää 

StatusCode
ää &
==
ää' )
$num
ää* -
)
ää- .
{
ãã 
return
åå 
responseDto
åå "
;
åå" #
}
çç 
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Result
ëë 
=
ëë 
null
ëë 
,
ëë 
	IsSuccess
íí 
=
íí 
true
íí  
,
íí  !
Message
ìì 
=
ìì 
$str
ìì >
,
ìì> ?

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 	
return
ôô 
new
ôô 
ResponseDTO
ôô "
(
ôô" #
)
ôô# $
{
öö 
Result
õõ 
=
õõ 
null
õõ 
,
õõ 
	IsSuccess
úú 
=
úú 
false
úú !
,
úú! "
Message
ùù 
=
ùù 
e
ùù 
.
ùù 
Message
ùù #
,
ùù# $

StatusCode
ûû 
=
ûû 
$num
ûû  
}
üü 
;
üü 
}
†† 	
}
°° 
public
££ 

async
££ 
Task
££ 
<
££ 
ResponseDTO
££ !
>
££! "'
GetCourseVersionsComments
££# <
(
§§ 
ClaimsPrincipal
•• 
User
•• 
,
•• 
Guid
¶¶ 
?
¶¶ 
courseVersionId
¶¶ 
,
¶¶ 
string
ßß 
?
ßß 
filterOn
ßß 
,
ßß 
string
®® 
?
®® 
filterQuery
®® 
,
®® 
string
©© 
?
©© 
sortBy
©© 
,
©© 
int
™™ 

pageNumber
™™ 
,
™™ 
int
´´ 
pageSize
´´ 
)
¨¨ 
{
≠≠ 
try
ÆÆ 
{
ØØ 	
var
±± 
userRole
±± 
=
±± 
User
±± 
.
±±  
Claims
±±  &
.
±±& '
FirstOrDefault
±±' 5
(
±±5 6
x
±±6 7
=>
±±8 :
x
±±; <
.
±±< =
Type
±±= A
==
±±B D

ClaimTypes
±±E O
.
±±O P
Role
±±P T
)
±±T U
?
±±U V
.
±±V W
Value
±±W \
;
±±\ ]
IEnumerable
≥≥ 
<
≥≥ "
CourseVersionComment
≥≥ ,
>
≥≥, -
comments
≥≥. 6
;
≥≥6 7
if
µµ 
(
µµ 
userRole
µµ 
==
µµ 
StaticUserRoles
µµ +
.
µµ+ ,
Admin
µµ, 1
)
µµ1 2
{
∂∂ 
comments
∏∏ 
=
∏∏ 
await
∏∏  
_unitOfWork
∏∏! ,
.
∏∏, -,
CourseVersionCommentRepository
∏∏- K
.
∏∏K L
GetAllAsync
∏∏L W
(
∏∏W X
x
∏∏X Y
=>
∏∏Z \
x
ππ 
.
ππ 
CourseVersionId
ππ %
==
ππ& (
courseVersionId
ππ) 8
)
ππ8 9
;
ππ9 :
}
∫∫ 
else
ªª 
{
ºº 
comments
ææ 
=
ææ 
await
ææ  
_unitOfWork
ææ! ,
.
ææ, -,
CourseVersionCommentRepository
ææ- K
.
ææK L
GetAllAsync
ææL W
(
ææW X
x
ææX Y
=>
ææZ \
x
øø 
.
øø 
CourseVersionId
øø %
==
øø& (
courseVersionId
øø) 8
&&
øø9 ;
x
øø< =
.
øø= >
Status
øø> D
<=
øøE G
StaticStatus
øøH T
.
øøT U
Category
øøU ]
.
øø] ^
	Activated
øø^ g
)
øøg h
;
øøh i
}
¿¿ 
if
√√ 
(
√√ 
!
√√ 
comments
√√ 
.
√√ 
Any
√√ 
(
√√ 
)
√√ 
)
√√  
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
(
≈≈& '
)
≈≈' (
{
∆∆ 
Message
«« 
=
«« 
$str
«« 5
,
««5 6
	IsSuccess
»» 
=
»» 
true
»»  $
,
»»$ %

StatusCode
…… 
=
……  
$num
……! $
,
……$ %
Result
   
=
   
null
   !
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
var
ŒŒ 
listComments
ŒŒ 
=
ŒŒ 
comments
ŒŒ '
.
ŒŒ' (
ToList
ŒŒ( .
(
ŒŒ. /
)
ŒŒ/ 0
;
ŒŒ0 1
if
—— 
(
—— 
!
—— 
string
—— 
.
—— 
IsNullOrEmpty
—— %
(
——% &
filterOn
——& .
)
——. /
&&
——0 2
!
——3 4
string
——4 :
.
——: ;
IsNullOrEmpty
——; H
(
——H I
filterQuery
——I T
)
——T U
)
——U V
{
““ 
switch
”” 
(
”” 
filterOn
””  
.
””  !
Trim
””! %
(
””% &
)
””& '
.
””' (
ToLower
””( /
(
””/ 0
)
””0 1
)
””1 2
{
‘‘ 
case
’’ 
$str
’’ "
:
’’" #
listComments
÷÷ $
=
÷÷% &
listComments
÷÷' 3
.
÷÷3 4
Where
÷÷4 9
(
÷÷9 :
x
÷÷: ;
=>
÷÷< >
x
◊◊ 
.
◊◊ 
Comment
◊◊ %
.
◊◊% &
Contains
◊◊& .
(
◊◊. /
filterQuery
◊◊/ :
,
◊◊: ;
StringComparison
◊◊< L
.
◊◊L M&
CurrentCultureIgnoreCase
◊◊M e
)
◊◊e f
)
◊◊f g
.
◊◊g h
ToList
◊◊h n
(
◊◊n o
)
◊◊o p
;
◊◊p q
break
ÿÿ 
;
ÿÿ 
case
ŸŸ 
$str
ŸŸ #
:
ŸŸ# $
listComments
⁄⁄ $
=
⁄⁄% &
listComments
⁄⁄' 3
.
⁄⁄3 4
Where
⁄⁄4 9
(
⁄⁄9 :
x
⁄⁄: ;
=>
⁄⁄< >
x
€€ 
.
€€ 
CreateBy
€€ &
.
€€& '
Contains
€€' /
(
€€/ 0
filterQuery
€€0 ;
,
€€; <
StringComparison
€€= M
.
€€M N&
CurrentCultureIgnoreCase
€€N f
)
€€f g
)
€€g h
.
€€h i
ToList
€€i o
(
€€o p
)
€€p q
;
€€q r
break
‹‹ 
;
‹‹ 
case
›› 
$str
›› #
:
››# $
listComments
ﬁﬁ $
=
ﬁﬁ% &
listComments
ﬁﬁ' 3
.
ﬁﬁ3 4
Where
ﬁﬁ4 9
(
ﬁﬁ9 :
x
ﬁﬁ: ;
=>
ﬁﬁ< >
x
ﬂﬂ 
.
ﬂﬂ 
UpdateBy
ﬂﬂ &
.
ﬂﬂ& '
Contains
ﬂﬂ' /
(
ﬂﬂ/ 0
filterQuery
ﬂﬂ0 ;
,
ﬂﬂ; <
StringComparison
ﬂﬂ= M
.
ﬂﬂM N&
CurrentCultureIgnoreCase
ﬂﬂN f
)
ﬂﬂf g
)
ﬂﬂg h
.
ﬂﬂh i
ToList
ﬂﬂi o
(
ﬂﬂo p
)
ﬂﬂp q
;
ﬂﬂq r
break
‡‡ 
;
‡‡ 
case
·· 
$str
·· %
:
··% &
listComments
‚‚ $
=
‚‚% &
listComments
‚‚' 3
.
‚‚3 4
Where
‚‚4 9
(
‚‚9 :
x
‚‚: ;
=>
‚‚< >
x
„„  !
.
„„! "

CreateTime
„„" ,
.
„„, -
HasValue
„„- 5
&&
„„6 8
x
„„9 :
.
„„: ;

CreateTime
„„; E
.
„„E F
Value
„„F K
.
„„K L
Date
„„L P
==
„„Q S
DateTime
„„T \
.
„„\ ]
Parse
„„] b
(
„„b c
filterQuery
„„c n
)
„„n o
.
„„o p
Date
„„p t
)
„„t u
.
‰‰ 
ToList
‰‰ #
(
‰‰# $
)
‰‰$ %
;
‰‰% &
break
ÂÂ 
;
ÂÂ 
case
ÊÊ 
$str
ÊÊ %
:
ÊÊ% &
listComments
ÁÁ $
=
ÁÁ% &
listComments
ÁÁ' 3
.
ÁÁ3 4
Where
ÁÁ4 9
(
ÁÁ9 :
x
ÁÁ: ;
=>
ÁÁ< >
x
ËË  !
.
ËË! "

UpdateTime
ËË" ,
.
ËË, -
HasValue
ËË- 5
&&
ËË6 8
x
ËË9 :
.
ËË: ;

UpdateTime
ËË; E
.
ËËE F
Value
ËËF K
.
ËËK L
Date
ËËL P
==
ËËQ S
DateTime
ËËT \
.
ËË\ ]
Parse
ËË] b
(
ËËb c
filterQuery
ËËc n
)
ËËn o
.
ËËo p
Date
ËËp t
)
ËËt u
.
ÈÈ 
ToList
ÈÈ #
(
ÈÈ# $
)
ÈÈ$ %
;
ÈÈ% &
break
ÍÍ 
;
ÍÍ 
case
ÎÎ 
$str
ÎÎ !
:
ÎÎ! "
if
ÏÏ 
(
ÏÏ 
int
ÏÏ 
.
ÏÏ  
TryParse
ÏÏ  (
(
ÏÏ( )
filterQuery
ÏÏ) 4
,
ÏÏ4 5
out
ÏÏ6 9
var
ÏÏ: =
status
ÏÏ> D
)
ÏÏD E
)
ÏÏE F
{
ÌÌ 
listComments
ÓÓ (
=
ÓÓ) *
listComments
ÓÓ+ 7
.
ÓÓ7 8
Where
ÓÓ8 =
(
ÓÓ= >
x
ÓÓ> ?
=>
ÓÓ@ B
x
ÓÓC D
.
ÓÓD E
Status
ÓÓE K
==
ÓÓL N
status
ÓÓO U
)
ÓÓU V
.
ÓÓV W
ToList
ÓÓW ]
(
ÓÓ] ^
)
ÓÓ^ _
;
ÓÓ_ `
}
ÔÔ 
break
ÒÒ 
;
ÒÒ 
default
ÚÚ 
:
ÚÚ 
break
ÛÛ 
;
ÛÛ 
}
ÙÙ 
}
ıı 
if
¯¯ 
(
¯¯ 
!
¯¯ 
string
¯¯ 
.
¯¯ 
IsNullOrEmpty
¯¯ %
(
¯¯% &
sortBy
¯¯& ,
)
¯¯, -
)
¯¯- .
{
˘˘ 
switch
˙˙ 
(
˙˙ 
sortBy
˙˙ 
.
˙˙ 
Trim
˙˙ #
(
˙˙# $
)
˙˙$ %
.
˙˙% &
ToLower
˙˙& -
(
˙˙- .
)
˙˙. /
)
˙˙/ 0
{
˚˚ 
case
¸¸ 
$str
¸¸ "
:
¸¸" #
listComments
˝˝ $
=
˝˝% &
listComments
˝˝' 3
.
˝˝3 4
OrderBy
˝˝4 ;
(
˝˝; <
x
˝˝< =
=>
˝˝> @
x
˝˝A B
.
˝˝B C
Comment
˝˝C J
)
˝˝J K
.
˝˝K L
ToList
˝˝L R
(
˝˝R S
)
˝˝S T
;
˝˝T U
break
˛˛ 
;
˛˛ 
case
ˇˇ 
$str
ˇˇ #
:
ˇˇ# $
listComments
Ä	Ä	 $
=
Ä	Ä	% &
listComments
Ä	Ä	' 3
.
Ä	Ä	3 4
OrderBy
Ä	Ä	4 ;
(
Ä	Ä	; <
x
Ä	Ä	< =
=>
Ä	Ä	> @
x
Ä	Ä	A B
.
Ä	Ä	B C
CreateBy
Ä	Ä	C K
)
Ä	Ä	K L
.
Ä	Ä	L M
ToList
Ä	Ä	M S
(
Ä	Ä	S T
)
Ä	Ä	T U
;
Ä	Ä	U V
break
Å	Å	 
;
Å	Å	 
case
Ç	Ç	 
$str
Ç	Ç	 #
:
Ç	Ç	# $
listComments
É	É	 $
=
É	É	% &
listComments
É	É	' 3
.
É	É	3 4
OrderBy
É	É	4 ;
(
É	É	; <
x
É	É	< =
=>
É	É	> @
x
É	É	A B
.
É	É	B C
UpdateBy
É	É	C K
)
É	É	K L
.
É	É	L M
ToList
É	É	M S
(
É	É	S T
)
É	É	T U
;
É	É	U V
break
Ñ	Ñ	 
;
Ñ	Ñ	 
case
Ö	Ö	 
$str
Ö	Ö	 %
:
Ö	Ö	% &
listComments
Ü	Ü	 $
=
Ü	Ü	% &
listComments
Ü	Ü	' 3
.
Ü	Ü	3 4
OrderBy
Ü	Ü	4 ;
(
Ü	Ü	; <
x
Ü	Ü	< =
=>
Ü	Ü	> @
x
Ü	Ü	A B
.
Ü	Ü	B C

CreateTime
Ü	Ü	C M
)
Ü	Ü	M N
.
Ü	Ü	N O
ToList
Ü	Ü	O U
(
Ü	Ü	U V
)
Ü	Ü	V W
;
Ü	Ü	W X
break
á	á	 
;
á	á	 
case
à	à	 
$str
à	à	 %
:
à	à	% &
listComments
â	â	 $
=
â	â	% &
listComments
â	â	' 3
.
â	â	3 4
OrderBy
â	â	4 ;
(
â	â	; <
x
â	â	< =
=>
â	â	> @
x
â	â	A B
.
â	â	B C

UpdateTime
â	â	C M
)
â	â	M N
.
â	â	N O
ToList
â	â	O U
(
â	â	U V
)
â	â	V W
;
â	â	W X
break
ä	ä	 
;
ä	ä	 
case
ã	ã	 
$str
ã	ã	 !
:
ã	ã	! "
listComments
å	å	 $
=
å	å	% &
listComments
å	å	' 3
.
å	å	3 4
OrderBy
å	å	4 ;
(
å	å	; <
x
å	å	< =
=>
å	å	> @
x
å	å	A B
.
å	å	B C
Status
å	å	C I
)
å	å	I J
.
å	å	J K
ToList
å	å	K Q
(
å	å	Q R
)
å	å	R S
;
å	å	S T
break
ç	ç	 
;
ç	ç	 
default
é	é	 
:
é	é	 
break
è	è	 
;
è	è	 
}
ê	ê	 
}
ë	ë	 
else
í	í	 
{
ì	ì	 
listComments
ï	ï	 
=
ï	ï	 
listComments
ï	ï	 +
.
ï	ï	+ ,
OrderByDescending
ï	ï	, =
(
ï	ï	= >
x
ï	ï	> ?
=>
ï	ï	@ B
x
ï	ï	C D
.
ï	ï	D E

CreateTime
ï	ï	E O
)
ï	ï	O P
.
ï	ï	P Q
ToList
ï	ï	Q W
(
ï	ï	W X
)
ï	ï	X Y
;
ï	ï	Y Z
}
ñ	ñ	 
if
ô	ô	 
(
ô	ô	 

pageNumber
ô	ô	 
>
ô	ô	 
$num
ô	ô	 
&&
ô	ô	 !
pageSize
ô	ô	" *
>
ô	ô	+ ,
$num
ô	ô	- .
)
ô	ô	. /
{
ö	ö	 
var
õ	õ	 

skipResult
õ	õ	 
=
õ	õ	  
(
õ	õ	! "

pageNumber
õ	õ	" ,
-
õ	õ	- .
$num
õ	õ	/ 0
)
õ	õ	0 1
*
õ	õ	2 3
pageSize
õ	õ	4 <
;
õ	õ	< =
listComments
ú	ú	 
=
ú	ú	 
listComments
ú	ú	 +
.
ú	ú	+ ,
Skip
ú	ú	, 0
(
ú	ú	0 1

skipResult
ú	ú	1 ;
)
ú	ú	; <
.
ú	ú	< =
Take
ú	ú	= A
(
ú	ú	A B
pageSize
ú	ú	B J
)
ú	ú	J K
.
ú	ú	K L
ToList
ú	ú	L R
(
ú	ú	R S
)
ú	ú	S T
;
ú	ú	T U
}
ù	ù	 
var
†	†	 
commentsDto
†	†	 
=
†	†	 
listComments
†	†	 *
.
†	†	* +
Select
†	†	+ 1
(
†	†	1 2
comment
†	†	2 9
=>
†	†	: <
new
†	†	= @
GetAllCommentsDTO
†	†	A R
{
°	°	 
Id
¢	¢	 
=
¢	¢	 
comment
¢	¢	 
.
¢	¢	 
Id
¢	¢	 
,
¢	¢	  
Comment
£	£	 
=
£	£	 
comment
£	£	 !
.
£	£	! "
Comment
£	£	" )
,
£	£	) *

CreateTime
§	§	 
=
§	§	 
comment
§	§	 $
.
§	§	$ %

CreateTime
§	§	% /
,
§	§	/ 0
CreateBy
•	•	 
=
•	•	 
comment
•	•	 "
.
•	•	" #
CreateBy
•	•	# +
,
•	•	+ ,

UpdateTime
¶	¶	 
=
¶	¶	 
comment
¶	¶	 $
.
¶	¶	$ %

UpdateTime
¶	¶	% /
,
¶	¶	/ 0
UpdateBy
ß	ß	 
=
ß	ß	 
comment
ß	ß	 "
.
ß	ß	" #
UpdateBy
ß	ß	# +
,
ß	ß	+ ,
Status
®	®	 
=
®	®	 
comment
®	®	  
.
®	®	  !
Status
®	®	! '
}
©	©	 
)
©	©	 
.
©	©	 
ToList
©	©	 
(
©	©	 
)
©	©	 
;
©	©	 
return
´	´	 
new
´	´	 
ResponseDTO
´	´	 "
(
´	´	" #
)
´	´	# $
{
¨	¨	 
Message
≠	≠	 
=
≠	≠	 
$str
≠	≠	 D
,
≠	≠	D E
	IsSuccess
Æ	Æ	 
=
Æ	Æ	 
true
Æ	Æ	  
,
Æ	Æ	  !

StatusCode
Ø	Ø	 
=
Ø	Ø	 
$num
Ø	Ø	  
,
Ø	Ø	  !
Result
∞	∞	 
=
∞	∞	 
commentsDto
∞	∞	 $
}
±	±	 
;
±	±	 
}
≤	≤	 	
catch
≥	≥	 
(
≥	≥	 
	Exception
≥	≥	 
e
≥	≥	 
)
≥	≥	 
{
¥	¥	 	
return
µ	µ	 
new
µ	µ	 
ResponseDTO
µ	µ	 "
(
µ	µ	" #
)
µ	µ	# $
{
∂	∂	 
Message
∑	∑	 
=
∑	∑	 
e
∑	∑	 
.
∑	∑	 
Message
∑	∑	 #
,
∑	∑	# $
Result
∏	∏	 
=
∏	∏	 
null
∏	∏	 
,
∏	∏	 
	IsSuccess
π	π	 
=
π	π	 
false
π	π	 !
,
π	π	! "

StatusCode
∫	∫	 
=
∫	∫	 
$num
∫	∫	  
}
ª	ª	 
;
ª	ª	 
}
º	º	 	
}
Ω	Ω	 
public
¡	¡	 

async
¡	¡	 
Task
¡	¡	 
<
¡	¡	 
ResponseDTO
¡	¡	 !
>
¡	¡	! "%
GetCourseVersionComment
¡	¡	# :
(
¡	¡	: ;
ClaimsPrincipal
¡	¡	; J
User
¡	¡	K O
,
¡	¡	O P
Guid
¡	¡	Q U$
courseVersionCommentId
¡	¡	V l
)
¡	¡	l m
{
¬	¬	 
try
√	√	 
{
ƒ	ƒ	 	
var
≈	≈	 "
courseVersionComment
≈	≈	 $
=
≈	≈	% &
await
∆	∆	 
_unitOfWork
∆	∆	 !
.
∆	∆	! ",
CourseVersionCommentRepository
∆	∆	" @
.
∆	∆	@ A)
GetCourseVersionCommentById
∆	∆	A \
(
∆	∆	\ ]$
courseVersionCommentId
∆	∆	] s
)
∆	∆	s t
;
∆	∆	t u
if
»	»	 
(
»	»	 "
courseVersionComment
»	»	 $
is
»	»	% '
null
»	»	( ,
)
»	»	, -
{
…	…	 
return
 	 	 
new
 	 	 
ResponseDTO
 	 	 &
(
 	 	& '
)
 	 	' (
{
À	À	 
Result
Ã	Ã	 
=
Ã	Ã	 
$str
Ã	Ã	 
,
Ã	Ã	  
Message
Õ	Õ	 
=
Õ	Õ	 
$str
Õ	Õ	 <
,
Õ	Õ	< =
	IsSuccess
Œ	Œ	 
=
Œ	Œ	 
true
Œ	Œ	  $
,
Œ	Œ	$ %

StatusCode
œ	œ	 
=
œ	œ	  
$num
œ	œ	! $
}
–	–	 
;
–	–	 
}
—	—	 
var
”	”	 %
courseVersionCommentDto
”	”	 '
=
”	”	( )
_mapper
”	”	* 1
.
”	”	1 2
Map
”	”	2 5
<
”	”	5 6!
GetCourseCommnetDTO
”	”	6 I
>
”	”	I J
(
”	”	J K"
courseVersionComment
”	”	K _
)
”	”	_ `
;
”	”	` a
return
’	’	 
new
’	’	 
ResponseDTO
’	’	 "
(
’	’	" #
)
’	’	# $
{
÷	÷	 
Result
◊	◊	 
=
◊	◊	 %
courseVersionCommentDto
◊	◊	 0
,
◊	◊	0 1
Message
ÿ	ÿ	 
=
ÿ	ÿ	 
$str
ÿ	ÿ	 ;
,
ÿ	ÿ	; <
	IsSuccess
Ÿ	Ÿ	 
=
Ÿ	Ÿ	 
true
Ÿ	Ÿ	  
,
Ÿ	Ÿ	  !

StatusCode
⁄	⁄	 
=
⁄	⁄	 
$num
⁄	⁄	  
}
€	€	 
;
€	€	 
}
‹	‹	 	
catch
›	›	 
(
›	›	 
	Exception
›	›	 
e
›	›	 
)
›	›	 
{
ﬁ	ﬁ	 	
return
ﬂ	ﬂ	 
new
ﬂ	ﬂ	 
ResponseDTO
ﬂ	ﬂ	 "
(
ﬂ	ﬂ	" #
)
ﬂ	ﬂ	# $
{
‡	‡	 
Result
·	·	 
=
·	·	 
null
·	·	 
,
·	·	 
Message
‚	‚	 
=
‚	‚	 
e
‚	‚	 
.
‚	‚	 
Message
‚	‚	 #
,
‚	‚	# $
	IsSuccess
„	„	 
=
„	„	 
true
„	„	  
,
„	„	  !

StatusCode
‰	‰	 
=
‰	‰	 
$num
‰	‰	  
}
Â	Â	 
;
Â	Â	 
}
Ê	Ê	 	
}
Á	Á	 
public
Í	Í	 

async
Í	Í	 
Task
Í	Í	 
<
Í	Í	 
ResponseDTO
Í	Í	 !
>
Í	Í	! "(
CreateCourseVersionComment
Í	Í	# =
(
Í	Í	= >
ClaimsPrincipal
Í	Í	> M
User
Í	Í	N R
,
Í	Í	R S,
CreateCourseVersionCommentsDTO
Î	Î	 &,
createCourseVersionCommentsDTO
Î	Î	' E
)
Î	Î	E F
{
Ï	Ï	 
try
Ì	Ì	 
{
Ó	Ó	 	
var
		 
courseVersionId
		 
=
		  !
await
Ò	Ò	 
_unitOfWork
Ò	Ò	 !
.
Ò	Ò	! "%
CourseVersionRepository
Ò	Ò	" 9
.
Ò	Ò	9 :
GetAsync
Ò	Ò	: B
(
Ò	Ò	B C
c
Ò	Ò	C D
=>
Ò	Ò	E G
c
Ú	Ú	 
.
Ú	Ú	 
Id
Ú	Ú	 
==
Ú	Ú	 ,
createCourseVersionCommentsDTO
Ú	Ú	 :
.
Ú	Ú	: ;
CourseVersionId
Ú	Ú	; J
)
Ú	Ú	J K
;
Ú	Ú	K L
if
Û	Û	 
(
Û	Û	 
courseVersionId
Û	Û	 
==
Û	Û	  "
null
Û	Û	# '
)
Û	Û	' (
{
Ù	Ù	 
return
ı	ı	 
new
ı	ı	 
ResponseDTO
ı	ı	 &
(
ı	ı	& '
)
ı	ı	' (
{
ˆ	ˆ	 
Message
˜	˜	 
=
˜	˜	 
$str
˜	˜	 7
,
˜	˜	7 8
Result
¯	¯	 
=
¯	¯	 
null
¯	¯	 !
,
¯	¯	! "
	IsSuccess
˘	˘	 
=
˘	˘	 
false
˘	˘	  %
,
˘	˘	% &

StatusCode
˙	˙	 
=
˙	˙	  
$num
˙	˙	! $
}
˚	˚	 
;
˚	˚	 
}
¸	¸	 
var
˛	˛	 
userId
˛	˛	 
=
˛	˛	 
User
˛	˛	 
.
˛	˛	 
Claims
˛	˛	 $
.
˛	˛	$ %
FirstOrDefault
˛	˛	% 3
(
˛	˛	3 4
x
˛	˛	4 5
=>
˛	˛	6 8
x
˛	˛	9 :
.
˛	˛	: ;
Type
˛	˛	; ?
==
˛	˛	@ B

ClaimTypes
˛	˛	C M
.
˛	˛	M N
NameIdentifier
˛	˛	N \
)
˛	˛	\ ]
?
˛	˛	] ^
.
˛	˛	^ _
Value
˛	˛	_ d
;
˛	˛	d e
var
ˇ	ˇ	 
admin
ˇ	ˇ	 
=
ˇ	ˇ	 
await
ˇ	ˇ	 
_unitOfWork
ˇ	ˇ	 )
.
ˇ	ˇ	) *#
UserManagerRepository
ˇ	ˇ	* ?
.
ˇ	ˇ	? @
FindByIdAsync
ˇ	ˇ	@ M
(
ˇ	ˇ	M N
userId
ˇ	ˇ	N T
)
ˇ	ˇ	T U
;
ˇ	ˇ	U V"
CourseVersionComment
Ç
Ç
  
comment
Ç
Ç
! (
=
Ç
Ç
) *
new
Ç
Ç
+ ."
CourseVersionComment
Ç
Ç
/ C
(
Ç
Ç
C D
)
Ç
Ç
D E
{
É
É
 
Comment
Ñ
Ñ
 
=
Ñ
Ñ
 ,
createCourseVersionCommentsDTO
Ñ
Ñ
 8
.
Ñ
Ñ
8 9
Comment
Ñ
Ñ
9 @
,
Ñ
Ñ
@ A
CourseVersionId
Ö
Ö
 
=
Ö
Ö
  !,
createCourseVersionCommentsDTO
Ö
Ö
" @
.
Ö
Ö
@ A
CourseVersionId
Ö
Ö
A P
,
Ö
Ö
P Q
CreateBy
Ü
Ü
 
=
Ü
Ü
 
admin
Ü
Ü
  
.
Ü
Ü
  !
Email
Ü
Ü
! &
,
Ü
Ü
& '

CreateTime
á
á
 
=
á
á
 
DateTime
á
á
 %
.
á
á
% &
Now
á
á
& )
,
á
á
) *

UpdateTime
à
à
 
=
à
à
 
null
à
à
 !
,
à
à
! "
UpdateBy
â
â
 
=
â
â
 
$str
â
â
 
,
â
â
 
Status
ä
ä
 
=
ä
ä
 
$num
ä
ä
 
}
ã
ã
 
;
ã
ã
 
await
é
é
 
_unitOfWork
é
é
 
.
é
é
 ,
CourseVersionCommentRepository
é
é
 <
.
é
é
< =
AddAsync
é
é
= E
(
é
é
E F
comment
é
é
F M
)
é
é
M N
;
é
é
N O
await
è
è
 
_unitOfWork
è
è
 
.
è
è
 
	SaveAsync
è
è
 '
(
è
è
' (
)
è
è
( )
;
è
è
) *
return
ë
ë
 
new
ë
ë
 
ResponseDTO
ë
ë
 "
(
ë
ë
" #
)
ë
ë
# $
{
í
í
 
Message
ì
ì
 
=
ì
ì
 
$str
ì
ì
 8
,
ì
ì
8 9
Result
î
î
 
=
î
î
 
comment
î
î
  
,
î
î
  !
	IsSuccess
ï
ï
 
=
ï
ï
 
true
ï
ï
  
,
ï
ï
  !

StatusCode
ñ
ñ
 
=
ñ
ñ
 
$num
ñ
ñ
  
,
ñ
ñ
  !
}
ó
ó
 
;
ó
ó
 
}
ò
ò
 	
catch
ô
ô
 
(
ô
ô
 
	Exception
ô
ô
 
e
ô
ô
 
)
ô
ô
 
{
ö
ö
 	
return
õ
õ
 
new
õ
õ
 
ResponseDTO
õ
õ
 "
{
ú
ú
 
Message
ù
ù
 
=
ù
ù
 
e
ù
ù
 
.
ù
ù
 
Message
ù
ù
 #
,
ù
ù
# $
Result
û
û
 
=
û
û
 
null
û
û
 
,
û
û
 
	IsSuccess
ü
ü
 
=
ü
ü
 
false
ü
ü
 !
,
ü
ü
! "

StatusCode
†
†
 
=
†
†
 
$num
†
†
  
}
°
°
 
;
°
°
 
}
¢
¢
 	
}
£
£
 
public
¶
¶
 

async
¶
¶
 
Task
¶
¶
 
<
¶
¶
 
ResponseDTO
¶
¶
 !
>
¶
¶
! "&
EditCourseVersionComment
¶
¶
# ;
(
¶
¶
; <
ClaimsPrincipal
¶
¶
< K
User
¶
¶
L P
,
¶
¶
P Q*
EditCourseVersionCommentsDTO
ß
ß
 $*
editCourseVersionCommentsDTO
ß
ß
% A
)
ß
ß
A B
{
®
®
 
try
©
©
 
{
™
™
 	
var
¨
¨
 
courseVersionId
¨
¨
 
=
¨
¨
  !
await
≠
≠
 
_unitOfWork
≠
≠
 !
.
≠
≠
! ",
CourseVersionCommentRepository
≠
≠
" @
.
≠
≠
@ A
GetAsync
≠
≠
A I
(
≠
≠
I J
c
≠
≠
J K
=>
≠
≠
L N
c
Æ
Æ
 
.
Æ
Æ
 
Id
Æ
Æ
 
==
Æ
Æ
 *
editCourseVersionCommentsDTO
Æ
Æ
 8
.
Æ
Æ
8 9
Id
Æ
Æ
9 ;
)
Æ
Æ
; <
;
Æ
Æ
< =
if
Ø
Ø
 
(
Ø
Ø
 
courseVersionId
Ø
Ø
 
==
Ø
Ø
  "
null
Ø
Ø
# '
)
Ø
Ø
' (
{
∞
∞
 
return
±
±
 
new
±
±
 
ResponseDTO
±
±
 &
(
±
±
& '
)
±
±
' (
{
≤
≤
 
Message
≥
≥
 
=
≥
≥
 
$str
≥
≥
 7
,
≥
≥
7 8
Result
¥
¥
 
=
¥
¥
 
null
¥
¥
 !
,
¥
¥
! "
	IsSuccess
µ
µ
 
=
µ
µ
 
false
µ
µ
  %
,
µ
µ
% &

StatusCode
∂
∂
 
=
∂
∂
  
$num
∂
∂
! $
}
∑
∑
 
;
∑
∑
 
}
∏
∏
 
var
∫
∫
 
userId
∫
∫
 
=
∫
∫
 
User
∫
∫
 
.
∫
∫
 
Claims
∫
∫
 $
.
∫
∫
$ %
FirstOrDefault
∫
∫
% 3
(
∫
∫
3 4
x
∫
∫
4 5
=>
∫
∫
6 8
x
∫
∫
9 :
.
∫
∫
: ;
Type
∫
∫
; ?
==
∫
∫
@ B

ClaimTypes
∫
∫
C M
.
∫
∫
M N
NameIdentifier
∫
∫
N \
)
∫
∫
\ ]
?
∫
∫
] ^
.
∫
∫
^ _
Value
∫
∫
_ d
;
∫
∫
d e
var
ª
ª
 
admin
ª
ª
 
=
ª
ª
 
await
ª
ª
 
_unitOfWork
ª
ª
 )
.
ª
ª
) *#
UserManagerRepository
ª
ª
* ?
.
ª
ª
? @
FindByIdAsync
ª
ª
@ M
(
ª
ª
M N
userId
ª
ª
N T
)
ª
ª
T U
;
ª
ª
U V
courseVersionId
æ
æ
 
.
æ
æ
 

UpdateTime
æ
æ
 &
=
æ
æ
' (
DateTime
æ
æ
) 1
.
æ
æ
1 2
UtcNow
æ
æ
2 8
;
æ
æ
8 9
courseVersionId
ø
ø
 
.
ø
ø
 
UpdateBy
ø
ø
 $
=
ø
ø
% &
admin
ø
ø
' ,
.
ø
ø
, -
Email
ø
ø
- 2
;
ø
ø
2 3
courseVersionId
¿
¿
 
.
¿
¿
 
Comment
¿
¿
 #
=
¿
¿
$ %*
editCourseVersionCommentsDTO
¿
¿
& B
.
¿
¿
B C
Comment
¿
¿
C J
;
¿
¿
J K
courseVersionId
¡
¡
 
.
¡
¡
 
Status
¡
¡
 "
=
¡
¡
# $
$num
¡
¡
% &
;
¡
¡
& '
_unitOfWork
√
√
 
.
√
√
 ,
CourseVersionCommentRepository
√
√
 6
.
√
√
6 7
Update
√
√
7 =
(
√
√
= >
courseVersionId
√
√
> M
)
√
√
M N
;
√
√
N O
await
ƒ
ƒ
 
_unitOfWork
ƒ
ƒ
 
.
ƒ
ƒ
 
	SaveAsync
ƒ
ƒ
 '
(
ƒ
ƒ
' (
)
ƒ
ƒ
( )
;
ƒ
ƒ
) *
return
∆
∆
 
new
∆
∆
 
ResponseDTO
∆
∆
 "
(
∆
∆
" #
)
∆
∆
# $
{
«
«
 
Message
»
»
 
=
»
»
 
$str
»
»
 7
,
»
»
7 8
Result
…
…
 
=
…
…
 
null
…
…
 
,
…
…
 
	IsSuccess
 
 
 
=
 
 
 
true
 
 
  
,
 
 
  !

StatusCode
À
À
 
=
À
À
 
$num
À
À
  
,
À
À
  !
}
Ã
Ã
 
;
Ã
Ã
 
}
Õ
Õ
 	
catch
Œ
Œ
 
(
Œ
Œ
 
	Exception
Œ
Œ
 
e
Œ
Œ
 
)
Œ
Œ
 
{
œ
œ
 	
return
–
–
 
new
–
–
 
ResponseDTO
–
–
 "
{
—
—
 
Message
“
“
 
=
“
“
 
e
“
“
 
.
“
“
 
Message
“
“
 #
,
“
“
# $
Result
”
”
 
=
”
”
 
null
”
”
 
,
”
”
 
	IsSuccess
‘
‘
 
=
‘
‘
 
false
‘
‘
 !
,
‘
‘
! "

StatusCode
’
’
 
=
’
’
 
$num
’
’
  
}
÷
÷
 
;
÷
÷
 
}
◊
◊
 	
}
ÿ
ÿ
 
public
€
€
 

async
€
€
 
Task
€
€
 
<
€
€
 
ResponseDTO
€
€
 !
>
€
€
! "(
RemoveCourseVersionComment
€
€
# =
(
€
€
= >
ClaimsPrincipal
€
€
> M
User
€
€
N R
,
€
€
R S
Guid
‹
‹
 
	commentId
‹
‹
 
)
‹
‹
 
{
›
›
 
try
ﬁ
ﬁ
 
{
ﬂ
ﬂ
 	
var
·
·
 
courseVersionId
·
·
 
=
·
·
  !
await
‚
‚
 
_unitOfWork
‚
‚
 !
.
‚
‚
! ",
CourseVersionCommentRepository
‚
‚
" @
.
‚
‚
@ A
GetAsync
‚
‚
A I
(
‚
‚
I J
c
‚
‚
J K
=>
‚
‚
L N
c
„
„
 
.
„
„
 
Id
„
„
 
==
„
„
 
	commentId
„
„
 %
)
„
„
% &
;
„
„
& '
if
‰
‰
 
(
‰
‰
 
courseVersionId
‰
‰
 
==
‰
‰
  "
null
‰
‰
# '
)
‰
‰
' (
{
Â
Â
 
return
Ê
Ê
 
new
Ê
Ê
 
ResponseDTO
Ê
Ê
 &
(
Ê
Ê
& '
)
Ê
Ê
' (
{
Á
Á
 
Message
Ë
Ë
 
=
Ë
Ë
 
$str
Ë
Ë
 7
,
Ë
Ë
7 8
Result
È
È
 
=
È
È
 
null
È
È
 !
,
È
È
! "
	IsSuccess
Í
Í
 
=
Í
Í
 
false
Í
Í
  %
,
Í
Í
% &

StatusCode
Î
Î
 
=
Î
Î
  
$num
Î
Î
! $
}
Ï
Ï
 
;
Ï
Ï
 
}
Ì
Ì
 
var
Ô
Ô
 
userId
Ô
Ô
 
=
Ô
Ô
 
User
Ô
Ô
 
.
Ô
Ô
 
Claims
Ô
Ô
 $
.
Ô
Ô
$ %
FirstOrDefault
Ô
Ô
% 3
(
Ô
Ô
3 4
x
Ô
Ô
4 5
=>
Ô
Ô
6 8
x
Ô
Ô
9 :
.
Ô
Ô
: ;
Type
Ô
Ô
; ?
==
Ô
Ô
@ B

ClaimTypes
Ô
Ô
C M
.
Ô
Ô
M N
NameIdentifier
Ô
Ô
N \
)
Ô
Ô
\ ]
?
Ô
Ô
] ^
.
Ô
Ô
^ _
Value
Ô
Ô
_ d
;
Ô
Ô
d e
var


 
admin


 
=


 
await


 
_unitOfWork


 )
.


) *#
UserManagerRepository


* ?
.


? @
FindByIdAsync


@ M
(


M N
userId


N T
)


T U
;


U V
courseVersionId
Ú
Ú
 
.
Ú
Ú
 

UpdateTime
Ú
Ú
 &
=
Ú
Ú
' (
DateTime
Ú
Ú
) 1
.
Ú
Ú
1 2
UtcNow
Ú
Ú
2 8
;
Ú
Ú
8 9
courseVersionId
Û
Û
 
.
Û
Û
 
UpdateBy
Û
Û
 $
=
Û
Û
% &
admin
Û
Û
' ,
.
Û
Û
, -
Email
Û
Û
- 2
;
Û
Û
2 3
courseVersionId
Ù
Ù
 
.
Ù
Ù
 
Status
Ù
Ù
 "
=
Ù
Ù
# $
$num
Ù
Ù
% &
;
Ù
Ù
& '
_unitOfWork
ˆ
ˆ
 
.
ˆ
ˆ
 ,
CourseVersionCommentRepository
ˆ
ˆ
 6
.
ˆ
ˆ
6 7
Update
ˆ
ˆ
7 =
(
ˆ
ˆ
= >
courseVersionId
ˆ
ˆ
> M
)
ˆ
ˆ
M N
;
ˆ
ˆ
N O
await
˜
˜
 
_unitOfWork
˜
˜
 
.
˜
˜
 
	SaveAsync
˜
˜
 '
(
˜
˜
' (
)
˜
˜
( )
;
˜
˜
) *
return
˘
˘
 
new
˘
˘
 
ResponseDTO
˘
˘
 "
(
˘
˘
" #
)
˘
˘
# $
{
˙
˙
 
Message
˚
˚
 
=
˚
˚
 
$str
˚
˚
 8
,
˚
˚
8 9
Result
¸
¸
 
=
¸
¸
 
null
¸
¸
 
,
¸
¸
 
	IsSuccess
˝
˝
 
=
˝
˝
 
true
˝
˝
  
,
˝
˝
  !

StatusCode
˛
˛
 
=
˛
˛
 
$num
˛
˛
  
,
˛
˛
  !
}
ˇ
ˇ
 
;
ˇ
ˇ
 
}
ÄÄ 	
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
e
ÖÖ 
.
ÖÖ 
Message
ÖÖ #
,
ÖÖ# $
Result
ÜÜ 
=
ÜÜ 
null
ÜÜ 
,
ÜÜ 
	IsSuccess
áá 
=
áá 
false
áá !
,
áá! "

StatusCode
àà 
=
àà 
$num
àà  
}
ââ 
;
ââ 
}
ää 	
}
ãã 
public
çç 

async
çç 
Task
çç 
<
çç 
ResponseDTO
çç !
>
çç! ".
 UploadCourseVersionBackgroundImg
çç# C
(
éé 
ClaimsPrincipal
èè 
User
èè 
,
èè 
Guid
êê 
courseVersionId
êê 
,
êê .
 UploadCourseVersionBackgroundImg
ëë (.
 uploadCourseVersionBackgroundImg
ëë) I
)
ëëI J
{
íí 
try
ìì 
{
îî 	
if
ññ 
(
ññ .
 uploadCourseVersionBackgroundImg
ññ 0
.
ññ0 1
File
ññ1 5
==
ññ6 8
null
ññ9 =
)
ññ= >
{
óó 
return
òò 
new
òò 
ResponseDTO
òò &
(
òò& '
)
òò' (
{
ôô 
	IsSuccess
öö 
=
öö 
false
öö  %
,
öö% &

StatusCode
õõ 
=
õõ  
$num
õõ! $
,
õõ$ %
Message
úú 
=
úú 
$str
úú 1
}
ùù 
;
ùù 
}
ûû 
var
†† 
courseVersion
†† 
=
†† 
await
°° 
_unitOfWork
°° !
.
°°! "%
CourseVersionRepository
°°" 9
.
°°9 :
GetAsync
°°: B
(
°°B C
x
°°C D
=>
°°E G
x
°°H I
.
°°I J
Id
°°J L
==
°°M O
courseVersionId
°°P _
)
°°_ `
;
°°` a
if
¢¢ 
(
¢¢ 
courseVersion
¢¢ 
==
¢¢  
null
¢¢! %
)
¢¢% &
{
££ 
return
§§ 
new
§§ 
ResponseDTO
§§ &
(
§§& '
)
§§' (
{
•• 
	IsSuccess
¶¶ 
=
¶¶ 
false
¶¶  %
,
¶¶% &

StatusCode
ßß 
=
ßß  
$num
ßß! $
,
ßß$ %
Message
®® 
=
®® 
$str
®® 9
}
©© 
;
©© 
}
™™ 
var
¨¨ 
filePath
¨¨ 
=
¨¨ 
$"
¨¨ 
$str
¨¨ $
{
¨¨$ %
courseVersion
¨¨% 2
.
¨¨2 3
CourseId
¨¨3 ;
}
¨¨; <
$str
¨¨< G
"
¨¨G H
;
¨¨H I
var
ÆÆ 
responseDto
ÆÆ 
=
ÆÆ 
await
ÆÆ #
_firebaseService
ÆÆ$ 4
.
ÆÆ4 5
UploadImage
ÆÆ5 @
(
ÆÆ@ A.
 uploadCourseVersionBackgroundImg
ÆÆA a
.
ÆÆa b
File
ÆÆb f
,
ÆÆf g
filePath
ÆÆh p
)
ÆÆp q
;
ÆÆq r
if
∞∞ 
(
∞∞ 
!
∞∞ 
responseDto
∞∞ 
.
∞∞ 
	IsSuccess
∞∞ &
)
∞∞& '
{
±± 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ &
(
≤≤& '
)
≤≤' (
{
≥≥ 
	IsSuccess
¥¥ 
=
¥¥ 
false
¥¥  %
,
¥¥% &

StatusCode
µµ 
=
µµ  
$num
µµ! $
,
µµ$ %
Message
∂∂ 
=
∂∂ 
$str
∂∂ 3
}
∑∑ 
;
∑∑ 
}
∏∏ 
courseVersion
ªª 
.
ªª 
CourseImgUrl
ªª &
=
ªª' (
responseDto
ªª) 4
.
ªª4 5
Result
ªª5 ;
?
ªª; <
.
ªª< =
ToString
ªª= E
(
ªªE F
)
ªªF G
;
ªªG H
_unitOfWork
ºº 
.
ºº %
CourseVersionRepository
ºº /
.
ºº/ 0
Update
ºº0 6
(
ºº6 7
courseVersion
ºº7 D
)
ººD E
;
ººE F
await
ΩΩ 
_unitOfWork
ΩΩ 
.
ΩΩ 
	SaveAsync
ΩΩ '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *
return
øø 
new
øø 
ResponseDTO
øø "
(
øø" #
)
øø# $
{
¿¿ 
	IsSuccess
¡¡ 
=
¡¡ 
true
¡¡  
,
¡¡  !

StatusCode
¬¬ 
=
¬¬ 
$num
¬¬  
,
¬¬  !
Result
√√ 
=
√√ 
responseDto
√√ $
.
√√$ %
Result
√√% +
,
√√+ ,
Message
ƒƒ 
=
ƒƒ 
$str
ƒƒ 4
}
≈≈ 
;
≈≈ 
}
∆∆ 	
catch
«« 
(
«« 
	Exception
«« 
e
«« 
)
«« 
{
»» 	
return
…… 
new
…… 
ResponseDTO
…… "
(
……" #
)
……# $
{
   
	IsSuccess
ÀÀ 
=
ÀÀ 
false
ÀÀ !
,
ÀÀ! "

StatusCode
ÃÃ 
=
ÃÃ 
$num
ÃÃ  
,
ÃÃ  !
Result
ÕÕ 
=
ÕÕ 
null
ÕÕ 
,
ÕÕ 
Message
ŒŒ 
=
ŒŒ 
e
ŒŒ 
.
ŒŒ 
Message
ŒŒ #
}
œœ 
;
œœ 
}
–– 	
}
—— 
public
”” 

async
”” 
Task
”” 
<
”” 
MemoryStream
”” "
>
””" #/
!DisplayCourseVersionBackgroundImg
””$ E
(
””E F
ClaimsPrincipal
””F U
User
””V Z
,
””Z [
Guid
””\ `
courseVersionId
””a p
)
””p q
{
‘‘ 
try
’’ 
{
÷÷ 	
var
◊◊ 
courseVersion
◊◊ 
=
◊◊ 
await
◊◊  %
_unitOfWork
◊◊& 1
.
◊◊1 2%
CourseVersionRepository
◊◊2 I
.
◊◊I J
GetAsync
◊◊J R
(
◊◊R S
x
◊◊S T
=>
◊◊U W
x
◊◊X Y
.
◊◊Y Z
Id
◊◊Z \
==
◊◊] _
courseVersionId
◊◊` o
)
◊◊o p
;
◊◊p q
if
ŸŸ 
(
ŸŸ 
courseVersion
ŸŸ 
!=
ŸŸ  
null
ŸŸ! %
&&
ŸŸ& (
courseVersion
ŸŸ) 6
.
ŸŸ6 7
CourseImgUrl
ŸŸ7 C
.
ŸŸC D
IsNullOrEmpty
ŸŸD Q
(
ŸŸQ R
)
ŸŸR S
)
ŸŸS T
{
⁄⁄ 
return
€€ 
null
€€ 
;
€€ 
}
‹‹ 
var
ﬁﬁ 
stream
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ 
_firebaseService
ﬁﬁ /
.
ﬁﬁ/ 0
GetImage
ﬁﬁ0 8
(
ﬁﬁ8 9
courseVersion
ﬁﬁ9 F
.
ﬁﬁF G
CourseImgUrl
ﬁﬁG S
)
ﬁﬁS T
;
ﬁﬁT U
return
ﬂﬂ 
stream
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
catch
·· 
(
·· 
	Exception
·· 
e
·· 
)
·· 
{
‚‚ 	
return
„„ 
null
„„ 
;
„„ 
}
‰‰ 	
}
ÂÂ 
}ÊÊ ∑í
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseService.cs
	namespace

 	
Cursus


 
.

 
LMS

 
.

 
Service

 
.

 
Service

 $
;

$ %
public 
class 
CourseService 
: 
ICourseService +
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

CourseService 
( 
IUnitOfWork $

unitOfWork% /
,/ 0
IMapper1 8
mapper9 ?
)? @
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
CreateFrameCourse# 4
(4 5
ClaimsPrincipal5 D
UserE I
,I J
GuidK O
courseVersionIdP _
)_ `
{ 
try 
{ 	
var 
userId 
= 
User 
. 
Claims $
.$ %
FirstOrDefault% 3
(3 4
x4 5
=>6 8
x9 :
.: ;
Type; ?
==@ B

ClaimTypesC M
.M N
NameIdentifierN \
)\ ]
?] ^
.^ _
Value_ d
;d e
var 

instructor 
= 
await "
_unitOfWork# .
.. / 
InstructorRepository/ C
.C D
GetAsyncD L
( 
filter 
: 
x 
=> 
x 
. 
UserId %
==& (
userId) /
,/ 0
includeProperties   !
:  ! "
$str  # 4
)!! 
;!! 
if## 
(## 

instructor## 
is## 
null## "
)##" #
{$$ 
return%% 
new%% 
ResponseDTO%% &
(%%& '
)%%' (
{&& 
Message'' 
='' 
$str'' 9
,''9 :
	IsSuccess(( 
=(( 
false((  %
,((% &

StatusCode)) 
=))  
$num))! $
,))$ %
Result** 
=** 
null** !
}++ 
;++ 
},, 
if.. 
(.. 

instructor.. 
... 

IsAccepted.. %
==..& (
false..) .
)... /
{// 
return00 
new00 
ResponseDTO00 &
(00& '
)00' (
{11 
Message22 
=22 
$str22 I
,22I J
	IsSuccess33 
=33 
true33  $
,33$ %

StatusCode44 
=44  
$num44! $
,44$ %
Result55 
=55 
null55 !
}66 
;66 
}77 
var:: 
course:: 
=:: 
new:: 
Course:: #
(::# $
)::$ %
{;; 
Id<< 
=<< 
Guid<< 
.<< 
NewGuid<< !
(<<! "
)<<" #
,<<# $
Code== 
=== 
null== 
,== 
InstructorId>> 
=>> 

instructor>> )
?>>) *
.>>* +
InstructorId>>+ 7
,>>7 8
CourseVersionId?? 
=??  !
courseVersionId??" 1
,??1 2
Status@@ 
=@@ 
$num@@ 
,@@ 
VersionAA 
=AA 
$numAA 
,AA 
StudentSlotsBB 
=BB 
$numBB  
,BB  !
	TotalRateCC 
=CC 
$numCC 
,CC 
ActivatedByDD 
=DD 
nullDD "
,DD" #
DeactivatedByEE 
=EE 
nullEE  $
,EE$ %
ActivatedTimeFF 
=FF 
nullFF  $
,FF$ %
DeactivatedTimeGG 
=GG  !
nullGG" &
,GG& '

MergedTimeHH 
=HH 
nullHH !
,HH! "
MergedByII 
=II 
nullII 
,II  
	CreatedByJJ 
=JJ 

instructorJJ &
?JJ& '
.JJ' (
ApplicationUserJJ( 7
.JJ7 8
EmailJJ8 =
,JJ= >
CreatedTimeKK 
=KK 
DateTimeKK &
.KK& '
UtcNowKK' -
}LL 
;LL 
awaitNN 
_unitOfWorkNN 
.NN 
CourseRepositoryNN .
.NN. /
AddAsyncNN/ 7
(NN7 8
courseNN8 >
)NN> ?
;NN? @
awaitOO 
_unitOfWorkOO 
.OO 
	SaveAsyncOO '
(OO' (
)OO( )
;OO) *
returnQQ 
newQQ 
ResponseDTOQQ "
(QQ" #
)QQ# $
{RR 
MessageSS 
=SS 
$strSS <
,SS< =
	IsSuccessTT 
=TT 
trueTT  
,TT  !

StatusCodeUU 
=UU 
$numUU  
,UU  !
ResultVV 
=VV 
courseVV 
}WW 
;WW 
}XX 	
catchYY 
(YY 
	ExceptionYY 
eYY 
)YY 
{ZZ 	
return[[ 
new[[ 
ResponseDTO[[ "
([[" #
)[[# $
{\\ 
Message]] 
=]] 
e]] 
.]] 
Message]] #
,]]# $

StatusCode^^ 
=^^ 
$num^^  
,^^  !
Result__ 
=__ 
null__ 
,__ 
	IsSuccess`` 
=`` 
true``  
}aa 
;aa 
}bb 	
}cc 
publicee 

asyncee 
Taskee 
<ee 
ResponseDTOee !
>ee! "

GetCoursesee# -
(ff 
ClaimsPrincipalgg 
Usergg 
,gg 
Guidhh 
?hh 
instructorIdhh 
,hh 
stringii 
?ii 
filterOnii 
,ii 
stringjj 
?jj 
filterQueryjj 
,jj 
doublekk 
?kk 
	fromPricekk 
,kk 
doublell 
?ll 
toPricell 
,ll 
stringmm 
?mm 
sortBymm 
,mm 
boolnn 
?nn 
isAscendingnn 
,nn 
intoo 

pageNumberoo 
=oo 
$numoo 
,oo 
intpp 
pageSizepp 
=pp 
$numpp 
)qq 
{rr 
tryss 
{tt 	
ifuu 
(uu 
stringuu 
.uu 
IsNullOrEmptyuu $
(uu$ %
instructorIduu% 1
.uu1 2
ToStringuu2 :
(uu: ;
)uu; <
)uu< =
)uu= >
{vv 
varww 
userIdww 
=ww 
Userww !
.ww! "
Claimsww" (
.ww( )
FirstOrDefaultww) 7
(ww7 8
xww8 9
=>ww: <
xww= >
.ww> ?
Typeww? C
==wwD F

ClaimTypeswwG Q
.wwQ R
NameIdentifierwwR `
)ww` a
?wwa b
.wwb c
Valuewwc h
;wwh i
varxx 

instructorxx 
=xx  
awaitxx! &
_unitOfWorkxx' 2
.xx2 3 
InstructorRepositoryxx3 G
.xxG H
GetAsyncxxH P
(yy 
filterzz 
:zz 
xzz 
=>zz  
xzz! "
.zz" #
UserIdzz# )
==zz* ,
userIdzz- 3
){{ 
;{{ 
if}} 
(}} 

instructor}} 
is}} !
null}}" &
)}}& '
{~~ 
return 
new 
ResponseDTO *
(* +
)+ ,
{
ÄÄ 
Message
ÅÅ 
=
ÅÅ  !
$str
ÅÅ" 9
,
ÅÅ9 :
	IsSuccess
ÇÇ !
=
ÇÇ" #
false
ÇÇ$ )
,
ÇÇ) *

StatusCode
ÉÉ "
=
ÉÉ# $
$num
ÉÉ% (
,
ÉÉ( )
Result
ÑÑ 
=
ÑÑ  
null
ÑÑ! %
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 
instructorId
àà 
=
àà 

instructor
àà )
.
àà) *
InstructorId
àà* 6
;
àà6 7
}
ââ 
var
åå 
courses
åå 
=
åå 
new
åå 
List
åå "
<
åå" #
Course
åå# )
>
åå) *
(
åå* +
)
åå+ ,
;
åå, -
if
çç 
(
çç 
string
çç 
.
çç 
IsNullOrEmpty
çç $
(
çç$ %
instructorId
çç% 1
.
çç1 2
ToString
çç2 :
(
çç: ;
)
çç; <
)
çç< =
)
çç= >
{
éé 
courses
èè 
=
èè 
_unitOfWork
èè %
.
èè% &
CourseRepository
èè& 6
.
êê 
GetAllAsync
êê  
(
ëë 
includeProperties
íí )
:
íí) *
$str
íí+ B
)
ìì 
.
îî 

GetAwaiter
îî 
(
îî  
)
îî  !
.
ïï 
	GetResult
ïï 
(
ïï 
)
ïï  
.
ññ 
ToList
ññ 
(
ññ 
)
ññ 
;
ññ 
}
óó 
else
òò 
{
ôô 
courses
öö 
=
öö 
_unitOfWork
öö %
.
öö% &
CourseRepository
öö& 6
.
õõ 
GetAllAsync
õõ  
(
úú 
filter
ùù 
:
ùù 
x
ùù  !
=>
ùù" $
x
ùù% &
.
ùù& '
InstructorId
ùù' 3
==
ùù4 6
instructorId
ùù7 C
)
ûû 
.
üü 

GetAwaiter
üü 
(
üü  
)
üü  !
.
†† 
	GetResult
†† 
(
†† 
)
††  
.
°° 
ToList
°° 
(
°° 
)
°° 
;
°° 
}
¢¢ 
var
§§ 
courseVersions
§§ 
=
§§  
new
§§! $
List
§§% )
<
§§) *
CourseVersion
§§* 7
>
§§7 8
(
§§8 9
)
§§9 :
;
§§: ;
foreach
¶¶ 
(
¶¶ 
var
¶¶ 
course
¶¶ 
in
¶¶  "
courses
¶¶# *
)
¶¶* +
{
ßß 
var
®® 
courseVersion
®® !
=
®®" #
await
®®$ )
_unitOfWork
®®* 5
.
®®5 6%
CourseVersionRepository
®®6 M
.
©© 
GetAsync
©© 
(
©© 
filter
™™ 
:
™™ 
x
™™  !
=>
™™" $
x
™™% &
.
™™& '
Id
™™' )
==
™™* ,
course
™™- 3
.
™™3 4
CourseVersionId
™™4 C
,
™™C D
includeProperties
´´ )
:
´´) *
$str
´´+ ;
)
¨¨ 
;
¨¨ 
if
≠≠ 
(
≠≠ 
courseVersion
≠≠ !
is
≠≠" $
not
≠≠% (
null
≠≠) -
)
≠≠- .
{
ÆÆ 
courseVersions
ØØ "
.
ØØ" #
Add
ØØ# &
(
ØØ& '
courseVersion
ØØ' 4
)
ØØ4 5
;
ØØ5 6
}
∞∞ 
}
±± 
if
µµ 
(
µµ 
!
µµ 
string
µµ 
.
µµ 
IsNullOrEmpty
µµ %
(
µµ% &
filterOn
µµ& .
)
µµ. /
&&
µµ0 2
!
µµ3 4
string
µµ4 :
.
µµ: ;
IsNullOrEmpty
µµ; H
(
µµH I
filterQuery
µµI T
)
µµT U
)
µµU V
{
∂∂ 
switch
∑∑ 
(
∑∑ 
filterOn
∑∑  
.
∑∑  !
Trim
∑∑! %
(
∑∑% &
)
∑∑& '
.
∑∑' (
ToLower
∑∑( /
(
∑∑/ 0
)
∑∑0 1
)
∑∑1 2
{
∏∏ 
case
ππ 
$str
ππ  
:
ππ  !
{
∫∫ 
courseVersions
ªª &
=
ªª' (
courseVersions
ªª) 7
.
ªª7 8
Where
ªª8 =
(
ªª= >
x
ªª> ?
=>
ªª@ B
x
ºº 
.
ºº 
Title
ºº #
.
ºº# $
Contains
ºº$ ,
(
ºº, -
filterQuery
ºº- 8
,
ºº8 9
StringComparison
ºº: J
.
ººJ K&
CurrentCultureIgnoreCase
ººK c
)
ººc d
)
ººd e
.
ººe f
ToList
ººf l
(
ººl m
)
ººm n
;
ººn o
break
ΩΩ 
;
ΩΩ 
}
ææ 
case
øø 
$str
øø 
:
øø  
{
¿¿ 
courseVersions
¡¡ &
=
¡¡' (
courseVersions
¡¡) 7
.
¡¡7 8
Where
¡¡8 =
(
¡¡= >
x
¡¡> ?
=>
¡¡@ B
x
¬¬ 
.
¬¬ 
Code
¬¬ "
.
¬¬" #
Contains
¬¬# +
(
¬¬+ ,
filterQuery
¬¬, 7
,
¬¬7 8
StringComparison
¬¬9 I
.
¬¬I J&
CurrentCultureIgnoreCase
¬¬J b
)
¬¬b c
)
¬¬c d
.
¬¬d e
ToList
¬¬e k
(
¬¬k l
)
¬¬l m
;
¬¬m n
break
√√ 
;
√√ 
}
ƒƒ 
case
≈≈ 
$str
≈≈ &
:
≈≈& '
{
∆∆ 
courseVersions
«« &
=
««' (
courseVersions
««) 7
.
««7 8
Where
««8 =
(
««= >
x
««> ?
=>
««@ B
x
»» 
.
»» 
Description
»» )
.
»») *
Contains
»»* 2
(
»»2 3
filterQuery
»»3 >
,
»»> ?
StringComparison
»»@ P
.
»»P Q&
CurrentCultureIgnoreCase
»»Q i
)
»»i j
)
»»j k
.
»»k l
ToList
»»l r
(
»»r s
)
»»s t
;
»»t u
break
…… 
;
…… 
}
   
case
ÀÀ 
$str
ÀÀ !
:
ÀÀ! "
{
ÃÃ 
courseVersions
ÕÕ &
=
ÕÕ' (
courseVersions
ÕÕ) 7
.
ÕÕ7 8
Where
ÕÕ8 =
(
ÕÕ= >
x
ÕÕ> ?
=>
ÕÕ@ B
x
ŒŒ 
.
ŒŒ 
CurrentStatus
ŒŒ +
==
ŒŒ, .
int
ŒŒ/ 2
.
ŒŒ2 3
Parse
ŒŒ3 8
(
ŒŒ8 9
filterQuery
ŒŒ9 D
.
ŒŒD E
Trim
ŒŒE I
(
ŒŒI J
)
ŒŒJ K
)
ŒŒK L
)
ŒŒL M
.
ŒŒM N
ToList
ŒŒN T
(
ŒŒT U
)
ŒŒU V
;
ŒŒV W
break
œœ 
;
œœ 
}
–– 
}
—— 
}
““ 
if
’’ 
(
’’ 
toPrice
’’ 
is
’’ 
not
’’ 
null
’’ #
&&
’’$ &
	fromPrice
’’' 0
is
’’1 3
not
’’4 7
null
’’8 <
)
’’< =
{
÷÷ 
if
◊◊ 
(
◊◊ 
toPrice
◊◊ 
>=
◊◊ 
$num
◊◊  
)
◊◊  !
{
ÿÿ 
courseVersions
ŸŸ "
=
ŸŸ# $
	fromPrice
ŸŸ% .
>=
ŸŸ/ 1
toPrice
ŸŸ2 9
?
⁄⁄ 
courseVersions
⁄⁄ (
.
⁄⁄( )
Where
⁄⁄) .
(
⁄⁄. /
x
⁄⁄/ 0
=>
⁄⁄1 3
x
⁄⁄4 5
.
⁄⁄5 6
Price
⁄⁄6 ;
>=
⁄⁄< >
toPrice
⁄⁄? F
&&
⁄⁄G I
x
⁄⁄J K
.
⁄⁄K L
Price
⁄⁄L Q
<=
⁄⁄R T
	fromPrice
⁄⁄U ^
)
⁄⁄^ _
.
⁄⁄_ `
ToList
⁄⁄` f
(
⁄⁄f g
)
⁄⁄g h
:
€€ 
courseVersions
€€ (
.
€€( )
Where
€€) .
(
€€. /
x
€€/ 0
=>
€€1 3
x
€€4 5
.
€€5 6
Price
€€6 ;
>=
€€< >
toPrice
€€? F
)
€€F G
.
€€G H
ToList
€€H N
(
€€N O
)
€€O P
;
€€P Q
}
‹‹ 
}
›› 
if
‡‡ 
(
‡‡ 
!
‡‡ 
string
‡‡ 
.
‡‡ 
IsNullOrEmpty
‡‡ %
(
‡‡% &
sortBy
‡‡& ,
)
‡‡, -
)
‡‡- .
{
·· 
switch
‚‚ 
(
‚‚ 
sortBy
‚‚ 
.
‚‚ 
Trim
‚‚ #
(
‚‚# $
)
‚‚$ %
.
‚‚% &
ToLower
‚‚& -
(
‚‚- .
)
‚‚. /
)
‚‚/ 0
{
„„ 
case
‰‰ 
$str
‰‰  
:
‰‰  !
{
ÂÂ 
courseVersions
ÊÊ &
=
ÊÊ' (
isAscending
ÊÊ) 4
==
ÊÊ5 7
true
ÊÊ8 <
?
ÁÁ 
[
ÁÁ 
..
ÁÁ !
courseVersions
ÁÁ" 0
.
ÁÁ0 1
OrderBy
ÁÁ1 8
(
ÁÁ8 9
x
ÁÁ9 :
=>
ÁÁ; =
x
ÁÁ> ?
.
ÁÁ? @
Title
ÁÁ@ E
)
ÁÁE F
]
ÁÁF G
:
ËË 
[
ËË 
..
ËË !
courseVersions
ËË" 0
.
ËË0 1
OrderByDescending
ËË1 B
(
ËËB C
x
ËËC D
=>
ËËE G
x
ËËH I
.
ËËI J
Title
ËËJ O
)
ËËO P
]
ËËP Q
;
ËËQ R
break
ÈÈ 
;
ÈÈ 
}
ÍÍ 
case
ÎÎ 
$str
ÎÎ 
:
ÎÎ  
{
ÏÏ 
courseVersions
ÌÌ &
=
ÌÌ' (
isAscending
ÌÌ) 4
==
ÌÌ5 7
true
ÌÌ8 <
?
ÓÓ 
[
ÓÓ 
..
ÓÓ !
courseVersions
ÓÓ" 0
.
ÓÓ0 1
OrderBy
ÓÓ1 8
(
ÓÓ8 9
x
ÓÓ9 :
=>
ÓÓ; =
x
ÓÓ> ?
.
ÓÓ? @
Code
ÓÓ@ D
)
ÓÓD E
]
ÓÓE F
:
ÔÔ 
[
ÔÔ 
..
ÔÔ !
courseVersions
ÔÔ" 0
.
ÔÔ0 1
OrderByDescending
ÔÔ1 B
(
ÔÔB C
x
ÔÔC D
=>
ÔÔE G
x
ÔÔH I
.
ÔÔI J
Code
ÔÔJ N
)
ÔÔN O
]
ÔÔO P
;
ÔÔP Q
break
 
;
 
}
ÒÒ 
case
ÚÚ 
$str
ÚÚ &
:
ÚÚ& '
{
ÛÛ 
courseVersions
ÙÙ &
=
ÙÙ' (
isAscending
ÙÙ) 4
==
ÙÙ5 7
true
ÙÙ8 <
?
ıı 
[
ıı 
..
ıı !
courseVersions
ıı" 0
.
ıı0 1
OrderBy
ıı1 8
(
ıı8 9
x
ıı9 :
=>
ıı; =
x
ıı> ?
.
ıı? @
Description
ıı@ K
)
ııK L
]
ııL M
:
ˆˆ 
[
ˆˆ 
..
ˆˆ !
courseVersions
ˆˆ" 0
.
ˆˆ0 1
OrderByDescending
ˆˆ1 B
(
ˆˆB C
x
ˆˆC D
=>
ˆˆE G
x
ˆˆH I
.
ˆˆI J
Description
ˆˆJ U
)
ˆˆU V
]
ˆˆV W
;
ˆˆW X
break
˜˜ 
;
˜˜ 
}
¯¯ 
case
˘˘ 
$str
˘˘  
:
˘˘  !
{
˙˙ 
courseVersions
˚˚ &
=
˚˚' (
isAscending
˚˚) 4
==
˚˚5 7
true
˚˚8 <
?
¸¸ 
[
¸¸ 
..
¸¸ !
courseVersions
¸¸" 0
.
¸¸0 1
OrderBy
¸¸1 8
(
¸¸8 9
x
¸¸9 :
=>
¸¸; =
x
¸¸> ?
.
¸¸? @
Price
¸¸@ E
)
¸¸E F
]
¸¸F G
:
˝˝ 
[
˝˝ 
..
˝˝ !
courseVersions
˝˝" 0
.
˝˝0 1
OrderByDescending
˝˝1 B
(
˝˝B C
x
˝˝C D
=>
˝˝E G
x
˝˝H I
.
˝˝I J
Price
˝˝J O
)
˝˝O P
]
˝˝P Q
;
˝˝Q R
break
˛˛ 
;
˛˛ 
}
ˇˇ 
default
ÄÄ 
:
ÄÄ 
{
ÅÅ 
break
ÇÇ 
;
ÇÇ 
}
ÉÉ 
}
ÑÑ 
}
ÖÖ 
if
àà 
(
àà 

pageNumber
àà 
>
àà 
$num
àà 
&&
àà !
pageSize
àà" *
>
àà+ ,
$num
àà- .
)
àà. /
{
ââ 
var
ää 

skipResult
ää 
=
ää  
(
ää! "

pageNumber
ää" ,
-
ää- .
$num
ää/ 0
)
ää0 1
*
ää2 3
pageSize
ää4 <
;
ää< =
courseVersions
ãã 
=
ãã  
courseVersions
ãã! /
.
ãã/ 0
Skip
ãã0 4
(
ãã4 5

skipResult
ãã5 ?
)
ãã? @
.
ãã@ A
Take
ããA E
(
ããE F
pageSize
ããF N
)
ããN O
.
ããO P
ToList
ããP V
(
ããV W
)
ããW X
;
ããX Y
}
åå 
var
éé 
courseVersionDto
éé  
=
éé! "
_mapper
éé# *
.
éé* +
Map
éé+ .
<
éé. /
List
éé/ 3
<
éé3 4!
GetCourseVersionDTO
éé4 G
>
ééG H
>
ééH I
(
ééI J
courseVersions
ééJ X
)
ééX Y
;
ééY Z
return
êê 
new
êê 
ResponseDTO
êê "
(
êê" #
)
êê# $
{
ëë 
Result
íí 
=
íí 
courseVersionDto
íí )
,
íí) *
Message
ìì 
=
ìì 
$str
ìì 4
,
ìì4 5
	IsSuccess
îî 
=
îî 
true
îî  
,
îî  !

StatusCode
ïï 
=
ïï 
$num
ïï  
}
ññ 
;
ññ 
}
óó 	
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 	
return
öö 
new
öö 
ResponseDTO
öö "
(
öö" #
)
öö# $
{
õõ 
Message
úú 
=
úú 
e
úú 
.
úú 
Message
úú #
,
úú# $

StatusCode
ùù 
=
ùù 
$num
ùù  
,
ùù  !
Result
ûû 
=
ûû 
null
ûû 
,
ûû 
	IsSuccess
üü 
=
üü 
false
üü !
}
†† 
;
†† 
}
°° 	
}
¢¢ 
public
§§ 

async
§§ 
Task
§§ 
<
§§ 
ResponseDTO
§§ !
>
§§! "
	GetCourse
§§# ,
(
§§, -
ClaimsPrincipal
§§- <
User
§§= A
,
§§A B
Guid
§§C G
courseId
§§H P
)
§§P Q
{
•• 
try
¶¶ 
{
ßß 	
var
®® 
course
®® 
=
®® 
await
®® 
_unitOfWork
®® *
.
®®* +
CourseRepository
®®+ ;
.
®®; <
GetAsync
®®< D
(
®®D E
x
®®E F
=>
®®G I
x
®®J K
.
®®K L
Id
®®L N
==
®®O Q
courseId
®®R Z
)
®®Z [
;
®®[ \
if
™™ 
(
™™ 
course
™™ 
is
™™ 
null
™™ 
)
™™ 
{
´´ 
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ &
(
¨¨& '
)
¨¨' (
{
≠≠ 
	IsSuccess
ÆÆ 
=
ÆÆ 
false
ÆÆ  %
,
ÆÆ% &

StatusCode
ØØ 
=
ØØ  
$num
ØØ! $
,
ØØ$ %
Result
∞∞ 
=
∞∞ 
null
∞∞ !
,
∞∞! "
Message
±± 
=
±± 
$str
±± 4
}
≤≤ 
;
≤≤ 
}
≥≥ 
var
µµ 
courseVersion
µµ 
=
µµ 
await
µµ  %
_unitOfWork
µµ& 1
.
µµ1 2%
CourseVersionRepository
µµ2 I
.
µµI J
GetAsync
µµJ R
(
µµR S
x
µµS T
=>
µµU W
x
µµX Y
.
µµY Z
Id
µµZ \
==
µµ] _
course
µµ` f
.
µµf g
CourseVersionId
µµg v
)
µµv w
;
µµw x
if
∑∑ 
(
∑∑ 
courseVersion
∑∑ 
is
∑∑  
null
∑∑! %
)
∑∑% &
{
∏∏ 
return
ππ 
new
ππ 
ResponseDTO
ππ &
(
ππ& '
)
ππ' (
{
∫∫ 
	IsSuccess
ªª 
=
ªª 
false
ªª  %
,
ªª% &

StatusCode
ºº 
=
ºº  
$num
ºº! $
,
ºº$ %
Result
ΩΩ 
=
ΩΩ 
null
ΩΩ !
,
ΩΩ! "
Message
ææ 
=
ææ 
$str
ææ 6
}
øø 
;
øø 
}
¿¿ 
var
¬¬ 
courseVersionDto
¬¬  
=
¬¬! "
_mapper
¬¬# *
.
¬¬* +
Map
¬¬+ .
<
¬¬. /!
GetCourseVersionDTO
¬¬/ B
>
¬¬B C
(
¬¬C D
courseVersion
¬¬D Q
)
¬¬Q R
;
¬¬R S
return
ƒƒ 
new
ƒƒ 
ResponseDTO
ƒƒ "
(
ƒƒ" #
)
ƒƒ# $
{
≈≈ 
	IsSuccess
∆∆ 
=
∆∆ 
true
∆∆  
,
∆∆  !

StatusCode
«« 
=
«« 
$num
««  
,
««  !
Result
»» 
=
»» 
courseVersionDto
»» )
,
»») *
Message
…… 
=
…… 
$str
…… 3
}
   
;
   
}
ÀÀ 	
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
e
ÃÃ 
)
ÃÃ 
{
ÕÕ 	
return
ŒŒ 
new
ŒŒ 
ResponseDTO
ŒŒ "
(
ŒŒ" #
)
ŒŒ# $
{
œœ 
	IsSuccess
–– 
=
–– 
false
–– !
,
––! "

StatusCode
—— 
=
—— 
$num
——  
,
——  !
Result
““ 
=
““ 
null
““ 
,
““ 
Message
”” 
=
”” 
e
”” 
.
”” 
Message
”” #
}
‘‘ 
;
‘‘ 
}
’’ 	
}
÷÷ 
public
ÿÿ 

async
ÿÿ 
Task
ÿÿ 
<
ÿÿ 
ResponseDTO
ÿÿ !
>
ÿÿ! "
GetCourseInfo
ÿÿ# 0
(
ÿÿ0 1
ClaimsPrincipal
ÿÿ1 @
User
ÿÿA E
,
ÿÿE F
Guid
ÿÿG K
courseId
ÿÿL T
)
ÿÿT U
{
ŸŸ 
try
⁄⁄ 
{
€€ 	
var
‹‹ 
course
‹‹ 
=
‹‹ 
await
‹‹ 
_unitOfWork
‹‹ *
.
‹‹* +
CourseRepository
‹‹+ ;
.
‹‹; <
GetAsync
‹‹< D
(
‹‹D E
x
‹‹E F
=>
‹‹G I
x
‹‹J K
.
‹‹K L
Id
‹‹L N
==
‹‹O Q
courseId
‹‹R Z
)
‹‹Z [
;
‹‹[ \
if
ﬁﬁ 
(
ﬁﬁ 
course
ﬁﬁ 
is
ﬁﬁ 
null
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
new
‡‡ 
ResponseDTO
‡‡ &
(
‡‡& '
)
‡‡' (
{
·· 
	IsSuccess
‚‚ 
=
‚‚ 
false
‚‚  %
,
‚‚% &

StatusCode
„„ 
=
„„  
$num
„„! $
,
„„$ %
Result
‰‰ 
=
‰‰ 
null
‰‰ !
,
‰‰! "
Message
ÂÂ 
=
ÂÂ 
$str
ÂÂ 4
}
ÊÊ 
;
ÊÊ 
}
ÁÁ 
var
ÈÈ 
getCourseInfoDto
ÈÈ  
=
ÈÈ! "
_mapper
ÈÈ# *
.
ÈÈ* +
Map
ÈÈ+ .
<
ÈÈ. /
GetCourseInfoDTO
ÈÈ/ ?
>
ÈÈ? @
(
ÈÈ@ A
course
ÈÈA G
)
ÈÈG H
;
ÈÈH I
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ "
(
ÎÎ" #
)
ÎÎ# $
{
ÏÏ 
	IsSuccess
ÌÌ 
=
ÌÌ 
true
ÌÌ  
,
ÌÌ  !

StatusCode
ÓÓ 
=
ÓÓ 
$num
ÓÓ  
,
ÓÓ  !
Result
ÔÔ 
=
ÔÔ 
getCourseInfoDto
ÔÔ )
,
ÔÔ) *
Message
 
=
 
$str
 ?
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 	
return
ıı 
new
ıı 
ResponseDTO
ıı "
(
ıı" #
)
ıı# $
{
ˆˆ 
Message
˜˜ 
=
˜˜ 
e
˜˜ 
.
˜˜ 
Message
˜˜ #
,
˜˜# $

StatusCode
¯¯ 
=
¯¯ 
$num
¯¯  
,
¯¯  !
Result
˘˘ 
=
˘˘ 
null
˘˘ 
,
˘˘ 
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙ !
}
˚˚ 
;
˚˚ 
}
¸¸ 	
}
˝˝ 
public
ˇˇ 

async
ˇˇ 
Task
ˇˇ 
<
ˇˇ 
ResponseDTO
ˇˇ !
>
ˇˇ! "
ActivateCourse
ˇˇ# 1
(
ˇˇ1 2
ClaimsPrincipal
ˇˇ2 A
User
ˇˇB F
,
ˇˇF G
Guid
ˇˇH L
courseId
ˇˇM U
)
ˇˇU V
{
ÄÄ 
try
ÅÅ 
{
ÇÇ 	
var
ÉÉ 
course
ÉÉ 
=
ÉÉ 
await
ÉÉ 
_unitOfWork
ÉÉ *
.
ÉÉ* +
CourseRepository
ÉÉ+ ;
.
ÉÉ; <
GetAsync
ÉÉ< D
(
ÉÉD E
x
ÉÉE F
=>
ÉÉG I
x
ÉÉJ K
.
ÉÉK L
Id
ÉÉL N
==
ÉÉO Q
courseId
ÉÉR Z
)
ÉÉZ [
;
ÉÉ[ \
if
ÖÖ 
(
ÖÖ 
course
ÖÖ 
is
ÖÖ 
null
ÖÖ 
)
ÖÖ 
{
ÜÜ 
return
áá 
new
áá 
ResponseDTO
áá &
(
áá& '
)
áá' (
{
àà 
	IsSuccess
ââ 
=
ââ 
false
ââ  %
,
ââ% &

StatusCode
ää 
=
ää  
$num
ää! $
,
ää$ %
Result
ãã 
=
ãã 
null
ãã !
,
ãã! "
Message
åå 
=
åå 
$str
åå 4
}
çç 
;
çç 
}
éé 
course
êê 
.
êê 
Status
êê 
=
êê  
StaticCourseStatus
êê .
.
êê. /
	Activated
êê/ 8
;
êê8 9
_unitOfWork
íí 
.
íí 
CourseRepository
íí (
.
íí( )
Update
íí) /
(
íí/ 0
course
íí0 6
)
íí6 7
;
íí7 8
await
ìì 
_unitOfWork
ìì 
.
ìì 
	SaveAsync
ìì '
(
ìì' (
)
ìì( )
;
ìì) *
return
ïï 
new
ïï 
ResponseDTO
ïï "
(
ïï" #
)
ïï# $
{
ññ 
	IsSuccess
óó 
=
óó 
true
óó  
,
óó  !

StatusCode
òò 
=
òò 
$num
òò  
,
òò  !
Result
ôô 
=
ôô 
null
ôô 
,
ôô 
Message
öö 
=
öö 
$str
öö 9
}
õõ 
;
õõ 
}
úú 	
catch
ùù 
(
ùù 
	Exception
ùù 
e
ùù 
)
ùù 
{
ûû 	
return
üü 
new
üü 
ResponseDTO
üü "
(
üü" #
)
üü# $
{
†† 
Message
°° 
=
°° 
e
°° 
.
°° 
Message
°° #
,
°°# $

StatusCode
¢¢ 
=
¢¢ 
$num
¢¢  
,
¢¢  !
Result
££ 
=
££ 
null
££ 
,
££ 
	IsSuccess
§§ 
=
§§ 
false
§§ !
}
•• 
;
•• 
}
¶¶ 	
}
ßß 
public
©© 

async
©© 
Task
©© 
<
©© 
ResponseDTO
©© !
>
©©! "
DeactivateCourse
©©# 3
(
©©3 4
ClaimsPrincipal
©©4 C
User
©©D H
,
©©H I
Guid
©©J N
courseId
©©O W
)
©©W X
{
™™ 
try
´´ 
{
¨¨ 	
var
≠≠ 
course
≠≠ 
=
≠≠ 
await
≠≠ 
_unitOfWork
≠≠ *
.
≠≠* +
CourseRepository
≠≠+ ;
.
≠≠; <
GetAsync
≠≠< D
(
≠≠D E
x
≠≠E F
=>
≠≠G I
x
≠≠J K
.
≠≠K L
Id
≠≠L N
==
≠≠O Q
courseId
≠≠R Z
)
≠≠Z [
;
≠≠[ \
if
ØØ 
(
ØØ 
course
ØØ 
is
ØØ 
null
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
new
±± 
ResponseDTO
±± &
(
±±& '
)
±±' (
{
≤≤ 
	IsSuccess
≥≥ 
=
≥≥ 
false
≥≥  %
,
≥≥% &

StatusCode
¥¥ 
=
¥¥  
$num
¥¥! $
,
¥¥$ %
Result
µµ 
=
µµ 
null
µµ !
,
µµ! "
Message
∂∂ 
=
∂∂ 
$str
∂∂ 4
}
∑∑ 
;
∑∑ 
}
∏∏ 
course
∫∫ 
.
∫∫ 
Status
∫∫ 
=
∫∫  
StaticCourseStatus
∫∫ .
.
∫∫. /
Deactivated
∫∫/ :
;
∫∫: ;
_unitOfWork
ªª 
.
ªª 
CourseRepository
ªª (
.
ªª( )
Update
ªª) /
(
ªª/ 0
course
ªª0 6
)
ªª6 7
;
ªª7 8
await
ºº 
_unitOfWork
ºº 
.
ºº 
	SaveAsync
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
BackgroundJob
ææ 
.
ææ 
Enqueue
ææ !
<
ææ! "
IEmailSender
ææ" .
>
ææ. /
(
ææ/ 0
job
ææ0 3
=>
ææ4 6
job
ææ7 :
.
ææ: ;3
%SendDeactivatedCourseEmailForStudents
ææ; `
(
ææ` a
courseId
ææa i
)
ææi j
)
ææj k
;
ææk l
return
¿¿ 
new
¿¿ 
ResponseDTO
¿¿ "
(
¿¿" #
)
¿¿# $
{
¡¡ 
	IsSuccess
¬¬ 
=
¬¬ 
true
¬¬  
,
¬¬  !

StatusCode
√√ 
=
√√ 
$num
√√  
,
√√  !
Result
ƒƒ 
=
ƒƒ 
null
ƒƒ 
,
ƒƒ 
Message
≈≈ 
=
≈≈ 
$str
≈≈ ;
}
∆∆ 
;
∆∆ 
}
«« 	
catch
»» 
(
»» 
	Exception
»» 
e
»» 
)
»» 
{
…… 	
return
   
new
   
ResponseDTO
   "
(
  " #
)
  # $
{
ÀÀ 
Message
ÃÃ 
=
ÃÃ 
e
ÃÃ 
.
ÃÃ 
Message
ÃÃ #
,
ÃÃ# $

StatusCode
ÕÕ 
=
ÕÕ 
$num
ÕÕ  
,
ÕÕ  !
Result
ŒŒ 
=
ŒŒ 
null
ŒŒ 
,
ŒŒ 
	IsSuccess
œœ 
=
œœ 
false
œœ !
}
–– 
;
–– 
}
—— 	
}
““ 
}”” ‡ˆ
tD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CourseSectionVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class '
CourseSectionVersionService (
:) *(
ICourseSectionVersionService+ G
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly )
ISectionDetailsVersionService 2)
_sectionDetailsVersionService3 P
;P Q
private 
IMapper 
_mapper 
; 
public 
'
CourseSectionVersionService &
( 
IUnitOfWork 

unitOfWork 
, 
IMapper 
mapper 
, )
ISectionDetailsVersionService %(
sectionDetailsVersionService& B
) 
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; )
_sectionDetailsVersionService %
=& '(
sectionDetailsVersionService( D
;D E
} 
public   

async   
Task   
<   
ResponseDTO   !
>  ! "%
CloneCourseSectionVersion  # <
(!! 
ClaimsPrincipal"" 
User"" 
,"" (
CloneCourseSectionVersionDTO## $(
cloneCourseSectionVersionDto##% A
)$$ 
{%% 
try&& 
{'' 	
var(( !
courseSectionVersions(( %
=((& '
await)) 
_unitOfWork)) !
.))! "*
CourseSectionVersionRepository))" @
.))@ A8
,GetCourseSectionVersionsOfCourseVersionAsync))A m
(** (
cloneCourseSectionVersionDto++ 0
.++0 1
OldCourseVersionId++1 C
,++C D
asNoTracking,,  
:,,  !
true,," &
)-- 
;-- 
if// 
(// !
courseSectionVersions// %
.//% &
IsNullOrEmpty//& 3
(//3 4
)//4 5
)//5 6
{00 
return11 
new11 
ResponseDTO11 &
(11& '
)11' (
{22 
	IsSuccess33 
=33 
false33  %
,33% &

StatusCode44 
=44  
$num44! $
,44$ %
Result55 
=55 
null55 !
,55! "
Message66 
=66 
$str66 G
}77 
;77 
}88 
var:: +
cloneSectionsDetailsVersionsDto:: /
=::0 1
new::2 5
List::6 :
<::: ;*
CloneSectionsDetailsVersionDTO::; Y
>::Y Z
(::Z [
)::[ \
;::\ ]
foreach<< 
(<< 
var<<  
courseSectionVersion<< -
in<<. 0!
courseSectionVersions<<1 F
)<<F G
{== 
var>> *
cloneSectionsDetailsVersionDto>> 2
=>>3 4
new>>5 8*
CloneSectionsDetailsVersionDTO>>9 W
(>>W X
)>>X Y
;>>Y Z*
cloneSectionsDetailsVersionDto@@ .
.@@. /%
OldCourseSectionVersionId@@/ H
=@@I J 
courseSectionVersion@@K _
.@@_ `
Id@@` b
;@@b c 
courseSectionVersionAA $
.AA$ %
IdAA% '
=AA( )
GuidAA* .
.AA. /
NewGuidAA/ 6
(AA6 7
)AA7 8
;AA8 9*
cloneSectionsDetailsVersionDtoBB .
.BB. /%
NewCourseSectionVersionIdBB/ H
=BBI J 
courseSectionVersionBBK _
.BB_ `
IdBB` b
;BBb c 
courseSectionVersionDD $
.DD$ %
CourseVersionIdDD% 4
=DD5 6(
cloneCourseSectionVersionDtoDD7 S
.DDS T
NewCourseVersionIdDDT f
;DDf g+
cloneSectionsDetailsVersionsDtoFF /
.FF/ 0
AddFF0 3
(FF3 4*
cloneSectionsDetailsVersionDtoFF4 R
)FFR S
;FFS T
}GG 
awaitII 
_unitOfWorkII 
.II *
CourseSectionVersionRepositoryII <
.II< =
AddRangeAsyncII= J
(IIJ K!
courseSectionVersionsIIK `
)II` a
;IIa b
awaitJJ 
_unitOfWorkJJ 
.JJ 
	SaveAsyncJJ '
(JJ' (
)JJ( )
;JJ) *
foreachMM 
(MM 
varMM *
cloneSectionsDetailsVersionDtoMM 7
inMM8 :+
cloneSectionsDetailsVersionsDtoMM; Z
)MMZ [
{NN 
varOO 
responseDtoOO 
=OO  !
awaitPP )
_sectionDetailsVersionServicePP 7
.PP7 8'
CloneSectionsDetailsVersionPP8 S
(QQ 
UserRR 
,RR 
newSS *
CloneSectionsDetailsVersionDTOSS :
(SS: ;
)SS; <
{TT %
OldCourseSectionVersionIdUU 5
=UU6 7*
cloneSectionsDetailsVersionDtoUU8 V
.UUV W%
OldCourseSectionVersionIdUUW p
,UUp q%
NewCourseSectionVersionIdVV 5
=VV6 7*
cloneSectionsDetailsVersionDtoVV8 V
.VVV W%
NewCourseSectionVersionIdVVW p
,VVp q
}WW 
)XX 
;XX 
ifYY 
(YY 
responseDtoYY 
.YY  

StatusCodeYY  *
==YY+ -
$numYY. 1
)YY1 2
{ZZ 
return[[ 
responseDto[[ &
;[[& '
}\\ 
}]] 
return__ 
new__ 
ResponseDTO__ "
(__" #
)__# $
{`` 
	IsSuccessaa 
=aa 
trueaa  
,aa  !

StatusCodebb 
=bb 
$numbb  
,bb  !
Messagecc 
=cc 
$strcc O
,ccO P
Resultdd 
=dd 
nulldd 
}ee 
;ee 
}ff 	
catchgg 
(gg 
	Exceptiongg 
egg 
)gg 
{hh 	
returnii 
newii 
ResponseDTOii "
(ii" #
)ii# $
{jj 
	IsSuccesskk 
=kk 
falsekk !
,kk! "

StatusCodell 
=ll 
$numll  
,ll  !
Messagemm 
=mm 
emm 
.mm 
Messagemm #
,mm# $
Resultnn 
=nn 
nullnn 
}oo 
;oo 
}pp 	
}qq 
publicss 

asyncss 
Taskss 
<ss 
ResponseDTOss !
>ss! "
GetCourseSectionsss# 4
(tt 
ClaimsPrincipaluu 
Useruu 
,uu 
Guidvv 
?vv 
courseVersionIdvv 
,vv 
stringww 
?ww 
filterOnww 
,ww 
stringxx 
?xx 
filterQueryxx 
,xx 
stringyy 
?yy 
sortByyy 
,yy 
intzz 

pageNumberzz 
,zz 
int{{ 
pageSize{{ 
)|| 
{}} 
try~~ 
{ 	
var
ÅÅ 
userRole
ÅÅ 
=
ÅÅ 
User
ÅÅ 
.
ÅÅ  
Claims
ÅÅ  &
.
ÅÅ& '
FirstOrDefault
ÅÅ' 5
(
ÅÅ5 6
x
ÅÅ6 7
=>
ÅÅ8 :
x
ÅÅ; <
.
ÅÅ< =
Type
ÅÅ= A
==
ÅÅB D

ClaimTypes
ÅÅE O
.
ÅÅO P
Role
ÅÅP T
)
ÅÅT U
?
ÅÅU V
.
ÅÅV W
Value
ÅÅW \
;
ÅÅ\ ]
IEnumerable
ÉÉ 
<
ÉÉ "
CourseSectionVersion
ÉÉ ,
>
ÉÉ, -
sectionVersions
ÉÉ. =
;
ÉÉ= >
if
ÖÖ 
(
ÖÖ 
userRole
ÖÖ 
==
ÖÖ 
StaticUserRoles
ÖÖ +
.
ÖÖ+ ,
Admin
ÖÖ, 1
)
ÖÖ1 2
{
ÜÜ 
sectionVersions
àà 
=
àà  !
await
àà" '
_unitOfWork
àà( 3
.
àà3 4,
CourseSectionVersionRepository
àà4 R
.
ààR S
GetAllAsync
ààS ^
(
àà^ _
x
àà_ `
=>
ààa c
x
ââ 
.
ââ 
CourseVersionId
ââ %
==
ââ& (
courseVersionId
ââ) 8
)
ââ8 9
;
ââ9 :
}
ää 
else
ãã 
{
åå 
sectionVersions
éé 
=
éé  !
await
éé" '
_unitOfWork
éé( 3
.
éé3 4,
CourseSectionVersionRepository
éé4 R
.
ééR S
GetAllAsync
ééS ^
(
éé^ _
x
éé_ `
=>
ééa c
x
èè 
.
èè 
CourseVersionId
èè %
==
èè& (
courseVersionId
èè) 8
&&
èè9 ;
x
èè< =
.
èè= >
CurrentStatus
èè> K
<=
èèL N
StaticStatus
èèO [
.
èè[ \
Category
èè\ d
.
èèd e
	Activated
èèe n
)
èèn o
;
èèo p
}
êê 
if
ìì 
(
ìì 
!
ìì 
sectionVersions
ìì  
.
ìì  !
Any
ìì! $
(
ìì$ %
)
ìì% &
)
ìì& '
{
îî 
return
ïï 
new
ïï 
ResponseDTO
ïï &
(
ïï& '
)
ïï' (
{
ññ 
Message
óó 
=
óó 
$str
óó <
,
óó< =
	IsSuccess
òò 
=
òò 
true
òò  $
,
òò$ %

StatusCode
ôô 
=
ôô  
$num
ôô! $
,
ôô$ %
Result
öö 
=
öö 
sectionVersions
öö ,
}
õõ 
;
õõ 
}
úú 
var
ûû 
listSections
ûû 
=
ûû 
sectionVersions
ûû .
.
ûû. /
ToList
ûû/ 5
(
ûû5 6
)
ûû6 7
;
ûû7 8
if
°° 
(
°° 
!
°° 
string
°° 
.
°° 
IsNullOrEmpty
°° %
(
°°% &
filterOn
°°& .
)
°°. /
&&
°°0 2
!
°°3 4
string
°°4 :
.
°°: ;
IsNullOrEmpty
°°; H
(
°°H I
filterQuery
°°I T
)
°°T U
)
°°U V
{
¢¢ 
switch
££ 
(
££ 
filterOn
££  
.
££  !
Trim
££! %
(
££% &
)
££& '
.
££' (
ToLower
££( /
(
££/ 0
)
££0 1
)
££1 2
{
§§ 
case
•• 
$str
••  
:
••  !
listSections
¶¶ $
=
¶¶% &
listSections
¶¶' 3
.
¶¶3 4
Where
¶¶4 9
(
¶¶9 :
x
¶¶: ;
=>
¶¶< >
x
ßß 
.
ßß 
Title
ßß #
.
ßß# $
Contains
ßß$ ,
(
ßß, -
filterQuery
ßß- 8
,
ßß8 9
StringComparison
ßß: J
.
ßßJ K&
CurrentCultureIgnoreCase
ßßK c
)
ßßc d
)
ßßd e
.
ßße f
ToList
ßßf l
(
ßßl m
)
ßßm n
;
ßßn o
break
®® 
;
®® 
case
©© 
$str
©© &
:
©©& '
listSections
™™ $
=
™™% &
listSections
™™' 3
.
™™3 4
Where
™™4 9
(
™™9 :
x
™™: ;
=>
™™< >
x
´´ 
.
´´ 
Description
´´ )
.
´´) *
Contains
´´* 2
(
´´2 3
filterQuery
´´3 >
,
´´> ?
StringComparison
´´@ P
.
´´P Q&
CurrentCultureIgnoreCase
´´Q i
)
´´i j
)
´´j k
.
´´k l
ToList
´´l r
(
´´r s
)
´´s t
;
´´t u
break
¨¨ 
;
¨¨ 
case
≠≠ 
$str
≠≠ (
:
≠≠( )
if
ÆÆ 
(
ÆÆ 
int
ÆÆ 
.
ÆÆ  
TryParse
ÆÆ  (
(
ÆÆ( )
filterQuery
ÆÆ) 4
,
ÆÆ4 5
out
ÆÆ6 9
var
ÆÆ: =
status
ÆÆ> D
)
ÆÆD E
)
ÆÆE F
{
ØØ 
listSections
∞∞ (
=
∞∞) *
listSections
∞∞+ 7
.
∞∞7 8
Where
∞∞8 =
(
∞∞= >
x
∞∞> ?
=>
∞∞@ B
x
∞∞C D
.
∞∞D E
CurrentStatus
∞∞E R
==
∞∞S U
status
∞∞V \
)
∞∞\ ]
.
∞∞] ^
ToList
∞∞^ d
(
∞∞d e
)
∞∞e f
;
∞∞f g
}
±± 
break
≥≥ 
;
≥≥ 
default
¥¥ 
:
¥¥ 
break
µµ 
;
µµ 
}
∂∂ 
}
∑∑ 
if
∫∫ 
(
∫∫ 
!
∫∫ 
string
∫∫ 
.
∫∫ 
IsNullOrEmpty
∫∫ %
(
∫∫% &
sortBy
∫∫& ,
)
∫∫, -
)
∫∫- .
{
ªª 
switch
ºº 
(
ºº 
sortBy
ºº 
.
ºº 
Trim
ºº #
(
ºº# $
)
ºº$ %
.
ºº% &
ToLower
ºº& -
(
ºº- .
)
ºº. /
)
ºº/ 0
{
ΩΩ 
case
ææ 
$str
ææ  
:
ææ  !
listSections
øø $
=
øø% &
listSections
øø' 3
.
øø3 4
OrderBy
øø4 ;
(
øø; <
x
øø< =
=>
øø> @
x
øøA B
.
øøB C
Title
øøC H
)
øøH I
.
øøI J
ToList
øøJ P
(
øøP Q
)
øøQ R
;
øøR S
break
¿¿ 
;
¿¿ 
case
¡¡ 
$str
¡¡ &
:
¡¡& '
listSections
¬¬ $
=
¬¬% &
listSections
¬¬' 3
.
¬¬3 4
OrderBy
¬¬4 ;
(
¬¬; <
x
¬¬< =
=>
¬¬> @
x
¬¬A B
.
¬¬B C
Description
¬¬C N
)
¬¬N O
.
¬¬O P
ToList
¬¬P V
(
¬¬V W
)
¬¬W X
;
¬¬X Y
break
√√ 
;
√√ 
case
ƒƒ 
$str
ƒƒ (
:
ƒƒ( )
listSections
≈≈ $
=
≈≈% &
listSections
≈≈' 3
.
≈≈3 4
OrderBy
≈≈4 ;
(
≈≈; <
x
≈≈< =
=>
≈≈> @
x
≈≈A B
.
≈≈B C
CurrentStatus
≈≈C P
)
≈≈P Q
.
≈≈Q R
ToList
≈≈R X
(
≈≈X Y
)
≈≈Y Z
;
≈≈Z [
break
∆∆ 
;
∆∆ 
default
«« 
:
«« 
break
»» 
;
»» 
}
…… 
}
   
else
ÀÀ 
{
ÃÃ 
listSections
ŒŒ 
=
ŒŒ 
listSections
ŒŒ +
.
ŒŒ+ ,
OrderBy
ŒŒ, 3
(
ŒŒ3 4
x
ŒŒ4 5
=>
ŒŒ6 8
x
ŒŒ9 :
.
ŒŒ: ;
Title
ŒŒ; @
)
ŒŒ@ A
.
ŒŒA B
ToList
ŒŒB H
(
ŒŒH I
)
ŒŒI J
;
ŒŒJ K
}
œœ 
if
““ 
(
““ 

pageNumber
““ 
>
““ 
$num
““ 
&&
““ !
pageSize
““" *
>
““+ ,
$num
““- .
)
““. /
{
”” 
var
‘‘ 

skipResult
‘‘ 
=
‘‘  
(
‘‘! "

pageNumber
‘‘" ,
-
‘‘- .
$num
‘‘/ 0
)
‘‘0 1
*
‘‘2 3
pageSize
‘‘4 <
;
‘‘< =
listSections
’’ 
=
’’ 
listSections
’’ +
.
’’+ ,
Skip
’’, 0
(
’’0 1

skipResult
’’1 ;
)
’’; <
.
’’< =
Take
’’= A
(
’’A B
pageSize
’’B J
)
’’J K
.
’’K L
ToList
’’L R
(
’’R S
)
’’S T
;
’’T U
}
÷÷ 
var
ŸŸ 
sectionsDto
ŸŸ 
=
ŸŸ 
listSections
ŸŸ *
.
ŸŸ* +
Select
ŸŸ+ 1
(
ŸŸ1 2
section
ŸŸ2 9
=>
ŸŸ: <
new
ŸŸ= @
GetAllSectionsDTO
ŸŸA R
{
⁄⁄ 
Id
€€ 
=
€€ 
section
€€ 
.
€€ 
Id
€€ 
,
€€  
Title
‹‹ 
=
‹‹ 
section
‹‹ 
.
‹‹  
Title
‹‹  %
,
‹‹% &
Description
›› 
=
›› 
section
›› %
.
››% &
Description
››& 1
,
››1 2
CurrentStatus
ﬁﬁ 
=
ﬁﬁ 
(
ﬁﬁ  !
int
ﬁﬁ! $
)
ﬁﬁ$ %
section
ﬁﬁ% ,
.
ﬁﬁ, -
CurrentStatus
ﬁﬁ- :
}
ﬂﬂ 
)
ﬂﬂ 
.
ﬂﬂ 
ToList
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
return
·· 
new
·· 
ResponseDTO
·· "
(
··" #
)
··# $
{
‚‚ 
Message
„„ 
=
„„ 
$str
„„ D
,
„„D E
	IsSuccess
‰‰ 
=
‰‰ 
true
‰‰  
,
‰‰  !

StatusCode
ÂÂ 
=
ÂÂ 
$num
ÂÂ  
,
ÂÂ  !
Result
ÊÊ 
=
ÊÊ 
sectionsDto
ÊÊ $
}
ÁÁ 
;
ÁÁ 
}
ËË 	
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
e
ÈÈ 
)
ÈÈ 
{
ÍÍ 	
return
ÎÎ 
new
ÎÎ 
ResponseDTO
ÎÎ "
(
ÎÎ" #
)
ÎÎ# $
{
ÏÏ 
Message
ÌÌ 
=
ÌÌ 
e
ÌÌ 
.
ÌÌ 
Message
ÌÌ #
,
ÌÌ# $
Result
ÓÓ 
=
ÓÓ 
null
ÓÓ 
,
ÓÓ 
	IsSuccess
ÔÔ 
=
ÔÔ 
false
ÔÔ !
,
ÔÔ! "

StatusCode
 
=
 
$num
  
}
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
}
ÛÛ 
public
ıı 

async
ıı 
Task
ıı 
<
ıı 
ResponseDTO
ıı !
>
ıı! "
GetCourseSection
ıı# 3
(
ˆˆ 
ClaimsPrincipal
˜˜ 
User
˜˜ 
,
˜˜ 
Guid
¯¯ $
courseSectionVersionId
¯¯ #
)
˘˘ 
{
˙˙ 
try
˚˚ 
{
¸¸ 	
var
˝˝ "
courseSectionVersion
˝˝ $
=
˝˝% &
await
˛˛ 
_unitOfWork
˛˛ !
.
˛˛! ",
CourseSectionVersionRepository
˛˛" @
.
˛˛@ A
GetAsync
˛˛A I
(
˛˛I J
c
˛˛J K
=>
˛˛L N
c
ˇˇ 
.
ˇˇ 
Id
ˇˇ 
==
ˇˇ $
courseSectionVersionId
ˇˇ 2
)
ˇˇ2 3
;
ˇˇ3 4
if
ÅÅ 
(
ÅÅ "
courseSectionVersion
ÅÅ $
is
ÅÅ% '
null
ÅÅ( ,
)
ÅÅ, -
{
ÇÇ 
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ &
(
ÉÉ& '
)
ÉÉ' (
{
ÑÑ 
Result
ÖÖ 
=
ÖÖ 
$str
ÖÖ 
,
ÖÖ  
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ C
,
ÜÜC D
	IsSuccess
áá 
=
áá 
true
áá  $
,
áá$ %

StatusCode
àà 
=
àà  
$num
àà! $
}
ââ 
;
ââ 
}
ää 
var
åå %
courseSectionVersionDto
åå '
=
åå( )
_mapper
åå* 1
.
åå1 2
Map
åå2 5
<
åå5 6!
GetCourseSectionDTO
åå6 I
>
ååI J
(
ååJ K"
courseSectionVersion
ååK _
)
åå_ `
;
åå` a
return
éé 
new
éé 
ResponseDTO
éé "
(
éé" #
)
éé# $
{
èè 
Result
êê 
=
êê %
courseSectionVersionDto
êê 0
,
êê0 1
Message
ëë 
=
ëë 
$str
ëë C
,
ëëC D
	IsSuccess
íí 
=
íí 
true
íí  
,
íí  !

StatusCode
ìì 
=
ìì 
$num
ìì  
}
îî 
;
îî 
}
ïï 	
catch
ññ 
(
ññ 
	Exception
ññ 
e
ññ 
)
ññ 
{
óó 	
return
òò 
new
òò 
ResponseDTO
òò "
(
òò" #
)
òò# $
{
ôô 
Result
öö 
=
öö 
null
öö 
,
öö 
Message
õõ 
=
õõ 
e
õõ 
.
õõ 
Message
õõ #
,
õõ# $
	IsSuccess
úú 
=
úú 
true
úú  
,
úú  !

StatusCode
ùù 
=
ùù 
$num
ùù  
}
ûû 
;
ûû 
}
üü 	
}
†† 
public
¢¢ 

async
¢¢ 
Task
¢¢ 
<
¢¢ 
ResponseDTO
¢¢ !
>
¢¢! "!
CreateCourseSection
¢¢# 6
(
££ 
ClaimsPrincipal
§§ 
User
§§ 
,
§§ +
CreateCourseSectionVersionDTO
•• %+
createCourseSectionVersionDTO
••& C
)
¶¶ 
{
ßß 
try
®® 
{
©© 	
var
™™ 
courseVersionId
™™ 
=
™™  !
await
´´ 
_unitOfWork
´´ !
.
´´! "%
CourseVersionRepository
´´" 9
.
´´9 :
GetAsync
´´: B
(
´´B C
c
´´C D
=>
´´E G
c
¨¨ 
.
¨¨ 
Id
¨¨ 
==
¨¨ +
createCourseSectionVersionDTO
¨¨ 9
.
¨¨9 :
CourseVersionId
¨¨: I
)
¨¨I J
;
¨¨J K
if
≠≠ 
(
≠≠ 
courseVersionId
≠≠ 
==
≠≠  "
null
≠≠# '
)
≠≠' (
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
(
ØØ& '
)
ØØ' (
{
∞∞ 
Message
±± 
=
±± 
$str
±± 7
,
±±7 8
Result
≤≤ 
=
≤≤ 
null
≤≤ !
,
≤≤! "
	IsSuccess
≥≥ 
=
≥≥ 
false
≥≥  %
,
≥≥% &

StatusCode
¥¥ 
=
¥¥  
$num
¥¥! $
}
µµ 
;
µµ 
}
∂∂ 
var
ππ "
courseSectionVersion
ππ $
=
ππ% &
new
ππ' *"
CourseSectionVersion
ππ+ ?
(
ππ? @
)
ππ@ A
{
∫∫ 
Id
ªª 
=
ªª 
Guid
ªª 
.
ªª 
NewGuid
ªª !
(
ªª! "
)
ªª" #
,
ªª# $
CourseVersionId
ºº 
=
ºº  !+
createCourseSectionVersionDTO
ºº" ?
.
ºº? @
CourseVersionId
ºº@ O
,
ººO P
Title
ΩΩ 
=
ΩΩ +
createCourseSectionVersionDTO
ΩΩ 5
.
ΩΩ5 6
Title
ΩΩ6 ;
,
ΩΩ; <
Description
ææ 
=
ææ +
createCourseSectionVersionDTO
ææ ;
.
ææ; <
Description
ææ< G
,
ææG H
CurrentStatus
øø 
=
øø 
$num
øø  !
}
¿¿ 
;
¿¿ 
await
√√ 
_unitOfWork
√√ 
.
√√ ,
CourseSectionVersionRepository
√√ <
.
√√< =
AddAsync
√√= E
(
√√E F"
courseSectionVersion
√√F Z
)
√√Z [
;
√√[ \
await
ƒƒ 
_unitOfWork
ƒƒ 
.
ƒƒ 
	SaveAsync
ƒƒ '
(
ƒƒ' (
)
ƒƒ( )
;
ƒƒ) *
return
∆∆ 
new
∆∆ 
ResponseDTO
∆∆ "
(
∆∆" #
)
∆∆# $
{
«« 
Result
»» 
=
»» "
courseSectionVersion
»» -
.
»»- .
Id
»». 0
,
»»0 1
Message
…… 
=
…… 
$str
…… J
,
……J K
	IsSuccess
   
=
   
true
    
,
    !

StatusCode
ÀÀ 
=
ÀÀ 
$num
ÀÀ  
}
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
e
ŒŒ 
)
ŒŒ 
{
œœ 	
return
–– 
new
–– 
ResponseDTO
–– "
(
––" #
)
––# $
{
—— 
Result
““ 
=
““ 
null
““ 
,
““ 
	IsSuccess
”” 
=
”” 
false
”” !
,
””! "
Message
‘‘ 
=
‘‘ 
e
‘‘ 
.
‘‘ 
Message
‘‘ #
,
‘‘# $

StatusCode
’’ 
=
’’ 
$num
’’  
}
÷÷ 
;
÷÷ 
}
◊◊ 	
}
ÿÿ 
public
⁄⁄ 

async
⁄⁄ 
Task
⁄⁄ 
<
⁄⁄ 
ResponseDTO
⁄⁄ !
>
⁄⁄! "
EditCourseSection
⁄⁄# 4
(
€€ 
ClaimsPrincipal
‹‹ 
User
‹‹ 
,
‹‹ )
EditCourseSectionVersionDTO
›› #)
editCourseSectionVersionDTO
››$ ?
)
ﬁﬁ 
{
ﬂﬂ 
try
‡‡ 
{
·· 	
var
„„ $
courseSectionVersionId
„„ &
=
„„' (
await
‰‰ 
_unitOfWork
‰‰ !
.
‰‰! ",
CourseSectionVersionRepository
‰‰" @
.
‰‰@ A
GetAsync
‰‰A I
(
‰‰I J
c
‰‰J K
=>
‰‰L N
c
ÂÂ 
.
ÂÂ 
Id
ÂÂ 
==
ÂÂ )
editCourseSectionVersionDTO
ÂÂ 7
.
ÂÂ7 8$
CourseSectionVersionId
ÂÂ8 N
)
ÂÂN O
;
ÂÂO P
if
ÊÊ 
(
ÊÊ $
courseSectionVersionId
ÊÊ &
==
ÊÊ' )
null
ÊÊ* .
)
ÊÊ. /
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË &
(
ËË& '
)
ËË' (
{
ÈÈ 
Message
ÍÍ 
=
ÍÍ 
$str
ÍÍ >
,
ÍÍ> ?
Result
ÎÎ 
=
ÎÎ 
null
ÎÎ !
,
ÎÎ! "
	IsSuccess
ÏÏ 
=
ÏÏ 
false
ÏÏ  %
,
ÏÏ% &

StatusCode
ÌÌ 
=
ÌÌ  
$num
ÌÌ! $
}
ÓÓ 
;
ÓÓ 
}
ÔÔ $
courseSectionVersionId
ıı "
.
ıı" #
Title
ıı# (
=
ıı) *)
editCourseSectionVersionDTO
ıı+ F
.
ııF G
Title
ııG L
;
ııL M$
courseSectionVersionId
ˆˆ "
.
ˆˆ" #
Description
ˆˆ# .
=
ˆˆ/ 0)
editCourseSectionVersionDTO
ˆˆ1 L
.
ˆˆL M
Description
ˆˆM X
;
ˆˆX Y$
courseSectionVersionId
˜˜ "
.
˜˜" #
CurrentStatus
˜˜# 0
=
˜˜1 2
$num
˜˜3 4
;
˜˜4 5
_unitOfWork
˘˘ 
.
˘˘ ,
CourseSectionVersionRepository
˘˘ 6
.
˘˘6 7
Update
˘˘7 =
(
˘˘= >$
courseSectionVersionId
˘˘> T
)
˘˘T U
;
˘˘U V
await
˙˙ 
_unitOfWork
˙˙ 
.
˙˙ 
	SaveAsync
˙˙ '
(
˙˙' (
)
˙˙( )
;
˙˙) *
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ "
(
¸¸" #
)
¸¸# $
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ D
,
˛˛D E
Result
ˇˇ 
=
ˇˇ 
null
ˇˇ 
,
ˇˇ 
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  
,
ÄÄ  !

StatusCode
ÅÅ 
=
ÅÅ 
$num
ÅÅ  
,
ÅÅ  !
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
e
ÑÑ 
)
ÑÑ 
{
ÖÖ 	
return
ÜÜ 
new
ÜÜ 
ResponseDTO
ÜÜ "
{
áá 
Message
àà 
=
àà 
e
àà 
.
àà 
Message
àà #
,
àà# $
Result
ââ 
=
ââ 
null
ââ 
,
ââ 
	IsSuccess
ää 
=
ää 
false
ää !
,
ää! "

StatusCode
ãã 
=
ãã 
$num
ãã  
}
åå 
;
åå 
}
çç 	
}
éé 
public
êê 

async
êê 
Task
êê 
<
êê 
ResponseDTO
êê !
>
êê! "!
RemoveCourseSection
êê# 6
(
ëë 
ClaimsPrincipal
íí 
User
íí 
,
íí 
Guid
ìì 
sectionVersionId
ìì 
)
îî 
{
ïï 
try
ññ 
{
óó 	
var
ôô "
courseSectionVersion
ôô $
=
ôô% &
await
öö 
_unitOfWork
öö !
.
öö! ",
CourseSectionVersionRepository
öö" @
.
öö@ A
GetAsync
ööA I
(
ööI J
c
ööJ K
=>
ööL N
c
õõ 
.
õõ 
Id
õõ 
==
õõ 
sectionVersionId
õõ ,
)
õõ, -
;
õõ- .
if
úú 
(
úú "
courseSectionVersion
úú $
==
úú% '
null
úú( ,
)
úú, -
{
ùù 
return
ûû 
new
ûû 
ResponseDTO
ûû &
(
ûû& '
)
ûû' (
{
üü 
Message
†† 
=
†† 
$str
†† D
,
††D E
Result
°° 
=
°° 
null
°° !
,
°°! "
	IsSuccess
¢¢ 
=
¢¢ 
false
¢¢  %
,
¢¢% &

StatusCode
££ 
=
££  
$num
££! $
}
§§ 
;
§§ 
}
•• 
var
™™ "
sectionDetailVersion
™™ $
=
™™% &
await
´´ 
_unitOfWork
´´ !
.
´´! "-
SectionDetailsVersionRepository
´´" A
.
´´A B
GetAllAsync
´´B M
(
´´M N
x
´´N O
=>
´´P R
x
¨¨ 
.
¨¨ $
CourseSectionVersionId
¨¨ ,
==
¨¨- /"
courseSectionVersion
¨¨0 D
.
¨¨D E
Id
¨¨E G
)
¨¨G H
;
¨¨H I
_unitOfWork
ÆÆ 
.
ÆÆ -
SectionDetailsVersionRepository
ÆÆ 7
.
ÆÆ7 8
RemoveRange
ÆÆ8 C
(
ÆÆC D"
sectionDetailVersion
ÆÆD X
)
ÆÆX Y
;
ÆÆY Z
_unitOfWork
ØØ 
.
ØØ ,
CourseSectionVersionRepository
ØØ 6
.
ØØ6 7
Remove
ØØ7 =
(
ØØ= >"
courseSectionVersion
ØØ> R
)
ØØR S
;
ØØS T
await
∞∞ 
_unitOfWork
∞∞ 
.
∞∞ 
	SaveAsync
∞∞ '
(
∞∞' (
)
∞∞( )
;
∞∞) *
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ G
,
¥¥G H
Result
µµ 
=
µµ 
null
µµ 
,
µµ 
	IsSuccess
∂∂ 
=
∂∂ 
true
∂∂  
,
∂∂  !

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
,
∑∑  !
}
∏∏ 
;
∏∏ 
}
ππ 	
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 	
return
ºº 
new
ºº 
ResponseDTO
ºº "
{
ΩΩ 
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $
Result
øø 
=
øø 
null
øø 
,
øø 
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿ !
,
¿¿! "

StatusCode
¡¡ 
=
¡¡ 
$num
¡¡  
}
¬¬ 
;
¬¬ 
}
√√ 	
}
ƒƒ 
}≈≈ ñZ
iD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\ClosedXMLService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public		 
class		 
ClosedXMLService		 
:		 
IClosedXMLService		  1
{

 
private 
readonly 
IWebHostEnvironment (
_env) -
;- .
private 
readonly 
IConfiguration #
_config$ +
;+ ,
public 

ClosedXMLService 
( 
IWebHostEnvironment /
env0 3
,3 4
IConfiguration5 C
configD J
)J K
{ 
_env 
= 
env 
; 
_config 
= 
config 
; 
} 
public 

async 
Task 
< 
string 
> !
ExportInstructorExcel 3
(3 4
List4 8
<8 9
InstructorInfoDTO9 J
>J K
instructorInfoDtosL ^
)^ _
{ 
string 
exportFolderPath 
=  !
Path" &
.& '
Combine' .
(. /
_env/ 3
.3 4
ContentRootPath4 C
,C D
_configE L
[L M
$strM o
]o p
)p q
;q r
if 

( 
! 
	Directory 
. 
Exists 
( 
exportFolderPath .
). /
)/ 0
{ 	
	Directory 
. 
CreateDirectory %
(% &
exportFolderPath& 6
)6 7
;7 8
} 	
string   
fileName   
=   
$"   
$str   (
{  ( )
DateTime  ) 1
.  1 2
Now  2 5
:  5 6
$str  6 E
}  E F
$str  F K
"  K L
;  L M
string!! 
filePath!! 
=!! 
Path!! 
.!! 
Combine!! &
(!!& '
exportFolderPath!!' 7
,!!7 8
fileName!!9 A
)!!A B
;!!B C
using## 
(## 
var## 
workBook## 
=## 
new## !

XLWorkbook##" ,
(##, -
)##- .
)##. /
{$$ 	
var%% 
	workSheet%% 
=%% 
workBook%% $
.%%$ %

Worksheets%%% /
.%%/ 0
Add%%0 3
(%%3 4
$str%%4 A
)%%A B
;%%B C
	workSheet(( 
.(( 
Cell(( 
((( 
$num(( 
,(( 
$num(( 
)((  
.((  !
Value((! &
=((' (
$str(() 8
;((8 9
	workSheet)) 
.)) 
Cell)) 
()) 
$num)) 
,)) 
$num)) 
)))  
.))  !
Value))! &
=))' (
$str))) 1
;))1 2
	workSheet** 
.** 
Cell** 
(** 
$num** 
,** 
$num** 
)**  
.**  !
Value**! &
=**' (
$str**) 3
;**3 4
	workSheet++ 
.++ 
Cell++ 
(++ 
$num++ 
,++ 
$num++ 
)++  
.++  !
Value++! &
=++' (
$str++) 0
;++0 1
	workSheet,, 
.,, 
Cell,, 
(,, 
$num,, 
,,, 
$num,, 
),,  
.,,  !
Value,,! &
=,,' (
$str,,) 6
;,,6 7
	workSheet-- 
.-- 
Cell-- 
(-- 
$num-- 
,-- 
$num-- 
)--  
.--  !
Value--! &
=--' (
$str--) 1
;--1 2
	workSheet.. 
... 
Cell.. 
(.. 
$num.. 
,.. 
$num.. 
)..  
...  !
Value..! &
=..' (
$str..) 4
;..4 5
	workSheet// 
.// 
Cell// 
(// 
$num// 
,// 
$num// 
)//  
.//  !
Value//! &
=//' (
$str//) 2
;//2 3
	workSheet00 
.00 
Cell00 
(00 
$num00 
,00 
$num00 
)00  
.00  !
Value00! &
=00' (
$str00) 2
;002 3
	workSheet11 
.11 
Cell11 
(11 
$num11 
,11 
$num11  
)11  !
.11! "
Value11" '
=11( )
$str11* 2
;112 3
	workSheet22 
.22 
Cell22 
(22 
$num22 
,22 
$num22  
)22  !
.22! "
Value22" '
=22( )
$str22* 4
;224 5
	workSheet33 
.33 
Cell33 
(33 
$num33 
,33 
$num33  
)33  !
.33! "
Value33" '
=33( )
$str33* 8
;338 9
	workSheet44 
.44 
Cell44 
(44 
$num44 
,44 
$num44  
)44  !
.44! "
Value44" '
=44( )
$str44* 5
;445 6
	workSheet55 
.55 
Cell55 
(55 
$num55 
,55 
$num55  
)55  !
.55! "
Value55" '
=55( )
$str55* 6
;556 7
forAA 
(AA 
intAA 
iAA 
=AA 
$numAA 
;AA 
iAA 
<AA 
instructorInfoDtosAA  2
.AA2 3
CountAA3 8
;AA8 9
iAA: ;
++AA; =
)AA= >
{BB 
	workSheetCC 
.CC 
CellCC 
(CC 
iCC  
+CC! "
$numCC# $
,CC$ %
$numCC& '
)CC' (
.CC( )
ValueCC) .
=CC/ 0
instructorInfoDtosCC1 C
[CCC D
iCCD E
]CCE F
.CCF G
InstructorIdCCG S
.CCS T
ToStringCCT \
(CC\ ]
)CC] ^
;CC^ _
	workSheetDD 
.DD 
CellDD 
(DD 
iDD  
+DD! "
$numDD# $
,DD$ %
$numDD& '
)DD' (
.DD( )
ValueDD) .
=DD/ 0
instructorInfoDtosDD1 C
[DDC D
iDDD E
]DDE F
.DDF G
UserIdDDG M
;DDM N
	workSheetEE 
.EE 
CellEE 
(EE 
iEE  
+EE! "
$numEE# $
,EE$ %
$numEE& '
)EE' (
.EE( )
ValueEE) .
=EE/ 0
instructorInfoDtosEE1 C
[EEC D
iEED E
]EEE F
.EEF G
FullNameEEG O
;EEO P
	workSheetFF 
.FF 
CellFF 
(FF 
iFF  
+FF! "
$numFF# $
,FF$ %
$numFF& '
)FF' (
.FF( )
ValueFF) .
=FF/ 0
instructorInfoDtosFF1 C
[FFC D
iFFD E
]FFE F
.FFF G
EmailFFG L
;FFL M
	workSheetGG 
.GG 
CellGG 
(GG 
iGG  
+GG! "
$numGG# $
,GG$ %
$numGG& '
)GG' (
.GG( )
ValueGG) .
=GG/ 0
instructorInfoDtosGG1 C
[GGC D
iGGD E
]GGE F
.GGF G
PhoneNumberGGG R
;GGR S
	workSheetHH 
.HH 
CellHH 
(HH 
iHH  
+HH! "
$numHH# $
,HH$ %
$numHH& '
)HH' (
.HH( )
ValueHH) .
=HH/ 0
instructorInfoDtosHH1 C
[HHC D
iHHD E
]HHE F
.HHF G
GenderHHG M
;HHM N
	workSheetII 
.II 
CellII 
(II 
iII  
+II! "
$numII# $
,II$ %
$numII& '
)II' (
.II( )
ValueII) .
=II/ 0
instructorInfoDtosII1 C
[IIC D
iIID E
]IIE F
.IIF G
	BirthDateIIG P
;IIP Q
	workSheetJJ 
.JJ 
CellJJ 
(JJ 
iJJ  
+JJ! "
$numJJ# $
,JJ$ %
$numJJ& '
)JJ' (
.JJ( )
ValueJJ) .
=JJ/ 0
instructorInfoDtosJJ1 C
[JJC D
iJJD E
]JJE F
.JJF G
CountryJJG N
;JJN O
	workSheetKK 
.KK 
CellKK 
(KK 
iKK  
+KK! "
$numKK# $
,KK$ %
$numKK& '
)KK' (
.KK( )
ValueKK) .
=KK/ 0
instructorInfoDtosKK1 C
[KKC D
iKKD E
]KKE F
.KKF G
AddressKKG N
;KKN O
	workSheetLL 
.LL 
CellLL 
(LL 
iLL  
+LL! "
$numLL# $
,LL$ %
$numLL& (
)LL( )
.LL) *
ValueLL* /
=LL0 1
instructorInfoDtosLL2 D
[LLD E
iLLE F
]LLF G
.LLG H
DegreeLLH N
;LLN O
	workSheetMM 
.MM 
CellMM 
(MM 
iMM  
+MM! "
$numMM# $
,MM$ %
$numMM& (
)MM( )
.MM) *
ValueMM* /
=MM0 1
instructorInfoDtosMM2 D
[MMD E
iMME F
]MMF G
.MMG H
IndustryMMH P
;MMP Q
	workSheetNN 
.NN 
CellNN 
(NN 
iNN  
+NN! "
$numNN# $
,NN$ %
$numNN& (
)NN( )
.NN) *
ValueNN* /
=NN0 1
instructorInfoDtosNN2 D
[NND E
iNNE F
]NNF G
.NNG H
IntroductionNNH T
;NNT U
	workSheetOO 
.OO 
CellOO 
(OO 
iOO  
+OO! "
$numOO# $
,OO$ %
$numOO& (
)OO( )
.OO) *
ValueOO* /
=OO0 1
instructorInfoDtosOO2 D
[OOD E
iOOE F
]OOF G
.OOG H
	TaxNumberOOH Q
;OOQ R
	workSheetPP 
.PP 
CellPP 
(PP 
iPP  
+PP! "
$numPP# $
,PP$ %
$numPP& (
)PP( )
.PP) *
ValuePP* /
=PP0 1
instructorInfoDtosPP2 D
[PPD E
iPPE F
]PPF G
.PPG H

IsAcceptedPPH R
.PPR S
ToStringPPS [
(PP[ \
)PP\ ]
;PP] ^
}QQ 
	workSheetSS 
.SS 
ColumnsSS 
(SS 
)SS 
.SS  
AdjustToContentsSS  0
(SS0 1
)SS1 2
;SS2 3
workBook__ 
.__ 
SaveAs__ 
(__ 
filePath__ $
)__$ %
;__% &
returnpp 
fileNamepp 
;pp 
}qq 	
}rr 
}ss òÄ
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\CategoryService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
CategoryService 
: 
ICategoryService /
{ 
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
IMapper 
_mapper $
;$ %
public 

CategoryService 
( 
IUnitOfWork &

unitOfWork' 1
,1 2
IMapper3 :
mapper; A
)A B
{ 
_unitOfWork 
= 

unitOfWork  
;  !
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
ResponseDTO !
>! "
GetAll# )
( 
ClaimsPrincipal 
User 
, 
string   
?   
filterOn   
,   
string!! 
?!! 
filterQuery!! 
,!! 
string"" 
?"" 
sortBy"" 
,"" 
bool## 
?## 
isAscending## 
,## 
int$$ 

pageNumber$$ 
,$$ 
int%% 
pageSize%% 
)%% 
{&& 
try'' 
{(( 	
var)) 
userRole)) 
=)) 
User)) 
.))  
Claims))  &
.))& '
FirstOrDefault))' 5
())5 6
x))6 7
=>))8 :
x)); <
.))< =
Type))= A
==))B D

ClaimTypes))E O
.))O P
Role))P T
)))T U
?))U V
.))V W
Value))W \
;))\ ]
IEnumerable++ 
<++ 
Category++  
>++  !

categories++" ,
;++, -
if.. 
(.. 
userRole.. 
==.. 
StaticUserRoles.. +
...+ ,
Admin.., 1
)..1 2
{// 

categories00 
=00 
await11 
_unitOfWork11 %
.11% &
CategoryRepository11& 8
.118 9
GetAllAsync119 D
(11D E
)11E F
;11F G
}22 
else33 
{44 

categories55 
=55 
await66 
_unitOfWork66 %
.66% &
CategoryRepository66& 8
.668 9
GetAllAsync669 D
(66D E
x66E F
=>66G I
x77 
.77 
Status77  
<=77! #
StaticStatus77$ 0
.770 1
Category771 9
.779 :
	Activated77: C
)77C D
;77D E
}88 
if:: 
(:: 

categories:: 
.:: 
IsNullOrEmpty:: (
(::( )
)::) *
)::* +
{;; 
return<< 
new<< 
ResponseDTO<< &
(<<& '
)<<' (
{== 
Message>> 
=>> 
$str>> 5
,>>5 6
Result?? 
=?? 
null?? !
,??! "
	IsSuccess@@ 
=@@ 
true@@  $
,@@$ %

StatusCodeAA 
=AA  
$numAA! $
}BB 
;BB 
}CC 
varEE 
listCategoryEE 
=EE 

categoriesEE )
.EE) *
ToListEE* 0
(EE0 1
)EE1 2
;EE2 3
varJJ  
categoriesDictionaryJJ $
=JJ% &
listCategoryJJ' 3
.JJ3 4
ToDictionaryJJ4 @
(JJ@ A
xJJA B
=>JJC E
xJJF G
.JJG H
IdJJH J
,JJJ K
xJJL M
=>JJN P
xJJQ R
)JJR S
;JJS T
varLL 
rootCategoriesLL 
=LL  
newLL! $
ListLL% )
<LL) *
CategoryLL* 2
>LL2 3
(LL3 4
)LL4 5
;LL5 6
foreachNN 
(NN 
varNN 
categoryNN !
inNN" $
listCategoryNN% 1
)NN1 2
{OO 
ifQQ 
(QQ 
categoryQQ 
.QQ 
ParentIdQQ %
.QQ% &
HasValueQQ& .
)QQ. /
{RR 
ifTT 
(TT  
categoriesDictionaryTT ,
.TT, -
TryGetValueTT- 8
(TT8 9
categoryTT9 A
.TTA B
ParentIdTTB J
.TTJ K
ValueTTK P
,TTP Q
outTTR U
varTTV Y
parentCategoryTTZ h
)TTh i
)TTi j
{UU 
parentCategoryWW &
.WW& '
SubCategoriesWW' 4
.WW4 5
AddWW5 8
(WW8 9
categoryWW9 A
)WWA B
;WWB C
}XX 
}YY 
elseZZ 
{[[ 
rootCategories]] "
.]]" #
Add]]# &
(]]& '
category]]' /
)]]/ 0
;]]0 1
}^^ 
}__ 
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrEmptygg %
(gg% &
filterOngg& .
)gg. /
&&gg0 2
!gg3 4
stringgg4 :
.gg: ;
IsNullOrEmptygg; H
(ggH I
filterQueryggI T
)ggT U
)ggU V
{hh 
switchii 
(ii 
filterOnii  
.ii  !
Trimii! %
(ii% &
)ii& '
.ii' (
ToLowerii( /
(ii/ 0
)ii0 1
)ii1 2
{jj 
casekk 
$strkk 
:kk  
{ll 
rootCategoriesmm &
=mm' (
rootCategoriesmm) 7
.mm7 8
Wheremm8 =
(mm= >
xmm> ?
=>mm@ B
xnn 
.nn 
Namenn "
.nn" #
Containsnn# +
(nn+ ,
filterQuerynn, 7
,nn7 8
StringComparisonnn9 I
.nnI J$
CurrentCultureIgnoreCasennJ b
)nnb c
)nnc d
.nnd e
ToListnne k
(nnk l
)nnl m
;nnm n
breakoo 
;oo 
}pp 
caseqq 
$strqq &
:qq& '
{rr 
rootCategoriesss &
=ss' (
rootCategoriesss) 7
.ss7 8
Wheress8 =
(ss= >
xss> ?
=>ss@ B
xtt 
.tt 
Namett "
.tt" #
Containstt# +
(tt+ ,
filterQuerytt, 7
,tt7 8
StringComparisontt9 I
.ttI J$
CurrentCultureIgnoreCasettJ b
)ttb c
)ttc d
.ttd e
ToListtte k
(ttk l
)ttl m
;ttm n
breakuu 
;uu 
}vv 
defaultww 
:ww 
{xx 
breakyy 
;yy 
}zz 
}{{ 
}|| 
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
sortBy& ,
), -
)- .
{
ÄÄ 
switch
ÅÅ 
(
ÅÅ 
sortBy
ÅÅ 
.
ÅÅ 
Trim
ÅÅ #
(
ÅÅ# $
)
ÅÅ$ %
.
ÅÅ% &
ToLower
ÅÅ& -
(
ÅÅ- .
)
ÅÅ. /
)
ÅÅ/ 0
{
ÇÇ 
case
ÉÉ 
$str
ÉÉ 
:
ÉÉ  
{
ÑÑ 
rootCategories
ÖÖ &
=
ÖÖ' (
isAscending
ÖÖ) 4
==
ÖÖ5 7
true
ÖÖ8 <
?
ÜÜ 
[
ÜÜ 
..
ÜÜ !
rootCategories
ÜÜ" 0
.
ÜÜ0 1
OrderBy
ÜÜ1 8
(
ÜÜ8 9
x
ÜÜ9 :
=>
ÜÜ; =
x
ÜÜ> ?
.
ÜÜ? @
Name
ÜÜ@ D
)
ÜÜD E
]
ÜÜE F
:
áá 
[
áá 
..
áá !
rootCategories
áá" 0
.
áá0 1
OrderByDescending
áá1 B
(
ááB C
x
ááC D
=>
ááE G
x
ááH I
.
ááI J
Name
ááJ N
)
ááN O
]
ááO P
;
ááP Q
break
àà 
;
àà 
}
ââ 
case
ää 
$str
ää &
:
ää& '
{
ãã 
rootCategories
åå &
=
åå' (
isAscending
åå) 4
==
åå5 7
true
åå8 <
?
çç 
[
çç 
..
çç !
rootCategories
çç" 0
.
çç0 1
OrderBy
çç1 8
(
çç8 9
x
çç9 :
=>
çç; =
x
çç> ?
.
çç? @
Description
çç@ K
)
ççK L
]
ççL M
:
éé 
[
éé 
..
éé !
rootCategories
éé" 0
.
éé0 1
OrderByDescending
éé1 B
(
ééB C
x
ééC D
=>
ééE G
x
ééH I
.
ééI J
Description
ééJ U
)
ééU V
]
ééV W
;
ééW X
break
èè 
;
èè 
}
êê 
default
ëë 
:
ëë 
{
íí 
break
ìì 
;
ìì 
}
îî 
}
ïï 
}
ññ 
if
ôô 
(
ôô 

pageNumber
ôô 
>
ôô 
$num
ôô 
&&
ôô !
pageSize
ôô" *
>
ôô+ ,
$num
ôô- .
)
ôô. /
{
öö 
var
õõ 

skipResult
õõ 
=
õõ  
(
õõ! "

pageNumber
õõ" ,
-
õõ- .
$num
õõ/ 0
)
õõ0 1
*
õõ2 3
pageSize
õõ4 <
;
õõ< =
rootCategories
úú 
=
úú  
rootCategories
úú! /
.
úú/ 0
Skip
úú0 4
(
úú4 5

skipResult
úú5 ?
)
úú? @
.
úú@ A
Take
úúA E
(
úúE F
pageSize
úúF N
)
úúN O
.
úúO P
ToList
úúP V
(
úúV W
)
úúW X
;
úúX Y
}
ùù 
object
¢¢ 
rootCategoriesDto
¢¢ $
;
¢¢$ %
if
££ 
(
££ 
userRole
££ 
==
££ 
StaticUserRoles
££ +
.
££+ ,
Admin
££, 1
)
££1 2
{
§§ 
rootCategoriesDto
•• !
=
••" #
_mapper
••$ +
.
••+ ,
Map
••, /
<
••/ 0
List
••0 4
<
••4 5
AdminCategoryDTO
••5 E
>
••E F
>
••F G
(
••G H
rootCategories
••H V
)
••V W
;
••W X
}
¶¶ 
else
ßß 
{
®® 
rootCategoriesDto
©© !
=
©©" #
_mapper
©©$ +
.
©©+ ,
Map
©©, /
<
©©/ 0
List
©©0 4
<
©©4 5
CategoryDTO
©©5 @
>
©©@ A
>
©©A B
(
©©B C
rootCategories
©©C Q
)
©©Q R
;
©©R S
}
™™ 
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ 9
,
ÆÆ9 :
Result
ØØ 
=
ØØ 
rootCategoriesDto
ØØ *
,
ØØ* +
	IsSuccess
∞∞ 
=
∞∞ 
true
∞∞  
,
∞∞  !

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
Message
∏∏ 
=
∏∏ 
e
∏∏ 
.
∏∏ 
Message
∏∏ #
,
∏∏# $
Result
ππ 
=
ππ 
null
ππ 
,
ππ 
	IsSuccess
∫∫ 
=
∫∫ 
false
∫∫ !
,
∫∫! "

StatusCode
ªª 
=
ªª 
$num
ªª  
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
¿¿ 

async
¿¿ 
Task
¿¿ 
<
¿¿ 
ResponseDTO
¿¿ !
>
¿¿! "
Search
¿¿# )
(
¡¡ 
ClaimsPrincipal
¬¬ 
User
¬¬ 
,
¬¬ 
string
√√ 
?
√√ 
filterOn
√√ 
,
√√ 
string
ƒƒ 
?
ƒƒ 
filterQuery
ƒƒ 
,
ƒƒ 
string
≈≈ 
?
≈≈ 
sortBy
≈≈ 
,
≈≈ 
bool
∆∆ 
?
∆∆ 
isAscending
∆∆ 
,
∆∆ 
int
«« 

pageNumber
«« 
,
«« 
int
»» 
pageSize
»» 
)
»» 
{
…… 
try
   
{
ÀÀ 	
var
ÃÃ 
userRole
ÃÃ 
=
ÃÃ 
User
ÃÃ 
.
ÃÃ  
Claims
ÃÃ  &
.
ÃÃ& '
FirstOrDefault
ÃÃ' 5
(
ÃÃ5 6
x
ÃÃ6 7
=>
ÃÃ8 :
x
ÃÃ; <
.
ÃÃ< =
Type
ÃÃ= A
==
ÃÃB D

ClaimTypes
ÃÃE O
.
ÃÃO P
Role
ÃÃP T
)
ÃÃT U
?
ÃÃU V
.
ÃÃV W
Value
ÃÃW \
;
ÃÃ\ ]
IEnumerable
ŒŒ 
<
ŒŒ 
Category
ŒŒ  
>
ŒŒ  !

categories
ŒŒ" ,
;
ŒŒ, -
if
—— 
(
—— 
userRole
—— 
==
—— 
StaticUserRoles
—— +
.
——+ ,
Admin
——, 1
)
——1 2
{
““ 

categories
”” 
=
”” 
await
‘‘ 
_unitOfWork
‘‘ %
.
‘‘% & 
CategoryRepository
‘‘& 8
.
‘‘8 9
GetAllAsync
‘‘9 D
(
‘‘D E
includeProperties
‘‘E V
:
‘‘V W
$str
‘‘X h
)
‘‘h i
;
‘‘i j
}
’’ 
else
÷÷ 
{
◊◊ 

categories
ÿÿ 
=
ÿÿ 
await
ŸŸ 
_unitOfWork
ŸŸ %
.
ŸŸ% & 
CategoryRepository
ŸŸ& 8
.
ŸŸ8 9
GetAllAsync
ŸŸ9 D
(
ŸŸD E
x
ŸŸE F
=>
ŸŸG I
x
⁄⁄ 
.
⁄⁄ 
Status
⁄⁄  
<=
⁄⁄! #
StaticStatus
⁄⁄$ 0
.
⁄⁄0 1
Category
⁄⁄1 9
.
⁄⁄9 :
	Activated
⁄⁄: C
,
⁄⁄C D
includeProperties
⁄⁄E V
:
⁄⁄V W
$str
⁄⁄X h
)
⁄⁄h i
;
⁄⁄i j
}
€€ 
if
›› 
(
›› 

categories
›› 
.
›› 
IsNullOrEmpty
›› (
(
››( )
)
››) *
)
››* +
{
ﬁﬁ 
return
ﬂﬂ 
new
ﬂﬂ 
ResponseDTO
ﬂﬂ &
(
ﬂﬂ& '
)
ﬂﬂ' (
{
‡‡ 
Message
·· 
=
·· 
$str
·· 5
,
··5 6
Result
‚‚ 
=
‚‚ 
null
‚‚ !
,
‚‚! "
	IsSuccess
„„ 
=
„„ 
true
„„  $
,
„„$ %

StatusCode
‰‰ 
=
‰‰  
$num
‰‰! $
}
ÂÂ 
;
ÂÂ 
}
ÊÊ 
var
ËË 
listCategory
ËË 
=
ËË 

categories
ËË )
.
ËË) *
ToList
ËË* 0
(
ËË0 1
)
ËË1 2
;
ËË2 3
if
ÌÌ 
(
ÌÌ 
!
ÌÌ 
string
ÌÌ 
.
ÌÌ 
IsNullOrEmpty
ÌÌ %
(
ÌÌ% &
filterOn
ÌÌ& .
)
ÌÌ. /
&&
ÌÌ0 2
!
ÌÌ3 4
string
ÌÌ4 :
.
ÌÌ: ;
IsNullOrEmpty
ÌÌ; H
(
ÌÌH I
filterQuery
ÌÌI T
)
ÌÌT U
)
ÌÌU V
{
ÓÓ 
switch
ÔÔ 
(
ÔÔ 
filterOn
ÔÔ  
.
ÔÔ  !
Trim
ÔÔ! %
(
ÔÔ% &
)
ÔÔ& '
.
ÔÔ' (
ToLower
ÔÔ( /
(
ÔÔ/ 0
)
ÔÔ0 1
)
ÔÔ1 2
{
 
case
ÒÒ 
$str
ÒÒ 
:
ÒÒ  
{
ÚÚ 
listCategory
ÛÛ $
=
ÛÛ% &
listCategory
ÛÛ' 3
.
ÛÛ3 4
Where
ÛÛ4 9
(
ÛÛ9 :
x
ÛÛ: ;
=>
ÛÛ< >
x
ÙÙ 
.
ÙÙ 
Name
ÙÙ "
.
ÙÙ" #
Contains
ÙÙ# +
(
ÙÙ+ ,
filterQuery
ÙÙ, 7
,
ÙÙ7 8
StringComparison
ÙÙ9 I
.
ÙÙI J&
CurrentCultureIgnoreCase
ÙÙJ b
)
ÙÙb c
)
ÙÙc d
.
ÙÙd e
ToList
ÙÙe k
(
ÙÙk l
)
ÙÙl m
;
ÙÙm n
break
ıı 
;
ıı 
}
ˆˆ 
case
˜˜ 
$str
˜˜ &
:
˜˜& '
{
¯¯ 
listCategory
˘˘ $
=
˘˘% &
listCategory
˘˘' 3
.
˘˘3 4
Where
˘˘4 9
(
˘˘9 :
x
˘˘: ;
=>
˘˘< >
x
˙˙ 
.
˙˙ 
Name
˙˙ "
.
˙˙" #
Contains
˙˙# +
(
˙˙+ ,
filterQuery
˙˙, 7
,
˙˙7 8
StringComparison
˙˙9 I
.
˙˙I J&
CurrentCultureIgnoreCase
˙˙J b
)
˙˙b c
)
˙˙c d
.
˙˙d e
ToList
˙˙e k
(
˙˙k l
)
˙˙l m
;
˙˙m n
break
˚˚ 
;
˚˚ 
}
¸¸ 
default
˝˝ 
:
˝˝ 
{
˛˛ 
break
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 
}
ÇÇ 
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 
string
ÖÖ 
.
ÖÖ 
IsNullOrEmpty
ÖÖ %
(
ÖÖ% &
sortBy
ÖÖ& ,
)
ÖÖ, -
)
ÖÖ- .
{
ÜÜ 
switch
áá 
(
áá 
sortBy
áá 
.
áá 
Trim
áá #
(
áá# $
)
áá$ %
.
áá% &
ToLower
áá& -
(
áá- .
)
áá. /
)
áá/ 0
{
àà 
case
ââ 
$str
ââ 
:
ââ  
{
ää 
listCategory
ãã $
=
ãã% &
isAscending
ãã' 2
==
ãã3 5
true
ãã6 :
?
åå 
[
åå 
..
åå !
listCategory
åå" .
.
åå. /
OrderBy
åå/ 6
(
åå6 7
x
åå7 8
=>
åå9 ;
x
åå< =
.
åå= >
Name
åå> B
)
ååB C
]
ååC D
:
çç 
[
çç 
..
çç !
listCategory
çç" .
.
çç. /
OrderByDescending
çç/ @
(
çç@ A
x
ççA B
=>
ççC E
x
ççF G
.
ççG H
Name
ççH L
)
ççL M
]
ççM N
;
ççN O
break
éé 
;
éé 
}
èè 
case
êê 
$str
êê &
:
êê& '
{
ëë 
listCategory
íí $
=
íí% &
isAscending
íí' 2
==
íí3 5
true
íí6 :
?
ìì 
[
ìì 
..
ìì !
listCategory
ìì" .
.
ìì. /
OrderBy
ìì/ 6
(
ìì6 7
x
ìì7 8
=>
ìì9 ;
x
ìì< =
.
ìì= >
Description
ìì> I
)
ììI J
]
ììJ K
:
îî 
[
îî 
..
îî !
listCategory
îî" .
.
îî. /
OrderByDescending
îî/ @
(
îî@ A
x
îîA B
=>
îîC E
x
îîF G
.
îîG H
Description
îîH S
)
îîS T
]
îîT U
;
îîU V
break
ïï 
;
ïï 
}
ññ 
default
óó 
:
óó 
{
òò 
break
ôô 
;
ôô 
}
öö 
}
õõ 
}
úú 
if
üü 
(
üü 

pageNumber
üü 
>
üü 
$num
üü 
&&
üü !
pageSize
üü" *
>
üü+ ,
$num
üü- .
)
üü. /
{
†† 
var
°° 

skipResult
°° 
=
°°  
(
°°! "

pageNumber
°°" ,
-
°°- .
$num
°°/ 0
)
°°0 1
*
°°2 3
pageSize
°°4 <
;
°°< =
listCategory
¢¢ 
=
¢¢ 
listCategory
¢¢ +
.
¢¢+ ,
Skip
¢¢, 0
(
¢¢0 1

skipResult
¢¢1 ;
)
¢¢; <
.
¢¢< =
Take
¢¢= A
(
¢¢A B
pageSize
¢¢B J
)
¢¢J K
.
¢¢K L
ToList
¢¢L R
(
¢¢R S
)
¢¢S T
;
¢¢T U
}
££ 
object
ßß 
listCategoryDto
ßß "
;
ßß" #
if
®® 
(
®® 
userRole
®® 
==
®® 
StaticUserRoles
®® +
.
®®+ ,
Admin
®®, 1
)
®®1 2
{
©© 
listCategoryDto
™™ 
=
™™  !
_mapper
™™" )
.
™™) *
Map
™™* -
<
™™- .
List
™™. 2
<
™™2 3
AdminCategoryDTO
™™3 C
>
™™C D
>
™™D E
(
™™E F
listCategory
™™F R
)
™™R S
;
™™S T
}
´´ 
else
¨¨ 
{
≠≠ 
listCategoryDto
ÆÆ 
=
ÆÆ  !
_mapper
ÆÆ" )
.
ÆÆ) *
Map
ÆÆ* -
<
ÆÆ- .
List
ÆÆ. 2
<
ÆÆ2 3
CategoryDTO
ÆÆ3 >
>
ÆÆ> ?
>
ÆÆ? @
(
ÆÆ@ A
listCategory
ÆÆA M
)
ÆÆM N
;
ÆÆN O
}
ØØ 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ "
(
≤≤" #
)
≤≤# $
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ 9
,
¥¥9 :
Result
µµ 
=
µµ 
listCategoryDto
µµ (
,
µµ( )
	IsSuccess
∂∂ 
=
∂∂ 
true
∂∂  
,
∂∂  !

StatusCode
∑∑ 
=
∑∑ 
$num
∑∑  
}
∏∏ 
;
∏∏ 
}
ππ 	
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
e
∫∫ 
)
∫∫ 
{
ªª 	
return
ºº 
new
ºº 
ResponseDTO
ºº "
(
ºº" #
)
ºº# $
{
ΩΩ 
Message
ææ 
=
ææ 
e
ææ 
.
ææ 
Message
ææ #
,
ææ# $
Result
øø 
=
øø 
null
øø 
,
øø 
	IsSuccess
¿¿ 
=
¿¿ 
false
¿¿ !
,
¿¿! "

StatusCode
¡¡ 
=
¡¡ 
$num
¡¡  
}
¬¬ 
;
¬¬ 
}
√√ 	
}
ƒƒ 
public
∆∆ 

async
∆∆ 
Task
∆∆ 
<
∆∆ 
ResponseDTO
∆∆ !
>
∆∆! "
GetSubCategory
∆∆# 1
(
∆∆1 2
Guid
∆∆2 6
id
∆∆7 9
)
∆∆9 :
{
«« 
try
»» 
{
…… 	
var
   

categories
   
=
   
await
ÀÀ 
_unitOfWork
ÀÀ !
.
ÀÀ! " 
CategoryRepository
ÀÀ" 4
.
ÀÀ4 5
GetAllAsync
ÀÀ5 @
(
ÀÀ@ A
filter
ÀÀA G
:
ÀÀG H
x
ÀÀI J
=>
ÀÀK M
x
ÀÀN O
.
ÀÀO P
ParentId
ÀÀP X
==
ÀÀY [
id
ÀÀ\ ^
)
ÀÀ^ _
;
ÀÀ_ `
if
ÕÕ 
(
ÕÕ 

categories
ÕÕ 
is
ÕÕ 
null
ÕÕ "
)
ÕÕ" #
{
ŒŒ 
return
œœ 
new
œœ 
ResponseDTO
œœ &
(
œœ& '
)
œœ' (
{
–– 
Message
—— 
=
—— 
$str
—— 6
,
——6 7
	IsSuccess
““ 
=
““ 
false
““  %
,
““% &

StatusCode
”” 
=
””  
$num
””! $
,
””$ %
Result
‘‘ 
=
‘‘ 
null
‘‘ !
,
‘‘! "
}
’’ 
;
’’ 
}
÷÷ 
var
ÿÿ 
categoryDto
ÿÿ 
=
ÿÿ 
_mapper
ÿÿ %
.
ÿÿ% &
Map
ÿÿ& )
<
ÿÿ) *
List
ÿÿ* .
<
ÿÿ. /
CategoryDTO
ÿÿ/ :
>
ÿÿ: ;
>
ÿÿ; <
(
ÿÿ< =

categories
ÿÿ= G
)
ÿÿG H
;
ÿÿH I
return
⁄⁄ 
new
⁄⁄ 
ResponseDTO
⁄⁄ "
(
⁄⁄" #
)
⁄⁄# $
{
€€ 
Message
‹‹ 
=
‹‹ 
$str
‹‹ 9
,
‹‹9 :
Result
›› 
=
›› 
categoryDto
›› $
,
››$ %
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  
,
ﬁﬁ  !

StatusCode
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ  
}
‡‡ 
;
‡‡ 
}
·· 	
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 	
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ "
(
‰‰" #
)
‰‰# $
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
,
ÊÊ# $
Result
ÁÁ 
=
ÁÁ 
null
ÁÁ 
,
ÁÁ 
	IsSuccess
ËË 
=
ËË 
false
ËË !
,
ËË! "

StatusCode
ÈÈ 
=
ÈÈ 
$num
ÈÈ  
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
}
ÏÏ 
public
ÓÓ 

async
ÓÓ 
Task
ÓÓ 
<
ÓÓ 
ResponseDTO
ÓÓ !
>
ÓÓ! "
GetParentCategory
ÓÓ# 4
(
ÓÓ4 5
Guid
ÓÓ5 9
id
ÓÓ: <
)
ÓÓ< =
{
ÔÔ 
try
 
{
ÒÒ 	
var
ÚÚ 
category
ÚÚ 
=
ÚÚ 
await
ÛÛ 
_unitOfWork
ÛÛ !
.
ÛÛ! " 
CategoryRepository
ÛÛ" 4
.
ÛÛ4 5
GetAsync
ÛÛ5 =
(
ÛÛ= >
filter
ÛÛ> D
:
ÛÛD E
x
ÛÛF G
=>
ÛÛH J
x
ÛÛK L
.
ÛÛL M
Id
ÛÛM O
==
ÛÛP R
id
ÛÛS U
)
ÛÛU V
;
ÛÛV W
if
ıı 
(
ıı 
category
ıı 
is
ıı 
null
ıı  
)
ıı  !
{
ˆˆ 
return
˜˜ 
new
˜˜ 
ResponseDTO
˜˜ &
(
˜˜& '
)
˜˜' (
{
¯¯ 
Message
˘˘ 
=
˘˘ 
$str
˘˘ 6
,
˘˘6 7
	IsSuccess
˙˙ 
=
˙˙ 
false
˙˙  %
,
˙˙% &

StatusCode
˚˚ 
=
˚˚  
$num
˚˚! $
,
˚˚$ %
Result
¸¸ 
=
¸¸ 
null
¸¸ !
,
¸¸! "
}
˝˝ 
;
˝˝ 
}
˛˛ 
var
ÄÄ 
parentCategory
ÄÄ 
=
ÄÄ  
await
ÄÄ! &
_unitOfWork
ÄÄ' 2
.
ÄÄ2 3 
CategoryRepository
ÄÄ3 E
.
ÄÄE F
GetAsync
ÄÄF N
(
ÄÄN O
filter
ÄÄO U
:
ÄÄU V
x
ÄÄW X
=>
ÄÄY [
x
ÄÄ\ ]
.
ÄÄ] ^
Id
ÄÄ^ `
==
ÄÄa c
category
ÄÄd l
.
ÄÄl m
ParentId
ÄÄm u
)
ÄÄu v
;
ÄÄv w
if
ÇÇ 
(
ÇÇ 
parentCategory
ÇÇ 
is
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ &
(
ÑÑ& '
)
ÑÑ' (
{
ÖÖ 
Message
ÜÜ 
=
ÜÜ 
$str
ÜÜ D
,
ÜÜD E
	IsSuccess
áá 
=
áá 
false
áá  %
,
áá% &

StatusCode
àà 
=
àà  
$num
àà! $
,
àà$ %
Result
ââ 
=
ââ 
null
ââ !
,
ââ! "
}
ää 
;
ää 
}
ãã 
var
çç 
parentCategoryDto
çç !
=
çç" #
_mapper
çç$ +
.
çç+ ,
Map
çç, /
<
çç/ 0
CategoryDTO
çç0 ;
>
çç; <
(
çç< =
parentCategory
çç= K
)
ççK L
;
ççL M
return
èè 
new
èè 
ResponseDTO
èè "
(
èè" #
)
èè# $
{
êê 
Message
ëë 
=
ëë 
$str
ëë <
,
ëë< =
Result
íí 
=
íí 
parentCategoryDto
íí *
,
íí* +
	IsSuccess
ìì 
=
ìì 
true
ìì  
,
ìì  !

StatusCode
îî 
=
îî 
$num
îî  
}
ïï 
;
ïï 
}
ññ 	
catch
óó 
(
óó 
	Exception
óó 
e
óó 
)
óó 
{
òò 	
return
ôô 
new
ôô 
ResponseDTO
ôô "
(
ôô" #
)
ôô# $
{
öö 
Message
õõ 
=
õõ 
e
õõ 
.
õõ 
Message
õõ #
,
õõ# $
Result
úú 
=
úú 
null
úú 
,
úú 
	IsSuccess
ùù 
=
ùù 
false
ùù !
,
ùù! "

StatusCode
ûû 
=
ûû 
$num
ûû  
}
üü 
;
üü 
}
†† 	
}
°° 
public
®® 

async
®® 
Task
®® 
<
®® 
ResponseDTO
®® !
>
®®! "
Get
®®# &
(
®®& '
ClaimsPrincipal
®®' 6
User
®®7 ;
,
®®; <
Guid
®®= A
id
®®B D
)
®®D E
{
©© 
try
™™ 
{
´´ 	
var
¨¨ 
category
¨¨ 
=
¨¨ 
await
≠≠ 
_unitOfWork
≠≠ !
.
≠≠! " 
CategoryRepository
≠≠" 4
.
≠≠4 5
GetAsync
≠≠5 =
(
≠≠= >
filter
≠≠> D
:
≠≠D E
x
≠≠F G
=>
≠≠H J
x
≠≠K L
.
≠≠L M
Id
≠≠M O
==
≠≠P R
id
≠≠S U
,
≠≠U V
includeProperties
ÆÆ %
:
ÆÆ% &
$str
ÆÆ' 7
)
ÆÆ7 8
;
ÆÆ8 9
if
∞∞ 
(
∞∞ 
category
∞∞ 
is
∞∞ 
null
∞∞  
)
∞∞  !
{
±± 
return
≤≤ 
new
≤≤ 
ResponseDTO
≤≤ &
(
≤≤& '
)
≤≤' (
{
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ 6
,
¥¥6 7
	IsSuccess
µµ 
=
µµ 
false
µµ  %
,
µµ% &

StatusCode
∂∂ 
=
∂∂  
$num
∂∂! $
,
∂∂$ %
Result
∑∑ 
=
∑∑ 
null
∑∑ !
,
∑∑! "
}
∏∏ 
;
∏∏ 
}
ππ 
var
ªª 
userRole
ªª 
=
ªª 
User
ªª 
.
ªª  
Claims
ªª  &
.
ªª& '
FirstOrDefault
ªª' 5
(
ªª5 6
x
ªª6 7
=>
ªª8 :
x
ªª; <
.
ªª< =
Type
ªª= A
==
ªªB D

ClaimTypes
ªªE O
.
ªªO P
Role
ªªP T
)
ªªT U
?
ªªU V
.
ªªV W
Value
ªªW \
;
ªª\ ]
object
ææ 
rootCategoryDto
ææ "
;
ææ" #
if
øø 
(
øø 
userRole
øø 
==
øø 
StaticUserRoles
øø +
.
øø+ ,
Admin
øø, 1
)
øø1 2
{
¿¿ 
rootCategoryDto
¡¡ 
=
¡¡  !
_mapper
¡¡" )
.
¡¡) *
Map
¡¡* -
<
¡¡- .
AdminCategoryDTO
¡¡. >
>
¡¡> ?
(
¡¡? @
category
¡¡@ H
)
¡¡H I
;
¡¡I J
}
¬¬ 
else
√√ 
{
ƒƒ 
rootCategoryDto
≈≈ 
=
≈≈  !
_mapper
≈≈" )
.
≈≈) *
Map
≈≈* -
<
≈≈- .
CategoryDTO
≈≈. 9
>
≈≈9 :
(
≈≈: ;
category
≈≈; C
)
≈≈C D
;
≈≈D E
}
∆∆ 
return
»» 
new
»» 
ResponseDTO
»» "
(
»»" #
)
»»# $
{
…… 
Message
   
=
   
$str
   9
,
  9 :
Result
ÀÀ 
=
ÀÀ 
rootCategoryDto
ÀÀ (
,
ÀÀ( )
	IsSuccess
ÃÃ 
=
ÃÃ 
true
ÃÃ  
,
ÃÃ  !

StatusCode
ÕÕ 
=
ÕÕ 
$num
ÕÕ  
}
ŒŒ 
;
ŒŒ 
}
œœ 	
catch
–– 
(
–– 
	Exception
–– 
e
–– 
)
–– 
{
—— 	
return
““ 
new
““ 
ResponseDTO
““ "
(
““" #
)
““# $
{
”” 
Message
‘‘ 
=
‘‘ 
e
‘‘ 
.
‘‘ 
Message
‘‘ #
,
‘‘# $
Result
’’ 
=
’’ 
null
’’ 
,
’’ 
	IsSuccess
÷÷ 
=
÷÷ 
false
÷÷ !
,
÷÷! "

StatusCode
◊◊ 
=
◊◊ 
$num
◊◊  
}
ÿÿ 
;
ÿÿ 
}
ŸŸ 	
}
⁄⁄ 
public
·· 

async
·· 
Task
·· 
<
·· 
ResponseDTO
·· !
>
··! "
CreateCategory
··# 1
(
··1 2
ClaimsPrincipal
··2 A
User
··B F
,
··F G
CreateCategoryDTO
··H Y
createCategoryDto
··Z k
)
··k l
{
‚‚ 
try
„„ 
{
‰‰ 	
Guid
ÂÂ 

guidOutput
ÂÂ 
;
ÂÂ 
var
ÊÊ 
isGuid
ÊÊ 
=
ÊÊ 
Guid
ÊÊ 
.
ÊÊ 
TryParse
ÊÊ &
(
ÊÊ& '
createCategoryDto
ÊÊ' 8
.
ÊÊ8 9
ParentId
ÊÊ9 A
,
ÊÊA B
out
ÊÊC F

guidOutput
ÊÊG Q
)
ÊÊQ R
;
ÊÊR S
var
ËË 
category
ËË 
=
ËË 
new
ËË 
Category
ËË '
{
ÈÈ 
Id
ÍÍ 
=
ÍÍ 
Guid
ÍÍ 
.
ÍÍ 
NewGuid
ÍÍ !
(
ÍÍ! "
)
ÍÍ" #
,
ÍÍ# $
Name
ÎÎ 
=
ÎÎ 
createCategoryDto
ÎÎ (
.
ÎÎ( )
Name
ÎÎ) -
,
ÎÎ- .
Description
ÏÏ 
=
ÏÏ 
createCategoryDto
ÏÏ /
.
ÏÏ/ 0
Description
ÏÏ0 ;
,
ÏÏ; <
ParentId
ÌÌ 
=
ÌÌ 
isGuid
ÌÌ !
?
ÌÌ" #

guidOutput
ÌÌ$ .
:
ÌÌ/ 0
null
ÌÌ1 5
,
ÌÌ5 6

CreateTime
ÓÓ 
=
ÓÓ 
DateTime
ÓÓ %
.
ÓÓ% &
Now
ÓÓ& )
,
ÓÓ) *

UpdateTime
ÔÔ 
=
ÔÔ 
null
ÔÔ !
,
ÔÔ! "
CreateBy
 
=
 
User
 
.
  
Identity
  (
.
( )
Name
) -
,
- .
UpdateBy
ÒÒ 
=
ÒÒ 
$str
ÒÒ 
,
ÒÒ 
Status
ÚÚ 
=
ÚÚ 
$num
ÚÚ 
,
ÚÚ 
}
ÛÛ 
;
ÛÛ 
var
ˆˆ  
existingCategories
ˆˆ "
=
ˆˆ# $
await
ˆˆ% *
_unitOfWork
ˆˆ+ 6
.
ˆˆ6 7 
CategoryRepository
ˆˆ7 I
.
ˆˆI J
GetAllAsync
ˆˆJ U
(
ˆˆU V
)
ˆˆV W
;
ˆˆW X
if
˜˜ 
(
˜˜  
existingCategories
˜˜ "
==
˜˜# %
null
˜˜& *
||
˜˜+ -
!
˜˜. / 
existingCategories
˜˜/ A
.
˜˜A B
Any
˜˜B E
(
˜˜E F
)
˜˜F G
)
˜˜G H
{
¯¯ 
await
˙˙ 
_unitOfWork
˙˙ !
.
˙˙! " 
CategoryRepository
˙˙" 4
.
˙˙4 5
AddAsync
˙˙5 =
(
˙˙= >
category
˙˙> F
)
˙˙F G
;
˙˙G H
await
˚˚ 
_unitOfWork
˚˚ !
.
˚˚! "
	SaveAsync
˚˚" +
(
˚˚+ ,
)
˚˚, -
;
˚˚- .
return
¸¸ 
new
¸¸ 
ResponseDTO
¸¸ &
{
˝˝ 
Message
˛˛ 
=
˛˛ 
$str
˛˛ =
,
˛˛= >
Result
ˇˇ 
=
ˇˇ 
category
ˇˇ %
,
ˇˇ% &
	IsSuccess
ÄÄ 
=
ÄÄ 
true
ÄÄ  $
,
ÄÄ$ %

StatusCode
ÅÅ 
=
ÅÅ  
$num
ÅÅ! $
,
ÅÅ$ %
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
else
ÜÜ 
if
ÜÜ 
(
ÜÜ 
category
ÜÜ 
.
ÜÜ 
ParentId
ÜÜ &
==
ÜÜ' )
null
ÜÜ* .
)
ÜÜ. /
{
áá 
await
àà 
_unitOfWork
àà !
.
àà! " 
CategoryRepository
àà" 4
.
àà4 5
AddAsync
àà5 =
(
àà= >
category
àà> F
)
ààF G
;
ààG H
await
ââ 
_unitOfWork
ââ !
.
ââ! "
	SaveAsync
ââ" +
(
ââ+ ,
)
ââ, -
;
ââ- .
return
ãã 
new
ãã 
ResponseDTO
ãã &
{
åå 
Message
çç 
=
çç 
$str
çç =
,
çç= >
Result
éé 
=
éé 
category
éé %
,
éé% &
	IsSuccess
èè 
=
èè 
true
èè  $
,
èè$ %

StatusCode
êê 
=
êê  
$num
êê! $
,
êê$ %
}
ëë 
;
ëë 
}
íí 
await
ïï 
_unitOfWork
ïï 
.
ïï  
CategoryRepository
ïï 0
.
ïï0 1
AddAsync
ïï1 9
(
ïï9 :
category
ïï: B
)
ïïB C
;
ïïC D
var
ññ 
save
ññ 
=
ññ 
await
ññ 
_unitOfWork
ññ (
.
ññ( )
	SaveAsync
ññ) 2
(
ññ2 3
)
ññ3 4
;
ññ4 5
if
óó 
(
óó 
save
óó 
<=
óó 
$num
óó 
)
óó 
{
òò 
return
ôô 
new
ôô 
ResponseDTO
ôô &
{
öö 
Message
õõ 
=
õõ 
$str
õõ  
,
õõ  !
Result
úú 
=
úú 
null
úú !
,
úú! "
	IsSuccess
ùù 
=
ùù 
false
ùù  %
,
ùù% &

StatusCode
ûû 
=
ûû  
$num
ûû! $
}
üü 
;
üü 
}
†† 
return
¢¢ 
new
¢¢ 
ResponseDTO
¢¢ "
{
££ 
Message
§§ 
=
§§ 
$str
§§ 9
,
§§9 :
Result
•• 
=
•• 
category
•• !
,
••! "
	IsSuccess
¶¶ 
=
¶¶ 
true
¶¶  
,
¶¶  !

StatusCode
ßß 
=
ßß 
$num
ßß  
}
®® 
;
®® 
}
©© 	
catch
™™ 
(
™™ 
	Exception
™™ 
e
™™ 
)
™™ 
{
´´ 	
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
e
ÆÆ 
.
ÆÆ 
Message
ÆÆ #
,
ÆÆ# $
Result
ØØ 
=
ØØ 
null
ØØ 
,
ØØ 
	IsSuccess
∞∞ 
=
∞∞ 
false
∞∞ !
,
∞∞! "

StatusCode
±± 
=
±± 
$num
±±  
}
≤≤ 
;
≤≤ 
}
≥≥ 	
}
¥¥ 
public
ªª 

async
ªª 
Task
ªª 
<
ªª 
ResponseDTO
ªª !
>
ªª! "
Update
ªª# )
(
ªª) *
ClaimsPrincipal
ªª* 9
User
ªª: >
,
ªª> ?
UpdateCategoryDTO
ªª@ Q
updateCategoryDTO
ªªR c
)
ªªc d
{
ºº 
try
ΩΩ 
{
ææ 	
var
¿¿ 
categoryToUpdate
¿¿  
=
¿¿! "
await
¿¿# (
_unitOfWork
¿¿) 4
.
¿¿4 5 
CategoryRepository
¿¿5 G
.
¿¿G H
GetAsync
¿¿H P
(
¿¿P Q
c
¿¿Q R
=>
¿¿S U
c
¿¿V W
.
¿¿W X
Id
¿¿X Z
==
¿¿[ ]
updateCategoryDTO
¿¿^ o
.
¿¿o p
Id
¿¿p r
)
¿¿r s
;
¿¿s t
if
√√ 
(
√√ 
categoryToUpdate
√√  
==
√√! #
null
√√$ (
)
√√( )
{
ƒƒ 
return
≈≈ 
new
≈≈ 
ResponseDTO
≈≈ &
{
∆∆ 
Message
«« 
=
«« 
$str
«« 2
,
««2 3
Result
»» 
=
»» 
null
»» !
,
»»! "
	IsSuccess
…… 
=
…… 
false
……  %
,
……% &

StatusCode
   
=
    
$num
  ! $
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 
categoryToUpdate
œœ 
.
œœ 
Name
œœ !
=
œœ" #
updateCategoryDTO
œœ$ 5
.
œœ5 6
Name
œœ6 :
;
œœ: ;
categoryToUpdate
–– 
.
–– 
Description
–– (
=
––) *
updateCategoryDTO
––+ <
.
––< =
Description
––= H
;
––H I
categoryToUpdate
—— 
.
—— 
ParentId
—— %
=
——& '
!
——( )
string
——) /
.
——/ 0
IsNullOrEmpty
——0 =
(
——= >
updateCategoryDTO
——> O
.
——O P
ParentId
——P X
)
——X Y
?
““ 
Guid
““ 
.
““ 
Parse
““ 
(
““ 
updateCategoryDTO
““ .
.
““. /
ParentId
““/ 7
)
““7 8
:
”” 
(
”” 
Guid
”” 
?
”” 
)
”” 
null
”” 
;
”” 
categoryToUpdate
‘‘ 
.
‘‘ 

UpdateTime
‘‘ '
=
‘‘( )
DateTime
‘‘* 2
.
‘‘2 3
Now
‘‘3 6
;
‘‘6 7
categoryToUpdate
’’ 
.
’’ 
UpdateBy
’’ %
=
’’& '
User
’’( ,
.
’’, -
Identity
’’- 5
.
’’5 6
Name
’’6 :
;
’’: ;
categoryToUpdate
÷÷ 
.
÷÷ 
Status
÷÷ #
=
÷÷$ %
updateCategoryDTO
÷÷& 7
.
÷÷7 8
Status
÷÷8 >
;
÷÷> ?
_unitOfWork
⁄⁄ 
.
⁄⁄  
CategoryRepository
⁄⁄ *
.
⁄⁄* +
Update
⁄⁄+ 1
(
⁄⁄1 2
categoryToUpdate
⁄⁄2 B
)
⁄⁄B C
;
⁄⁄C D
var
›› 
save
›› 
=
›› 
await
›› 
_unitOfWork
›› (
.
››( )
	SaveAsync
››) 2
(
››2 3
)
››3 4
;
››4 5
if
ﬁﬁ 
(
ﬁﬁ 
save
ﬁﬁ 
<=
ﬁﬁ 
$num
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
return
‡‡ 
new
‡‡ 
ResponseDTO
‡‡ &
{
·· 
Message
‚‚ 
=
‚‚ 
$str
‚‚ 9
,
‚‚9 :
Result
„„ 
=
„„ 
null
„„ !
,
„„! "
	IsSuccess
‰‰ 
=
‰‰ 
false
‰‰  %
,
‰‰% &

StatusCode
ÂÂ 
=
ÂÂ  
$num
ÂÂ! $
}
ÊÊ 
;
ÊÊ 
}
ÁÁ 
return
ÈÈ 
new
ÈÈ 
ResponseDTO
ÈÈ "
{
ÍÍ 
Message
ÎÎ 
=
ÎÎ 
$str
ÎÎ 9
,
ÎÎ9 :
Result
ÏÏ 
=
ÏÏ 
categoryToUpdate
ÏÏ )
,
ÏÏ) *
	IsSuccess
ÌÌ 
=
ÌÌ 
true
ÌÌ  
,
ÌÌ  !

StatusCode
ÓÓ 
=
ÓÓ 
$num
ÓÓ  
}
ÔÔ 
;
ÔÔ 
}
 	
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 	
return
ÛÛ 
new
ÛÛ 
ResponseDTO
ÛÛ "
{
ÙÙ 
Message
ıı 
=
ıı 
e
ıı 
.
ıı 
Message
ıı #
,
ıı# $
Result
ˆˆ 
=
ˆˆ 
null
ˆˆ 
,
ˆˆ 
	IsSuccess
˜˜ 
=
˜˜ 
false
˜˜ !
,
˜˜! "

StatusCode
¯¯ 
=
¯¯ 
$num
¯¯  
}
˘˘ 
;
˘˘ 
}
˙˙ 	
}
˚˚ 
public
ÇÇ 

async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
ResponseDTO
ÇÇ !
>
ÇÇ! "
Delete
ÇÇ# )
(
ÇÇ) *
ClaimsPrincipal
ÇÇ* 9
User
ÇÇ: >
,
ÇÇ> ?
Guid
ÇÇ@ D
id
ÇÇE G
)
ÇÇG H
{
ÉÉ 
try
ÑÑ 
{
ÖÖ 	
var
áá 
category
áá 
=
áá 
await
áá  
_unitOfWork
áá! ,
.
áá, - 
CategoryRepository
áá- ?
.
áá? @
GetAsync
áá@ H
(
ááH I
c
ááI J
=>
ááK M
c
ááN O
.
ááO P
Id
ááP R
==
ááS U
id
ááV X
)
ááX Y
;
ááY Z
if
ää 
(
ää 
category
ää 
==
ää 
null
ää  
)
ää  !
{
ãã 
return
åå 
new
åå 
ResponseDTO
åå &
{
çç 
Message
éé 
=
éé 
$str
éé 2
,
éé2 3
	IsSuccess
èè 
=
èè 
false
èè  %
,
èè% &

StatusCode
êê 
=
êê  
$num
êê! $
,
êê$ %
Result
ëë 
=
ëë 
null
ëë !
}
íí 
;
íí 
}
ìì 
var
ññ 
subCategories
ññ 
=
ññ 
await
ññ  %
_unitOfWork
ññ& 1
.
ññ1 2 
CategoryRepository
ññ2 D
.
ññD E
GetAllAsync
ññE P
(
ññP Q
c
ññQ R
=>
ññS U
c
ññV W
.
ññW X
ParentId
ññX `
==
ñña c
id
ññd f
)
ññf g
;
ññg h
if
ôô 
(
ôô 
subCategories
ôô 
.
ôô 
Any
ôô !
(
ôô! "
)
ôô" #
)
ôô# $
{
öö 
return
õõ 
new
õõ 
ResponseDTO
õõ &
{
úú 
Message
ùù 
=
ùù 
$str
ùù X
,
ùùX Y
	IsSuccess
ûû 
=
ûû 
false
ûû  %
,
ûû% &

StatusCode
üü 
=
üü  
$num
üü! $
,
üü$ %
Result
†† 
=
†† 
subCategories
†† *
.
††* +
Select
††+ 1
(
††1 2
x
††2 3
=>
††4 6
new
††7 :
{
††; <
x
††= >
.
††> ?
Id
††? A
,
††A B
x
††C D
.
††D E
Name
††E I
}
††J K
)
††K L
.
††L M
ToList
††M S
(
††S T
)
††T U
}
°° 
;
°° 
}
¢¢ 
category
•• 
.
•• 
Status
•• 
=
•• 
$num
•• 
;
••  
category
¶¶ 
.
¶¶ 

UpdateTime
¶¶ 
=
¶¶  !
DateTime
¶¶" *
.
¶¶* +
Now
¶¶+ .
;
¶¶. /
category
ßß 
.
ßß 
UpdateBy
ßß 
=
ßß 
User
ßß  $
.
ßß$ %
Identity
ßß% -
.
ßß- .
Name
ßß. 2
;
ßß2 3
_unitOfWork
™™ 
.
™™  
CategoryRepository
™™ *
.
™™* +
Update
™™+ 1
(
™™1 2
category
™™2 :
)
™™: ;
;
™™; <
var
´´ 

saveResult
´´ 
=
´´ 
await
´´ "
_unitOfWork
´´# .
.
´´. /
	SaveAsync
´´/ 8
(
´´8 9
)
´´9 :
;
´´: ;
if
≠≠ 
(
≠≠ 

saveResult
≠≠ 
<=
≠≠ 
$num
≠≠ 
)
≠≠  
{
ÆÆ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ &
{
∞∞ 
Message
±± 
=
±± 
$str
±± 9
,
±±9 :
	IsSuccess
≤≤ 
=
≤≤ 
false
≤≤  %
,
≤≤% &

StatusCode
≥≥ 
=
≥≥  
$num
≥≥! $
,
≥≥$ %
Result
¥¥ 
=
¥¥ 
null
¥¥ !
}
µµ 
;
µµ 
}
∂∂ 
return
∏∏ 
new
∏∏ 
ResponseDTO
∏∏ "
{
ππ 
Message
∫∫ 
=
∫∫ 
$str
∫∫ 9
,
∫∫9 :
	IsSuccess
ªª 
=
ªª 
true
ªª  
,
ªª  !

StatusCode
ºº 
=
ºº 
$num
ºº  
,
ºº  !
Result
ΩΩ 
=
ΩΩ 
category
ΩΩ !
.
ΩΩ! "
Id
ΩΩ" $
}
ææ 
;
ææ 
}
øø 	
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
e
¿¿ 
)
¿¿ 
{
¡¡ 	
return
¬¬ 
new
¬¬ 
ResponseDTO
¬¬ "
{
√√ 
Message
ƒƒ 
=
ƒƒ 
e
ƒƒ 
.
ƒƒ 
Message
ƒƒ #
,
ƒƒ# $
Result
≈≈ 
=
≈≈ 
null
≈≈ 
,
≈≈ 
	IsSuccess
∆∆ 
=
∆∆ 
false
∆∆ !
,
∆∆! "

StatusCode
«« 
=
«« 
$num
««  
}
»» 
;
»» 
}
…… 	
}
   
}ÀÀ ö>
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\BaseService.cs
	namespace		 	
Cursus		
 
.		 
LMS		 
.		 
Service		 
.		 
Service		 $
;		$ %
public 
class 
BaseService 
: 
IBaseService '
{ 
private 
readonly 
IHttpClientFactory '
_httpClientFactory( :
;: ;
public 

BaseService 
( 
IHttpClientFactory )
httpClientFactory* ;
); <
{ 
_httpClientFactory 
= 
httpClientFactory .
;. /
} 
public 

async 
Task 
< 
ResponseDTO !
?! "
>" #
	SendAsync$ -
(- .

RequestDTO. 8

RequestDTO9 C
,C D
stringE K
?K L
apiKeyM S
)S T
{ 
try 
{ 	

HttpClient 
client 
= 
_httpClientFactory  2
.2 3
CreateClient3 ?
(? @
$str@ K
)K L
;L M
HttpRequestMessage 
message &
=' (
new) ,
(, -
)- .
;. /
message 
. 
Headers 
. 
Add 
(  
$str  (
,( )
$str* <
)< =
;= >
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
apiKey& ,
), -
)- .
{ 
var 
token 
= 
apiKey "
;" #
message   
.   
Headers   
.    
Add    #
(  # $
$str  $ 3
,  3 4
$"  5 7
$str  7 >
{  > ?
token  ? D
}  D E
"  E F
)  F G
;  G H
}!! 
message## 
.## 

RequestUri## 
=##  
new##! $
Uri##% (
(##( )

RequestDTO##) 3
.##3 4
Url##4 7
)##7 8
;##8 9
if%% 
(%% 

RequestDTO%% 
.%% 
Data%% 
is%%  "
not%%# &
null%%' +
)%%+ ,
{&& 
message'' 
.'' 
Content'' 
=''  !
new''" %
StringContent''& 3
(''3 4
JsonConvert''4 ?
.''? @
SerializeObject''@ O
(''O P

RequestDTO''P Z
.''Z [
Data''[ _
)''_ `
,''` a
Encoding''b j
.''j k
UTF8''k o
,''o p
$str(( &
)((& '
;((' (
})) 
HttpResponseMessage++ 
?++  
responseMessage++! 0
=++1 2
null++3 7
;++7 8
switch-- 
(-- 

RequestDTO-- 
.-- 
ApiType-- &
)--& '
{.. 
case// 

StaticEnum// 
.//  
ApiType//  '
.//' (
GET//( +
://+ ,
{00 
message11 
.11 
Method11 "
=11# $

HttpMethod11% /
.11/ 0
Get110 3
;113 4
break22 
;22 
}33 
case44 

StaticEnum44 
.44  
ApiType44  '
.44' (
POST44( ,
:44, -
{55 
message66 
.66 
Method66 "
=66# $

HttpMethod66% /
.66/ 0
Post660 4
;664 5
break77 
;77 
}88 
case99 

StaticEnum99 
.99  
ApiType99  '
.99' (
PUT99( +
:99+ ,
{:: 
message;; 
.;; 
Method;; "
=;;# $

HttpMethod;;% /
.;;/ 0
Put;;0 3
;;;3 4
break<< 
;<< 
}== 
case>> 

StaticEnum>> 
.>>  
ApiType>>  '
.>>' (
DELETE>>( .
:>>. /
{?? 
message@@ 
.@@ 
Method@@ "
=@@# $

HttpMethod@@% /
.@@/ 0
Delete@@0 6
;@@6 7
breakAA 
;AA 
}BB 
}CC 
responseMessageEE 
=EE 
awaitEE #
clientEE$ *
.EE* +
	SendAsyncEE+ 4
(EE4 5
messageEE5 <
)EE< =
;EE= >
switchGG 
(GG 
responseMessageGG #
.GG# $

StatusCodeGG$ .
)GG. /
{HH 
caseII 
HttpStatusCodeII #
.II# $
NotFoundII$ ,
:II, -
{JJ 
returnKK 
newKK 
(KK 
)KK  
{LL 
	IsSuccessMM !
=MM" #
falseMM$ )
,MM) *
MessageNN 
=NN  !
$strNN" -
,NN- .
}OO 
;OO 
}PP 
caseQQ 
HttpStatusCodeQQ #
.QQ# $
	ForbiddenQQ$ -
:QQ- .
{RR 
returnSS 
newSS 
(SS 
)SS  
{TT 
	IsSuccessUU !
=UU" #
falseUU$ )
,UU) *
MessageVV 
=VV  !
$strVV" -
,VV- .
}WW 
;WW 
}XX 
caseYY 
HttpStatusCodeYY #
.YY# $
UnauthorizedYY$ 0
:YY0 1
{ZZ 
return[[ 
new[[ 
([[ 
)[[  
{\\ 
	IsSuccess]] !
=]]" #
false]]$ )
,]]) *
Message^^ 
=^^  !
$str^^" 0
,^^0 1
}__ 
;__ 
}`` 
caseaa 
HttpStatusCodeaa #
.aa# $

BadRequestaa$ .
:aa. /
{bb 
returncc 
newcc 
(cc 
)cc  
{dd 
	IsSuccessee !
=ee" #
falseee$ )
,ee) *
Messageff 
=ff  !
$strff" .
,ff. /
}gg 
;gg 
}hh 
caseii 
HttpStatusCodeii #
.ii# $
InternalServerErrorii$ 7
:ii7 8
{jj 
returnkk 
newkk 
(kk 
)kk  
{ll 
	IsSuccessmm !
=mm" #
falsemm$ )
,mm) *
Messagenn 
=nn  !
$strnn" 7
,nn7 8
}oo 
;oo 
}pp 
defaultqq 
:qq 
{rr 
varss 

apiContentss "
=ss# $
awaitss% *
responseMessagess+ :
.ss: ;
Contentss; B
.ssB C
ReadAsStringAsyncssC T
(ssT U
)ssU V
;ssV W
varuu 
apiResponseDTOuu &
=uu' (
JsonConvertuu) 4
.uu4 5
DeserializeObjectuu5 F
<uuF G
ResponseDTOuuG R
>uuR S
(uuS T

apiContentuuT ^
)uu^ _
;uu_ `
returnvv 
apiResponseDTOvv )
;vv) *
}ww 
}xx 
}yy 	
catchzz 
(zz 
	Exceptionzz 
ezz 
)zz 
{{{ 	
return|| 
new|| 
(|| 
)|| 
{}} 
Message~~ 
=~~ 
e~~ 
.~~ 
Message~~ #
.~~# $
ToString~~$ ,
(~~, -
)~~- .
,~~. /
	IsSuccess 
= 
false !
}
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
}ÉÉ Á§
dD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Service\AuthService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Service $
;$ %
public 
class 
AuthService 
: 
IAuthService '
{ 
private 
readonly "
IUserManagerRepository +"
_userManagerRepository, B
;B C
private 
readonly 
IUnitOfWork  
_unitOfWork! ,
;, -
private 
readonly 
UserManager  
<  !
ApplicationUser! 0
>0 1
_userManager2 >
;> ?
private 
readonly 
RoleManager  
<  !
IdentityRole! -
>- .
_roleManager/ ;
;; <
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
ITokenService "
_tokenService# 0
;0 1
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
IEmailService "
_emailService# 0
;0 1
private 
readonly 
IFirebaseService %
_firebaseService& 6
;6 7
private   
readonly    
IHttpContextAccessor   ) 
_httpContextAccessor  * >
;  > ?
private"" 
static"" 
readonly""  
ConcurrentDictionary"" 0
<""0 1
string""1 7
,""7 8
(""9 :
int"": =
Count""> C
,""C D
DateTime""E M
LastRequest""N Y
)""Y Z
>""Z [!
ResetPasswordAttempts""\ q
=""r s
new## 
(## 
)## 
;## 
public%% 

AuthService%% 
(%% "
IUserManagerRepository&& !
userManagerRepository&& 4
,&&4 5
UserManager'' 
<'' 
ApplicationUser'' #
>''# $
userManager''% 0
,''0 1
RoleManager(( 
<(( 
IdentityRole((  
>((  !
roleManager((" -
,((- .
IConfiguration)) 
configuration)) $
,))$ %
IMapper** 
mapper** 
,** 
IEmailService++ 
emailService++ "
,++" #
IFirebaseService,, 
firebaseService,, (
,,,( ) 
IHttpContextAccessor-- 
httpContextAccessor-- 0
,--0 1
ITokenService.. 
tokenService.. "
,.." #
IUnitOfWork..$ /

unitOfWork..0 :
)..: ;
{// "
_userManagerRepository00 
=00  !
userManagerRepository00! 6
;006 7
_userManager11 
=11 
userManager11 "
;11" #
_roleManager22 
=22 
roleManager22 "
;22" #
_configuration33 
=33 
configuration33 &
;33& '
_mapper44 
=44 
mapper44 
;44 
_emailService55 
=55 
emailService55 $
;55$ %
_firebaseService66 
=66 
firebaseService66 *
;66* + 
_httpContextAccessor77 
=77 
httpContextAccessor77 2
;772 3
_tokenService88 
=88 
tokenService88 $
;88$ %
_unitOfWork99 
=99 

unitOfWork99  
;99  !
}:: 
public<< 

AuthService<< 
(<< 
UserManager<< "
<<<" #
ApplicationUser<<# 2
><<2 3
object1<<4 ;
,<<; <
RoleManager<<= H
<<<H I
IdentityRole<<I U
><<U V
object2<<W ^
,<<^ _
IConfiguration<<` n
object3<<o v
,<<v w
IMapper== 
object4== 
,== 
IEmailService== &
object5==' .
,==. /
IFirebaseService==0 @
object6==A H
,==H I 
IHttpContextAccessor==J ^
object7==_ f
,==f g
ITokenService>> 
object9>> 
,>> 
IUnitOfWork>> *
object10>>+ 3
)>>3 4
{?? 
}@@ 
publicBB 

asyncBB 
TaskBB 
<BB 
ResponseDTOBB !
>BB! "
SignUpStudentBB# 0
(BB0 1
RegisterStudentDTOBB1 C
registerStudentDTOBBD V
)BBV W
{CC 
tryDD 
{EE 	
varFF 
isEmailExitFF 
=FF 
awaitFF #"
_userManagerRepositoryFF$ :
.FF: ;
FindByEmailAsyncFF; K
(FFK L
registerStudentDTOFFL ^
.FF^ _
EmailFF_ d
)FFd e
;FFe f
ifGG 
(GG 
isEmailExitGG 
isGG 
notGG "
nullGG# '
)GG' (
{HH 
returnII 
newII 
ResponseDTOII &
(II& '
)II' (
{JJ 
MessageKK 
=KK 
$strKK >
,KK> ?
ResultLL 
=LL 
registerStudentDTOLL /
,LL/ 0
	IsSuccessMM 
=MM 
falseMM  %
,MM% &

StatusCodeNN 
=NN  
$numNN! $
}OO 
;OO 
}PP 
varRR 
isPhonenumerExitRR  
=RR! "
awaitSS "
_userManagerRepositorySS ,
.SS, -)
CheckIfPhoneNumberExistsAsyncSS- J
(SSJ K
registerStudentDTOSSK ]
.SS] ^
PhoneNumberSS^ i
)SSi j
;SSj k
ifTT 
(TT 
isPhonenumerExitTT  
)TT  !
{UU 
returnVV 
newVV 
ResponseDTOVV &
(VV& '
)VV' (
{WW 
MessageXX 
=XX 
$strXX E
,XXE F
ResultYY 
=YY 
registerStudentDTOYY /
,YY/ 0
	IsSuccessZZ 
=ZZ 
falseZZ  %
,ZZ% &

StatusCode[[ 
=[[  
$num[[! $
}\\ 
;\\ 
}]] 
var__ 
isCardExist__ 
=__ 
await`` 
_unitOfWork`` !
.``! "!
PaymentCardRepository``" 7
.``7 8!
CardNumberExistsAsync``8 M
(``M N
registerStudentDTO``N `
.``` a

CardNumber``a k
)``k l
;``l m
ifaa 
(aa 
isCardExistaa 
isaa 
notaa "
nullaa# '
)aa' (
{bb 
returncc 
newcc 
ResponseDTOcc &
(cc& '
)cc' (
{dd 
Messageee 
=ee 
$stree D
,eeD E

StatusCodeff 
=ff  
$numff! $
,ff$ %
Resultgg 
=gg 
registerStudentDTOgg /
,gg/ 0
	IsSuccesshh 
=hh 
falsehh  %
}ii 
;ii 
}jj 
ApplicationUsermm 
newUsermm #
=mm$ %
newmm& )
ApplicationUsermm* 9
(mm9 :
)mm: ;
{nn 
Addressoo 
=oo 
registerStudentDTOoo ,
.oo, -
Addressoo- 4
,oo4 5
Emailpp 
=pp 
registerStudentDTOpp *
.pp* +
Emailpp+ 0
,pp0 1
	BirthDateqq 
=qq 
registerStudentDTOqq .
.qq. /
	BirthDateqq/ 8
,qq8 9
UserNamerr 
=rr 
registerStudentDTOrr -
.rr- .
Emailrr. 3
,rr3 4
FullNamess 
=ss 
registerStudentDTOss -
.ss- .
FullNamess. 6
,ss6 7
Gendertt 
=tt 
registerStudentDTOtt +
.tt+ ,
Gendertt, 2
,tt2 3
Countryuu 
=uu 
registerStudentDTOuu ,
.uu, -
Countryuu- 4
,uu4 5
PhoneNumbervv 
=vv 
registerStudentDTOvv 0
.vv0 1
PhoneNumbervv1 <
,vv< =

UpdateTimeww 
=ww 
DateTimeww %
.ww% &
Nowww& )
,ww) *
	AvatarUrlxx 
=xx 
$strxx 
,xx 
	TaxNumberyy 
=yy 
$stryy 
}zz 
;zz 
var}} 
createUserResult}}  
=}}! "
await}}# ("
_userManagerRepository}}) ?
.}}? @
CreateAsync}}@ K
(}}K L
newUser}}L S
,}}S T
registerStudentDTO}}U g
.}}g h
Password}}h p
)}}p q
;}}q r
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
createUserResult
ÄÄ !
.
ÄÄ! "
	Succeeded
ÄÄ" +
)
ÄÄ+ ,
{
ÅÅ 
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ &
(
ÉÉ& '
)
ÉÉ' (
{
ÑÑ 
Message
ÖÖ 
=
ÖÖ 
createUserResult
ÖÖ .
.
ÖÖ. /
Errors
ÖÖ/ 5
.
ÖÖ5 6
ToString
ÖÖ6 >
(
ÖÖ> ?
)
ÖÖ? @
,
ÖÖ@ A
	IsSuccess
ÜÜ 
=
ÜÜ 
false
ÜÜ  %
,
ÜÜ% &

StatusCode
áá 
=
áá  
$num
áá! $
,
áá$ %
Result
àà 
=
àà  
registerStudentDTO
àà /
}
ââ 
;
ââ 
}
ää 
var
åå 
user
åå 
=
åå 
await
åå $
_userManagerRepository
åå 3
.
åå3 4
FindByPhoneAsync
åå4 D
(
ååD E 
registerStudentDTO
ååE W
.
ååW X
PhoneNumber
ååX c
)
ååc d
;
ååd e
Student
éé 
student
éé 
=
éé 
new
éé !
Student
éé" )
(
éé) *
)
éé* +
{
èè 
UserId
êê 
=
êê 
user
êê 
.
êê 
Id
êê  
,
êê  !

University
ëë 
=
ëë  
registerStudentDTO
ëë /
.
ëë/ 0

University
ëë0 :
}
íí 
;
íí 
PaymentCard
îî 
paymentCard
îî #
=
îî$ %
new
îî& )
PaymentCard
îî* 5
(
îî5 6
)
îî6 7
{
ïï 
CardName
ññ 
=
ññ  
registerStudentDTO
ññ -
.
ññ- .
CardName
ññ. 6
,
ññ6 7

CardNumber
óó 
=
óó  
registerStudentDTO
óó /
.
óó/ 0

CardNumber
óó0 :
,
óó: ;
CardProvider
òò 
=
òò  
registerStudentDTO
òò 1
.
òò1 2
CardProvider
òò2 >
,
òò> ?
UserId
ôô 
=
ôô 
user
ôô 
.
ôô 
Id
ôô  
}
öö 
;
öö 
var
ùù 
isRoleExist
ùù 
=
ùù 
await
ùù #
_roleManager
ùù$ 0
.
ùù0 1
RoleExistsAsync
ùù1 @
(
ùù@ A
StaticUserRoles
ùùA P
.
ùùP Q
Student
ùùQ X
)
ùùX Y
;
ùùY Z
if
†† 
(
†† 
isRoleExist
†† 
is
†† 
false
†† $
)
††$ %
{
°° 
await
¢¢ 
_roleManager
¢¢ "
.
¢¢" #
CreateAsync
¢¢# .
(
¢¢. /
new
¢¢/ 2
IdentityRole
¢¢3 ?
(
¢¢? @
StaticUserRoles
¢¢@ O
.
¢¢O P
Student
¢¢P W
)
¢¢W X
)
¢¢X Y
;
¢¢Y Z
}
££ 
var
¶¶ 
	isRoleAdd
¶¶ 
=
¶¶ 
await
¶¶ !$
_userManagerRepository
¶¶" 8
.
¶¶8 9
AddToRoleAsync
¶¶9 G
(
¶¶G H
user
¶¶H L
,
¶¶L M
StaticUserRoles
¶¶N ]
.
¶¶] ^
Student
¶¶^ e
)
¶¶e f
;
¶¶f g
if
®® 
(
®® 
!
®® 
	isRoleAdd
®® 
.
®® 
	Succeeded
®® $
)
®®$ %
{
©© 
return
™™ 
new
™™ 
ResponseDTO
™™ &
(
™™& '
)
™™' (
{
´´ 
Message
¨¨ 
=
¨¨ 
$str
¨¨ 1
,
¨¨1 2
	IsSuccess
≠≠ 
=
≠≠ 
false
≠≠  %
,
≠≠% &

StatusCode
ÆÆ 
=
ÆÆ  
$num
ÆÆ! $
,
ÆÆ$ %
Result
ØØ 
=
ØØ  
registerStudentDTO
ØØ /
}
∞∞ 
;
∞∞ 
}
±± 
var
¥¥ 
isStudentAdd
¥¥ 
=
¥¥ 
await
¥¥ $
_unitOfWork
¥¥% 0
.
¥¥0 1
StudentRepository
¥¥1 B
.
¥¥B C
AddAsync
¥¥C K
(
¥¥K L
student
¥¥L S
)
¥¥S T
;
¥¥T U
if
µµ 
(
µµ 
isStudentAdd
µµ 
==
µµ 
null
µµ  $
)
µµ$ %
{
∂∂ 
return
∑∑ 
new
∑∑ 
ResponseDTO
∑∑ &
(
∑∑& '
)
∑∑' (
{
∏∏ 
Message
ππ 
=
ππ 
$str
ππ 5
,
ππ5 6
	IsSuccess
∫∫ 
=
∫∫ 
false
∫∫  %
,
∫∫% &

StatusCode
ªª 
=
ªª  
$num
ªª! $
,
ªª$ %
Result
ºº 
=
ºº  
registerStudentDTO
ºº /
}
ΩΩ 
;
ΩΩ 
}
ææ 
var
¡¡ 
isPaymentAdd
¡¡ 
=
¡¡ 
await
¡¡ $
_unitOfWork
¡¡% 0
.
¡¡0 1#
PaymentCardRepository
¡¡1 F
.
¡¡F G
AddAsync
¡¡G O
(
¡¡O P
paymentCard
¡¡P [
)
¡¡[ \
;
¡¡\ ]
if
¬¬ 
(
¬¬ 
isPaymentAdd
¬¬ 
==
¬¬ 
null
¬¬  $
)
¬¬$ %
{
√√ 
return
ƒƒ 
new
ƒƒ 
ResponseDTO
ƒƒ &
(
ƒƒ& '
)
ƒƒ' (
{
≈≈ 
Message
∆∆ 
=
∆∆ 
$str
∆∆ :
,
∆∆: ;
	IsSuccess
«« 
=
«« 
false
««  %
,
««% &

StatusCode
»» 
=
»»  
$num
»»! $
,
»»$ %
Result
…… 
=
……  
registerStudentDTO
…… /
}
   
;
   
}
ÀÀ 
var
ŒŒ 
	isSuccess
ŒŒ 
=
ŒŒ 
await
ŒŒ !
_unitOfWork
ŒŒ" -
.
ŒŒ- .
	SaveAsync
ŒŒ. 7
(
ŒŒ7 8
)
ŒŒ8 9
;
ŒŒ9 :
if
œœ 
(
œœ 
	isSuccess
œœ 
<=
œœ 
$num
œœ 
)
œœ 
{
–– 
return
—— 
new
—— 
ResponseDTO
—— &
(
——& '
)
——' (
{
““ 
Message
”” 
=
”” 
$str
”” F
,
””F G
	IsSuccess
‘‘ 
=
‘‘ 
false
‘‘  %
,
‘‘% &

StatusCode
’’ 
=
’’  
$num
’’! $
,
’’$ %
Result
÷÷ 
=
÷÷  
registerStudentDTO
÷÷ /
}
◊◊ 
;
◊◊ 
}
ÿÿ 
return
€€ 
new
€€ 
ResponseDTO
€€ "
(
€€" #
)
€€# $
{
‹‹ 
Message
›› 
=
›› 
$str
›› 8
,
››8 9
	IsSuccess
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  
,
ﬁﬁ  !

StatusCode
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ  
,
ﬂﬂ  !
Result
‡‡ 
=
‡‡  
registerStudentDTO
‡‡ +
}
·· 
;
·· 
}
‚‚ 	
catch
„„ 
(
„„ 
	Exception
„„ 
e
„„ 
)
„„ 
{
‰‰ 	
return
ÊÊ 
new
ÊÊ 
ResponseDTO
ÊÊ "
(
ÊÊ" #
)
ÊÊ# $
{
ÁÁ 
Message
ËË 
=
ËË 
e
ËË 
.
ËË 
Message
ËË #
,
ËË# $
Result
ÈÈ 
=
ÈÈ  
registerStudentDTO
ÈÈ +
,
ÈÈ+ ,
	IsSuccess
ÍÍ 
=
ÍÍ 
false
ÍÍ !
,
ÍÍ! "

StatusCode
ÎÎ 
=
ÎÎ 
$num
ÎÎ  
}
ÏÏ 
;
ÏÏ 
}
ÌÌ 	
}
ÓÓ 
public
ıı 

async
ıı 
Task
ıı 
<
ıı 
ResponseDTO
ıı !
>
ıı! "
SignUpInstructor
ıı# 3
(
ıı3 4!
SignUpInstructorDTO
ıı4 G!
signUpInstructorDto
ııH [
)
ıı[ \
{
ˆˆ 
try
˜˜ 
{
¯¯ 	
var
˙˙ 
user
˙˙ 
=
˙˙ 
await
˙˙ 
_userManager
˙˙ )
.
˙˙) *
FindByEmailAsync
˙˙* :
(
˙˙: ;!
signUpInstructorDto
˙˙; N
.
˙˙N O
Email
˙˙O T
)
˙˙T U
;
˙˙U V
if
˝˝ 
(
˝˝ 
user
˝˝ 
is
˝˝ 
not
˝˝ 
null
˝˝  
)
˝˝  !
{
˛˛ 
return
ˇˇ 
new
ˇˇ 
ResponseDTO
ˇˇ &
(
ˇˇ& '
)
ˇˇ' (
{
ÄÄ 
Message
ÅÅ 
=
ÅÅ 
$str
ÅÅ >
,
ÅÅ> ?
Result
ÇÇ 
=
ÇÇ !
signUpInstructorDto
ÇÇ 0
,
ÇÇ0 1
	IsSuccess
ÉÉ 
=
ÉÉ 
false
ÉÉ  %
,
ÉÉ% &

StatusCode
ÑÑ 
=
ÑÑ  
$num
ÑÑ! $
}
ÖÖ 
;
ÖÖ 
}
ÜÜ 
var
àà 
isPhonenumerExit
àà  
=
àà! "
await
ââ 
_userManager
ââ "
.
ââ" #
Users
ââ# (
.
ââ( )
AnyAsync
ââ) 1
(
ââ1 2
u
ââ2 3
=>
ââ4 6
u
ââ7 8
.
ââ8 9
PhoneNumber
ââ9 D
==
ââE G!
signUpInstructorDto
ââH [
.
ââ[ \
PhoneNumber
ââ\ g
)
ââg h
;
ââh i
if
ää 
(
ää 
isPhonenumerExit
ää  
)
ää  !
{
ãã 
return
åå 
new
åå 
ResponseDTO
åå &
(
åå& '
)
åå' (
{
çç 
Message
éé 
=
éé 
$str
éé E
,
ééE F
Result
èè 
=
èè !
signUpInstructorDto
èè 0
,
èè0 1
	IsSuccess
êê 
=
êê 
false
êê  %
,
êê% &

StatusCode
ëë 
=
ëë  
$num
ëë! $
}
íí 
;
íí 
}
ìì 
var
ïï 
isCardExist
ïï 
=
ïï 
await
ññ 
_unitOfWork
ññ !
.
ññ! "#
PaymentCardRepository
ññ" 7
.
ññ7 8
GetAsync
ññ8 @
(
ññ@ A
x
ññA B
=>
ññC E
x
ññF G
.
ññG H

CardNumber
ññH R
==
ññS U!
signUpInstructorDto
ññV i
.
ññi j

CardNumber
ññj t
)
ññt u
;
ññu v
if
óó 
(
óó 
isCardExist
óó 
is
óó 
not
óó "
null
óó# '
)
óó' (
{
òò 
return
ôô 
new
ôô 
ResponseDTO
ôô &
{
öö 
	IsSuccess
õõ 
=
õõ 
false
õõ  %
,
õõ% &

StatusCode
úú 
=
úú  
$num
úú! $
,
úú$ %
Message
ùù 
=
ùù 
$str
ùù D
,
ùùD E
Result
ûû 
=
ûû 
null
ûû !
}
üü 
;
üü 
}
†† 
ApplicationUser
££ 
newUser
££ #
=
££$ %
new
££& )
ApplicationUser
££* 9
(
££9 :
)
££: ;
{
§§ 
Address
•• 
=
•• !
signUpInstructorDto
•• -
.
••- .
Address
••. 5
,
••5 6
Email
¶¶ 
=
¶¶ !
signUpInstructorDto
¶¶ +
.
¶¶+ ,
Email
¶¶, 1
,
¶¶1 2
	BirthDate
ßß 
=
ßß !
signUpInstructorDto
ßß /
.
ßß/ 0
	BirthDate
ßß0 9
,
ßß9 :
UserName
®® 
=
®® !
signUpInstructorDto
®® .
.
®®. /
Email
®®/ 4
,
®®4 5
FullName
©© 
=
©© !
signUpInstructorDto
©© .
.
©©. /
FullName
©©/ 7
,
©©7 8
Gender
™™ 
=
™™ !
signUpInstructorDto
™™ ,
.
™™, -
Gender
™™- 3
,
™™3 4
Country
´´ 
=
´´ !
signUpInstructorDto
´´ -
.
´´- .
Country
´´. 5
,
´´5 6
PhoneNumber
¨¨ 
=
¨¨ !
signUpInstructorDto
¨¨ 1
.
¨¨1 2
PhoneNumber
¨¨2 =
,
¨¨= >
	TaxNumber
≠≠ 
=
≠≠ !
signUpInstructorDto
≠≠ /
.
≠≠/ 0
	TaxNumber
≠≠0 9
,
≠≠9 :

UpdateTime
ÆÆ 
=
ÆÆ 
DateTime
ÆÆ %
.
ÆÆ% &
Now
ÆÆ& )
}
ØØ 
;
ØØ 
var
≤≤ 
createUserResult
≤≤  
=
≤≤! "
await
≤≤# (
_userManager
≤≤) 5
.
≤≤5 6
CreateAsync
≤≤6 A
(
≤≤A B
newUser
≤≤B I
,
≤≤I J!
signUpInstructorDto
≤≤K ^
.
≤≤^ _
Password
≤≤_ g
)
≤≤g h
;
≤≤h i
if
∂∂ 
(
∂∂ 
!
∂∂ 
createUserResult
∂∂ !
.
∂∂! "
	Succeeded
∂∂" +
)
∂∂+ ,
{
∑∑ 
return
ππ 
new
ππ 
ResponseDTO
ππ &
(
ππ& '
)
ππ' (
{
∫∫ 
Message
ªª 
=
ªª 
createUserResult
ªª .
.
ªª. /
Errors
ªª/ 5
.
ªª5 6
ToString
ªª6 >
(
ªª> ?
)
ªª? @
,
ªª@ A
	IsSuccess
ºº 
=
ºº 
false
ºº  %
,
ºº% &

StatusCode
ΩΩ 
=
ΩΩ  
$num
ΩΩ! $
,
ΩΩ$ %
Result
ææ 
=
ææ !
signUpInstructorDto
ææ 0
}
øø 
;
øø 
}
¿¿ 
user
√√ 
=
√√ 
await
√√ 
_userManager
√√ %
.
√√% &
FindByEmailAsync
√√& 6
(
√√6 7!
signUpInstructorDto
√√7 J
.
√√J K
Email
√√K P
)
√√P Q
;
√√Q R

Instructor
«« 

instructor
«« !
=
««" #
new
««$ '

Instructor
««( 2
(
««2 3
)
««3 4
{
»» 
UserId
…… 
=
…… 
user
…… 
.
…… 
Id
……  
,
……  !
Degree
   
=
   !
signUpInstructorDto
   ,
.
  , -
Degree
  - 3
,
  3 4
Industry
ÀÀ 
=
ÀÀ !
signUpInstructorDto
ÀÀ .
.
ÀÀ. /
Industry
ÀÀ/ 7
,
ÀÀ7 8
Introduction
ÃÃ 
=
ÃÃ !
signUpInstructorDto
ÃÃ 2
.
ÃÃ2 3
Introduction
ÃÃ3 ?
,
ÃÃ? @

AcceptedBy
ÕÕ 
=
ÕÕ 
$str
ÕÕ 
,
ÕÕ  
AcceptedTime
ŒŒ 
=
ŒŒ 
null
ŒŒ #
,
ŒŒ# $

RejectedBy
œœ 
=
œœ 
$str
œœ 
,
œœ  
RejectedTime
–– 
=
–– 
null
–– #
,
––# $

IsAccepted
—— 
=
—— 
null
—— !
}
““ 
;
““ 
PaymentCard
’’ 
paymentCard
’’ #
=
’’$ %
new
’’& )
PaymentCard
’’* 5
(
’’5 6
)
’’6 7
{
÷÷ 
CardName
◊◊ 
=
◊◊ !
signUpInstructorDto
◊◊ .
.
◊◊. /
CardName
◊◊/ 7
,
◊◊7 8

CardNumber
ÿÿ 
=
ÿÿ !
signUpInstructorDto
ÿÿ 0
.
ÿÿ0 1

CardNumber
ÿÿ1 ;
,
ÿÿ; <
CardProvider
ŸŸ 
=
ŸŸ !
signUpInstructorDto
ŸŸ 2
.
ŸŸ2 3
CardProvider
ŸŸ3 ?
,
ŸŸ? @
UserId
⁄⁄ 
=
⁄⁄ 
user
⁄⁄ 
.
⁄⁄ 
Id
⁄⁄  
}
€€ 
;
€€ 
var
ﬁﬁ 
isRoleExist
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ #
_roleManager
ﬁﬁ$ 0
.
ﬁﬁ0 1
RoleExistsAsync
ﬁﬁ1 @
(
ﬁﬁ@ A
StaticUserRoles
ﬁﬁA P
.
ﬁﬁP Q

Instructor
ﬁﬁQ [
)
ﬁﬁ[ \
;
ﬁﬁ\ ]
if
·· 
(
·· 
isRoleExist
·· 
is
·· 
false
·· $
)
··$ %
{
‚‚ 
await
„„ 
_roleManager
„„ "
.
„„" #
CreateAsync
„„# .
(
„„. /
new
„„/ 2
IdentityRole
„„3 ?
(
„„? @
StaticUserRoles
„„@ O
.
„„O P

Instructor
„„P Z
)
„„Z [
)
„„[ \
;
„„\ ]
}
‰‰ 
await
ÁÁ 
_userManager
ÁÁ 
.
ÁÁ 
AddToRoleAsync
ÁÁ -
(
ÁÁ- .
user
ÁÁ. 2
,
ÁÁ2 3
StaticUserRoles
ÁÁ4 C
.
ÁÁC D

Instructor
ÁÁD N
)
ÁÁN O
;
ÁÁO P
await
ÍÍ 
_unitOfWork
ÍÍ 
.
ÍÍ "
InstructorRepository
ÍÍ 2
.
ÍÍ2 3
AddAsync
ÍÍ3 ;
(
ÍÍ; <

instructor
ÍÍ< F
)
ÍÍF G
;
ÍÍG H
await
ÌÌ 
_unitOfWork
ÌÌ 
.
ÌÌ #
PaymentCardRepository
ÌÌ 3
.
ÌÌ3 4
AddAsync
ÌÌ4 <
(
ÌÌ< =
paymentCard
ÌÌ= H
)
ÌÌH I
;
ÌÌI J
await
 
_unitOfWork
 
.
 
	SaveAsync
 '
(
' (
)
( )
;
) *
return
ÛÛ 
new
ÛÛ 
ResponseDTO
ÛÛ "
(
ÛÛ" #
)
ÛÛ# $
{
ÙÙ 
Message
ıı 
=
ıı 
$str
ıı 8
,
ıı8 9
	IsSuccess
ˆˆ 
=
ˆˆ 
true
ˆˆ  
,
ˆˆ  !

StatusCode
˜˜ 
=
˜˜ 
$num
˜˜  
,
˜˜  !
Result
¯¯ 
=
¯¯ !
signUpInstructorDto
¯¯ ,
}
˘˘ 
;
˘˘ 
}
˙˙ 	
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 	
return
˛˛ 
new
˛˛ 
ResponseDTO
˛˛ "
(
˛˛" #
)
˛˛# $
{
ˇˇ 
Message
ÄÄ 
=
ÄÄ 
e
ÄÄ 
.
ÄÄ 
Message
ÄÄ #
,
ÄÄ# $
Result
ÅÅ 
=
ÅÅ !
signUpInstructorDto
ÅÅ ,
,
ÅÅ, -
	IsSuccess
ÇÇ 
=
ÇÇ 
false
ÇÇ !
,
ÇÇ! "

StatusCode
ÉÉ 
=
ÉÉ 
$num
ÉÉ  
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
public
éé 

async
éé 
Task
éé 
<
éé 
ResponseDTO
éé !
>
éé! "$
UploadInstructorDegree
éé# 9
(
éé9 :
	IFormFile
éé: C
file
ééD H
,
ééH I
ClaimsPrincipal
ééJ Y
User
ééZ ^
)
éé^ _
{
èè 
try
êê 
{
ëë 	
var
íí 
userId
íí 
=
íí 
User
íí 
.
íí 
Claims
íí $
.
íí$ %
FirstOrDefault
íí% 3
(
íí3 4
x
íí4 5
=>
íí6 8
x
íí9 :
.
íí: ;
Type
íí; ?
==
íí@ B

ClaimTypes
ííC M
.
ííM N
NameIdentifier
ííN \
)
íí\ ]
?
íí] ^
.
íí^ _
Value
íí_ d
;
ííd e
if
îî 
(
îî 
userId
îî 
is
îî 
null
îî 
)
îî 
{
ïï 
throw
ññ 
new
ññ 
	Exception
ññ #
(
ññ# $
$str
ññ$ 9
)
ññ9 :
;
ññ: ;
}
óó 
var
ôô 

instructor
ôô 
=
ôô 
await
ôô "
_unitOfWork
ôô# .
.
ôô. /"
InstructorRepository
ôô/ C
.
ôôC D
GetAsync
ôôD L
(
ôôL M
x
ôôM N
=>
ôôO Q
x
ôôR S
.
ôôS T
UserId
ôôT Z
==
ôô[ ]
userId
ôô^ d
)
ôôd e
;
ôôe f
if
õõ 
(
õõ 

instructor
õõ 
is
õõ 
null
õõ "
)
õõ" #
{
úú 
throw
ùù 
new
ùù 
	Exception
ùù #
(
ùù# $
$str
ùù$ ?
)
ùù? @
;
ùù@ A
}
ûû 
var
†† 
responseDto
†† 
=
†† 
await
†† #
_firebaseService
††$ 4
.
††4 5
UploadImage
††5 @
(
††@ A
file
††A E
,
††E F#
StaticFirebaseFolders
††G \
.
††\ ]
InstructorDegrees
††] n
)
††n o
;
††o p
if
¢¢ 
(
¢¢ 
!
¢¢ 
responseDto
¢¢ 
.
¢¢ 
	IsSuccess
¢¢ &
)
¢¢& '
{
££ 
throw
§§ 
new
§§ 
	Exception
§§ #
(
§§# $
$str
§§$ 8
)
§§8 9
;
§§9 :
}
•• 

instructor
ßß 
.
ßß 
DegreeImageUrl
ßß %
=
ßß& '
responseDto
ßß( 3
.
ßß3 4
Result
ßß4 :
.
ßß: ;
ToString
ßß; C
(
ßßC D
)
ßßD E
;
ßßE F
await
©© 
_unitOfWork
©© 
.
©© 
	SaveAsync
©© '
(
©©' (
)
©©( )
;
©©) *
return
´´ 
new
´´ 
ResponseDTO
´´ "
(
´´" #
)
´´# $
{
¨¨ 
	IsSuccess
≠≠ 
=
≠≠ 
true
≠≠  
,
≠≠  !

StatusCode
ÆÆ 
=
ÆÆ 
$num
ÆÆ  
,
ÆÆ  !
Result
ØØ 
=
ØØ 
responseDto
ØØ $
.
ØØ$ %
Result
ØØ% +
,
ØØ+ ,
Message
∞∞ 
=
∞∞ 
$str
∞∞ A
}
±± 
;
±± 
}
≤≤ 	
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 	
return
µµ 
new
µµ 
ResponseDTO
µµ "
(
µµ" #
)
µµ# $
{
∂∂ 
	IsSuccess
∑∑ 
=
∑∑ 
false
∑∑ !
,
∑∑! "

StatusCode
∏∏ 
=
∏∏ 
$num
∏∏  
,
∏∏  !
Result
ππ 
=
ππ 
null
ππ 
,
ππ 
Message
∫∫ 
=
∫∫ 
e
∫∫ 
.
∫∫ 
Message
∫∫ #
}
ªª 
;
ªª 
}
ºº 	
}
ΩΩ 
public
ƒƒ 

async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
DegreeResponseDTO
ƒƒ '
>
ƒƒ' (!
GetInstructorDegree
ƒƒ) <
(
ƒƒ< =
ClaimsPrincipal
ƒƒ= L
User
ƒƒM Q
)
ƒƒQ R
{
≈≈ 
try
∆∆ 
{
«« 	
var
»» 
userId
»» 
=
»» 
User
»» 
.
»» 
Claims
»» $
.
»»$ %
FirstOrDefault
»»% 3
(
»»3 4
x
»»4 5
=>
»»6 8
x
»»9 :
.
»»: ;
Type
»»; ?
==
»»@ B

ClaimTypes
»»C M
.
»»M N
NameIdentifier
»»N \
)
»»\ ]
?
»»] ^
.
»»^ _
Value
»»_ d
;
»»d e
if
   
(
   
userId
   
is
   
null
   
)
   
{
ÀÀ 
throw
ÃÃ 
new
ÃÃ 
	Exception
ÃÃ #
(
ÃÃ# $
$str
ÃÃ$ ;
)
ÃÃ; <
;
ÃÃ< =
}
ÕÕ 
var
œœ 

instructor
œœ 
=
œœ 
await
œœ "
_unitOfWork
œœ# .
.
œœ. /"
InstructorRepository
œœ/ C
.
œœC D
GetAsync
œœD L
(
œœL M
x
œœM N
=>
œœO Q
x
œœR S
.
œœS T
UserId
œœT Z
==
œœ[ ]
userId
œœ^ d
)
œœd e
;
œœe f
if
—— 
(
—— 

instructor
—— 
is
—— 
null
—— "
)
——" #
{
““ 
throw
”” 
new
”” 
	Exception
”” #
(
””# $
$str
””$ @
)
””@ A
;
””A B
}
‘‘ 
var
÷÷ 

degreePath
÷÷ 
=
÷÷ 

instructor
÷÷ '
?
÷÷' (
.
÷÷( )
DegreeImageUrl
÷÷) 7
;
÷÷7 8
if
◊◊ 
(
◊◊ 

degreePath
◊◊ 
.
◊◊ 
IsNullOrEmpty
◊◊ (
(
◊◊( )
)
◊◊) *
)
◊◊* +
{
ÿÿ 
throw
ŸŸ 
new
ŸŸ 
	Exception
ŸŸ #
(
ŸŸ# $
$str
ŸŸ$ H
)
ŸŸH I
;
ŸŸI J
}
⁄⁄ 
var
‹‹ 
stream
‹‹ 
=
‹‹ 
await
‹‹ 
_firebaseService
‹‹ /
.
‹‹/ 0
GetImage
‹‹0 8
(
‹‹8 9

instructor
‹‹9 C
.
‹‹C D
DegreeImageUrl
‹‹D R
)
‹‹R S
;
‹‹S T
if
ﬁﬁ 
(
ﬁﬁ 
stream
ﬁﬁ 
is
ﬁﬁ 
null
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
throw
‡‡ 
new
‡‡ 
	Exception
‡‡ #
(
‡‡# $
$str
‡‡$ F
)
‡‡F G
;
‡‡G H
}
·· 
var
„„ 
contentType
„„ 
=
„„ 
$str
„„ 7
;
„„7 8
if
ÂÂ 
(
ÂÂ 

degreePath
ÂÂ 
.
ÂÂ 
EndsWith
ÂÂ #
(
ÂÂ# $
$str
ÂÂ$ *
)
ÂÂ* +
)
ÂÂ+ ,
{
ÊÊ 
contentType
ÁÁ 
=
ÁÁ "
StaticFileExtensions
ÁÁ 2
.
ÁÁ2 3
Pdf
ÁÁ3 6
;
ÁÁ6 7
}
ËË 
if
ÍÍ 
(
ÍÍ 

degreePath
ÍÍ 
.
ÍÍ 
EndsWith
ÍÍ #
(
ÍÍ# $
$str
ÍÍ$ *
)
ÍÍ* +
)
ÍÍ+ ,
{
ÎÎ 
contentType
ÏÏ 
=
ÏÏ "
StaticFileExtensions
ÏÏ 2
.
ÏÏ2 3
Png
ÏÏ3 6
;
ÏÏ6 7
}
ÌÌ 
if
ÔÔ 
(
ÔÔ 

degreePath
ÔÔ 
.
ÔÔ 
EndsWith
ÔÔ #
(
ÔÔ# $
$str
ÔÔ$ *
)
ÔÔ* +
||
ÔÔ, .

degreePath
ÔÔ/ 9
.
ÔÔ9 :
EndsWith
ÔÔ: B
(
ÔÔB C
$str
ÔÔC J
)
ÔÔJ K
)
ÔÔK L
{
 
contentType
ÒÒ 
=
ÒÒ "
StaticFileExtensions
ÒÒ 2
.
ÒÒ2 3
Jpeg
ÒÒ3 7
;
ÒÒ7 8
}
ÚÚ 
return
ÙÙ 
new
ÙÙ 
DegreeResponseDTO
ÙÙ (
(
ÙÙ( )
)
ÙÙ) *
{
ıı 
Message
ˆˆ 
=
ˆˆ 
$str
ˆˆ 1
,
ˆˆ1 2
Stream
˜˜ 
=
˜˜ 
stream
˜˜ 
,
˜˜  
ContentType
¯¯ 
=
¯¯ 
contentType
¯¯ )
,
¯¯) *
FileName
˘˘ 
=
˘˘ 
Path
˘˘ 
.
˘˘  
GetFileName
˘˘  +
(
˘˘+ ,

degreePath
˘˘, 6
)
˘˘6 7
}
˙˙ 
;
˙˙ 
}
˚˚ 	
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
e
¸¸ 
)
¸¸ 
{
˝˝ 	
return
˛˛ 
new
˛˛ 
DegreeResponseDTO
˛˛ (
(
˛˛( )
)
˛˛) *
{
ˇˇ 
ContentType
ÄÄ 
=
ÄÄ 
null
ÄÄ "
,
ÄÄ" #
Message
ÅÅ 
=
ÅÅ 
e
ÅÅ 
.
ÅÅ 
Message
ÅÅ #
,
ÅÅ# $
Stream
ÇÇ 
=
ÇÇ 
null
ÇÇ 
}
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
}
ÖÖ 
public
çç 

async
çç 
Task
çç 
<
çç 
ResponseDTO
çç !
>
çç! "
UploadUserAvatar
çç# 3
(
çç3 4
	IFormFile
çç4 =
file
çç> B
,
ççB C
ClaimsPrincipal
ççD S
User
ççT X
)
ççX Y
{
éé 
try
èè 
{
êê 	
var
ëë 
userId
ëë 
=
ëë 
User
ëë 
.
ëë 
Claims
ëë $
.
ëë$ %
FirstOrDefault
ëë% 3
(
ëë3 4
x
ëë4 5
=>
ëë6 8
x
ëë9 :
.
ëë: ;
Type
ëë; ?
==
ëë@ B

ClaimTypes
ëëC M
.
ëëM N
NameIdentifier
ëëN \
)
ëë\ ]
?
ëë] ^
.
ëë^ _
Value
ëë_ d
;
ëëd e
if
ìì 
(
ìì 
userId
ìì 
is
ìì 
null
ìì 
)
ìì 
{
îî 
throw
ïï 
new
ïï 
	Exception
ïï #
(
ïï# $
$str
ïï$ 9
)
ïï9 :
;
ïï: ;
}
ññ 
var
òò 
user
òò 
=
òò 
await
òò 
_userManager
òò )
.
òò) *
FindByIdAsync
òò* 7
(
òò7 8
userId
òò8 >
)
òò> ?
;
òò? @
if
öö 
(
öö 
user
öö 
is
öö 
null
öö 
)
öö 
{
õõ 
throw
úú 
new
úú 
	Exception
úú #
(
úú# $
$str
úú$ 9
)
úú9 :
;
úú: ;
}
ùù 
var
üü 
responseDto
üü 
=
üü 
await
üü #
_firebaseService
üü$ 4
.
üü4 5
UploadImage
üü5 @
(
üü@ A
file
üüA E
,
üüE F#
StaticFirebaseFolders
üüG \
.
üü\ ]
UserAvatars
üü] h
)
üüh i
;
üüi j
if
°° 
(
°° 
!
°° 
responseDto
°° 
.
°° 
	IsSuccess
°° &
)
°°& '
{
¢¢ 
throw
££ 
new
££ 
	Exception
££ #
(
££# $
$str
££$ 8
)
££8 9
;
££9 :
}
§§ 
user
¶¶ 
.
¶¶ 
	AvatarUrl
¶¶ 
=
¶¶ 
responseDto
¶¶ (
.
¶¶( )
Result
¶¶) /
?
¶¶/ 0
.
¶¶0 1
ToString
¶¶1 9
(
¶¶9 :
)
¶¶: ;
;
¶¶; <
var
®® 
updateResult
®® 
=
®® 
await
®® $
_userManager
®®% 1
.
®®1 2
UpdateAsync
®®2 =
(
®®= >
user
®®> B
)
®®B C
;
®®C D
if
™™ 
(
™™ 
!
™™ 
updateResult
™™ 
.
™™ 
	Succeeded
™™ '
)
™™' (
{
´´ 
throw
¨¨ 
new
¨¨ 
	Exception
¨¨ #
(
¨¨# $
$str
¨¨$ >
)
¨¨> ?
;
¨¨? @
}
≠≠ 
return
ØØ 
new
ØØ 
ResponseDTO
ØØ "
(
ØØ" #
)
ØØ# $
{
∞∞ 
Message
±± 
=
±± 
$str
±± <
,
±±< =
Result
≤≤ 
=
≤≤ 
null
≤≤ 
,
≤≤ 
	IsSuccess
≥≥ 
=
≥≥ 
true
≥≥  
,
≥≥  !

StatusCode
¥¥ 
=
¥¥ 
$num
¥¥  
}
µµ 
;
µµ 
}
∂∂ 	
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 	
return
ππ 
new
ππ 
ResponseDTO
ππ "
(
ππ" #
)
ππ# $
{
∫∫ 
Message
ªª 
=
ªª 
e
ªª 
.
ªª 
Message
ªª #
,
ªª# $
Result
ºº 
=
ºº 
null
ºº 
,
ºº 
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ !
,
ΩΩ! "

StatusCode
ææ 
=
ææ 
$num
ææ  
}
øø 
;
øø 
}
¿¿ 	
}
¡¡ 
public
»» 

async
»» 
Task
»» 
<
»» 
MemoryStream
»» "
>
»»" #
GetUserAvatar
»»$ 1
(
»»1 2
ClaimsPrincipal
»»2 A
User
»»B F
)
»»F G
{
…… 
try
   
{
ÀÀ 	
var
ÃÃ 
userId
ÃÃ 
=
ÃÃ 
User
ÃÃ 
.
ÃÃ 
Claims
ÃÃ $
.
ÃÃ$ %
FirstOrDefault
ÃÃ% 3
(
ÃÃ3 4
x
ÃÃ4 5
=>
ÃÃ6 8
x
ÃÃ9 :
.
ÃÃ: ;
Type
ÃÃ; ?
==
ÃÃ@ B

ClaimTypes
ÃÃC M
.
ÃÃM N
NameIdentifier
ÃÃN \
)
ÃÃ\ ]
?
ÃÃ] ^
.
ÃÃ^ _
Value
ÃÃ_ d
;
ÃÃd e
var
ŒŒ 
user
ŒŒ 
=
ŒŒ 
await
ŒŒ 
_userManager
ŒŒ )
.
ŒŒ) *
FindByIdAsync
ŒŒ* 7
(
ŒŒ7 8
userId
ŒŒ8 >
)
ŒŒ> ?
;
ŒŒ? @
var
–– 
stream
–– 
=
–– 
await
–– 
_firebaseService
–– /
.
––/ 0
GetImage
––0 8
(
––8 9
user
––9 =
.
––= >
	AvatarUrl
––> G
)
––G H
;
––H I
return
““ 
stream
““ 
;
““ 
}
”” 	
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
e
‘‘ 
)
‘‘ 
{
’’ 	
return
÷÷ 
null
÷÷ 
;
÷÷ 
}
◊◊ 	
}
ÿÿ 
public
‹‹ 

async
‹‹ 
Task
‹‹ 
<
‹‹ 
ResponseDTO
‹‹ !
>
‹‹! "
SignIn
‹‹# )
(
‹‹) *
SignDTO
‹‹* 1
signDTO
‹‹2 9
)
‹‹9 :
{
›› 
try
ﬁﬁ 
{
ﬂﬂ 	
var
‡‡ 
user
‡‡ 
=
‡‡ 
await
‡‡ 
_userManager
‡‡ )
.
‡‡) *
FindByEmailAsync
‡‡* :
(
‡‡: ;
signDTO
‡‡; B
.
‡‡B C
Email
‡‡C H
)
‡‡H I
;
‡‡I J
if
·· 
(
·· 
user
·· 
==
·· 
null
·· 
)
·· 
{
‚‚ 
new
„„ 
ResponseDTO
„„ 
(
„„  
)
„„  !
{
‰‰ 
Message
ÂÂ 
=
ÂÂ 
$str
ÂÂ 4
,
ÂÂ4 5
Result
ÊÊ 
=
ÊÊ 
null
ÊÊ !
,
ÊÊ! "
	IsSuccess
ÁÁ 
=
ÁÁ 
false
ÁÁ  %
,
ÁÁ% &

StatusCode
ËË 
=
ËË  
$num
ËË! $
}
ÈÈ 
;
ÈÈ 
}
ÍÍ 
var
ÏÏ 
isPasswordCorrect
ÏÏ !
=
ÏÏ" #
await
ÏÏ$ )
_userManager
ÏÏ* 6
.
ÏÏ6 7 
CheckPasswordAsync
ÏÏ7 I
(
ÏÏI J
user
ÏÏJ N
,
ÏÏN O
signDTO
ÏÏP W
.
ÏÏW X
Password
ÏÏX `
)
ÏÏ` a
;
ÏÏa b
if
ÓÓ 
(
ÓÓ 
!
ÓÓ 
isPasswordCorrect
ÓÓ "
)
ÓÓ" #
{
ÔÔ 
return
 
new
 
ResponseDTO
 &
(
& '
)
' (
{
ÒÒ 
Message
ÚÚ 
=
ÚÚ 
$str
ÚÚ ;
,
ÚÚ; <
Result
ÛÛ 
=
ÛÛ 
null
ÛÛ !
,
ÛÛ! "
	IsSuccess
ÙÙ 
=
ÙÙ 
false
ÙÙ  %
,
ÙÙ% &

StatusCode
ıı 
=
ıı  
$num
ıı! $
}
ˆˆ 
;
ˆˆ 
}
˜˜ 
if
˘˘ 
(
˘˘ 
!
˘˘ 
user
˘˘ 
.
˘˘ 
EmailConfirmed
˘˘ $
)
˘˘$ %
{
˙˙ 
return
˚˚ 
new
˚˚ 
ResponseDTO
˚˚ &
(
˚˚& '
)
˚˚' (
{
¸¸ 
Message
˝˝ 
=
˝˝ 
$str
˝˝ :
,
˝˝: ;
Result
˛˛ 
=
˛˛ 
null
˛˛ !
,
˛˛! "
	IsSuccess
ˇˇ 
=
ˇˇ 
false
ˇˇ  %
,
ˇˇ% &

StatusCode
ÄÄ 
=
ÄÄ  
$num
ÄÄ! $
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 
var
ÑÑ 
accessToken
ÑÑ 
=
ÑÑ 
await
ÑÑ #
_tokenService
ÑÑ$ 1
.
ÑÑ1 2)
GenerateJwtAccessTokenAsync
ÑÑ2 M
(
ÑÑM N
user
ÑÑN R
)
ÑÑR S
;
ÑÑS T
var
ÖÖ 
refreshToken
ÖÖ 
=
ÖÖ 
await
ÖÖ $
_tokenService
ÖÖ% 2
.
ÖÖ2 3*
GenerateJwtRefreshTokenAsync
ÖÖ3 O
(
ÖÖO P
user
ÖÖP T
)
ÖÖT U
;
ÖÖU V
await
ÜÜ 
_tokenService
ÜÜ 
.
ÜÜ  
StoreRefreshToken
ÜÜ  1
(
ÜÜ1 2
user
ÜÜ2 6
.
ÜÜ6 7
Id
ÜÜ7 9
,
ÜÜ9 :
refreshToken
ÜÜ; G
)
ÜÜG H
;
ÜÜH I
return
àà 
new
àà 
ResponseDTO
àà "
(
àà" #
)
àà# $
{
ââ 
Result
ää 
=
ää 
new
ää 
SignResponseDTO
ää ,
(
ää, -
)
ää- .
{
ãã 
AccessToken
åå 
=
åå  !
accessToken
åå" -
,
åå- .
RefreshToken
çç  
=
çç! "
refreshToken
çç# /
,
çç/ 0
}
éé 
,
éé 
Message
èè 
=
èè 
$str
èè 0
,
èè0 1
	IsSuccess
êê 
=
êê 
true
êê  
,
êê  !

StatusCode
ëë 
=
ëë 
$num
ëë  
}
íí 
;
íí 
}
ìì 	
catch
îî 
(
îî 
	Exception
îî 
e
îî 
)
îî 
{
ïï 	
return
ññ 
new
ññ 
ResponseDTO
ññ "
(
ññ" #
)
ññ# $
{
óó 
Message
òò 
=
òò 
e
òò 
.
òò 
Message
òò #
,
òò# $
	IsSuccess
ôô 
=
ôô 
false
ôô !
,
ôô! "

StatusCode
öö 
=
öö 
$num
öö  
,
öö  !
Result
õõ 
=
õõ 
null
õõ 
}
úú 
;
úú 
}
ùù 	
}
ûû 
public
•• 

async
•• 
Task
•• 
<
•• 
ResponseDTO
•• !
>
••! "
Refresh
••# *
(
••* +
string
••+ 1
token
••2 7
)
••7 8
{
¶¶ 
try
ßß 
{
®® 	
ClaimsPrincipal
©© 
user
©©  
=
©©! "
await
©©# (
_tokenService
©©) 6
.
©©6 7#
GetPrincipalFromToken
©©7 L
(
©©L M
token
©©M R
)
©©R S
;
©©S T
var
´´ 
userId
´´ 
=
´´ 
user
´´ 
.
´´ 
Claims
´´ $
.
´´$ %
FirstOrDefault
´´% 3
(
´´3 4
x
´´4 5
=>
´´6 8
x
´´9 :
.
´´: ;
Type
´´; ?
==
´´@ B

ClaimTypes
´´C M
.
´´M N
NameIdentifier
´´N \
)
´´\ ]
?
´´] ^
.
´´^ _
Value
´´_ d
;
´´d e
if
¨¨ 
(
¨¨ 
userId
¨¨ 
is
¨¨ 
null
¨¨ 
)
¨¨ 
{
≠≠ 
return
ÆÆ 
new
ÆÆ 
ResponseDTO
ÆÆ &
(
ÆÆ& '
)
ÆÆ' (
{
ØØ 
Message
∞∞ 
=
∞∞ 
$str
∞∞ 2
,
∞∞2 3
	IsSuccess
±± 
=
±± 
false
±±  %
,
±±% &

StatusCode
≤≤ 
=
≤≤  
$num
≤≤! $
,
≤≤$ %
Result
≥≥ 
=
≥≥ 
null
≥≥ !
}
¥¥ 
;
¥¥ 
}
µµ 
var
∑∑ 
applicationUser
∑∑ 
=
∑∑  !
await
∑∑" '
_userManager
∑∑( 4
.
∑∑4 5
FindByIdAsync
∑∑5 B
(
∑∑B C
userId
∑∑C I
)
∑∑I J
;
∑∑J K
if
∏∏ 
(
∏∏ 
applicationUser
∏∏ 
is
∏∏  "
null
∏∏# '
)
∏∏' (
{
ππ 
return
∫∫ 
new
∫∫ 
ResponseDTO
∫∫ &
(
∫∫& '
)
∫∫' (
{
ªª 
Message
ºº 
=
ºº 
$str
ºº 3
,
ºº3 4
	IsSuccess
ΩΩ 
=
ΩΩ 
false
ΩΩ  %
,
ΩΩ% &

StatusCode
ææ 
=
ææ  
$num
ææ! $
,
ææ$ %
Result
øø 
=
øø 
null
øø !
}
¿¿ 
;
¿¿ 
}
¡¡ 
var
ƒƒ 
tokenOnRedis
ƒƒ 
=
ƒƒ 
await
ƒƒ $
_tokenService
ƒƒ% 2
.
ƒƒ2 3"
RetrieveRefreshToken
ƒƒ3 G
(
ƒƒG H
applicationUser
ƒƒH W
.
ƒƒW X
Id
ƒƒX Z
)
ƒƒZ [
;
ƒƒ[ \
if
≈≈ 
(
≈≈ 
tokenOnRedis
≈≈ 
!=
≈≈ 
token
≈≈  %
)
≈≈% &
{
∆∆ 
return
«« 
new
«« 
ResponseDTO
«« &
(
««& '
)
««' (
{
»» 
Message
…… 
=
…… 
$str
…… 2
,
……2 3
	IsSuccess
   
=
   
false
    %
,
  % &

StatusCode
ÀÀ 
=
ÀÀ  
$num
ÀÀ! $
,
ÀÀ$ %
Result
ÃÃ 
=
ÃÃ 
null
ÃÃ !
}
ÕÕ 
;
ÕÕ 
}
ŒŒ 
var
–– 
accessToken
–– 
=
–– 
await
–– #
_tokenService
––$ 1
.
––1 2)
GenerateJwtAccessTokenAsync
––2 M
(
––M N
applicationUser
––N ]
)
––] ^
;
––^ _
var
—— 
refreshToken
—— 
=
—— 
await
—— $
_tokenService
——% 2
.
——2 3*
GenerateJwtRefreshTokenAsync
——3 O
(
——O P
applicationUser
——P _
)
——_ `
;
——` a
await
”” 
_tokenService
”” 
.
””   
DeleteRefreshToken
””  2
(
””2 3
applicationUser
””3 B
.
””B C
Id
””C E
)
””E F
;
””F G
await
‘‘ 
_tokenService
‘‘ 
.
‘‘  
StoreRefreshToken
‘‘  1
(
‘‘1 2
applicationUser
‘‘2 A
.
‘‘A B
Id
‘‘B D
,
‘‘D E
refreshToken
‘‘F R
)
‘‘R S
;
‘‘S T
return
÷÷ 
new
÷÷ 
ResponseDTO
÷÷ "
(
÷÷" #
)
÷÷# $
{
◊◊ 
Result
ÿÿ 
=
ÿÿ 
new
ÿÿ 
JwtTokenDTO
ÿÿ (
(
ÿÿ( )
)
ÿÿ) *
{
ŸŸ 
AccessToken
⁄⁄ 
=
⁄⁄  !
accessToken
⁄⁄" -
,
⁄⁄- .
RefreshToken
€€  
=
€€! "
refreshToken
€€# /
}
‹‹ 
,
‹‹ 
	IsSuccess
›› 
=
›› 
true
››  
,
››  !

StatusCode
ﬁﬁ 
=
ﬁﬁ 
$num
ﬁﬁ  
,
ﬁﬁ  !
Message
ﬂﬂ 
=
ﬂﬂ 
$str
ﬂﬂ 7
}
‡‡ 
;
‡‡ 
}
·· 	
catch
‚‚ 
(
‚‚ 
	Exception
‚‚ 
e
‚‚ 
)
‚‚ 
{
„„ 	
return
‰‰ 
new
‰‰ 
ResponseDTO
‰‰ "
(
‰‰" #
)
‰‰# $
{
ÂÂ 
Message
ÊÊ 
=
ÊÊ 
e
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
,
ÊÊ# $
	IsSuccess
ÁÁ 
=
ÁÁ 
false
ÁÁ !
,
ÁÁ! "

StatusCode
ËË 
=
ËË 
$num
ËË  
,
ËË  !
Result
ÈÈ 
=
ÈÈ 
null
ÈÈ 
}
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
}
ÏÏ 
private
 
string
 
ip
 
;
 
private
ÒÒ 
string
ÒÒ 
city
ÒÒ 
;
ÒÒ 
private
ÚÚ 
string
ÚÚ 
region
ÚÚ 
;
ÚÚ 
private
ÛÛ 
string
ÛÛ 
country
ÛÛ 
;
ÛÛ 
private
ÙÙ 
const
ÙÙ 
int
ÙÙ 
MaxAttemptsPerDay
ÙÙ '
=
ÙÙ( )
$num
ÙÙ* +
;
ÙÙ+ ,
public
ˆˆ 

async
ˆˆ 
Task
ˆˆ 
<
ˆˆ 
ResponseDTO
ˆˆ !
>
ˆˆ! "
ForgotPassword
ˆˆ# 1
(
ˆˆ1 2
ForgotPasswordDTO
ˆˆ2 C
forgotPasswordDto
ˆˆD U
)
ˆˆU V
{
˜˜ 
try
¯¯ 
{
˘˘ 	
var
˚˚ 
user
˚˚ 
=
˚˚ 
await
˚˚ 
_userManager
˚˚ )
.
˚˚) *
FindByEmailAsync
˚˚* :
(
˚˚: ;
forgotPasswordDto
˚˚; L
.
˚˚L M
EmailOrPhone
˚˚M Y
)
˚˚Y Z
;
˚˚Z [
if
¸¸ 
(
¸¸ 
user
¸¸ 
==
¸¸ 
null
¸¸ 
)
¸¸ 
{
˝˝ 
user
˛˛ 
=
˛˛ 
await
˛˛ 
_userManager
˛˛ )
.
˛˛) *
Users
˛˛* /
.
˛˛/ 0!
FirstOrDefaultAsync
˛˛0 C
(
˛˛C D
u
ˇˇ 
=>
ˇˇ 
u
ˇˇ 
.
ˇˇ 
PhoneNumber
ˇˇ &
==
ˇˇ' )
forgotPasswordDto
ˇˇ* ;
.
ˇˇ; <
EmailOrPhone
ˇˇ< H
)
ˇˇH I
;
ˇˇI J
}
ÄÄ 
if
ÇÇ 
(
ÇÇ 
user
ÇÇ 
==
ÇÇ 
null
ÇÇ 
||
ÇÇ 
!
ÇÇ  !
user
ÇÇ! %
.
ÇÇ% &
EmailConfirmed
ÇÇ& 4
)
ÇÇ4 5
{
ÉÉ 
return
ÑÑ 
new
ÑÑ 
ResponseDTO
ÑÑ &
{
ÖÖ 
	IsSuccess
ÜÜ 
=
ÜÜ 
false
ÜÜ  %
,
ÜÜ% &
Message
áá 
=
áá 
$str
áá G
,
ááG H

StatusCode
àà 
=
àà  
$num
àà! $
}
ââ 
;
ââ 
}
ää 
var
çç 
email
çç 
=
çç 
user
çç 
.
çç 
Email
çç "
;
çç" #
var
éé 
now
éé 
=
éé 
DateTime
éé 
.
éé 
Now
éé "
;
éé" #
if
êê 
(
êê #
ResetPasswordAttempts
êê %
.
êê% &
TryGetValue
êê& 1
(
êê1 2
email
êê2 7
,
êê7 8
out
êê9 <
var
êê= @
attempts
êêA I
)
êêI J
)
êêJ K
{
ëë 
if
ìì 
(
ìì 
now
ìì 
-
ìì 
attempts
ìì "
.
ìì" #
LastRequest
ìì# .
>=
ìì/ 1
TimeSpan
ìì2 :
.
ìì: ;
FromSeconds
ìì; F
(
ììF G
$num
ììG H
)
ììH I
)
ììI J
{
îî #
ResetPasswordAttempts
ññ )
[
ññ) *
email
ññ* /
]
ññ/ 0
=
ññ1 2
(
ññ3 4
$num
ññ4 5
,
ññ5 6
now
ññ7 :
)
ññ: ;
;
ññ; <
}
óó 
else
òò 
if
òò 
(
òò 
attempts
òò !
.
òò! "
Count
òò" '
>=
òò( *
MaxAttemptsPerDay
òò+ <
)
òò< =
{
ôô 
await
õõ 
_emailService
õõ '
.
õõ' (
SendEmailAsync
õõ( 6
(
õõ6 7
user
õõ7 ;
.
õõ; <
Email
õõ< A
,
õõA B
$str
úú ?
,
úú? @
$"
ùù 
$str
ùù y
"
ùùy z
)
ûû 
;
ûû 
return
°° 
new
°° 
ResponseDTO
°° *
{
¢¢ 
	IsSuccess
££ !
=
££" #
false
££$ )
,
££) *
Message
§§ 
=
§§  !
$str
•• }
,
••} ~

StatusCode
¶¶ "
=
¶¶# $
$num
¶¶% (
}
ßß 
;
ßß 
}
®® 
else
©© 
{
™™ #
ResetPasswordAttempts
¨¨ )
[
¨¨) *
email
¨¨* /
]
¨¨/ 0
=
¨¨1 2
(
¨¨3 4
attempts
¨¨4 <
.
¨¨< =
Count
¨¨= B
+
¨¨C D
$num
¨¨E F
,
¨¨F G
now
¨¨H K
)
¨¨K L
;
¨¨L M
}
≠≠ 
}
ÆÆ 
else
ØØ 
{
∞∞ #
ResetPasswordAttempts
≤≤ %
.
≤≤% &
AddOrUpdate
≤≤& 1
(
≤≤1 2
email
≤≤2 7
,
≤≤7 8
(
≤≤9 :
$num
≤≤: ;
,
≤≤; <
now
≤≤= @
)
≤≤@ A
,
≤≤A B
(
≤≤C D
key
≤≤D G
,
≤≤G H
old
≤≤I L
)
≤≤L M
=>
≤≤N P
(
≤≤Q R
old
≤≤R U
.
≤≤U V
Count
≤≤V [
+
≤≤\ ]
$num
≤≤^ _
,
≤≤_ `
now
≤≤a d
)
≤≤d e
)
≤≤e f
;
≤≤f g
}
≥≥ 
var
∂∂ 
token
∂∂ 
=
∂∂ 
await
∂∂ 
_userManager
∂∂ *
.
∂∂* +-
GeneratePasswordResetTokenAsync
∂∂+ J
(
∂∂J K
user
∂∂K O
)
∂∂O P
;
∂∂P Q
var
∫∫ 
	resetLink
∫∫ 
=
∫∫ 
$"
∫∫ 
$str
∫∫ A
{
∫∫A B
token
∫∫B G
}
∫∫G H
$str
∫∫H O
{
∫∫O P
user
∫∫P T
.
∫∫T U
Email
∫∫U Z
}
∫∫Z [
"
∫∫[ \
;
∫∫\ ]
var
ΩΩ 
currentDate
ΩΩ 
=
ΩΩ 
DateTime
ΩΩ &
.
ΩΩ& '
Now
ΩΩ' *
.
ΩΩ* +
ToString
ΩΩ+ 3
(
ΩΩ3 4
$str
ΩΩ4 B
)
ΩΩB C
;
ΩΩC D
var
øø 
	userAgent
øø 
=
øø "
_httpContextAccessor
øø 0
.
øø0 1
HttpContext
øø1 <
?
øø< =
.
øø= >
Request
øø> E
.
øøE F
Headers
øøF M
[
øøM N
$str
øøN Z
]
øøZ [
;
øø[ \
var
¬¬ 
operatingSystem
¬¬ 
=
¬¬  !)
GetUserAgentOperatingSystem
¬¬" =
(
¬¬= >
	userAgent
¬¬> G
)
¬¬G H
;
¬¬H I
var
≈≈ 
browser
≈≈ 
=
≈≈ !
GetUserAgentBrowser
≈≈ -
(
≈≈- .
	userAgent
≈≈. 7
)
≈≈7 8
;
≈≈8 9
var
»» 
url
»» 
=
»» 
$str
»» Q
;
»»Q R
using
…… 
(
…… 

HttpClient
…… 
client
…… $
=
……% &
new
……' *

HttpClient
……+ 5
(
……5 6
)
……6 7
)
……7 8
{
   !
HttpResponseMessage
ÀÀ #
response
ÀÀ$ ,
=
ÀÀ- .
await
ÀÀ/ 4
client
ÀÀ5 ;
.
ÀÀ; <
GetAsync
ÀÀ< D
(
ÀÀD E
url
ÀÀE H
)
ÀÀH I
;
ÀÀI J
if
ÃÃ 
(
ÃÃ 
response
ÃÃ 
.
ÃÃ !
IsSuccessStatusCode
ÃÃ 0
)
ÃÃ0 1
{
ÕÕ 
string
ŒŒ 
jsonContent
ŒŒ &
=
ŒŒ' (
await
ŒŒ) .
response
ŒŒ/ 7
.
ŒŒ7 8
Content
ŒŒ8 ?
.
ŒŒ? @
ReadAsStringAsync
ŒŒ@ Q
(
ŒŒQ R
)
ŒŒR S
;
ŒŒS T
JObject
œœ 
data
œœ  
=
œœ! "
JObject
œœ# *
.
œœ* +
Parse
œœ+ 0
(
œœ0 1
jsonContent
œœ1 <
)
œœ< =
;
œœ= >
this
—— 
.
—— 
ip
—— 
=
—— 
data
—— "
[
——" #
$str
——# '
]
——' (
.
——( )
ToString
——) 1
(
——1 2
)
——2 3
;
——3 4
this
““ 
.
““ 
city
““ 
=
““ 
data
““  $
[
““$ %
$str
““% +
]
““+ ,
.
““, -
ToString
““- 5
(
““5 6
)
““6 7
;
““7 8
this
”” 
.
”” 
region
”” 
=
””  !
data
””" &
[
””& '
$str
””' /
]
””/ 0
.
””0 1
ToString
””1 9
(
””9 :
)
””: ;
;
””; <
this
‘‘ 
.
‘‘ 
country
‘‘  
=
‘‘! "
data
‘‘# '
[
‘‘' (
$str
‘‘( 1
]
‘‘1 2
.
‘‘2 3
ToString
‘‘3 ;
(
‘‘; <
)
‘‘< =
;
‘‘= >
}
’’ 
else
÷÷ 
{
◊◊ 
return
ÿÿ 
new
ÿÿ 
ResponseDTO
ÿÿ *
{
ŸŸ 
	IsSuccess
⁄⁄ !
=
⁄⁄" #
false
⁄⁄$ )
,
⁄⁄) *
Message
€€ 
=
€€  !
$str
€€" C
,
€€C D

StatusCode
‹‹ "
=
‹‹# $
$num
‹‹% (
}
›› 
;
›› 
}
ﬁﬁ 
}
ﬂﬂ 
await
‚‚ 
_emailService
‚‚ 
.
‚‚  !
SendEmailResetAsync
‚‚  3
(
‚‚3 4
user
‚‚4 8
.
‚‚8 9
Email
‚‚9 >
,
‚‚> ?
$str
‚‚@ h
,
‚‚h i
user
‚‚j n
,
‚‚n o
currentDate
„„ 
,
„„ 
	resetLink
„„ &
,
„„& '
operatingSystem
„„( 7
,
„„7 8
browser
„„9 @
,
„„@ A
ip
„„B D
,
„„D E
region
„„F L
,
„„L M
city
„„N R
,
„„R S
country
„„T [
)
„„[ \
;
„„\ ]
string
ÊÊ )
GetUserAgentOperatingSystem
ÊÊ .
(
ÊÊ. /
string
ÊÊ/ 5
	userAgent
ÊÊ6 ?
)
ÊÊ? @
{
ÁÁ 
if
ÍÍ 
(
ÍÍ 
	userAgent
ÍÍ 
.
ÍÍ 
Contains
ÍÍ &
(
ÍÍ& '
$str
ÍÍ' 0
)
ÍÍ0 1
)
ÍÍ1 2
return
ÍÍ3 9
$str
ÍÍ: C
;
ÍÍC D
else
ÎÎ 
if
ÎÎ 
(
ÎÎ 
	userAgent
ÎÎ "
.
ÎÎ" #
Contains
ÎÎ# +
(
ÎÎ+ ,
$str
ÎÎ, 1
)
ÎÎ1 2
)
ÎÎ2 3
return
ÎÎ4 :
$str
ÎÎ; B
;
ÎÎB C
else
ÏÏ 
if
ÏÏ 
(
ÏÏ 
	userAgent
ÏÏ "
.
ÏÏ" #
Contains
ÏÏ# +
(
ÏÏ+ ,
$str
ÏÏ, 3
)
ÏÏ3 4
)
ÏÏ4 5
return
ÏÏ6 <
$str
ÏÏ= D
;
ÏÏD E
else
ÌÌ 
return
ÌÌ 
$str
ÌÌ %
;
ÌÌ% &
}
ÓÓ 
string
 !
GetUserAgentBrowser
 &
(
& '
string
' -
	userAgent
. 7
)
7 8
{
ÒÒ 
if
ÙÙ 
(
ÙÙ 
	userAgent
ÙÙ 
.
ÙÙ 
Contains
ÙÙ &
(
ÙÙ& '
$str
ÙÙ' /
)
ÙÙ/ 0
)
ÙÙ0 1
return
ÙÙ2 8
$str
ÙÙ9 A
;
ÙÙA B
else
ıı 
if
ıı 
(
ıı 
	userAgent
ıı "
.
ıı" #
Contains
ıı# +
(
ıı+ ,
$str
ıı, 5
)
ıı5 6
)
ıı6 7
return
ıı8 >
$str
ıı? H
;
ııH I
else
ˆˆ 
if
ˆˆ 
(
ˆˆ 
	userAgent
ˆˆ "
.
ˆˆ" #
Contains
ˆˆ# +
(
ˆˆ+ ,
$str
ˆˆ, 4
)
ˆˆ4 5
)
ˆˆ5 6
return
ˆˆ7 =
$str
ˆˆ> F
;
ˆˆF G
else
˜˜ 
return
˜˜ 
$str
˜˜ %
;
˜˜% &
}
¯¯ 
return
˙˙ 
new
˙˙ 
ResponseDTO
˙˙ "
{
˚˚ 
	IsSuccess
¸¸ 
=
¸¸ 
true
¸¸  
,
¸¸  !
Message
˝˝ 
=
˝˝ 
$str
˝˝ P
,
˝˝P Q

StatusCode
˛˛ 
=
˛˛ 
$num
˛˛  
}
ˇˇ 
;
ˇˇ 
}
ÄÄ 	
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
return
ÉÉ 
new
ÉÉ 
ResponseDTO
ÉÉ "
{
ÑÑ 
	IsSuccess
ÖÖ 
=
ÖÖ 
false
ÖÖ !
,
ÖÖ! "
Message
ÜÜ 
=
ÜÜ 
e
ÜÜ 
.
ÜÜ 
Message
ÜÜ #
,
ÜÜ# $

StatusCode
áá 
=
áá 
$num
áá  
}
àà 
;
àà 
}
ââ 	
}
ää 
public
çç 

async
çç 
Task
çç 
<
çç 
ResponseDTO
çç !
>
çç! "
ResetPassword
çç# 0
(
çç0 1
string
çç1 7
email
çç8 =
,
çç= >
string
çç? E
token
ççF K
,
ççK L
string
ççM S
password
ççT \
)
çç\ ]
{
éé 
try
èè 
{
êê 	
var
íí 
user
íí 
=
íí 
await
íí 
_userManager
íí )
.
íí) *
FindByEmailAsync
íí* :
(
íí: ;
email
íí; @
)
íí@ A
;
ííA B
if
ìì 
(
ìì 
user
ìì 
==
ìì 
null
ìì 
)
ìì 
{
îî 
return
ïï 
new
ïï 
ResponseDTO
ïï &
{
ññ 
	IsSuccess
óó 
=
óó 
false
óó  %
,
óó% &
Message
òò 
=
òò 
$str
òò /
,
òò/ 0

StatusCode
ôô 
=
ôô  
$num
ôô! $
}
öö 
;
öö 
}
õõ 
if
ûû 
(
ûû 
await
ûû 
_userManager
ûû "
.
ûû" # 
CheckPasswordAsync
ûû# 5
(
ûû5 6
user
ûû6 :
,
ûû: ;
password
ûû< D
)
ûûD E
)
ûûE F
{
üü 
return
†† 
new
†† 
ResponseDTO
†† &
{
°° 
	IsSuccess
¢¢ 
=
¢¢ 
false
¢¢  %
,
¢¢% &
Message
££ 
=
££ 
$str
££ T
,
££T U

StatusCode
§§ 
=
§§  
$num
§§! $
}
•• 
;
•• 
}
¶¶ 
var
©© 
result
©© 
=
©© 
await
©© 
_userManager
©© +
.
©©+ , 
ResetPasswordAsync
©©, >
(
©©> ?
user
©©? C
,
©©C D
token
©©E J
,
©©J K
password
©©L T
)
©©T U
;
©©U V
if
™™ 
(
™™ 
result
™™ 
.
™™ 
	Succeeded
™™  
)
™™  !
{
´´ 
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ &
{
≠≠ 
	IsSuccess
ÆÆ 
=
ÆÆ 
true
ÆÆ  $
,
ÆÆ$ %
Message
ØØ 
=
ØØ 
$str
ØØ <
,
ØØ< =

StatusCode
∞∞ 
=
∞∞  
$num
∞∞! $
}
±± 
;
±± 
}
≤≤ 
else
≥≥ 
{
¥¥ 
StringBuilder
∂∂ 
errors
∂∂ $
=
∂∂% &
new
∂∂' *
StringBuilder
∂∂+ 8
(
∂∂8 9
)
∂∂9 :
;
∂∂: ;
foreach
∑∑ 
(
∑∑ 
var
∑∑ 
error
∑∑ "
in
∑∑# %
result
∑∑& ,
.
∑∑, -
Errors
∑∑- 3
)
∑∑3 4
{
∏∏ 
errors
ππ 
.
ππ 

AppendLine
ππ %
(
ππ% &
error
ππ& +
.
ππ+ ,
Description
ππ, 7
)
ππ7 8
;
ππ8 9
}
∫∫ 
return
ºº 
new
ºº 
ResponseDTO
ºº &
{
ΩΩ 
	IsSuccess
ææ 
=
ææ 
false
ææ  %
,
ææ% &
Message
øø 
=
øø 
errors
øø $
.
øø$ %
ToString
øø% -
(
øø- .
)
øø. /
,
øø/ 0

StatusCode
¿¿ 
=
¿¿  
$num
¿¿! $
}
¡¡ 
;
¡¡ 
}
¬¬ 
}
√√ 	
catch
ƒƒ 
(
ƒƒ 
	Exception
ƒƒ 
e
ƒƒ 
)
ƒƒ 
{
≈≈ 	
return
∆∆ 
new
∆∆ 
ResponseDTO
∆∆ "
{
«« 
	IsSuccess
»» 
=
»» 
false
»» !
,
»»! "
Message
…… 
=
…… 
e
…… 
.
…… 
Message
…… #
,
……# $

StatusCode
   
=
   
$num
    
}
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
}
ÕÕ 
public
–– 

async
–– 
Task
–– 
<
–– 
ResponseDTO
–– !
>
––! "
ChangePassword
––# 1
(
––1 2
string
––2 8
userId
––9 ?
,
––? @
string
––A G
oldPassword
––H S
,
––S T
string
––U [
newPassword
––\ g
,
––g h
string
——  
confirmNewPassword
—— !
)
——! "
{
““ 
try
”” 
{
‘‘ 	
var
÷÷ 
user
÷÷ 
=
÷÷ 
await
÷÷ 
_userManager
÷÷ )
.
÷÷) *
FindByIdAsync
÷÷* 7
(
÷÷7 8
userId
÷÷8 >
)
÷÷> ?
;
÷÷? @
if
◊◊ 
(
◊◊ 
user
◊◊ 
==
◊◊ 
null
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
new
ŸŸ 
ResponseDTO
ŸŸ &
{
ŸŸ' (
	IsSuccess
ŸŸ) 2
=
ŸŸ3 4
false
ŸŸ5 :
,
ŸŸ: ;
Message
ŸŸ< C
=
ŸŸD E
$str
ŸŸF W
}
ŸŸX Y
;
ŸŸY Z
}
⁄⁄ 
if
ﬂﬂ 
(
ﬂﬂ 
newPassword
ﬂﬂ 
!=
ﬂﬂ  
confirmNewPassword
ﬂﬂ 1
)
ﬂﬂ1 2
{
‡‡ 
return
·· 
new
·· 
ResponseDTO
·· &
{
‚‚ 
	IsSuccess
‚‚ 
=
‚‚  !
false
‚‚" '
,
‚‚' (
Message
‚‚) 0
=
‚‚1 2
$str
‚‚3 e
}
‚‚f g
;
‚‚g h
}
„„ 
if
ÊÊ 
(
ÊÊ 
newPassword
ÊÊ 
==
ÊÊ 
oldPassword
ÊÊ *
)
ÊÊ* +
{
ÁÁ 
return
ËË 
new
ËË 
ResponseDTO
ËË &
{
ÈÈ 
	IsSuccess
ÈÈ 
=
ÈÈ  !
false
ÈÈ" '
,
ÈÈ' (
Message
ÈÈ) 0
=
ÈÈ1 2
$str
ÈÈ3 i
}
ÈÈj k
;
ÈÈk l
}
ÍÍ 
var
ÌÌ 
result
ÌÌ 
=
ÌÌ 
await
ÌÌ 
_userManager
ÌÌ +
.
ÌÌ+ ,!
ChangePasswordAsync
ÌÌ, ?
(
ÌÌ? @
user
ÌÌ@ D
,
ÌÌD E
oldPassword
ÌÌF Q
,
ÌÌQ R
newPassword
ÌÌS ^
)
ÌÌ^ _
;
ÌÌ_ `
if
ÓÓ 
(
ÓÓ 
result
ÓÓ 
.
ÓÓ 
	Succeeded
ÓÓ  
)
ÓÓ  !
{
ÔÔ 
return
 
new
 
ResponseDTO
 &
{
' (
	IsSuccess
) 2
=
3 4
true
5 9
,
9 :
Message
; B
=
C D
$str
E e
}
f g
;
g h
}
ÒÒ 
else
ÚÚ 
{
ÛÛ 
return
ÙÙ 
new
ÙÙ 
ResponseDTO
ÙÙ &
{
ıı 
	IsSuccess
ˆˆ 
=
ˆˆ 
false
ˆˆ  %
,
ˆˆ% &
Message
˜˜ 
=
˜˜ 
$str
˜˜ b
}
¯¯ 
;
¯¯ 
}
˘˘ 
}
˙˙ 	
catch
˚˚ 
(
˚˚ 
	Exception
˚˚ 
e
˚˚ 
)
˚˚ 
{
¸¸ 	
return
˝˝ 
new
˝˝ 
ResponseDTO
˝˝ "
{
˝˝# $
	IsSuccess
˝˝% .
=
˝˝/ 0
false
˝˝1 6
,
˝˝6 7
Message
˝˝8 ?
=
˝˝@ A
e
˝˝B C
.
˝˝C D
Message
˝˝D K
}
˝˝L M
;
˝˝M N
}
˛˛ 	
}
ˇˇ 
public
ÜÜ 

async
ÜÜ 
Task
ÜÜ 
<
ÜÜ 
ResponseDTO
ÜÜ !
>
ÜÜ! "
SendVerifyEmail
ÜÜ# 2
(
ÜÜ2 3
string
ÜÜ3 9
email
ÜÜ: ?
,
ÜÜ? @
string
ÜÜA G
confirmationLink
ÜÜH X
)
ÜÜX Y
{
áá 
try
àà 
{
ââ 	
await
ää 
_emailService
ää 
.
ää  
SendVerifyEmail
ää  /
(
ää/ 0
email
ää0 5
,
ää5 6
confirmationLink
ää7 G
)
ääG H
;
ääH I
return
ãã 
new
ãã 
(
ãã 
)
ãã 
{
åå 
Message
çç 
=
çç 
$str
çç :
,
çç: ;
	IsSuccess
éé 
=
éé 
true
éé  
,
éé  !

StatusCode
èè 
=
èè 
$num
èè  
,
èè  !
Result
êê 
=
êê 
null
êê 
}
ëë 
;
ëë 
}
íí 	
catch
ìì 
(
ìì 
	Exception
ìì 
e
ìì 
)
ìì 
{
îî 	
return
ïï 
new
ïï 
(
ïï 
)
ïï 
{
ññ 
Message
óó 
=
óó 
e
óó 
.
óó 
Message
óó #
,
óó# $
	IsSuccess
òò 
=
òò 
false
òò !
,
òò! "

StatusCode
ôô 
=
ôô 
$num
ôô  
,
ôô  !
Result
öö 
=
öö 
null
öö 
}
õõ 
;
õõ 
}
úú 	
}
ùù 
public
•• 

async
•• 
Task
•• 
<
•• 
ResponseDTO
•• !
>
••! "
VerifyEmail
••# .
(
••. /
string
••/ 5
userId
••6 <
,
••< =
string
••> D
token
••E J
)
••J K
{
¶¶ 
var
ßß 
user
ßß 
=
ßß 
await
ßß 
_userManager
ßß %
.
ßß% &
FindByIdAsync
ßß& 3
(
ßß3 4
userId
ßß4 :
)
ßß: ;
;
ßß; <
if
©© 

(
©© 
user
©© 
.
©© 
EmailConfirmed
©© 
)
©©  
{
™™ 	
return
´´ 
new
´´ 
ResponseDTO
´´ "
(
´´" #
)
´´# $
{
¨¨ 
Message
≠≠ 
=
≠≠ 
$str
≠≠ :
,
≠≠: ;
	IsSuccess
ÆÆ 
=
ÆÆ 
true
ÆÆ  
,
ÆÆ  !

StatusCode
ØØ 
=
ØØ 
$num
ØØ  
,
ØØ  !
Result
∞∞ 
=
∞∞ 
null
∞∞ 
}
±± 
;
±± 
}
≤≤ 	
var
¥¥ 
confirmResult
¥¥ 
=
¥¥ 
await
¥¥ !
_userManager
¥¥" .
.
¥¥. /
ConfirmEmailAsync
¥¥/ @
(
¥¥@ A
user
¥¥A E
,
¥¥E F
token
¥¥G L
)
¥¥L M
;
¥¥M N
if
∂∂ 

(
∂∂ 
!
∂∂ 
confirmResult
∂∂ 
.
∂∂ 
	Succeeded
∂∂ $
)
∂∂$ %
{
∑∑ 	
return
∏∏ 
new
∏∏ 
(
∏∏ 
)
∏∏ 
{
ππ 
Message
∫∫ 
=
∫∫ 
confirmResult
∫∫ '
.
∫∫' (
Errors
∫∫( .
.
∫∫. /
ToString
∫∫/ 7
(
∫∫7 8
)
∫∫8 9
,
∫∫9 :

StatusCode
ªª 
=
ªª 
$num
ªª  
,
ªª  !
	IsSuccess
ºº 
=
ºº 
false
ºº !
,
ºº! "
Result
ΩΩ 
=
ΩΩ 
null
ΩΩ 
}
ææ 
;
ææ 
}
øø 	
return
¡¡ 
new
¡¡ 
(
¡¡ 
)
¡¡ 
{
¬¬ 	
Message
√√ 
=
√√ 
$str
√√ 2
,
√√2 3
	IsSuccess
ƒƒ 
=
ƒƒ 
true
ƒƒ 
,
ƒƒ 

StatusCode
≈≈ 
=
≈≈ 
$num
≈≈ 
,
≈≈ 
Result
∆∆ 
=
∆∆ 
null
∆∆ 
}
«« 	
;
««	 

}
»» 
public
œœ 

async
œœ 
Task
œœ 
<
œœ 
ResponseDTO
œœ !
>
œœ! "
CheckEmailExist
œœ# 2
(
œœ2 3
string
œœ3 9
email
œœ: ?
)
œœ? @
{
–– 
try
—— 
{
““ 	
var
”” 
user
”” 
=
”” 
await
”” 
_userManager
”” )
.
””) *
FindByEmailAsync
””* :
(
””: ;
email
””; @
)
””@ A
;
””A B
return
‘‘ 
new
‘‘ 
(
‘‘ 
)
‘‘ 
{
’’ 
Result
÷÷ 
=
÷÷ 
user
÷÷ 
is
÷÷  
not
÷÷! $
null
÷÷% )
,
÷÷) *
Message
◊◊ 
=
◊◊ 
user
◊◊ 
is
◊◊ !
null
◊◊" &
?
◊◊' (
$str
◊◊) ?
:
◊◊@ A
$str
◊◊B T
,
◊◊T U
	IsSuccess
ÿÿ 
=
ÿÿ 
true
ÿÿ  
,
ÿÿ  !

StatusCode
ŸŸ 
=
ŸŸ 
$num
ŸŸ  
}
⁄⁄ 
;
⁄⁄ 
}
€€ 	
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
e
‹‹ 
)
‹‹ 
{
›› 	
return
ﬁﬁ 
new
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
{
ﬂﬂ 
Message
‡‡ 
=
‡‡ 
e
‡‡ 
.
‡‡ 
Message
‡‡ #
,
‡‡# $
	IsSuccess
·· 
=
·· 
false
·· !
,
··! "

StatusCode
‚‚ 
=
‚‚ 
$num
‚‚  
,
‚‚  !
Result
„„ 
=
„„ 
null
„„ 
}
‰‰ 
;
‰‰ 
}
ÂÂ 	
}
ÊÊ 
public
ÌÌ 

async
ÌÌ 
Task
ÌÌ 
<
ÌÌ 
ResponseDTO
ÌÌ !
>
ÌÌ! "#
CheckPhoneNumberExist
ÌÌ# 8
(
ÌÌ8 9
string
ÌÌ9 ?
phoneNumber
ÌÌ@ K
)
ÌÌK L
{
ÓÓ 
try
ÔÔ 
{
 	
var
ÒÒ 
user
ÒÒ 
=
ÒÒ 
await
ÒÒ 
_userManager
ÒÒ )
.
ÒÒ) *
Users
ÒÒ* /
.
ÒÒ/ 0!
FirstOrDefaultAsync
ÒÒ0 C
(
ÒÒC D
x
ÒÒD E
=>
ÒÒF H
x
ÒÒI J
.
ÒÒJ K
PhoneNumber
ÒÒK V
==
ÒÒW Y
phoneNumber
ÒÒZ e
)
ÒÒe f
;
ÒÒf g
return
ÚÚ 
new
ÚÚ 
(
ÚÚ 
)
ÚÚ 
{
ÛÛ 
Result
ÙÙ 
=
ÙÙ 
user
ÙÙ 
is
ÙÙ  
not
ÙÙ! $
null
ÙÙ% )
,
ÙÙ) *
Message
ıı 
=
ıı 
user
ıı 
is
ıı !
null
ıı" &
?
ıı' (
$str
ıı) G
:
ııH I
$str
ııJ d
,
ııd e
	IsSuccess
ˆˆ 
=
ˆˆ 
true
ˆˆ  
,
ˆˆ  !

StatusCode
˜˜ 
=
˜˜ 
$num
˜˜  
}
¯¯ 
;
¯¯ 
}
˘˘ 	
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
e
˙˙ 
)
˙˙ 
{
˚˚ 	
return
¸¸ 
new
¸¸ 
(
¸¸ 
)
¸¸ 
{
˝˝ 
Message
˛˛ 
=
˛˛ 
e
˛˛ 
.
˛˛ 
Message
˛˛ #
,
˛˛# $
Result
ˇˇ 
=
ˇˇ 
null
ˇˇ 
,
ˇˇ 
	IsSuccess
Ä	Ä	 
=
Ä	Ä	 
false
Ä	Ä	 !
,
Ä	Ä	! "

StatusCode
Å	Å	 
=
Å	Å	 
$num
Å	Å	  
}
Ç	Ç	 
;
Ç	Ç	 
}
É	É	 	
}
Ñ	Ñ	 
public
ç	ç	 

async
ç	ç	 
Task
ç	ç	 
<
ç	ç	 
ResponseDTO
ç	ç	 !
>
ç	ç	! "$
CompleteStudentProfile
ç	ç	# 9
(
ç	ç	9 :
ClaimsPrincipal
é	é	 
User
é	é	 
,
é	é	 '
CompleteStudentProfileDTO
è	è	 !
studentProfileDto
è	è	" 3
)
è	è	3 4
{
ê	ê	 
try
ë	ë	 
{
í	í	 	
var
î	î	 
userId
î	î	 
=
î	î	 
User
î	î	 
.
î	î	 
Claims
î	î	 $
.
î	î	$ %
FirstOrDefault
î	î	% 3
(
î	î	3 4
x
î	î	4 5
=>
î	î	6 8
x
î	î	9 :
.
î	î	: ;
Type
î	î	; ?
==
î	î	@ B

ClaimTypes
î	î	C M
.
î	î	M N
NameIdentifier
î	î	N \
)
î	î	\ ]
?
î	î	] ^
.
î	î	^ _
Value
î	î	_ d
;
î	î	d e
var
ï	ï	 
user
ï	ï	 
=
ï	ï	 
await
ï	ï	 
_userManager
ï	ï	 )
.
ï	ï	) *
FindByIdAsync
ï	ï	* 7
(
ï	ï	7 8
userId
ï	ï	8 >
)
ï	ï	> ?
;
ï	ï	? @
if
ò	ò	 
(
ò	ò	 
user
ò	ò	 
is
ò	ò	 
null
ò	ò	 
)
ò	ò	 
{
ô	ô	 
return
ö	ö	 
new
ö	ö	 
ResponseDTO
ö	ö	 &
(
ö	ö	& '
)
ö	ö	' (
{
õ	õ	 
Message
ú	ú	 
=
ú	ú	 
$str
ú	ú	 4
,
ú	ú	4 5
	IsSuccess
ù	ù	 
=
ù	ù	 
false
ù	ù	  %
,
ù	ù	% &

StatusCode
û	û	 
=
û	û	  
$num
û	û	! $
,
û	û	$ %
Result
ü	ü	 
=
ü	ü	 
studentProfileDto
ü	ü	 .
,
ü	ü	. /
}
†	†	 
;
†	†	 
}
°	°	 
var
§	§	 
isPhonenumerExit
§	§	  
=
§	§	! "
await
•	•	 
_userManager
•	•	 "
.
•	•	" #
Users
•	•	# (
.
•	•	( )
AnyAsync
•	•	) 1
(
•	•	1 2
u
¶	¶	 
=>
¶	¶	 
u
¶	¶	 
.
¶	¶	 
PhoneNumber
¶	¶	 &
==
¶	¶	' )
studentProfileDto
¶	¶	* ;
.
¶	¶	; <
PhoneNumber
¶	¶	< G
&&
¶	¶	H J
u
¶	¶	K L
.
¶	¶	L M
Id
¶	¶	M O
!=
¶	¶	P R
user
¶	¶	S W
.
¶	¶	W X
Id
¶	¶	X Z
)
¶	¶	Z [
;
¶	¶	[ \
if
ß	ß	 
(
ß	ß	 
isPhonenumerExit
ß	ß	  
)
ß	ß	  !
{
®	®	 
return
©	©	 
new
©	©	 
ResponseDTO
©	©	 &
(
©	©	& '
)
©	©	' (
{
™	™	 
Message
´	´	 
=
´	´	 
$str
´	´	 E
,
´	´	E F
Result
¨	¨	 
=
¨	¨	 
studentProfileDto
¨	¨	 .
,
¨	¨	. /
	IsSuccess
≠	≠	 
=
≠	≠	 
false
≠	≠	  %
,
≠	≠	% &

StatusCode
Æ	Æ	 
=
Æ	Æ	  
$num
Æ	Æ	! $
}
Ø	Ø	 
;
Ø	Ø	 
}
∞	∞	 
var
≥	≥	 
isCardExist
≥	≥	 
=
≥	≥	 
await
¥	¥	 
_unitOfWork
¥	¥	 !
.
¥	¥	! "#
PaymentCardRepository
¥	¥	" 7
.
¥	¥	7 8
GetAsync
¥	¥	8 @
(
¥	¥	@ A
x
¥	¥	A B
=>
¥	¥	C E
x
µ	µ	 
.
µ	µ	 

CardNumber
µ	µ	  
==
µ	µ	! #
studentProfileDto
µ	µ	$ 5
.
µ	µ	5 6

CardNumber
µ	µ	6 @
&&
µ	µ	A C
x
µ	µ	D E
.
µ	µ	E F
UserId
µ	µ	F L
!=
µ	µ	M O
user
µ	µ	P T
.
µ	µ	T U
Id
µ	µ	U W
)
µ	µ	W X
;
µ	µ	X Y
if
∂	∂	 
(
∂	∂	 
isCardExist
∂	∂	 
is
∂	∂	 
not
∂	∂	 "
null
∂	∂	# '
)
∂	∂	' (
{
∑	∑	 
return
∏	∏	 
new
∏	∏	 
ResponseDTO
∏	∏	 &
(
∏	∏	& '
)
∏	∏	' (
{
π	π	 
Message
∫	∫	 
=
∫	∫	 
$str
∫	∫	 D
,
∫	∫	D E

StatusCode
ª	ª	 
=
ª	ª	  
$num
ª	ª	! $
,
ª	ª	$ %
Result
º	º	 
=
º	º	 
studentProfileDto
º	º	 .
,
º	º	. /
	IsSuccess
Ω	Ω	 
=
Ω	Ω	 
false
Ω	Ω	  %
}
æ	æ	 
;
æ	æ	 
}
ø	ø	 
user
¡	¡	 
.
¡	¡	 
	BirthDate
¡	¡	 
=
¡	¡	 
studentProfileDto
¡	¡	 .
.
¡	¡	. /
	BirthDate
¡	¡	/ 8
;
¡	¡	8 9
user
¬	¬	 
.
¬	¬	 
PhoneNumber
¬	¬	 
=
¬	¬	 
studentProfileDto
¬	¬	 0
.
¬	¬	0 1
PhoneNumber
¬	¬	1 <
;
¬	¬	< =
user
√	√	 
.
√	√	 
Address
√	√	 
=
√	√	 
studentProfileDto
√	√	 ,
.
√	√	, -
Address
√	√	- 4
;
√	√	4 5
user
ƒ	ƒ	 
.
ƒ	ƒ	 
Country
ƒ	ƒ	 
=
ƒ	ƒ	 
studentProfileDto
ƒ	ƒ	 ,
.
ƒ	ƒ	, -
Country
ƒ	ƒ	- 4
;
ƒ	ƒ	4 5
user
≈	≈	 
.
≈	≈	 
Gender
≈	≈	 
=
≈	≈	 
studentProfileDto
≈	≈	 +
.
≈	≈	+ ,
Gender
≈	≈	, 2
;
≈	≈	2 3
var
«	«	 
student
«	«	 
=
«	«	 
await
«	«	 
_unitOfWork
«	«	  +
.
«	«	+ ,
StudentRepository
«	«	, =
.
«	«	= >
GetAsync
«	«	> F
(
«	«	F G
x
«	«	G H
=>
«	«	I K
x
«	«	L M
.
«	«	M N
UserId
«	«	N T
==
«	«	U W
userId
«	«	X ^
)
«	«	^ _
;
«	«	_ `
if
»	»	 
(
»	»	 
student
»	»	 
is
»	»	 
null
»	»	 
)
»	»	  
{
…	…	 
student
 	 	 
=
 	 	 
new
 	 	 
Student
 	 	 %
(
 	 	% &
)
 	 	& '
{
À	À	 
UserId
Ã	Ã	 
=
Ã	Ã	 
user
Ã	Ã	 !
.
Ã	Ã	! "
Id
Ã	Ã	" $
,
Ã	Ã	$ %

University
Õ	Õ	 
=
Õ	Õ	  
studentProfileDto
Õ	Õ	! 2
.
Õ	Õ	2 3

University
Õ	Õ	3 =
}
Œ	Œ	 
;
Œ	Œ	 
await
œ	œ	 
_unitOfWork
œ	œ	 !
.
œ	œ	! "
StudentRepository
œ	œ	" 3
.
œ	œ	3 4
AddAsync
œ	œ	4 <
(
œ	œ	< =
student
œ	œ	= D
)
œ	œ	D E
;
œ	œ	E F
}
–	–	 
else
—	—	 
{
“	“	 
student
”	”	 
.
”	”	 

University
”	”	 "
=
”	”	# $
studentProfileDto
”	”	% 6
.
”	”	6 7

University
”	”	7 A
;
”	”	A B
}
‘	‘	 
var
÷	÷	 
paymentCard
÷	÷	 
=
÷	÷	 
await
◊	◊	 
_unitOfWork
◊	◊	 !
.
◊	◊	! "#
PaymentCardRepository
◊	◊	" 7
.
◊	◊	7 8
GetAsync
◊	◊	8 @
(
◊	◊	@ A
x
◊	◊	A B
=>
◊	◊	C E
x
ÿ	ÿ	 
.
ÿ	ÿ	 

CardNumber
ÿ	ÿ	  
==
ÿ	ÿ	! #
studentProfileDto
ÿ	ÿ	$ 5
.
ÿ	ÿ	5 6

CardNumber
ÿ	ÿ	6 @
&&
ÿ	ÿ	A C
x
ÿ	ÿ	D E
.
ÿ	ÿ	E F
UserId
ÿ	ÿ	F L
==
ÿ	ÿ	M O
user
ÿ	ÿ	P T
.
ÿ	ÿ	T U
Id
ÿ	ÿ	U W
)
ÿ	ÿ	W X
;
ÿ	ÿ	X Y
if
Ÿ	Ÿ	 
(
Ÿ	Ÿ	 
paymentCard
Ÿ	Ÿ	 
is
Ÿ	Ÿ	 
null
Ÿ	Ÿ	 #
)
Ÿ	Ÿ	# $
{
⁄	⁄	 
paymentCard
€	€	 
=
€	€	 
new
€	€	 !
PaymentCard
€	€	" -
(
€	€	- .
)
€	€	. /
{
‹	‹	 
CardName
›	›	 
=
›	›	 
studentProfileDto
›	›	 0
.
›	›	0 1
CardName
›	›	1 9
,
›	›	9 :

CardNumber
ﬁ	ﬁ	 
=
ﬁ	ﬁ	  
studentProfileDto
ﬁ	ﬁ	! 2
.
ﬁ	ﬁ	2 3

CardNumber
ﬁ	ﬁ	3 =
,
ﬁ	ﬁ	= >
CardProvider
ﬂ	ﬂ	  
=
ﬂ	ﬂ	! "
studentProfileDto
ﬂ	ﬂ	# 4
.
ﬂ	ﬂ	4 5
CardProvider
ﬂ	ﬂ	5 A
,
ﬂ	ﬂ	A B
UserId
‡	‡	 
=
‡	‡	 
user
‡	‡	 !
.
‡	‡	! "
Id
‡	‡	" $
}
·	·	 
;
·	·	 
await
‚	‚	 
_unitOfWork
‚	‚	 !
.
‚	‚	! "#
PaymentCardRepository
‚	‚	" 7
.
‚	‚	7 8
AddAsync
‚	‚	8 @
(
‚	‚	@ A
paymentCard
‚	‚	A L
)
‚	‚	L M
;
‚	‚	M N
}
„	„	 
var
Â	Â	 
isRoleExist
Â	Â	 
=
Â	Â	 
await
Â	Â	 #
_roleManager
Â	Â	$ 0
.
Â	Â	0 1
RoleExistsAsync
Â	Â	1 @
(
Â	Â	@ A
StaticUserRoles
Â	Â	A P
.
Â	Â	P Q
Student
Â	Â	Q X
)
Â	Â	X Y
;
Â	Â	Y Z
if
Ë	Ë	 
(
Ë	Ë	 
isRoleExist
Ë	Ë	 
is
Ë	Ë	 
false
Ë	Ë	 $
)
Ë	Ë	$ %
{
È	È	 
await
Í	Í	 
_roleManager
Í	Í	 "
.
Í	Í	" #
CreateAsync
Í	Í	# .
(
Í	Í	. /
new
Í	Í	/ 2
IdentityRole
Í	Í	3 ?
(
Í	Í	? @
StaticUserRoles
Í	Í	@ O
.
Í	Í	O P
Student
Í	Í	P W
)
Í	Í	W X
)
Í	Í	X Y
;
Í	Í	Y Z
}
Î	Î	 
await
Ó	Ó	 
_userManager
Ó	Ó	 
.
Ó	Ó	 
AddToRoleAsync
Ó	Ó	 -
(
Ó	Ó	- .
user
Ó	Ó	. 2
,
Ó	Ó	2 3
StaticUserRoles
Ó	Ó	4 C
.
Ó	Ó	C D
Student
Ó	Ó	D K
)
Ó	Ó	K L
;
Ó	Ó	L M
await
		 
_unitOfWork
		 
.
		 
	SaveAsync
		 '
(
		' (
)
		( )
;
		) *
return
Ú	Ú	 
new
Ú	Ú	 
ResponseDTO
Ú	Ú	 "
(
Ú	Ú	" #
)
Ú	Ú	# $
{
Û	Û	 
Message
Ù	Ù	 
=
Ù	Ù	 
$str
Ù	Ù	 ?
,
Ù	Ù	? @
	IsSuccess
ı	ı	 
=
ı	ı	 
true
ı	ı	  
,
ı	ı	  !

StatusCode
ˆ	ˆ	 
=
ˆ	ˆ	 
$num
ˆ	ˆ	  
,
ˆ	ˆ	  !
Result
˜	˜	 
=
˜	˜	 
studentProfileDto
˜	˜	 *
}
¯	¯	 
;
¯	¯	 
}
˘	˘	 	
catch
˙	˙	 
(
˙	˙	 
	Exception
˙	˙	 
e
˙	˙	 
)
˙	˙	 
{
˚	˚	 	
return
¸	¸	 
new
¸	¸	 
ResponseDTO
¸	¸	 "
(
¸	¸	" #
)
¸	¸	# $
{
˝	˝	 
Message
˛	˛	 
=
˛	˛	 
e
˛	˛	 
.
˛	˛	 
Message
˛	˛	 #
,
˛	˛	# $
	IsSuccess
ˇ	ˇ	 
=
ˇ	ˇ	 
false
ˇ	ˇ	 !
,
ˇ	ˇ	! "

StatusCode
Ä
Ä
 
=
Ä
Ä
 
$num
Ä
Ä
  
,
Ä
Ä
  !
Result
Å
Å
 
=
Å
Å
 
null
Å
Å
 
}
Ç
Ç
 
;
Ç
Ç
 
}
É
É
 	
}
Ñ
Ñ
 
public
ç
ç
 

async
ç
ç
 
Task
ç
ç
 
<
ç
ç
 
ResponseDTO
ç
ç
 !
>
ç
ç
! "'
CompleteInstructorProfile
ç
ç
# <
(
ç
ç
< =
ClaimsPrincipal
é
é
 
User
é
é
 
,
é
é
 *
CompleteInstructorProfileDTO
è
è
 $"
instructorProfileDto
è
è
% 9
)
è
è
9 :
{
ê
ê
 
try
ë
ë
 
{
í
í
 	
var
î
î
 
userId
î
î
 
=
î
î
 
User
î
î
 
.
î
î
 
Claims
î
î
 $
.
î
î
$ %
FirstOrDefault
î
î
% 3
(
î
î
3 4
x
î
î
4 5
=>
î
î
6 8
x
î
î
9 :
.
î
î
: ;
Type
î
î
; ?
==
î
î
@ B

ClaimTypes
î
î
C M
.
î
î
M N
NameIdentifier
î
î
N \
)
î
î
\ ]
?
î
î
] ^
.
î
î
^ _
Value
î
î
_ d
;
î
î
d e
var
ï
ï
 
user
ï
ï
 
=
ï
ï
 
await
ï
ï
 
_userManager
ï
ï
 )
.
ï
ï
) *
FindByIdAsync
ï
ï
* 7
(
ï
ï
7 8
userId
ï
ï
8 >
)
ï
ï
> ?
;
ï
ï
? @
if
ò
ò
 
(
ò
ò
 
user
ò
ò
 
is
ò
ò
 
null
ò
ò
 
)
ò
ò
 
{
ô
ô
 
return
ö
ö
 
new
ö
ö
 
ResponseDTO
ö
ö
 &
(
ö
ö
& '
)
ö
ö
' (
{
õ
õ
 
Message
ú
ú
 
=
ú
ú
 
$str
ú
ú
 4
,
ú
ú
4 5
	IsSuccess
ù
ù
 
=
ù
ù
 
false
ù
ù
  %
,
ù
ù
% &

StatusCode
û
û
 
=
û
û
  
$num
û
û
! $
,
û
û
$ %
Result
ü
ü
 
=
ü
ü
 "
instructorProfileDto
ü
ü
 1
,
ü
ü
1 2
}
†
†
 
;
†
†
 
}
°
°
 
var
§
§
 
isPhonenumerExit
§
§
  
=
§
§
! "
await
•
•
 
_userManager
•
•
 "
.
•
•
" #
Users
•
•
# (
.
•
•
( )
AnyAsync
•
•
) 1
(
•
•
1 2
u
¶
¶
 
=>
¶
¶
 
u
¶
¶
 
.
¶
¶
 
PhoneNumber
¶
¶
 &
==
¶
¶
' )"
instructorProfileDto
¶
¶
* >
.
¶
¶
> ?
PhoneNumber
¶
¶
? J
&&
¶
¶
K M
u
¶
¶
N O
.
¶
¶
O P
Id
¶
¶
P R
!=
¶
¶
S U
user
¶
¶
V Z
.
¶
¶
Z [
Id
¶
¶
[ ]
)
¶
¶
] ^
;
¶
¶
^ _
if
ß
ß
 
(
ß
ß
 
isPhonenumerExit
ß
ß
  
)
ß
ß
  !
{
®
®
 
return
©
©
 
new
©
©
 
ResponseDTO
©
©
 &
(
©
©
& '
)
©
©
' (
{
™
™
 
Message
´
´
 
=
´
´
 
$str
´
´
 E
,
´
´
E F
Result
¨
¨
 
=
¨
¨
 "
instructorProfileDto
¨
¨
 1
,
¨
¨
1 2
	IsSuccess
≠
≠
 
=
≠
≠
 
false
≠
≠
  %
,
≠
≠
% &

StatusCode
Æ
Æ
 
=
Æ
Æ
  
$num
Æ
Æ
! $
}
Ø
Ø
 
;
Ø
Ø
 
}
∞
∞
 
var
≥
≥
 
isCardExist
≥
≥
 
=
≥
≥
 
await
¥
¥
 
_unitOfWork
¥
¥
 !
.
¥
¥
! "#
PaymentCardRepository
¥
¥
" 7
.
¥
¥
7 8
GetAsync
¥
¥
8 @
(
¥
¥
@ A
x
¥
¥
A B
=>
¥
¥
C E
x
µ
µ
 
.
µ
µ
 

CardNumber
µ
µ
  
==
µ
µ
! #"
instructorProfileDto
µ
µ
$ 8
.
µ
µ
8 9

CardNumber
µ
µ
9 C
&&
µ
µ
D F
x
µ
µ
G H
.
µ
µ
H I
UserId
µ
µ
I O
!=
µ
µ
P R
user
µ
µ
S W
.
µ
µ
W X
Id
µ
µ
X Z
)
µ
µ
Z [
;
µ
µ
[ \
if
∂
∂
 
(
∂
∂
 
isCardExist
∂
∂
 
is
∂
∂
 
not
∂
∂
 "
null
∂
∂
# '
)
∂
∂
' (
{
∑
∑
 
return
∏
∏
 
new
∏
∏
 
ResponseDTO
∏
∏
 &
(
∏
∏
& '
)
∏
∏
' (
{
π
π
 
Message
∫
∫
 
=
∫
∫
 
$str
∫
∫
 D
,
∫
∫
D E

StatusCode
ª
ª
 
=
ª
ª
  
$num
ª
ª
! $
,
ª
ª
$ %
Result
º
º
 
=
º
º
 "
instructorProfileDto
º
º
 1
,
º
º
1 2
	IsSuccess
Ω
Ω
 
=
Ω
Ω
 
false
Ω
Ω
  %
}
æ
æ
 
;
æ
æ
 
}
ø
ø
 
user
¡
¡
 
.
¡
¡
 
	BirthDate
¡
¡
 
=
¡
¡
 "
instructorProfileDto
¡
¡
 1
.
¡
¡
1 2
	BirthDate
¡
¡
2 ;
;
¡
¡
; <
user
¬
¬
 
.
¬
¬
 
PhoneNumber
¬
¬
 
=
¬
¬
 "
instructorProfileDto
¬
¬
 3
.
¬
¬
3 4
PhoneNumber
¬
¬
4 ?
;
¬
¬
? @
user
√
√
 
.
√
√
 
Address
√
√
 
=
√
√
 "
instructorProfileDto
√
√
 /
.
√
√
/ 0
Address
√
√
0 7
;
√
√
7 8
user
ƒ
ƒ
 
.
ƒ
ƒ
 
Country
ƒ
ƒ
 
=
ƒ
ƒ
 "
instructorProfileDto
ƒ
ƒ
 /
.
ƒ
ƒ
/ 0
Country
ƒ
ƒ
0 7
;
ƒ
ƒ
7 8
user
≈
≈
 
.
≈
≈
 
Gender
≈
≈
 
=
≈
≈
 "
instructorProfileDto
≈
≈
 .
.
≈
≈
. /
Gender
≈
≈
/ 5
;
≈
≈
5 6
user
∆
∆
 
.
∆
∆
 
	TaxNumber
∆
∆
 
=
∆
∆
 "
instructorProfileDto
∆
∆
 1
.
∆
∆
1 2
	TaxNumber
∆
∆
2 ;
;
∆
∆
; <
user
«
«
 
.
«
«
 

UpdateTime
«
«
 
=
«
«
 
DateTime
«
«
 &
.
«
«
& '
Now
«
«
' *
;
«
«
* +
var
 
 
 

instructor
 
 
 
=
 
 
 
await
 
 
 "
_unitOfWork
 
 
# .
.
 
 
. /"
InstructorRepository
 
 
/ C
.
 
 
C D
GetAsync
 
 
D L
(
 
 
L M
x
 
 
M N
=>
 
 
O Q
x
 
 
R S
.
 
 
S T
UserId
 
 
T Z
==
 
 
[ ]
userId
 
 
^ d
)
 
 
d e
;
 
 
e f
if
À
À
 
(
À
À
 

instructor
À
À
 
is
À
À
 
null
À
À
 "
)
À
À
" #
{
Ã
Ã
 

instructor
Õ
Õ
 
=
Õ
Õ
 
new
Õ
Õ
  

Instructor
Õ
Õ
! +
(
Õ
Õ
+ ,
)
Õ
Õ
, -
{
Œ
Œ
 
UserId
œ
œ
 
=
œ
œ
 
user
œ
œ
 !
.
œ
œ
! "
Id
œ
œ
" $
,
œ
œ
$ %
Introduction
–
–
  
=
–
–
! ""
instructorProfileDto
–
–
# 7
.
–
–
7 8
Introduction
–
–
8 D
,
–
–
D E
Degree
—
—
 
=
—
—
 "
instructorProfileDto
—
—
 1
.
—
—
1 2
Degree
—
—
2 8
,
—
—
8 9
Industry
“
“
 
=
“
“
 "
instructorProfileDto
“
“
 3
.
“
“
3 4
Industry
“
“
4 <
}
”
”
 
;
”
”
 
await
‘
‘
 
_unitOfWork
‘
‘
 !
.
‘
‘
! ""
InstructorRepository
‘
‘
" 6
.
‘
‘
6 7
AddAsync
‘
‘
7 ?
(
‘
‘
? @

instructor
‘
‘
@ J
)
‘
‘
J K
;
‘
‘
K L
}
’
’
 
else
÷
÷
 
{
◊
◊
 

instructor
ÿ
ÿ
 
.
ÿ
ÿ
 
Introduction
ÿ
ÿ
 '
=
ÿ
ÿ
( )"
instructorProfileDto
ÿ
ÿ
* >
.
ÿ
ÿ
> ?
Introduction
ÿ
ÿ
? K
;
ÿ
ÿ
K L

instructor
Ÿ
Ÿ
 
.
Ÿ
Ÿ
 
Industry
Ÿ
Ÿ
 #
=
Ÿ
Ÿ
$ %"
instructorProfileDto
Ÿ
Ÿ
& :
.
Ÿ
Ÿ
: ;
Industry
Ÿ
Ÿ
; C
;
Ÿ
Ÿ
C D
}
⁄
⁄
 
var
‹
‹
 
paymentCard
‹
‹
 
=
‹
‹
 
await
›
›
 
_unitOfWork
›
›
 !
.
›
›
! "#
PaymentCardRepository
›
›
" 7
.
›
›
7 8
GetAsync
›
›
8 @
(
›
›
@ A
x
›
›
A B
=>
›
›
C E
x
ﬁ
ﬁ
 
.
ﬁ
ﬁ
 

CardNumber
ﬁ
ﬁ
  
==
ﬁ
ﬁ
! #"
instructorProfileDto
ﬁ
ﬁ
$ 8
.
ﬁ
ﬁ
8 9

CardNumber
ﬁ
ﬁ
9 C
&&
ﬁ
ﬁ
D F
x
ﬁ
ﬁ
G H
.
ﬁ
ﬁ
H I
UserId
ﬁ
ﬁ
I O
==
ﬁ
ﬁ
P R
user
ﬁ
ﬁ
S W
.
ﬁ
ﬁ
W X
Id
ﬁ
ﬁ
X Z
)
ﬁ
ﬁ
Z [
;
ﬁ
ﬁ
[ \
if
ﬂ
ﬂ
 
(
ﬂ
ﬂ
 
paymentCard
ﬂ
ﬂ
 
is
ﬂ
ﬂ
 
null
ﬂ
ﬂ
 #
)
ﬂ
ﬂ
# $
{
‡
‡
 
paymentCard
·
·
 
=
·
·
 
new
·
·
 !
PaymentCard
·
·
" -
(
·
·
- .
)
·
·
. /
{
‚
‚
 
CardName
„
„
 
=
„
„
 "
instructorProfileDto
„
„
 3
.
„
„
3 4
CardName
„
„
4 <
,
„
„
< =

CardNumber
‰
‰
 
=
‰
‰
  "
instructorProfileDto
‰
‰
! 5
.
‰
‰
5 6

CardNumber
‰
‰
6 @
,
‰
‰
@ A
CardProvider
Â
Â
  
=
Â
Â
! ""
instructorProfileDto
Â
Â
# 7
.
Â
Â
7 8
CardProvider
Â
Â
8 D
,
Â
Â
D E
UserId
Ê
Ê
 
=
Ê
Ê
 
user
Ê
Ê
 !
.
Ê
Ê
! "
Id
Ê
Ê
" $
}
Á
Á
 
;
Á
Á
 
await
Ë
Ë
 
_unitOfWork
Ë
Ë
 !
.
Ë
Ë
! "#
PaymentCardRepository
Ë
Ë
" 7
.
Ë
Ë
7 8
AddAsync
Ë
Ë
8 @
(
Ë
Ë
@ A
paymentCard
Ë
Ë
A L
)
Ë
Ë
L M
;
Ë
Ë
M N
}
È
È
 
var
Î
Î
 
isRoleExist
Î
Î
 
=
Î
Î
 
await
Î
Î
 #
_roleManager
Î
Î
$ 0
.
Î
Î
0 1
RoleExistsAsync
Î
Î
1 @
(
Î
Î
@ A
StaticUserRoles
Î
Î
A P
.
Î
Î
P Q

Instructor
Î
Î
Q [
)
Î
Î
[ \
;
Î
Î
\ ]
if
Ó
Ó
 
(
Ó
Ó
 
isRoleExist
Ó
Ó
 
is
Ó
Ó
 
false
Ó
Ó
 $
)
Ó
Ó
$ %
{
Ô
Ô
 
await


 
_roleManager


 "
.


" #
CreateAsync


# .
(


. /
new


/ 2
IdentityRole


3 ?
(


? @
StaticUserRoles


@ O
.


O P

Instructor


P Z
)


Z [
)


[ \
;


\ ]
}
Ò
Ò
 
await
Ù
Ù
 
_userManager
Ù
Ù
 
.
Ù
Ù
 
AddToRoleAsync
Ù
Ù
 -
(
Ù
Ù
- .
user
Ù
Ù
. 2
,
Ù
Ù
2 3
StaticUserRoles
Ù
Ù
4 C
.
Ù
Ù
C D

Instructor
Ù
Ù
D N
)
Ù
Ù
N O
;
Ù
Ù
O P
await
ˆ
ˆ
 
_unitOfWork
ˆ
ˆ
 
.
ˆ
ˆ
 
	SaveAsync
ˆ
ˆ
 '
(
ˆ
ˆ
' (
)
ˆ
ˆ
( )
;
ˆ
ˆ
) *
return
¯
¯
 
new
¯
¯
 
ResponseDTO
¯
¯
 "
(
¯
¯
" #
)
¯
¯
# $
{
˘
˘
 
Message
˙
˙
 
=
˙
˙
 
$str
˙
˙
 ?
,
˙
˙
? @
	IsSuccess
˚
˚
 
=
˚
˚
 
true
˚
˚
  
,
˚
˚
  !

StatusCode
¸
¸
 
=
¸
¸
 
$num
¸
¸
  
,
¸
¸
  !
Result
˝
˝
 
=
˝
˝
 "
instructorProfileDto
˝
˝
 -
}
˛
˛
 
;
˛
˛
 
}
ˇ
ˇ
 	
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 	
return
ÇÇ 
new
ÇÇ 
ResponseDTO
ÇÇ "
(
ÇÇ" #
)
ÇÇ# $
{
ÉÉ 
Message
ÑÑ 
=
ÑÑ 
e
ÑÑ 
.
ÑÑ 
Message
ÑÑ #
,
ÑÑ# $
	IsSuccess
ÖÖ 
=
ÖÖ 
false
ÖÖ !
,
ÖÖ! "

StatusCode
ÜÜ 
=
ÜÜ 
$num
ÜÜ  
,
ÜÜ  !
Result
áá 
=
áá 
null
áá 
}
àà 
;
àà 
}
ââ 	
}
ää 
public
åå 

async
åå 
Task
åå 
<
åå 
ResponseDTO
åå !
>
åå! "
GetUserInfo
åå# .
(
åå. /
ClaimsPrincipal
åå/ >
User
åå? C
)
ååC D
{
çç 
try
èè 
{
êê 	
var
ëë 
userId
ëë 
=
ëë 
User
ëë 
.
ëë 
Claims
ëë $
.
ëë$ %
FirstOrDefault
ëë% 3
(
ëë3 4
x
ëë4 5
=>
ëë6 8
x
ëë9 :
.
ëë: ;
Type
ëë; ?
==
ëë@ B

ClaimTypes
ëëC M
.
ëëM N
NameIdentifier
ëëN \
)
ëë\ ]
?
ëë] ^
.
ëë^ _
Value
ëë_ d
;
ëëd e
var
íí 
user
íí 
=
íí 
await
íí 
_userManager
íí )
.
íí) *
FindByIdAsync
íí* 7
(
íí7 8
userId
íí8 >
)
íí> ?
;
íí? @
if
ïï 
(
ïï 
user
ïï 
is
ïï 
null
ïï 
)
ïï 
{
ññ 
return
óó 
new
óó 
ResponseDTO
óó &
(
óó& '
)
óó' (
{
òò 
Message
ôô 
=
ôô 
$str
ôô 4
,
ôô4 5
	IsSuccess
öö 
=
öö 
false
öö  %
,
öö% &

StatusCode
õõ 
=
õõ  
$num
õõ! $
,
õõ$ %
Result
úú 
=
úú 
null
úú !
,
úú! "
}
ùù 
;
ùù 
}
ûû 
var
†† 
userInfo
†† 
=
†† 
_mapper
†† "
.
††" #
Map
††# &
<
††& '
UserInfoDTO
††' 2
>
††2 3
(
††3 4
user
††4 8
)
††8 9
;
††9 :
var
°° 
roles
°° 
=
°° 
await
°° 
_userManager
°° *
.
°°* +
GetRolesAsync
°°+ 8
(
°°8 9
user
°°9 =
)
°°= >
;
°°> ?
userInfo
¢¢ 
.
¢¢ 
Roles
¢¢ 
=
¢¢ 
roles
¢¢ "
;
¢¢" #
userInfo
££ 
.
££ 

isAccepted
££ 
=
££  !
true
££" &
;
££& '
if
•• 
(
•• 
roles
•• 
.
•• 
Contains
•• 
(
•• 
StaticUserRoles
•• .
.
••. /

Instructor
••/ 9
)
••9 :
)
••: ;
{
¶¶ 
var
ßß 

instructor
ßß 
=
ßß  
await
ßß! &
_unitOfWork
ßß' 2
.
ßß2 3"
InstructorRepository
ßß3 G
.
ßßG H
GetAsync
ßßH P
(
ßßP Q
x
ßßQ R
=>
ßßS U
x
ßßV W
.
ßßW X
UserId
ßßX ^
==
ßß_ a
user
ßßb f
.
ßßf g
Id
ßßg i
)
ßßi j
;
ßßj k
userInfo
®® 
.
®® 
isUploadDegree
®® '
=
®®( )

instructor
®®* 4
.
®®4 5
DegreeImageUrl
®®5 C
!=
®®D F
null
®®G K
?
®®L M
true
®®N R
:
®®S T
false
®®U Z
;
®®Z [
userInfo
©© 
.
©© 

isAccepted
©© #
=
©©$ %

instructor
©©& 0
.
©©0 1

IsAccepted
©©1 ;
;
©©; <
}
™™ 
return
¨¨ 
new
¨¨ 
ResponseDTO
¨¨ "
(
¨¨" #
)
¨¨# $
{
≠≠ 
Message
ÆÆ 
=
ÆÆ 
$str
ÆÆ 6
,
ÆÆ6 7
	IsSuccess
ØØ 
=
ØØ 
true
ØØ  
,
ØØ  !

StatusCode
∞∞ 
=
∞∞ 
$num
∞∞  
,
∞∞  !
Result
±± 
=
±± 
userInfo
±± !
,
±±! "
}
≤≤ 
;
≤≤ 
}
≥≥ 	
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
e
¥¥ 
)
¥¥ 
{
µµ 	
return
∂∂ 
new
∂∂ 
ResponseDTO
∂∂ "
(
∂∂" #
)
∂∂# $
{
∑∑ 
Message
∏∏ 
=
∏∏ 
$str
∏∏ 0
,
∏∏0 1
	IsSuccess
ππ 
=
ππ 
false
ππ !
,
ππ! "

StatusCode
∫∫ 
=
∫∫ 
$num
∫∫  
,
∫∫  !
Result
ªª 
=
ªª 
null
ªª 
,
ªª 
}
ºº 
;
ºº 
}
ΩΩ 	
}
ææ 
public
¿¿ 

async
¿¿ 
Task
¿¿ 
<
¿¿ 
MemoryStream
¿¿ "
>
¿¿" #
DisplayUserAvatar
¿¿$ 5
(
¿¿5 6
string
¿¿6 <
userId
¿¿= C
)
¿¿C D
{
¡¡ 
try
¬¬ 
{
√√ 	
var
ƒƒ 
user
ƒƒ 
=
ƒƒ 
await
ƒƒ 
_userManager
ƒƒ )
.
ƒƒ) *
FindByIdAsync
ƒƒ* 7
(
ƒƒ7 8
userId
ƒƒ8 >
)
ƒƒ> ?
;
ƒƒ? @
var
∆∆ 
stream
∆∆ 
=
∆∆ 
await
∆∆ 
_firebaseService
∆∆ /
.
∆∆/ 0
GetImage
∆∆0 8
(
∆∆8 9
user
∆∆9 =
.
∆∆= >
	AvatarUrl
∆∆> G
)
∆∆G H
;
∆∆H I
return
»» 
stream
»» 
;
»» 
}
…… 	
catch
   
(
   
	Exception
   
e
   
)
   
{
ÀÀ 	
return
ÃÃ 
null
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
}
ŒŒ 
public
–– 

async
–– 
Task
–– 
<
–– 
DegreeResponseDTO
–– '
>
––' (%
DisplayInstructorDegree
––) @
(
––@ A
string
––A G
userId
––H N
)
––N O
{
—— 
try
““ 
{
”” 	
if
‘‘ 
(
‘‘ 
userId
‘‘ 
is
‘‘ 
null
‘‘ 
)
‘‘ 
{
’’ 
throw
÷÷ 
new
÷÷ 
	Exception
÷÷ #
(
÷÷# $
$str
÷÷$ ;
)
÷÷; <
;
÷÷< =
}
◊◊ 
var
ŸŸ 

instructor
ŸŸ 
=
ŸŸ 
await
ŸŸ "
_unitOfWork
ŸŸ# .
.
ŸŸ. /"
InstructorRepository
ŸŸ/ C
.
ŸŸC D
GetAsync
ŸŸD L
(
ŸŸL M
x
ŸŸM N
=>
ŸŸO Q
x
ŸŸR S
.
ŸŸS T
UserId
ŸŸT Z
==
ŸŸ[ ]
userId
ŸŸ^ d
)
ŸŸd e
;
ŸŸe f
if
€€ 
(
€€ 

instructor
€€ 
is
€€ 
null
€€ "
)
€€" #
{
‹‹ 
throw
›› 
new
›› 
	Exception
›› #
(
››# $
$str
››$ @
)
››@ A
;
››A B
}
ﬁﬁ 
var
‡‡ 

degreePath
‡‡ 
=
‡‡ 

instructor
‡‡ '
?
‡‡' (
.
‡‡( )
DegreeImageUrl
‡‡) 7
;
‡‡7 8
if
·· 
(
·· 

degreePath
·· 
.
·· 
IsNullOrEmpty
·· (
(
··( )
)
··) *
)
··* +
{
‚‚ 
throw
„„ 
new
„„ 
	Exception
„„ #
(
„„# $
$str
„„$ H
)
„„H I
;
„„I J
}
‰‰ 
var
ÊÊ 
stream
ÊÊ 
=
ÊÊ 
await
ÊÊ 
_firebaseService
ÊÊ /
.
ÊÊ/ 0
GetImage
ÊÊ0 8
(
ÊÊ8 9

instructor
ÊÊ9 C
.
ÊÊC D
DegreeImageUrl
ÊÊD R
)
ÊÊR S
;
ÊÊS T
if
ËË 
(
ËË 
stream
ËË 
is
ËË 
null
ËË 
)
ËË 
{
ÈÈ 
throw
ÍÍ 
new
ÍÍ 
	Exception
ÍÍ #
(
ÍÍ# $
$str
ÍÍ$ F
)
ÍÍF G
;
ÍÍG H
}
ÎÎ 
var
ÌÌ 
contentType
ÌÌ 
=
ÌÌ 
$str
ÌÌ 7
;
ÌÌ7 8
if
ÔÔ 
(
ÔÔ 

degreePath
ÔÔ 
.
ÔÔ 
EndsWith
ÔÔ #
(
ÔÔ# $
$str
ÔÔ$ *
)
ÔÔ* +
)
ÔÔ+ ,
{
 
contentType
ÒÒ 
=
ÒÒ "
StaticFileExtensions
ÒÒ 2
.
ÒÒ2 3
Pdf
ÒÒ3 6
;
ÒÒ6 7
}
ÚÚ 
if
ÙÙ 
(
ÙÙ 

degreePath
ÙÙ 
.
ÙÙ 
EndsWith
ÙÙ #
(
ÙÙ# $
$str
ÙÙ$ *
)
ÙÙ* +
)
ÙÙ+ ,
{
ıı 
contentType
ˆˆ 
=
ˆˆ "
StaticFileExtensions
ˆˆ 2
.
ˆˆ2 3
Png
ˆˆ3 6
;
ˆˆ6 7
}
˜˜ 
if
˘˘ 
(
˘˘ 

degreePath
˘˘ 
.
˘˘ 
EndsWith
˘˘ #
(
˘˘# $
$str
˘˘$ *
)
˘˘* +
||
˘˘, .

degreePath
˘˘/ 9
.
˘˘9 :
EndsWith
˘˘: B
(
˘˘B C
$str
˘˘C J
)
˘˘J K
)
˘˘K L
{
˙˙ 
contentType
˚˚ 
=
˚˚ "
StaticFileExtensions
˚˚ 2
.
˚˚2 3
Jpeg
˚˚3 7
;
˚˚7 8
}
¸¸ 
return
˛˛ 
new
˛˛ 
DegreeResponseDTO
˛˛ (
(
˛˛( )
)
˛˛) *
{
ˇˇ 
Message
ÄÄ 
=
ÄÄ 
$str
ÄÄ 1
,
ÄÄ1 2
Stream
ÅÅ 
=
ÅÅ 
stream
ÅÅ 
,
ÅÅ  
ContentType
ÇÇ 
=
ÇÇ 
contentType
ÇÇ )
,
ÇÇ) *
FileName
ÉÉ 
=
ÉÉ 
Path
ÉÉ 
.
ÉÉ  
GetFileName
ÉÉ  +
(
ÉÉ+ ,

degreePath
ÉÉ, 6
)
ÉÉ6 7
}
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
e
ÜÜ 
)
ÜÜ 
{
áá 	
return
àà 
new
àà 
DegreeResponseDTO
àà (
(
àà( )
)
àà) *
{
ââ 
ContentType
ää 
=
ää 
null
ää "
,
ää" #
Message
ãã 
=
ãã 
e
ãã 
.
ãã 
Message
ãã #
,
ãã# $
Stream
åå 
=
åå 
null
åå 
}
çç 
;
çç 
}
éé 	
}
èè 
public
ññ 

async
ññ 
Task
ññ 
<
ññ 
ResponseDTO
ññ !
>
ññ! "
SignInByGoogle
ññ# 1
(
ññ1 2
SignInByGoogleDTO
ññ2 C
signInByGoogleDto
ññD U
)
ññU V
{
óó 
try
òò 
{
ôô 	
FirebaseToken
õõ 
googleTokenS
õõ &
=
õõ' (
await
úú 
FirebaseAuth
úú "
.
úú" #
DefaultInstance
úú# 2
.
úú2 3 
VerifyIdTokenAsync
úú3 E
(
úúE F
signInByGoogleDto
úúF W
.
úúW X
Token
úúX ]
)
úú] ^
;
úú^ _
string
ùù 
userId
ùù 
=
ùù 
googleTokenS
ùù (
.
ùù( )
Uid
ùù) ,
;
ùù, -
string
ûû 
email
ûû 
=
ûû 
googleTokenS
ûû '
.
ûû' (
Claims
ûû( .
[
ûû. /
$str
ûû/ 6
]
ûû6 7
.
ûû7 8
ToString
ûû8 @
(
ûû@ A
)
ûûA B
;
ûûB C
string
üü 
name
üü 
=
üü 
googleTokenS
üü &
.
üü& '
Claims
üü' -
[
üü- .
$str
üü. 4
]
üü4 5
.
üü5 6
ToString
üü6 >
(
üü> ?
)
üü? @
;
üü@ A
string
†† 
	avatarUrl
†† 
=
†† 
googleTokenS
†† +
.
††+ ,
Claims
††, 2
[
††2 3
$str
††3 <
]
††< =
.
††= >
ToString
††> F
(
††F G
)
††G H
;
††H I
var
££ 
user
££ 
=
££ 
await
££ 
_userManager
££ )
.
££) *
FindByEmailAsync
££* :
(
££: ;
email
££; @
)
££@ A
;
££A B
UserLoginInfo
§§ 
?
§§ 
userLoginInfo
§§ (
=
§§) *
null
§§+ /
;
§§/ 0
if
•• 
(
•• 
user
•• 
is
•• 
not
•• 
null
••  
)
••  !
{
¶¶ 
userLoginInfo
ßß 
=
ßß 
_userManager
ßß  ,
.
ßß, -
GetLoginsAsync
ßß- ;
(
ßß; <
user
ßß< @
)
ßß@ A
.
ßßA B

GetAwaiter
ßßB L
(
ßßL M
)
ßßM N
.
ßßN O
	GetResult
ßßO X
(
ßßX Y
)
ßßY Z
.
®® 
FirstOrDefault
®® #
(
®®# $
x
®®$ %
=>
®®& (
x
®®) *
.
®®* +
LoginProvider
®®+ 8
==
®®9 ;!
StaticLoginProvider
®®< O
.
®®O P
Google
®®P V
)
®®V W
;
®®W X
}
©© 
if
´´ 
(
´´ 
user
´´ 
is
´´ 
not
´´ 
null
´´  
&&
´´! #
userLoginInfo
´´$ 1
is
´´2 4
null
´´5 9
)
´´9 :
{
¨¨ 
return
≠≠ 
new
≠≠ 
ResponseDTO
≠≠ &
(
≠≠& '
)
≠≠' (
{
ÆÆ 
Result
ØØ 
=
ØØ 
new
ØØ  
SignResponseDTO
ØØ! 0
(
ØØ0 1
)
ØØ1 2
{
∞∞ 
RefreshToken
±± $
=
±±% &
null
±±' +
,
±±+ ,
AccessToken
≤≤ #
=
≤≤$ %
null
≤≤& *
,
≤≤* +
}
≥≥ 
,
≥≥ 
Message
¥¥ 
=
¥¥ 
$str
¥¥ B
,
¥¥B C
	IsSuccess
µµ 
=
µµ 
false
µµ  %
,
µµ% &

StatusCode
∂∂ 
=
∂∂  
$num
∂∂! $
}
∑∑ 
;
∑∑ 
}
∏∏ 
if
∫∫ 
(
∫∫ 
userLoginInfo
∫∫ 
is
∫∫  
null
∫∫! %
&&
∫∫& (
user
∫∫) -
is
∫∫. 0
null
∫∫1 5
)
∫∫5 6
{
ªª 
user
ΩΩ 
=
ΩΩ 
new
ΩΩ 
ApplicationUser
ΩΩ *
{
ææ 
Email
øø 
=
øø 
email
øø !
,
øø! "
FullName
¿¿ 
=
¿¿ 
name
¿¿ #
,
¿¿# $
UserName
¡¡ 
=
¡¡ 
email
¡¡ $
,
¡¡$ %
	AvatarUrl
¬¬ 
=
¬¬ 
	avatarUrl
¬¬  )
,
¬¬) *
EmailConfirmed
√√ "
=
√√# $
true
√√% )
,
√√) *

UpdateTime
ƒƒ 
=
ƒƒ  
null
ƒƒ! %
}
≈≈ 
;
≈≈ 
await
«« 
_userManager
«« "
.
««" #
CreateAsync
««# .
(
««. /
user
««/ 3
)
««3 4
;
««4 5
await
»» 
_userManager
»» "
.
»»" #
AddLoginAsync
»»# 0
(
»»0 1
user
»»1 5
,
»»5 6
new
…… 
UserLoginInfo
…… %
(
……% &!
StaticLoginProvider
……& 9
.
……9 :
Google
……: @
,
……@ A
userId
……B H
,
……H I
$str
……J R
)
……R S
)
……S T
;
……T U
}
   
var
ÃÃ 
accessToken
ÃÃ 
=
ÃÃ 
await
ÃÃ #
_tokenService
ÃÃ$ 1
.
ÃÃ1 2)
GenerateJwtAccessTokenAsync
ÃÃ2 M
(
ÃÃM N
user
ÃÃN R
)
ÃÃR S
;
ÃÃS T
var
ÕÕ 
refreshToken
ÕÕ 
=
ÕÕ 
await
ÕÕ $
_tokenService
ÕÕ% 2
.
ÕÕ2 3*
GenerateJwtRefreshTokenAsync
ÕÕ3 O
(
ÕÕO P
user
ÕÕP T
)
ÕÕT U
;
ÕÕU V
await
ŒŒ 
_tokenService
ŒŒ 
.
ŒŒ  
StoreRefreshToken
ŒŒ  1
(
ŒŒ1 2
user
ŒŒ2 6
.
ŒŒ6 7
Id
ŒŒ7 9
,
ŒŒ9 :
refreshToken
ŒŒ; G
)
ŒŒG H
;
ŒŒH I
return
–– 
new
–– 
ResponseDTO
–– "
(
––" #
)
––# $
{
—— 
Result
““ 
=
““ 
new
““ 
SignResponseDTO
““ ,
(
““, -
)
““- .
{
”” 
AccessToken
‘‘ 
=
‘‘  !
accessToken
‘‘" -
,
‘‘- .
RefreshToken
’’  
=
’’! "
refreshToken
’’# /
,
’’/ 0
}
÷÷ 
,
÷÷ 
Message
◊◊ 
=
◊◊ 
$str
◊◊ 0
,
◊◊0 1
	IsSuccess
ÿÿ 
=
ÿÿ 
true
ÿÿ  
,
ÿÿ  !

StatusCode
ŸŸ 
=
ŸŸ 
$num
ŸŸ  
}
⁄⁄ 
;
⁄⁄ 
}
€€ 	
catch
‹‹ 
(
‹‹ #
FirebaseAuthException
‹‹ $
e
‹‹% &
)
‹‹& '
{
›› 	
return
ﬁﬁ 
new
ﬁﬁ 
ResponseDTO
ﬁﬁ "
(
ﬁﬁ" #
)
ﬁﬁ# $
{
ﬂﬂ 
Result
‡‡ 
=
‡‡ 
new
‡‡ 
SignResponseDTO
‡‡ ,
(
‡‡, -
)
‡‡- .
{
·· 
AccessToken
‚‚ 
=
‚‚  !
null
‚‚" &
,
‚‚& '
RefreshToken
„„  
=
„„! "
null
„„# '
,
„„' (
}
‰‰ 
,
‰‰ 
Message
ÂÂ 
=
ÂÂ 
$str
ÂÂ 0
,
ÂÂ0 1
	IsSuccess
ÊÊ 
=
ÊÊ 
false
ÊÊ !
,
ÊÊ! "

StatusCode
ÁÁ 
=
ÁÁ 
$num
ÁÁ  
}
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
}ÎÎ Í©
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Mappings\AutoMapperProfile.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Mappings %
;% &
public 
class 
AutoMapperProfile 
:  
Profile! (
{		 
public

 

AutoMapperProfile

 
(

 
)

 
{ 
	CreateMap 
< 
UserInfoDTO 
, 
ApplicationUser .
>. /
(/ 0
)0 1
.1 2

ReverseMap2 <
(< =
)= >
;> ?
	CreateMap 
< 
Category 
, 
CategoryDTO '
>' (
(( )
)) *
.* +

ReverseMap+ 5
(5 6
)6 7
;7 8
	CreateMap 
< 
Category 
, 
CreateCategoryDTO -
>- .
(. /
)/ 0
.0 1

ReverseMap1 ;
(; <
)< =
;= >
	CreateMap 
< 
CreateCategoryDTO #
,# $
Category% -
>- .
(. /
)/ 0
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
Id$ &
,& '
opt( +
=> 
opt 
. 
MapFrom 
( 
src "
=># %
Guid& *
.* +
NewGuid+ 2
(2 3
)3 4
)4 5
)5 6
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
ParentId$ ,
,, -
opt. 1
=> 
opt 
. 
MapFrom 
( 
src "
=># %
src& )
.) *
ParentId* 2
!=3 5
null6 :
?; <
Guid= A
.A B
ParseB G
(G H
srcH K
.K L
ParentIdL T
)T U
:V W
(X Y
GuidY ]
?] ^
)^ _
null_ c
)c d
)d e
. 

ReverseMap 
( 
) 
; 
	CreateMap 
< 
Category 
, 
UpdateCategoryDTO -
>- .
(. /
)/ 0
.0 1

ReverseMap1 ;
(; <
)< =
;= >
	CreateMap 
< 
Category 
, 
AdminCategoryDTO ,
>, -
(- .
). /
. 
	ForMember 
( 
dest 
=> 
dest #
.# $

ParentName$ .
,. /
opt0 3
=> 
opt 
. 
MapFrom 
( 
src "
=># %
src& )
.) *
ParentCategory* 8
.8 9
Name9 =
)= >
)> ?
.? @

ReverseMap@ J
(J K
)K L
;L M
	CreateMap 
< 
EmailTemplateDTO "
," #
EmailTemplateDTO$ 4
>4 5
(5 6
)6 7
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
TemplateName$ 0
,0 1
opt2 5
=>   
opt   
.   
MapFrom   
(   
src   "
=>  # %
src  & )
.  ) *
TemplateName  * 6
)  6 7
)  7 8
.!! 
	ForMember!! 
(!! 
dest!! 
=>!! 
dest!! #
.!!# $

SenderName!!$ .
,!!. /
opt!!0 3
=>"" 
opt"" 
."" 
MapFrom"" 
("" 
src"" "
=>""# %
src""& )
."") *

SenderName""* 4
)""4 5
)""5 6
.## 
	ForMember## 
(## 
dest## 
=>## 
dest## #
.### $
SenderEmail##$ /
,##/ 0
opt##1 4
=>$$ 
opt$$ 
.$$ 
MapFrom$$ 
($$ 
src$$ "
=>$$# %
src$$& )
.$$) *
SenderEmail$$* 5
)$$5 6
)$$6 7
.%% 
	ForMember%% 
(%% 
dest%% 
=>%% 
dest%% #
.%%# $
Category%%$ ,
,%%, -
opt%%. 1
=>&& 
opt&& 
.&& 
MapFrom&& 
(&& 
src&& "
=>&&# %
src&&& )
.&&) *
Category&&* 2
)&&2 3
)&&3 4
.'' 
	ForMember'' 
('' 
dest'' 
=>'' 
dest'' #
.''# $
SubjectLine''$ /
,''/ 0
opt''1 4
=>(( 
opt(( 
.(( 
MapFrom(( 
((( 
src(( "
=>((# %
src((& )
.(() *
SubjectLine((* 5
)((5 6
)((6 7
.)) 
	ForMember)) 
()) 
dest)) 
=>)) 
dest)) #
.))# $
PreHeaderText))$ 1
,))1 2
opt))3 6
=>** 
opt** 
.** 
MapFrom** 
(** 
src** "
=>**# %
src**& )
.**) *
PreHeaderText*** 7
)**7 8
)**8 9
.++ 
	ForMember++ 
(++ 
dest++ 
=>++ 
dest++ #
.++# $
PersonalizationTags++$ 7
,++7 8
opt++9 <
=>,, 
opt,, 
.,, 
MapFrom,, 
(,, 
src,, "
=>,,# %
src,,& )
.,,) *
PersonalizationTags,,* =
),,= >
),,> ?
.-- 
	ForMember-- 
(-- 
dest-- 
=>-- 
dest-- #
.--# $
BodyContent--$ /
,--/ 0
opt--1 4
=>.. 
opt.. 
... 
MapFrom.. 
(.. 
src.. "
=>..# %
src..& )
...) *
BodyContent..* 5
)..5 6
)..6 7
.// 
	ForMember// 
(// 
dest// 
=>// 
dest// #
.//# $
FooterContent//$ 1
,//1 2
opt//3 6
=>00 
opt00 
.00 
MapFrom00 
(00 
src00 "
=>00# %
src00& )
.00) *
FooterContent00* 7
)007 8
)008 9
.11 
	ForMember11 
(11 
dest11 
=>11 
dest11 #
.11# $
CallToAction11$ 0
,110 1
opt112 5
=>22 
opt22 
.22 
MapFrom22 
(22 
src22 "
=>22# %
src22& )
.22) *
CallToAction22* 6
)226 7
)227 8
.33 
	ForMember33 
(33 
dest33 
=>33 
dest33 #
.33# $
Language33$ ,
,33, -
opt33. 1
=>44 
opt44 
.44 
MapFrom44 
(44 
src44 "
=>44# %
src44& )
.44) *
Language44* 2
)442 3
)443 4
.55 
	ForMember55 
(55 
dest55 
=>55 
dest55 #
.55# $
RecipientType55$ 1
,551 2
opt553 6
=>66 
opt66 
.66 
MapFrom66 
(66 
src66 "
=>66# %
src66& )
.66) *
RecipientType66* 7
)667 8
)668 9
.77 

ReverseMap77 
(77 
)77 
;77 
	CreateMap99 
<99 

Instructor99 
,99 !
InstructorInfoLiteDTO99 3
>993 4
(994 5
)995 6
.:: 
	ForMember:: 
(:: 
dest:: 
=>:: 
dest:: #
.::# $
FullName::$ ,
,::, -
opt::. 1
=>;; 
opt;; 
.;; 
MapFrom;; 
(;; 
src;; "
=>;;# %
src;;& )
.;;) *
ApplicationUser;;* 9
.;;9 :
FullName;;: B
);;B C
);;C D
.<< 
	ForMember<< 
(<< 
dest<< 
=><< 
dest<< #
.<<# $
Email<<$ )
,<<) *
opt<<+ .
=>== 
opt== 
.== 
MapFrom== 
(== 
src== "
=>==# %
src==& )
.==) *
ApplicationUser==* 9
.==9 :
Email==: ?
)==? @
)==@ A
.>> 
	ForMember>> 
(>> 
dest>> 
=>>> 
dest>> #
.>># $
PhoneNumber>>$ /
,>>/ 0
opt>>1 4
=>?? 
opt?? 
.?? 
MapFrom?? 
(?? 
src?? "
=>??# %
src??& )
.??) *
ApplicationUser??* 9
.??9 :
PhoneNumber??: E
)??E F
)??F G
.@@ 
	ForMember@@ 
(@@ 
dest@@ 
=>@@ 
dest@@ #
.@@# $
Gender@@$ *
,@@* +
opt@@, /
=>AA 
optAA 
.AA 
MapFromAA 
(AA 
srcAA "
=>AA# %
srcAA& )
.AA) *
ApplicationUserAA* 9
.AA9 :
GenderAA: @
)AA@ A
)AAA B
.BB 
	ForMemberBB 
(BB 
destBB 
=>BB 
destBB #
.BB# $
	BirthDateBB$ -
,BB- .
optBB/ 2
=>CC 
optCC 
.CC 
MapFromCC 
(CC 
srcCC "
=>CC# %
srcCC& )
.CC) *
ApplicationUserCC* 9
.CC9 :
	BirthDateCC: C
)CCC D
)CCD E
.DD 
	ForMemberDD 
(DD 
destDD 
=>DD 
destDD #
.DD# $

IsAcceptedDD$ .
,DD. /
optDD0 3
=>EE 
optEE 
.EE 
MapFromEE 
(EE 
srcEE "
=>EE# %
srcEE& )
.EE) *

IsAcceptedEE* 4
)EE4 5
)EE5 6
.FF 

ReverseMapFF 
(FF 
)FF 
;FF 
	CreateMapHH 
<HH 

InstructorHH 
,HH 
InstructorInfoDTOHH /
>HH/ 0
(HH0 1
)HH1 2
.II 
	ForMemberII 
(II 
destII 
=>II 
destII #
.II# $
InstructorIdII$ 0
,II0 1
optII2 5
=>JJ 
optJJ 
.JJ 
MapFromJJ 
(JJ 
srcJJ "
=>JJ# %
srcJJ& )
.JJ) *
InstructorIdJJ* 6
)JJ6 7
)JJ7 8
.KK 
	ForMemberKK 
(KK 
destKK 
=>KK 
destKK #
.KK# $
UserIdKK$ *
,KK* +
optKK, /
=>LL 
optLL 
.LL 
MapFromLL 
(LL 
srcLL "
=>LL# %
srcLL& )
.LL) *
UserIdLL* 0
)LL0 1
)LL1 2
.MM 
	ForMemberMM 
(MM 
destMM 
=>MM 
destMM #
.MM# $
FullNameMM$ ,
,MM, -
optMM. 1
=>NN 
optNN 
.NN 
MapFromNN 
(NN 
srcNN "
=>NN# %
srcNN& )
.NN) *
ApplicationUserNN* 9
.NN9 :
FullNameNN: B
)NNB C
)NNC D
.OO 
	ForMemberOO 
(OO 
destOO 
=>OO 
destOO #
.OO# $
EmailOO$ )
,OO) *
optOO+ .
=>PP 
optPP 
.PP 
MapFromPP 
(PP 
srcPP "
=>PP# %
srcPP& )
.PP) *
ApplicationUserPP* 9
.PP9 :
EmailPP: ?
)PP? @
)PP@ A
.QQ 
	ForMemberQQ 
(QQ 
destQQ 
=>QQ 
destQQ #
.QQ# $
PhoneNumberQQ$ /
,QQ/ 0
optQQ1 4
=>RR 
optRR 
.RR 
MapFromRR 
(RR 
srcRR "
=>RR# %
srcRR& )
.RR) *
ApplicationUserRR* 9
.RR9 :
PhoneNumberRR: E
)RRE F
)RRF G
.SS 
	ForMemberSS 
(SS 
destSS 
=>SS 
destSS #
.SS# $
GenderSS$ *
,SS* +
optSS, /
=>TT 
optTT 
.TT 
MapFromTT 
(TT 
srcTT "
=>TT# %
srcTT& )
.TT) *
ApplicationUserTT* 9
.TT9 :
GenderTT: @
)TT@ A
)TTA B
.UU 
	ForMemberUU 
(UU 
destUU 
=>UU 
destUU #
.UU# $
	BirthDateUU$ -
,UU- .
optUU/ 2
=>VV 
optVV 
.VV 
MapFromVV 
(VV 
srcVV "
=>VV# %
srcVV& )
.VV) *
ApplicationUserVV* 9
.VV9 :
	BirthDateVV: C
)VVC D
)VVD E
.WW 
	ForMemberWW 
(WW 
destWW 
=>WW 
destWW #
.WW# $
CountryWW$ +
,WW+ ,
optWW- 0
=>XX 
optXX 
.XX 
MapFromXX 
(XX 
srcXX "
=>XX# %
srcXX& )
.XX) *
ApplicationUserXX* 9
.XX9 :
CountryXX: A
)XXA B
)XXB C
.YY 
	ForMemberYY 
(YY 
destYY 
=>YY 
destYY #
.YY# $
AddressYY$ +
,YY+ ,
optYY- 0
=>ZZ 
optZZ 
.ZZ 
MapFromZZ 
(ZZ 
srcZZ "
=>ZZ# %
srcZZ& )
.ZZ) *
ApplicationUserZZ* 9
.ZZ9 :
AddressZZ: A
)ZZA B
)ZZB C
.[[ 
	ForMember[[ 
([[ 
dest[[ 
=>[[ 
dest[[ #
.[[# $
Degree[[$ *
,[[* +
opt[[, /
=>\\ 
opt\\ 
.\\ 
MapFrom\\ 
(\\ 
src\\ "
=>\\# %
src\\& )
.\\) *
Degree\\* 0
)\\0 1
)\\1 2
.]] 
	ForMember]] 
(]] 
dest]] 
=>]] 
dest]] #
.]]# $
Industry]]$ ,
,]], -
opt]]. 1
=>^^ 
opt^^ 
.^^ 
MapFrom^^ 
(^^ 
src^^ "
=>^^# %
src^^& )
.^^) *
Industry^^* 2
)^^2 3
)^^3 4
.__ 
	ForMember__ 
(__ 
dest__ 
=>__ 
dest__ #
.__# $
	TaxNumber__$ -
,__- .
opt__/ 2
=>`` 
opt`` 
.`` 
MapFrom`` 
(`` 
src`` "
=>``# %
src``& )
.``) *
ApplicationUser``* 9
.``9 :
	TaxNumber``: C
)``C D
)``D E
.aa 
	ForMemberaa 
(aa 
destaa 
=>aa 
destaa #
.aa# $

IsAcceptedaa$ .
,aa. /
optaa0 3
=>bb 
optbb 
.bb 
MapFrombb 
(bb 
srcbb "
=>bb# %
srcbb& )
.bb) *

IsAcceptedbb* 4
)bb4 5
)bb5 6
.cc 

ReverseMapcc 
(cc 
)cc 
;cc 
	CreateMapee 
<ee 
InstructorCommentee #
,ee# $
GetAllCommentsDTOee% 6
>ee6 7
(ee7 8
)ee8 9
.ee9 :

ReverseMapee: D
(eeD E
)eeE F
;eeF G
	CreateMapff 
<ff 
InstructorCommentff #
,ff# $&
CreateInstructorCommentDTOff% ?
>ff? @
(ff@ A
)ffA B
.ffB C

ReverseMapffC M
(ffM N
)ffN O
;ffO P
	CreateMapgg 
<gg 
InstructorCommentgg #
,gg# $&
UpdateInstructorCommentDTOgg% ?
>gg? @
(gg@ A
)ggA B
.ggB C

ReverseMapggC M
(ggM N
)ggN O
;ggO P
	CreateMapjj 
<jj 
CourseVersionjj 
,jj  
GetCourseVersionDTOjj! 4
>jj4 5
(jj5 6
)jj6 7
.kk 
	ForMemberkk 
(kk 
destkk 
=>kk 
destkk #
.kk# $
CategoryNamekk$ 0
,kk0 1
optkk2 5
=>kk6 8
optkk9 <
.kk< =
MapFromkk= D
(kkD E
srckkE H
=>kkI K
srckkL O
.kkO P
CategorykkP X
.kkX Y
NamekkY ]
)kk] ^
)kk^ _
.ll 
	ForMemberll 
(ll 
destll 
=>ll 
destll #
.ll# $
	LevelNamell$ -
,ll- .
optll/ 2
=>ll3 5
optll6 9
.ll9 :
MapFromll: A
(llA B
srcllB E
=>llF H
srcllI L
.llL M
LevelllM R
.llR S
NamellS W
)llW X
)llX Y
;llY Z
	CreateMapnn 
<nn 
CourseVersionStatusnn %
,nn% &%
GetCourseVersionStatusDTOnn' @
>nn@ A
(nnA B
)nnB C
.nnC D

ReverseMapnnD N
(nnN O
)nnO P
;nnP Q
	CreateMappp 
<pp  
CourseVersionCommentpp &
,pp& '
GetCourseCommnetDTOpp( ;
>pp; <
(pp< =
)pp= >
.qq 
	ForMemberqq 
(qq 
destqq 
=>qq 
destqq #
.qq# $
CourseVersionIdqq$ 3
,qq3 4
optqq5 8
=>qq9 ;
optqq< ?
.qq? @
MapFromqq@ G
(qqG H
srcqqH K
=>qqL N
srcqqO R
.qqR S
CourseVersionIdqqS b
)qqb c
)qqc d
.rr 
	ForMemberrr 
(rr 
destrr 
=>rr 
destrr #
.rr# $
Commentrr$ +
,rr+ ,
optrr- 0
=>rr1 3
optrr4 7
.rr7 8
MapFromrr8 ?
(rr? @
srcrr@ C
=>rrD F
srcrrG J
.rrJ K
CommentrrK R
)rrR S
)rrS T
.ss 
	ForMemberss 
(ss 
destss 
=>ss 
destss #
.ss# $
CreateByss$ ,
,ss, -
optss. 1
=>ss2 4
optss5 8
.ss8 9
MapFromss9 @
(ss@ A
srcssA D
=>ssE G
srcssH K
.ssK L
CreateByssL T
)ssT U
)ssU V
.tt 
	ForMembertt 
(tt 
desttt 
=>tt 
desttt #
.tt# $

CreateTimett$ .
,tt. /
opttt0 3
=>tt4 6
opttt7 :
.tt: ;
MapFromtt; B
(ttB C
srcttC F
=>ttG I
srcttJ M
.ttM N

CreateTimettN X
)ttX Y
)ttY Z
.uu 
	ForMemberuu 
(uu 
destuu 
=>uu 
destuu #
.uu# $
UpdateByuu$ ,
,uu, -
optuu. 1
=>uu2 4
optuu5 8
.uu8 9
MapFromuu9 @
(uu@ A
srcuuA D
=>uuE G
srcuuH K
.uuK L
UpdateByuuL T
)uuT U
)uuU V
.vv 
	ForMembervv 
(vv 
destvv 
=>vv 
destvv #
.vv# $

UpdateTimevv$ .
,vv. /
optvv0 3
=>vv4 6
optvv7 :
.vv: ;
MapFromvv; B
(vvB C
srcvvC F
=>vvG I
srcvvJ M
.vvM N

UpdateTimevvN X
)vvX Y
)vvY Z
.ww 
	ForMemberww 
(ww 
destww 
=>ww 
destww #
.ww# $
Statusww$ *
,ww* +
optww, /
=>ww0 2
optww3 6
.ww6 7
MapFromww7 >
(ww> ?
srcww? B
=>wwC E
srcwwF I
.wwI J
StatuswwJ P
)wwP Q
)wwQ R
.xx 

ReverseMapxx 
(xx 
)xx 
;xx 
	CreateMap{{ 
<{{ 
Course{{ 
,{{ 
GetCourseInfoDTO{{ *
>{{* +
({{+ ,
){{, -
.{{- .

ReverseMap{{. 8
({{8 9
){{9 :
;{{: ;
	CreateMap|| 
<|| 
Level|| 
,|| 
GetLevelDTO|| $
>||$ %
(||% &
)||& '
.||' (

ReverseMap||( 2
(||2 3
)||3 4
;||4 5
}~~ 
} §
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ITokenService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ITokenService 
{ 
Task 
< 	
string	 
> '
GenerateJwtAccessTokenAsync ,
(, -
ApplicationUser- <
user= A
)A B
;B C
Task		 
<		 	
string			 
>		 (
GenerateJwtRefreshTokenAsync		 -
(		- .
ApplicationUser		. =
user		> B
)		B C
;		C D
Task

 
<

 	
bool

	 
>

 
StoreRefreshToken

  
(

  !
string

! '
userId

( .
,

. /
string

0 6
refreshToken

7 C
)

C D
;

D E
Task 
< 	
ClaimsPrincipal	 
> !
GetPrincipalFromToken /
(/ 0
string0 6
token7 <
)< =
;= >
Task 
< 	
string	 
>  
RetrieveRefreshToken %
(% &
string& ,
userId- 3
)3 4
;4 5
Task 
< 	
bool	 
> 
DeleteRefreshToken !
(! "
string" (
userId) /
)/ 0
;0 1
} Æ
wD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ISectionDetailsVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface )
ISectionDetailsVersionService .
{ 
Task		 
<		 	
ResponseDTO			 
>		 '
CloneSectionsDetailsVersion		 1
(

 
ClaimsPrincipal 
User 
, *
CloneSectionsDetailsVersionDTO &*
cloneSectionsDetailsVersionDto' E
) 
; 
Task 
< 	
ResponseDTO	 
> &
GetSectionsDetailsVersions 0
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseSectionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> $
GetSectionDetailsVersion .
( 
ClaimsPrincipal 
User 
, 
Guid "
	detailsId# ,
) 
; 
Task   
<   	
ResponseDTO  	 
>   '
CreateSectionDetailsVersion   1
(!! 
ClaimsPrincipal"" 
User"" 
,"" *
CreateSectionDetailsVersionDTO## &*
createSectionDetailsVersionDto##' E
)$$ 
;$$ 
Task&& 
<&& 	
ResponseDTO&&	 
>&& %
EditSectionDetailsVersion&& /
('' 
ClaimsPrincipal(( 
User(( 
,(( (
EditSectionDetailsVersionDTO)) $(
editSectionDetailsVersionDto))% A
)** 
;** 
Task,, 
<,, 	
ResponseDTO,,	 
>,, '
RemoveSectionDetailsVersion,, 1
(-- 
ClaimsPrincipal.. 
User.. 
,.. 
Guid// 
	detailsId// 
)00 
;00 
Task22 
<22 	
ResponseDTO22	 
>22 .
"UploadSectionDetailsVersionContent22 8
(33 
ClaimsPrincipal44 
User44 
,44 
Guid55 
	detailsId55 
,55 1
%UploadSectionDetailsVersionContentDTO66 -1
%uploadSectionDetailsVersionContentDto66. S
)77 
;77 
Task99 
<99 	
ContentResponseDTO99	 
>99 /
#DisplaySectionDetailsVersionContent99 @
(:: 
ClaimsPrincipal;; 
User;; 
,;; 
Guid<< #
sectionDetailsVersionId<< $
,<<$ %
string== 
type== 
)>> 
;>> 
}?? ´
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IRedisService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IRedisService 
{ 
Task 
< 	
bool	 
> 
StoreString 
( 
string !
key" %
,% &
string' -
value. 3
)3 4
;4 5
Task 
< 	
string	 
> 
RetrieveString 
(  
string  &
key' *
)* +
;+ ,
Task 
< 	
bool	 
> 
DeleteString 
( 
string "
key# &
)& '
;' (
} ˆ
nD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\INotificationService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface  
INotificationService %
{ 
} Â
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ILevelService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ILevelService 
{ 
Task 
< 	
ResponseDTO	 
> 
	GetLevels 
(		 
ClaimsPrincipal

 
User

 
,

 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
= 
$num 
, 
int 
pageSize 
= 
$num 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetLevel 
( 
ClaimsPrincipal .
User/ 3
,3 4
Guid5 9
levelId: A
)A B
;B C
Task 
< 	
ResponseDTO	 
> 
CreateLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
CreateLevelDTO8 F
createLevelDtoG U
)U V
;V W
Task 
< 	
ResponseDTO	 
> 
UpdateLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
UpdateLevelDTO8 F
updateLevelDtoG U
)U V
;V W
Task 
< 	
ResponseDTO	 
> 
DeleteLevel !
(! "
ClaimsPrincipal" 1
User2 6
,6 7
Guid8 <
levelId= D
)D E
;E F
} Ú 
lD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IInstructorService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IInstructorService #
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetById 
( 
Guid "
id# %
)% &
;& '
Task 
< 	
ResponseDTO	 
> 

UpdateById  
(  !
UpdateInstructorDTO! 4
updateInstructorDto5 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> 
AcceptInstructor &
(& '
ClaimsPrincipal' 6
User7 ;
,; <
Guid= A
idB D
)D E
;E F
Task 
< 	
ResponseDTO	 
> 
RejectInstructor &
(& '
ClaimsPrincipal' 6
User7 ;
,; <
Guid= A
idB D
)D E
;E F
Task 
< 	
ResponseDTO	 
> %
GetInstructorTotalCourses /
(/ 0
Guid0 4
instructorId5 A
)A B
;B C
Task 
< 	
ResponseDTO	 
> $
GetInstructorTotalRating .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> $
GetInstructorEarnedMoney .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> $
GetInstructorPayoutMoney .
(. /
Guid/ 3
instructorId4 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> #
GetAllInstructorComment -
(- .
Guid. 2
instructorId3 ?
,? @
intA D

pageNumberE O
,O P
intQ T
pageSizeU ]
)] ^
;^ _
Task 
< 	
ResponseDTO	 
> #
CreateInstructorComment -
(- .
ClaimsPrincipal. =
User> B
,B C&
CreateInstructorCommentDTOD ^#
createInstructorComment_ v
)v w
;w x
Task 
< 	
ResponseDTO	 
> #
UpdateInstructorComment -
(- .
ClaimsPrincipal. =
User> B
,B C&
UpdateInstructorCommentDTOD ^#
updateInstructorComment_ v
)v w
;w x
Task   
<   	
ResponseDTO  	 
>   #
DeleteInstructorComment   -
(  - .
Guid  . 2
	commentId  3 <
)  < =
;  = >
Task!! 
<!! 	
ResponseDTO!!	 
>!! 
ExportInstructors!! '
(!!' (
string!!( .
userId!!/ 5
,!!5 6
int!!7 :
month!!; @
,!!@ A
int!!B E
year!!F J
)!!J K
;!!K L
Task"" 
<"" 	 
ClosedXMLResponseDTO""	 
>"" 
DownloadInstructors"" 2
(""2 3
string""3 9
fileName"": B
)""B C
;""C D
}## ‘
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IFirebaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IFirebaseService !
{ 
Task		 
<		 	
ResponseDTO			 
>		 
UploadImage		 !
(		! "
	IFormFile		" +
file		, 0
,		0 1
string		2 8
folder		9 ?
)		? @
;		@ A
Task

 
<

 	
MemoryStream

	 
>

 
GetImage

 
(

  
string

  &
filePath

' /
)

/ 0
;

0 1
Task 
< 	
ResponseDTO	 
> 
UploadVideo !
(! "
	IFormFile" +
file, 0
,0 1
Guid2 6
?6 7
courseId8 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> 
UploadSlide !
(! "
	IFormFile" +
file, 0
,0 1
Guid2 6
?6 7
courseId8 @
)@ A
;A B
Task 
< 	
ResponseDTO	 
> 
	UploadDoc 
(  
	IFormFile  )
file* .
,. /
Guid0 4
?4 5
courseId6 >
)> ?
;? @
Task 
< 	
MemoryStream	 
> 

GetContent !
(! "
string" (
?( )
filePath* 2
)2 3
;3 4
} ≈
gD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IEmailService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IEmailService 
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
bool	 
> 
SendEmailAsync 
( 
string $
toEmail% ,
,, -
string. 4
subject5 <
,< =
string> D
bodyE I
)I J
;J K
Task 
< 	
bool	 
> (
SendEmailInactiveCourseAsync +
(+ ,
string, 2
instructorEmail3 B
,B C
stringD J
studentEmailK W
,W X
stringY _
subject` g
,g h
stringi o
bodyp t
)t u
;u v
Task 
< 	
bool	 
> 
SendEmailResetAsync "
(" #
string# )
toEmail* 1
,1 2
string3 9
subject: A
,A B
ApplicationUserC R
userS W
,W X
stringY _
currentDate` k
,k l
string 
	resetLink 
, 
string 
operatingSystem 
, 
string  &
browser' .
,. /
string0 6
ip7 9
,9 :
string; A
regionB H
,H I
stringJ P
cityQ U
,U V
stringW ]
country^ e
)e f
;f g
Task 
< 	
bool	 
> +
SendEmailForAdminAboutNewCourse .
(. /
string/ 5
toMail6 <
)< =
;= >
Task 
< 	
bool	 
> 7
+SendApproveEmailForInstructorAboutNewCourse :
(: ;
string; A
toMailB H
)H I
;I J
Task 
< 	
bool	 
> 6
*SendRejectEmailForInstructorAboutNewCourse 9
(9 :
string: @
toMailA G
)G H
;H I
Task 
< 	
bool	 
> 
SendVerifyEmail 
( 
string %
toMail& ,
,, -
string. 4
confirmationLink5 E
)E F
;F G
Task 
< 	
bool	 
> #
SendEmailInactiveCourse &
(& '
string' -
instructorEmail. =
,= >
string? E
instructorNameF T
,T U
stringV \
courseTitle] h
,h i
Listj n
<n o
stringo u
>u v
studentEmails	w Ñ
)
Ñ Ö
;
Ö Ü
} Æ
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IEmailSender.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IEmailSender 
{ 
Task -
!SendSubmittedCourseEmailForAdmins	 *
(* +
)+ ,
;, -
Task 0
$SendRejectedCourseEmailForInstructor	 -
(- .
Guid. 2
courseVersionId3 B
)B C
;C D
Task 0
$SendAcceptedCourseEmailForInstructor	 -
(- .
Guid. 2
courseVersionId3 B
)B C
;C D
Task 1
%SendDeactivatedCourseEmailForStudents	 .
(. /
Guid/ 3
courseId4 <
)< =
;= >
}		 ·
uD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseVersionStatusService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface '
ICourseVersionStatusService ,
{ 
Task		 
<		 	
ResponseDTO			 
>		 #
GetCourseVersionsStatus		 -
(

 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> "
GetCourseVersionStatus ,
( 
ClaimsPrincipal 
User 
, 
Guid !
courseVersionStatusId "
) 
; 
Task 
< 	
ResponseDTO	 
> %
CreateCourseVersionStatus /
( 
ClaimsPrincipal 
User 
, (
CreateCourseVersionStatusDTO $"
courseVersionStatusDto% ;
) 
; 
}   Ë-
oD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface !
ICourseVersionService &
{ 
Task 
< 	
ResponseDTO	 
> 
GetCourseVersions '
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int   
pageSize   
)!! 
;!! 
Task** 
<** 	
ResponseDTO**	 
>** 
GetCourseVersion** &
(++ 
ClaimsPrincipal,, 
User,, 
,,, 
Guid-- 
courseVersionId-- 
).. 
;.. 
Task66 
<66 	
ResponseDTO66	 
>66 "
CreateCourseAndVersion66 ,
(77 
ClaimsPrincipal88 
User88 
,88 (
CreateNewCourseAndVersionDTO99 $(
createNewCourseAndVersionDto99% A
):: 
;:: 
TaskCC 
<CC 	
ResponseDTOCC	 
>CC 
CloneCourseVersionCC (
(DD 
ClaimsPrincipalEE 
UserEE 
,EE !
CloneCourseVersionDTOFF !
cloneCourseVersionDtoFF 3
)GG 
;GG 
TaskII 
<II 	
ResponseDTOII	 
>II 
RemoveCourseVersionII )
(II) *
ClaimsPrincipalII* 9
UserII: >
,II> ?
GuidII@ D
courseVersionIdIIE T
)IIT U
;IIU V
TaskJJ 
<JJ 	
ResponseDTOJJ	 
>JJ 
EditCourseVersionJJ '
(JJ' (
ClaimsPrincipalJJ( 7
UserJJ8 <
,JJ< = 
EditCourseVersionDTOJJ> R 
editCourseVersionDtoJJS g
)JJg h
;JJh i
TaskKK 
<KK 	
ResponseDTOKK	 
>KK 
AcceptCourseVersionKK )
(KK) *
ClaimsPrincipalKK* 9
UserKK: >
,KK> ?
GuidKK@ D
courseVersionIdKKE T
)KKT U
;KKU V
TaskLL 
<LL 	
ResponseDTOLL	 
>LL 
RejectCourseVersionLL )
(LL) *
ClaimsPrincipalLL* 9
UserLL: >
,LL> ?
GuidLL@ D
courseVersionIdLLE T
)LLT U
;LLU V
TaskMM 
<MM 	
ResponseDTOMM	 
>MM 
SubmitCourseVersionMM )
(MM) *
ClaimsPrincipalMM* 9
UserMM: >
,MM> ?
GuidMM@ D
courseVersionIdMME T
)MMT U
;MMU V
TaskNN 
<NN 	
ResponseDTONN	 
>NN 
MergeCourseVersionNN (
(NN( )
ClaimsPrincipalNN) 8
UserNN9 =
,NN= >
GuidNN? C
courseVersionIdNND S
)NNS T
;NNT U
TaskPP 
<PP 	
ResponseDTOPP	 
>PP %
GetCourseVersionsCommentsPP /
(QQ 
ClaimsPrincipalRR 
UserRR 
,RR 
GuidSS 
?SS 
courseVersionIdSS 
,SS 
stringTT 
?TT 
filterOnTT 
,TT 
stringUU 
?UU 
filterQueryUU 
,UU 
stringVV 
?VV 
sortByVV 
,VV 
intWW 

pageNumberWW 
,WW 
intXX 
pageSizeXX 
)YY 
;YY 
Task[[ 
<[[ 	
ResponseDTO[[	 
>[[ #
GetCourseVersionComment[[ -
(\\ 
ClaimsPrincipal]] 
User]] 
,]] 
Guid^^ "
courseVersionCommentId^^ #
)__ 
;__ 
Taskaa 
<aa 	
ResponseDTOaa	 
>aa &
CreateCourseVersionCommentaa 0
(bb 
ClaimsPrincipalcc 
Usercc 
,cc *
CreateCourseVersionCommentsDTOdd &*
createCourseVersionCommentsDTOdd' E
)ee 
;ee 
Taskgg 
<gg 	
ResponseDTOgg	 
>gg $
EditCourseVersionCommentgg .
(hh 
ClaimsPrincipalii 
Userii 
,ii (
EditCourseVersionCommentsDTOjj $(
editCourseVersionCommentsDTOjj% A
)kk 
;kk 
Taskmm 
<mm 	
ResponseDTOmm	 
>mm &
RemoveCourseVersionCommentmm 0
(nn 
ClaimsPrincipaloo 
Useroo 
,oo 
Guidpp 
	commentIdpp 
)qq 
;qq 
Taskss 
<ss 	
ResponseDTOss	 
>ss ,
 UploadCourseVersionBackgroundImgss 6
(tt 
ClaimsPrincipaluu 
Useruu 
,uu 
Guidvv 
courseVersionIdvv 
,vv ,
 UploadCourseVersionBackgroundImgww (,
 uploadCourseVersionBackgroundImgww) I
)xx 
;xx 
Taskzz 
<zz 	
MemoryStreamzz	 
>zz -
!DisplayCourseVersionBackgroundImgzz 8
({{ 
ClaimsPrincipal|| 
User|| 
,|| 
Guid}} 
courseVersionId}} 
)~~ 
;~~ 
} Ô
hD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ICourseService 
{ 
Task 
< 	
ResponseDTO	 
> 
CreateFrameCourse '
(' (
ClaimsPrincipal( 7
User8 <
,< =
Guid> B
courseVersionIdC R
)R S
;S T
Task 
< 	
ResponseDTO	 
> 

GetCourses  
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
instructorId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
double 
? 
	fromPrice 
, 
double 
? 
toPrice 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
	GetCourse 
( 
ClaimsPrincipal   
User   
,   
Guid!! 
courseId!! 
)"" 
;"" 
Task$$ 
<$$ 	
ResponseDTO$$	 
>$$ 
GetCourseInfo$$ #
(%% 
ClaimsPrincipal&& 
User&& 
,&& 
Guid'' 
courseId'' 
)(( 
;(( 
Task** 
<** 	
ResponseDTO**	 
>** 
ActivateCourse** $
(++ 
ClaimsPrincipal,, 
User,, 
,,, 
Guid-- 
courseId-- 
).. 
;.. 
Task00 
<00 	
ResponseDTO00	 
>00 
DeactivateCourse00 &
(11 
ClaimsPrincipal22 
User22 
,22 
Guid33 
courseId33 
)44 
;44 
}55 „
vD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICourseSectionVersionService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface (
ICourseSectionVersionService -
{ 
Task 
< 	
ResponseDTO	 
> %
CloneCourseSectionVersion /
(		 
ClaimsPrincipal

 
User

 
,

 (
CloneCourseSectionVersionDTO $(
cloneCourseSectionVersionDto% A
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetCourseSections '
( 
ClaimsPrincipal 
User 
, 
Guid 
? 
courseVersionId 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetCourseSection &
( 
ClaimsPrincipal 
User 
, 
Guid 
courseVersionId 
) 
; 
Task 
< 	
ResponseDTO	 
> 
CreateCourseSection )
( 
ClaimsPrincipal   
User   
,   )
CreateCourseSectionVersionDTO!! %)
createCourseSectionVersionDTO!!& C
)"" 
;"" 
Task## 
<## 	
ResponseDTO##	 
>## 
EditCourseSection## '
($$ 
ClaimsPrincipal%% 
User%% 
,%% '
EditCourseSectionVersionDTO&& #'
editCourseSectionVersionDTO&&$ ?
)'' 
;'' 
Task(( 
<(( 	
ResponseDTO((	 
>(( 
RemoveCourseSection(( )
()) 
ClaimsPrincipal** 
User** 
,** 
Guid++ 
sectionVersionId++ 
),, 
;,, 
}-- Û
kD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IClosedXMLService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IClosedXMLService "
{ 
Task 
< 	
string	 
> !
ExportInstructorExcel &
(& '
List' +
<+ ,
InstructorInfoDTO, =
>= >
instructorInfoDtos? Q
)Q R
;R S
}		 –
jD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\ICategoryService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
ICategoryService !
{ 
Task		 
<		 	
ResponseDTO			 
>		 
GetAll		 
(

 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
Search 
( 
ClaimsPrincipal 
User 
, 
string 
? 
filterOn 
, 
string 
? 
filterQuery 
, 
string 
? 
sortBy 
, 
bool 
? 
isAscending 
, 
int 

pageNumber 
, 
int 
pageSize 
) 
; 
Task 
< 	
ResponseDTO	 
> 
GetSubCategory $
($ %
Guid% )
id* ,
), -
;- .
Task   
<   	
ResponseDTO  	 
>   
GetParentCategory   '
(  ' (
Guid  ( ,
id  - /
)  / 0
;  0 1
Task!! 
<!! 	
ResponseDTO!!	 
>!! 
Get!! 
(!! 
ClaimsPrincipal!! )
User!!* .
,!!. /
Guid!!0 4
id!!5 7
)!!7 8
;!!8 9
Task"" 
<"" 	
ResponseDTO""	 
>"" 
CreateCategory"" $
(""$ %
ClaimsPrincipal""% 4
User""5 9
,""9 :
CreateCategoryDTO""; L
createCategoryDto""M ^
)""^ _
;""_ `
Task## 
<## 	
ResponseDTO##	 
>## 
Update## 
(## 
ClaimsPrincipal## ,
User##- 1
,##1 2
UpdateCategoryDTO##3 D
updateCategoryDto##E V
)##V W
;##W X
Task$$ 
<$$ 	
ResponseDTO$$	 
>$$ 
Delete$$ 
($$ 
ClaimsPrincipal$$ ,
User$$- 1
,$$1 2
Guid$$3 7
id$$8 :
)$$: ;
;$$; <
}%% ¯
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IBaseService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IBaseService 
{ 
Task 
< 	
ResponseDTO	 
? 
> 
	SendAsync  
(  !

RequestDTO! +

requestDto, 6
,6 7
string8 >
?> ?
apiKey@ F
)F G
;G H
} µ(
fD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\IService\IAuthService.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
IService %
;% &
public 
	interface 
IAuthService 
{ 
Task		 
<		 	
ResponseDTO			 
>		 
SignUpStudent		 #
(		# $
RegisterStudentDTO		$ 6
registerStudentDTO		7 I
)		I J
;		J K
Task

 
<

 	
ResponseDTO

	 
>

 
SignUpInstructor

 &
(

& '
SignUpInstructorDTO

' :
signUpInstructorDto

; N
)

N O
;

O P
Task 
< 	
ResponseDTO	 
> "
UploadInstructorDegree ,
(, -
	IFormFile- 6
file7 ;
,; <
ClaimsPrincipal= L
userM Q
)Q R
;R S
Task 
< 	
ResponseDTO	 
> 
UploadUserAvatar &
(& '
	IFormFile' 0
file1 5
,5 6
ClaimsPrincipal7 F
userG K
)K L
;L M
Task 
< 	
DegreeResponseDTO	 
> 
GetInstructorDegree /
(/ 0
ClaimsPrincipal0 ?
user@ D
)D E
;E F
Task 
< 	
MemoryStream	 
> 
GetUserAvatar $
($ %
ClaimsPrincipal% 4
user5 9
)9 :
;: ;
Task 
< 	
ResponseDTO	 
> 
SignIn 
( 
SignDTO $
signDTO% ,
), -
;- .
Task 
< 	
ResponseDTO	 
> 
ForgotPassword $
($ %
ForgotPasswordDTO% 6
forgotPasswordDto7 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> 
Refresh 
( 
string $
token% *
)* +
;+ ,
Task 
< 	
ResponseDTO	 
> 
ResetPassword #
(# $
string$ *
resetPasswordDto+ ;
,; <
string= C
tokenD I
,I J
stringK Q
passwordR Z
)Z [
;[ \
Task 
< 	
ResponseDTO	 
> 
ChangePassword $
($ %
string% +
userId, 2
,2 3
string4 :
oldPassword; F
,F G
stringH N
newPasswordO Z
,Z [
string\ b
confirmNewPasswordc u
)u v
;v w
Task 
< 	
ResponseDTO	 
> 
SendVerifyEmail %
(% &
string& ,
email- 2
,2 3
string4 :
confirmationLink; K
)K L
;L M
Task 
< 	
ResponseDTO	 
> 
VerifyEmail !
(! "
string" (
userId) /
,/ 0
string1 7
token8 =
)= >
;> ?
Task 
< 	
ResponseDTO	 
> 
CheckEmailExist %
(% &
string& ,
email- 2
)2 3
;3 4
Task 
< 	
ResponseDTO	 
> !
CheckPhoneNumberExist +
(+ ,
string, 2
phoneNumber3 >
)> ?
;? @
Task 
< 	
ResponseDTO	 
> 
SignInByGoogle $
($ %
SignInByGoogleDTO% 6
signInByGoogleDto7 H
)H I
;I J
Task 
< 	
ResponseDTO	 
> "
CompleteStudentProfile ,
(, -
ClaimsPrincipal- <
User= A
,A B%
CompleteStudentProfileDTOC \
studentProfileDto] n
)n o
;o p
Task 
< 	
ResponseDTO	 
> %
CompleteInstructorProfile /
(/ 0
ClaimsPrincipal0 ?
User@ D
,D E(
CompleteInstructorProfileDTOF b 
instructorProfileDtoc w
)w x
;x y
Task 
< 	
ResponseDTO	 
> 
GetUserInfo !
(! "
ClaimsPrincipal" 1
User2 6
)6 7
;7 8
Task 
< 	
MemoryStream	 
> 
DisplayUserAvatar (
(( )
string) /
userId0 6
)6 7
;7 8
Task 
< 	
DegreeResponseDTO	 
> #
DisplayInstructorDegree 3
(3 4
string4 :
userId; A
)A B
;B C
} ∏
eD:\FPT\Semester 6\Project_Cursus\Backend_Cursus\Cursus.LMS\Cursus.LMS.Service\Hubs\NotificationHub.cs
	namespace 	
Cursus
 
. 
LMS 
. 
Service 
. 
Hubs !
;! "
[ 
	Authorize 

]
 
public 
class 
NotificationHub 
: 
Hub "
{ 
private		 
static		 
readonly		 

Dictionary		 &
<		& '
string		' -
,		- .
string		/ 5
>		5 6
_connections		7 C
=		D E
new		F I

Dictionary		J T
<		T U
string		U [
,		[ \
string		] c
>		c d
(		d e
)		e f
;		f g
public 

override 
Task 
OnConnectedAsync )
() *
)* +
{ 
string 
userId 
= 
Context 
.  
UserIdentifier  .
;. /
if 

( 
userId 
!= 
null 
) 
{ 	
_connections 
[ 
userId 
]  
=! "
Context# *
.* +
ConnectionId+ 7
;7 8
} 	
return 
base 
. 
OnConnectedAsync $
($ %
)% &
;& '
} 
public 

override 
Task 
OnDisconnectedAsync ,
(, -
	Exception- 6
	exception7 @
)@ A
{ 
string 
userId 
= 
Context 
.  
UserIdentifier  .
;. /
if 

( 
userId 
!= 
null 
) 
{ 	
_connections 
. 
Remove 
(  
userId  &
)& '
;' (
} 	
return 
base 
. 
OnDisconnectedAsync '
(' (
	exception( 1
)1 2
;2 3
} 
public 

Task 
SendMessageToUser !
(! "
string" (
userId) /
,/ 0
string1 7
message8 ?
)? @
{   
if!! 

(!! 
_connections!! 
.!! 
TryGetValue!! $
(!!$ %
userId!!% +
,!!+ ,
out!!- 0
var!!1 4
connectionId!!5 A
)!!A B
)!!B C
{"" 	
return## 
Clients## 
.## 
Client## !
(##! "
connectionId##" .
)##. /
.##/ 0
	SendAsync##0 9
(##9 :
$str##: J
,##J K
message##L S
)##S T
;##T U
}$$ 	
return%% 
Task%% 
.%% 
CompletedTask%% !
;%%! "
}&& 
}'' 